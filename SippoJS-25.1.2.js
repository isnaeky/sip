!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Sippo=t():e.Sippo=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=115)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function o(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))}},function(e,t,n){(function(i){var r;
/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */!function(s){var o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=void 0!==e.maxListeners?e.maxListeners:10,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=10}function u(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==i&&i.emitWarning){var r=new Error(n);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,i.emitWarning(r)}else console.error(n),console.trace&&console.trace()}function h(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}function l(e,t,n,i){if(!n)return[];var r,s,o,a,c,u,h,d=[],p=t.length,f=t[i],m=t[i+1];if(i===p&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,s=n._listeners.length;r<s;r++)e&&e.push(n._listeners[r]);return[n]}if("*"===f||"**"===f||n[f]){if("*"===f){for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&(d=d.concat(l(e,t,n[o],i+1)));return d}if("**"===f){for(o in(h=i+1===p||i+2===p&&"*"===m)&&n._listeners&&(d=d.concat(l(e,t,n,p))),n)"_listeners"!==o&&n.hasOwnProperty(o)&&("*"===o||"**"===o?(n[o]._listeners&&!h&&(d=d.concat(l(e,t,n[o],p))),d=d.concat(l(e,t,n[o],i))):d=o===m?d.concat(l(e,t,n[o],i+2)):d.concat(l(e,t,n[o],i)));return d}d=d.concat(l(e,t,n[f],i+1))}if((a=n["*"])&&l(e,t,a,i+1),c=n["**"])if(i<p)for(o in c._listeners&&l(e,t,c,p),c)"_listeners"!==o&&c.hasOwnProperty(o)&&(o===m?l(e,t,c[o],i+2):o===f?l(e,t,c[o],i+1):((u={})[o]=c[o],l(e,t,{"**":u},i+1)));else c._listeners?l(e,t,c,p):c["*"]&&c["*"]._listeners&&l(e,t,c["*"],p);return d}function d(e,t){for(var n=0,i=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;n+1<i;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var r=this.listenerTree,s=e.shift();void 0!==s;){if(r[s]||(r[s]={}),r=r[s],0===e.length)return r._listeners?("function"==typeof r._listeners&&(r._listeners=[r._listeners]),r._listeners.push(t),!r._listeners.warned&&this._maxListeners>0&&r._listeners.length>this._maxListeners&&(r._listeners.warned=!0,u.call(this,r._listeners.length,s))):r._listeners=t,!0;s=e.shift()}return!0}h.EventEmitter2=h,h.prototype.delimiter=".",h.prototype.setMaxListeners=function(e){void 0!==e&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},h.prototype.event="",h.prototype.once=function(e,t){return this._once(e,t,!1)},h.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},h.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},h.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},h.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},h.prototype._many=function(e,t,n,i){var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function s(){return 0==--t&&r.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,i),r},h.prototype.emit=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,n,i,r,s,o=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),o>3)for(t=new Array(o),r=0;r<o;r++)t[r]=arguments[r];for(i=0,n=s.length;i<n;i++)switch(this.event=e,o){case 1:s[i].call(this,e);break;case 2:s[i].call(this,e,arguments[1]);break;case 3:s[i].call(this,e,arguments[1],arguments[2]);break;default:s[i].apply(this,t)}}if(this.wildcard){s=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();l.call(this,s,c,this.listenerTree,0)}else{if("function"==typeof(s=this._events[e])){switch(this.event=e,o){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),r=1;r<o;r++)t[r-1]=arguments[r];s.apply(this,t)}return!0}s&&(s=s.slice())}if(s&&s.length){if(o>3)for(t=new Array(o-1),r=1;r<o;r++)t[r-1]=arguments[r];for(i=0,n=s.length;i<n;i++)switch(this.event=e,o){case 1:s[i].call(this);break;case 2:s[i].call(this,arguments[1]);break;case 3:s[i].call(this,arguments[1],arguments[2]);break;default:s[i].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},h.prototype.emitAsync=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,i,r,s,o=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),r=1;r<c;r++)t[r]=arguments[r];for(i=0,n=this._all.length;i<n;i++)switch(this.event=e,c){case 1:o.push(this._all[i].call(this,e));break;case 2:o.push(this._all[i].call(this,e,arguments[1]));break;case 3:o.push(this._all[i].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[i].apply(this,t))}}if(this.wildcard){s=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();l.call(this,s,u,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s)switch(this.event=e,c){case 1:o.push(s.call(this));break;case 2:o.push(s.call(this,arguments[1]));break;case 3:o.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),r=1;r<c;r++)t[r-1]=arguments[r];o.push(s.apply(this,t))}else if(s&&s.length){if(s=s.slice(),c>3)for(t=new Array(c-1),r=1;r<c;r++)t[r-1]=arguments[r];for(i=0,n=s.length;i<n;i++)switch(this.event=e,c){case 1:o.push(s[i].call(this));break;case 2:o.push(s[i].call(this,arguments[1]));break;case 3:o.push(s[i].call(this,arguments[1],arguments[2]));break;default:o.push(s[i].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},h.prototype.on=function(e,t){return this._on(e,t,!1)},h.prototype.prependListener=function(e,t){return this._on(e,t,!0)},h.prototype.onAny=function(e){return this._onAny(e,!1)},h.prototype.prependAny=function(e){return this._onAny(e,!0)},h.prototype.addListener=h.prototype.on,h.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},h.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||a.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(d.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=t,this)},h.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,i=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();i=l.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var s=0;s<i.length;s++){var a=i[s];if(n=a._listeners,o(n)){for(var c=-1,u=0,h=n.length;u<h;u++)if(n[u]===t||n[u].listener&&n[u].listener===t||n[u]._origin&&n[u]._origin===t){c=u;break}if(c<0)continue;return this.wildcard?a._listeners.splice(c,1):this._events[e].splice(c,1),0===n.length&&(this.wildcard?delete a._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete a._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(void 0!==t){var n=Object.keys(t);for(var i in n){var r=n[i],s=t[r];s instanceof Function||"object"!=typeof s||null===s||(Object.keys(s).length>0&&e(t[r]),0===Object.keys(s).length&&delete t[r])}}}(this.listenerTree),this},h.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},h.prototype.removeListener=h.prototype.off,h.prototype.removeAllListeners=function(e){if(void 0===e)return!this._events||a.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=l.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){n[i]._listeners=null}else this._events&&(this._events[e]=null);return this},h.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return l.call(this,t,n,this.listenerTree,0),t}return this._events||a.call(this),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},h.prototype.eventNames=function(){return Object.keys(this._events)},h.prototype.listenerCount=function(e){return this.listeners(e).length},h.prototype.listenersAny=function(){return this._all?this._all:[]},void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(14))},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return V})),n.d(t,"b",(function(){return sr})),n.d(t,"c",(function(){return To}));var r=n(0),s=n(16),o=n(10),a=n.n(o),c=n(19),u=n(5),h=n(31);const l={"A.1":{r:"hk:if|le:lf|nf:nv|qg:qv|rg:rj|rm:rp|rr:rt|rv:s3|vn:vv|17m:17n|17q:17v|18g:19g|1an:1ao|1cb:1cg|1e5:1ef|1fb:1ff|1fl:1gb|1gd:1gq|1gs:1gu|1hr:1hv|1im:1iv|1ne:1nf|1pd:1pf|1qb:1rv|1ti:280|29q:29r|2ae:2af|2al:2an|2bh:2c0|2cd:2ce|2ch:2ci|2dj:2dl|2dq:2dr|2e5:2e6|2e9:2ea|2ee:2em|2eo:2er|2f4:2f5|2fr:2g1|2g3:2g4|2gb:2ge|2gh:2gi|2hq:2hr|2i3:2i6|2i9:2ia|2ie:2io|2iv:2j5|2jl:2k0|2lq:2lr|2me:2mf|2mh:2mv|2n1:2n5|2ng:2o0|2od:2oe|2oh:2oi|2pk:2pl|2pq:2pr|2q4:2q6|2q9:2qa|2qe:2ql|2qo:2qr|2r2:2r5|2rh:2s1|2sb:2sd|2sm:2so|2t0:2t2|2t5:2t7|2tb:2td|2tq:2tt|2u3:2u5|2ue:2um|2uo:2v6|2vj:300|31q:31t|32e:32k|32n:32v|332:335|33g:341|35q:35t|36e:36k|36n:36t|372:375|37g:381|39q:39t|3a4:3a5|3ae:3am|3ao:3av|3b2:3b5|3bg:3c1|3cn:3cp|3du:3dv|3e7:3e9|3eb:3ee|3f0:3fh|3fl:3g0|3hr:3hu|3is:3k0|3k5:3k6|3kb:3kc|3ke:3kj|3l8:3l9|3lu:3lv|3me:3mf|3mq:3mr|3mu:3nv|3rb:3rg|3sc:3sf|3ud:3ue|3ug:3vv|41j:41l|41q:41v|42q:44v|466:46f|47p:47q|47s:47v|4aq:4au|4d3:4d7|4fq:4fv|4ie:4if|4iu:4iv|4ke:4kf|4lm:4ln|4m6:4m7|4om:4on|4qr:4r0|4rt:4sv|4vl:500|5jn:5jv|5kt:5kv|5nh:5nv|5ol:5ov|5pn:5pv|5qk:5qv|5rk:5rv|5ut:5uv|5va:5vv|60q:60v|63o:63v|65a:7fv|7ks:7kv|7nq:7nv|7om:7on|7ou:7ov|7q6:7q7|7qe:7qf|7ru:7rv|7uk:7ul|7vg:7vh|82j:82m|82o:82u|834:839|83i:83j|84f:84v|85i:86f|87b:87v|89r:89s|8ac:8ai|8c4:8cf|8uf:8vv|917:91v|92b:92v|9gk:9gl|9ju:9jv|9ka:9o0|9oa:9ob|9qj:9ql|9qv:9r0|9sl:9sn|9tv:9uf|9vc:9vf|ao0:bjv|bnk:bnv|bum:bvf|bvs:bvv|c4n:c4o|c80:c84|c9d:c9g|cdo:cff|cgt:cgv|ci4:cig|cjs:cju|cmc:cmf|crn:crq|cuu:cuv|jdm:jfv|17t6:17vv|194d:194f|1967:1avv|1lt4:1lvv|1uhe:1uhf|1ujb:1unv|1uo7:1uoi|1uoo:1uos|1uti:1uui|1va0:1vaf|1vcg:1vch|1ve8:1vef|1vft:1vfv|1vgg:1vgv|1vh4:1vhf|1vi7:1vi8|1vjc:1vjf|1vnt:1vnu|1vtv:1vu1|1vu8:1vu9|1vug:1vuh|1vuo:1vup|1vut:1vuv|1vvf:1vvo|2000:20nv|20p4:20pf|20qb:20vv|2116:2117|212e:3jvv|3k7m:3k7v|3k97:3k99|3keu:3kvv|3l50:3l51|3l53:3l54|3l57:3l58|3l8b:3l8c|3la7:3la9|3ll4:3ll7|3lua:3lud|3m00:3vvt|59mn:5tvv|5ugu:5vvt|6000:7vvt|8000:9vvt|a000:bvvt|c000:dvvt|e000:fvvt|g000:hvvt|i000:jvvt|k000:lvvt|m000:nvvt|o000:pvvt|q000:rvvt|s002:s00v|s040:tvvt",s:"9p8|9qc|9qe|9qn|9tg|147|bkq|3l2l|3l4t|3l5d|3l5q|3l5s|3l61|3l64|3l86|3l8l|3l8t|3l9q|3l9v|3la5|3lah|16f|c20|ccf|cnv|cvv|1b0|1c8|1d2|1dq|1h0|1nv|1oe|284|2c4|2d9|2dh|2dt|2eu|2h9|2hh|2hk|2hn|2ht|2it|2k4|2kc|2ke|2ki|2l9|2lh|2lk|2m6|2ma|2o4|2p9|2ph|2qu|2s4|2sh|2sr|2st|2tm|2u9|304|30d|30h|319|31k|325|329|344|34d|34h|359|35k|365|369|36v|384|38d|38h|399|3a9|3c4|3di|3ds|3el|3en|3k3|3k9|3ko|3l0|3l4|3l6|3lc|3lq|3m5|3m7|3q8|3so|3tt|412|418|41b|4g7|4i7|4i9|4in|4ip|4k7|4k9|4lf|4lh|4lv|4m1|4mf|4mn|4nf|4of|4oh|4ov|4q7|h1|5od|5rd|5rh|60f|1upn|1upt|1upv|1uq2|1uq5|1vij|1vj7|1vjl|1vo0|1vv7|20ov|7qo|7qq|7qs|7qu|7tl|7u5|7us|7vl|7vv|sb|sd|s000|t2|97v|uf|9go|9o5"},"B.1":{r:"60b:60d|80b:80d|1vg0:1vgf",s:"5d|606|1vnv|830|qf"},"B.2":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|rq:10;tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ui:u5|uj:ud|uk:ub|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|858:3i;3j|882:33|883:5g;33|887:ir|889:5g;36|88b:38|88c:38|88d:38|88g:39|88h:39|88i:3c|88l:3e|88m:3e;3f|88p:3g|88q:3h|88r:3i|88s:3i|88t:3i|890:3j;3d|891:3k;35;3c|892:3k;3d|894:3q|898:3q|89c:32|89d:33|89g:35|89h:36|89j:3d|89u:tj|89v:u0|8a5:34|crh:38;3g;31|crj:31;3l|crl:3f;3m|cs0:3g;31|cs1:3e;31|cs2:ts;31|cs3:3d;31|cs4:3b;31|cs5:3b;32|cs6:3d;32|cs7:37;32|csa:3g;36|csb:3e;36|csc:ts;36|csg:38;3q|csh:3b;38;3q|csi:3d;38;3q|csj:37;38;3q|csk:3k;38;3q|ct9:3g;31|cta:3b;3g;31|ctb:3d;3g;31|ctc:37;3g;31|ctk:3g;3m|ctl:3e;3m|ctm:ts;3m|ctn:3d;3m|cto:3b;3m|ctp:3d;3m|ctq:3g;3n|ctr:3e;3n|cts:ts;3n|ctt:3d;3n|ctu:3b;3n|ctv:3d;3n|cu0:3b;u9|cu1:3d;u9|cu3:32;3h|cu6:33;8gl;3b;37|cu7:33;3f;1e|cu8:34;32|cu9:37;3p|cub:38;3g|cud:3b;3b|cue:3b;3d|cun:3g;38|cup:3g;3g;3d|cuq:3g;3i|cus:3j;3m|cut:3n;32|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd|3l00:31|3l01:32|3l02:33|3l03:34|3l04:35|3l05:36|3l06:37|3l07:38|3l08:39|3l09:3a|3l0a:3b|3l0b:3c|3l0c:3d|3l0d:3e|3l0e:3f|3l0f:3g|3l0g:3h|3l0h:3i|3l0i:3j|3l0j:3k|3l0k:3l|3l0l:3m|3l0m:3n|3l0n:3o|3l0o:3p|3l0p:3q|3l1k:31|3l1l:32|3l1m:33|3l1n:34|3l1o:35|3l1p:36|3l1q:37|3l1r:38|3l1s:39|3l1t:3a|3l1u:3b|3l1v:3c|3l20:3d|3l21:3e|3l22:3f|3l23:3g|3l24:3h|3l25:3i|3l26:3j|3l27:3k|3l28:3l|3l29:3m|3l2a:3n|3l2b:3o|3l2c:3p|3l2d:3q|3l38:31|3l39:32|3l3a:33|3l3b:34|3l3c:35|3l3d:36|3l3e:37|3l3f:38|3l3g:39|3l3h:3a|3l3i:3b|3l3j:3c|3l3k:3d|3l3l:3e|3l3m:3f|3l3n:3g|3l3o:3h|3l3p:3i|3l3q:3j|3l3r:3k|3l3s:3l|3l3t:3m|3l3u:3n|3l3v:3o|3l40:3p|3l41:3q|3l4s:31|3l4u:33|3l4v:34|3l52:37|3l55:3a|3l56:3b|3l59:3e|3l5a:3f|3l5b:3g|3l5c:3h|3l5e:3j|3l5f:3k|3l5g:3l|3l5h:3m|3l5i:3n|3l5j:3o|3l5k:3p|3l5l:3q|3l6g:31|3l6h:32|3l6i:33|3l6j:34|3l6k:35|3l6l:36|3l6m:37|3l6n:38|3l6o:39|3l6p:3a|3l6q:3b|3l6r:3c|3l6s:3d|3l6t:3e|3l6u:3f|3l6v:3g|3l70:3h|3l71:3i|3l72:3j|3l73:3k|3l74:3l|3l75:3m|3l76:3n|3l77:3o|3l78:3p|3l79:3q|3l84:31|3l85:32|3l87:34|3l88:35|3l89:36|3l8a:37|3l8d:3a|3l8e:3b|3l8f:3c|3l8g:3d|3l8h:3e|3l8i:3f|3l8j:3g|3l8k:3h|3l8m:3j|3l8n:3k|3l8o:3l|3l8p:3m|3l8q:3n|3l8r:3o|3l8s:3p|3l9o:31|3l9p:32|3l9r:34|3l9s:35|3l9t:36|3l9u:37|3la0:39|3la1:3a|3la2:3b|3la3:3c|3la4:3d|3la6:3f|3laa:3j|3lab:3k|3lac:3l|3lad:3m|3lae:3n|3laf:3o|3lag:3p|3lbc:31|3lbd:32|3lbe:33|3lbf:34|3lbg:35|3lbh:36|3lbi:37|3lbj:38|3lbk:39|3lbl:3a|3lbm:3b|3lbn:3c|3lbo:3d|3lbp:3e|3lbq:3f|3lbr:3g|3lbs:3h|3lbt:3i|3lbu:3j|3lbv:3k|3lc0:3l|3lc1:3m|3lc2:3n|3lc3:3o|3lc4:3p|3lc5:3q|3ld0:31|3ld1:32|3ld2:33|3ld3:34|3ld4:35|3ld5:36|3ld6:37|3ld7:38|3ld8:39|3ld9:3a|3lda:3b|3ldb:3c|3ldc:3d|3ldd:3e|3lde:3f|3ldf:3g|3ldg:3h|3ldh:3i|3ldi:3j|3ldj:3k|3ldk:3l|3ldl:3m|3ldm:3n|3ldn:3o|3ldo:3p|3ldp:3q|3lek:31|3lel:32|3lem:33|3len:34|3leo:35|3lep:36|3leq:37|3ler:38|3les:39|3let:3a|3leu:3b|3lev:3c|3lf0:3d|3lf1:3e|3lf2:3f|3lf3:3g|3lf4:3h|3lf5:3i|3lf6:3j|3lf7:3k|3lf8:3l|3lf9:3m|3lfa:3n|3lfb:3o|3lfc:3p|3lfd:3q|3lg8:31|3lg9:32|3lga:33|3lgb:34|3lgc:35|3lgd:36|3lge:37|3lgf:38|3lgg:39|3lgh:3a|3lgi:3b|3lgj:3c|3lgk:3d|3lgl:3e|3lgm:3f|3lgn:3g|3lgo:3h|3lgp:3i|3lgq:3j|3lgr:3k|3lgs:3l|3lgt:3m|3lgu:3n|3lgv:3o|3lh0:3p|3lh1:3q|3lhs:31|3lht:32|3lhu:33|3lhv:34|3li0:35|3li1:36|3li2:37|3li3:38|3li4:39|3li5:3a|3li6:3b|3li7:3c|3li8:3d|3li9:3e|3lia:3f|3lib:3g|3lic:3h|3lid:3i|3lie:3j|3lif:3k|3lig:3l|3lih:3m|3lii:3n|3lij:3o|3lik:3p|3lil:3q|3ljg:31|3ljh:32|3lji:33|3ljj:34|3ljk:35|3ljl:36|3ljm:37|3ljn:38|3ljo:39|3ljp:3a|3ljq:3b|3ljr:3c|3ljs:3d|3ljt:3e|3lju:3f|3ljv:3g|3lk0:3h|3lk1:3i|3lk2:3j|3lk3:3k|3lk4:3l|3lk5:3m|3lk6:3n|3lk7:3o|3lk8:3p|3lk9:3q|3ll8:th|3ll9:ti|3lla:tj|3llb:tk|3llc:tl|3lld:tm|3lle:tn|3llf:to|3llg:tp|3llh:tq|3lli:tr|3llj:ts|3llk:tt|3lll:tu|3llm:tv|3lln:u0|3llo:u1|3llp:to|3llq:u3|3llr:u4|3lls:u5|3llt:u6|3llu:u7|3llv:u8|3lm0:u9|3lmj:u3|3ln2:th|3ln3:ti|3ln4:tj|3ln5:tk|3ln6:tl|3ln7:tm|3ln8:tn|3ln9:to|3lna:tp|3lnb:tq|3lnc:tr|3lnd:ts|3lne:tt|3lnf:tu|3lng:tv|3lnh:u0|3lni:u1|3lnj:to|3lnk:u3|3lnl:u4|3lnm:u5|3lnn:u6|3lno:u7|3lnp:u8|3lnq:u9|3lod:u3|3los:th|3lot:ti|3lou:tj|3lov:tk|3lp0:tl|3lp1:tm|3lp2:tn|3lp3:to|3lp4:tp|3lp5:tq|3lp6:tr|3lp7:ts|3lp8:tt|3lp9:tu|3lpa:tv|3lpb:u0|3lpc:u1|3lpd:to|3lpe:u3|3lpf:u4|3lpg:u5|3lph:u6|3lpi:u7|3lpj:u8|3lpk:u9|3lq7:u3|3lqm:th|3lqn:ti|3lqo:tj|3lqp:tk|3lqq:tl|3lqr:tm|3lqs:tn|3lqt:to|3lqu:tp|3lqv:tq|3lr0:tr|3lr1:ts|3lr2:tt|3lr3:tu|3lr4:tv|3lr5:u0|3lr6:u1|3lr7:to|3lr8:u3|3lr9:u4|3lra:u5|3lrb:u6|3lrc:u7|3lrd:u8|3lre:u9|3ls1:u3|3lsg:th|3lsh:ti|3lsi:tj|3lsj:tk|3lsk:tl|3lsl:tm|3lsm:tn|3lsn:to|3lso:tp|3lsp:tq|3lsq:tr|3lsr:ts|3lss:tt|3lst:tu|3lsu:tv|3lsv:u0|3lt0:u1|3lt1:to|3lt2:u3|3lt3:u4|3lt4:u5|3lt5:u6|3lt6:u7|3lt7:u8|3lt8:u9|3ltr:u3",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"B.3":{m:"5l:ts|6v:3j;3j|9g:39;o7|a9:ls;3e|bv:3j|fg:3a;oc|q5:tp|sg:tp;o8;o1|tg:u5;o8;o1|u2:u3|ug:ti|uh:to|ul:u6|um:u0|vg:tq|vh:u1|vi:u3|vl:tl|1c7:1b5;1c2|7km:38;ph|7kn:3k;o8|7ko:3n;oa|7kp:3p;oa|7kq:31;lu|7kr:7j1|7qg:u5;oj|7qi:u5;oj;o0|7qk:u5;oj;o1|7qm:u5;oj;q2|7s0:7o0;tp|7s1:7o1;tp|7s2:7o2;tp|7s3:7o3;tp|7s4:7o4;tp|7s5:7o5;tp|7s6:7o6;tp|7s7:7o7;tp|7s8:7o0;tp|7s9:7o1;tp|7sa:7o2;tp|7sb:7o3;tp|7sc:7o4;tp|7sd:7o5;tp|7se:7o6;tp|7sf:7o7;tp|7sg:7p0;tp|7sh:7p1;tp|7si:7p2;tp|7sj:7p3;tp|7sk:7p4;tp|7sl:7p5;tp|7sm:7p6;tp|7sn:7p7;tp|7so:7p0;tp|7sp:7p1;tp|7sq:7p2;tp|7sr:7p3;tp|7ss:7p4;tp|7st:7p5;tp|7su:7p6;tp|7sv:7p7;tp|7t0:7r0;tp|7t1:7r1;tp|7t2:7r2;tp|7t3:7r3;tp|7t4:7r4;tp|7t5:7r5;tp|7t6:7r6;tp|7t7:7r7;tp|7t8:7r0;tp|7t9:7r1;tp|7ta:7r2;tp|7tb:7r3;tp|7tc:7r4;tp|7td:7r5;tp|7te:7r6;tp|7tf:7r7;tp|7ti:7rg;tp|7tj:th;tp|7tk:tc;tp|7tm:th;q2|7tn:th;q2;tp|7ts:th;tp|7tu:tp|7u2:7rk;tp|7u3:tn;tp|7u4:te;tp|7u6:tn;q2|7u7:tn;q2;tp|7uc:tn;tp|7ui:tp;o8;o0|7uj:tp;o8;o1|7um:tp;q2|7un:tp;o8;q2|7v2:u5;o8;o0|7v3:u5;o8;o1|7v4:u1;oj|7v6:u5;q2|7v7:u5;o8;q2|7vi:7rs;tp|7vj:u9;tp|7vk:ue;tp|7vm:u9;q2|7vn:u9;q2;tp|7vs:u9;tp|1uo0:36;36|1uo1:36;39|1uo2:36;3c|1uo3:36;36;39|1uo4:36;36;3c|1uo5:3j;3k|1uo6:3j;3k|1uoj:1bk;1bm|1uok:1bk;1b5|1uol:1bk;1bb|1uom:1bu;1bm|1uon:1bk;1bd",r:"23:2c|2i:2k|2m:2q|60:6m|6o:6u|bo:bp|c1:c2|c6:c7|c9:cb|ce:ch|cj:ck|cm:co|cs:ct|cv:d0|d6:d7|de:df|dh:dj|dn:do|e4:e5|e7:e8|ea:eb|fh:fi|fm:fo|s8:sa|se:sf|sh:t1|t3:tb|100:11f|19h:1am|7o8:7of|7oo:7ot|7p8:7pf|7po:7pv|7q8:7qd|7r8:7rf|7to:7tr|7u8:7ub|7uo:7ur|7v8:7vc|7vo:7vr|89a:89b|8b0:8bf|95m:96f|1vp1:1vpq|2100:2115",s:"v8|va|vc|ve|vk|130|132|134|136|138|13a|13c|13e|13g|13i|13k|13m|13o|13q|13s|13u|140|14a|14c|14e|14g|14i|14k|14m|14o|14q|14s|14u|150|152|154|156|158|15a|15c|15e|15g|15i|15k|15m|15o|15q|15s|15u|161|163|165|167|169|16b|16d|16g|16i|16k|16m|16o|16q|16s|16u|170|172|174|176|178|17a|17c|17e|17g|17i|17k|17o|180|182|184|186|188|18a|18c|18e|80|82|84|86|88|8a|8c|8e|8g|8i|8k|8m|8o|8q|8s|8u|90|92|94|96|98|9a|9c|9e|9i|9k|9m|9p|9r|9t|9v|a1|a3|a5|a7|aa|ac|ae|ag|ai|ak|am|ao|aq|as|au|b0|b2|b4|b6|b8|ba|bc|be|bg|bi|bk|bm|br|bt|c4|d2|d4|d9|dc|dl|ds|ed|ef|eh|ej|el|en|ep|er|eu|f0|f2|f4|f6|f8|fa|fc|fe|fk|fq|fs|fu|g0|g2|g4|g6|g8|ga|gc|ge|gg|gi|gk|gm|go|gq|gs|gu|h0|h2|h4|h6|h8|ha|hc|he|hg|hi|21|22|7g0|7g2|7g4|7g6|7g8|7ga|7gc|7ge|7gg|7gi|2d|7gk|7gm|7go|7gq|7gs|7gu|7h0|7h2|7h4|7h6|7h8|7ha|7hc|7he|7hg|7hi|7hk|7hm|7ho|7hq|7hs|7hu|7i0|7i2|7i4|7i6|7i8|7ia|7ic|7ie|7ig|7ii|7ik|7im|7io|7iq|7is|7iu|7j0|7j2|7j4|7j6|7j8|7ja|7jc|7je|7jg|7ji|7jk|7jm|2e|7jo|7jq|7js|7ju|7k0|7k2|7k4|7k6|7k8|7ka|7kc|7ke|7kg|7ki|7kk|7l0|7l2|7l4|7l6|7l8|7la|7lc|7le|7lg|7li|7lk|7lm|7lo|7lq|7ls|7lu|7m0|7m2|7m4|7m6|7m8|7ma|7mc|7me|7mg|7mi|7mk|7mm|7mo|7mq|2f|7ms|7mu|7n0|7n2|7n4|7n6|7n8|7na|7nc|7ne|7ng|7ni|7nk|7nm|7no|2g|7qp|7qr|7qt|7qv|2h|896|2l|s6|sc|uo|uq|us|uu|v0|v2|v4|v6"},"C.1.1":{s:"10"},"C.1.2":{r:"800:80b",s:"c00|50|5k0|81f|82v"},"C.2.1":{r:"0:v",s:"3v"},"C.2.2":{r:"40:4v|80c:80d|818:819|830:833|83a:83f|1vvp:1vvs|3kbj:3kbq",s:"1mt|1of|60e|1vnv"},"C.3":{r:"1o00:1u7v|u000:vvvt|10000:11vvt"},"C.4":{r:"1veg:1vff|1vvu:1vvv|3vvu:3vvv|5vvu:5vvv|7vvu:7vvv|9vvu:9vvv|bvvu:bvvv|dvvu:dvvv|fvvu:fvvv|hvvu:hvvv|jvvu:jvvv|lvvu:lvvv|nvvu:nvvv|pvvu:pvvv|rvvu:rvvv|tvvu:tvvv|vvvu:vvvv|11vvu:11vvv"},"C.5":{r:"1m00:1nvv"},"C.6":{r:"1vvp:1vvt"},"C.7":{r:"bvg:bvr"},"C.8":{r:"q0:q1|80e:80f|81a:81e|83a:83f"},"C.9":{r:"s010:s03v",s:"s001"},"D.1":{r:"1eg:1fa|1fg:1fk|1h1:1hq|1i0:1ia|1jd:1jf|1jh:1ml|1n5:1n6|1nq:1nu|1o0:1od|1oi:1pc|1s0:1t5|1uov:1up8|1upa:1upm|1upo:1ups|1uq0:1uq1|1uq3:1uq4|1uq6:1uth|1uuj:1v9t|1vag:1vcf|1vci:1ve7|1vfg:1vfs|1vjg:1vjk|1vjm:1vns",s:"1du|1e0|1e3|1gr|1gv|1mt|1og|1th|1uot|1upu|80f"},"D.2":{r:"21:2q|31:3q|60:6m|6o:7m|7o:h0|h2:hj|ig:ld|lg:lo|lr:m1|mg:mh|n0:n4|s8:sa|se:t1|t3:ue|ug:vl|100:142|14a:16e|16g:17l|17o:17p|180:18f|19h:1am|1ap:1av|1b1:1c7|285:29p|29t:2a0|2a9:2ac|2ao:2b1|2b4:2bg|2c2:2c3|2c5:2cc|2cf:2cg|2cj:2d8|2da:2dg|2dm:2dp|2du:2e0|2e7:2e8|2eb:2ec|2es:2et|2ev:2f1|2f6:2fh|2fk:2fq|2g5:2ga|2gf:2gg|2gj:2h8|2ha:2hg|2hi:2hj|2hl:2hm|2ho:2hp|2hu:2i0|2ip:2is|2j6:2jf|2ji:2jk|2k5:2kb|2kf:2kh|2kj:2l8|2la:2lg|2li:2lj|2ll:2lp|2lt:2m0|2mb:2mc|2n6:2nf|2o2:2o3|2o5:2oc|2of:2og|2oj:2p8|2pa:2pg|2pi:2pj|2pm:2pp|2pt:2pu|2q7:2q8|2qb:2qc|2qs:2qt|2qv:2r1|2r6:2rg|2s5:2sa|2se:2sg|2si:2sl|2sp:2sq|2su:2sv|2t3:2t4|2t8:2ta|2te:2tl|2tn:2tp|2tu:2tv|2u1:2u2|2u6:2u8|2ua:2uc|2v7:2vi|301:303|305:30c|30e:30g|30i:318|31a:31j|31l:31p|321:324|330:331|336:33f|342:343|345:34c|34e:34g|34i:358|35a:35j|35l:35p|360:364|367:368|36a:36b|36l:36m|370:371|376:37f|382:383|385:38c|38e:38g|38i:398|39a:39p|39u:3a0|3a6:3a8|3aa:3ac|3b0:3b1|3b6:3bf|3c2:3c3|3c5:3cm|3cq:3dh|3dj:3dr|3e0:3e6|3ef:3eh|3eo:3ev|3fi:3fk|3g1:3hg|3hi:3hj|3i0:3i6|3if:3ir|3k1:3k2|3k7:3k8|3kk:3kn|3kp:3kv|3l1:3l3|3la:3lb|3ld:3lg|3li:3lj|3m0:3m4|3mg:3mp|3ms:3mt|3o0:3on|3oq:3pk|3pu:3q7|3q9:3ra|3s8:3sb|3tu:3u5|3u7:3uc|400:411|413:417|419:41a|420:42n|450:465|46g:47o|480:4ap|4av:4d2|4d8:4fp|4g0:4g6|4g8:4i6|4ia:4id|4ig:4im|4iq:4it|4j0:4k6|4ka:4kd|4kg:4le|4li:4ll|4lo:4lu|4m2:4m5|4m8:4me|4mg:4mm|4mo:4ne|4ng:4oe|4oi:4ol|4oo:4ou|4p0:4q6|4q8:4qq|4r1:4rs|4t0:4vk|501:5jm|5k1:5kq|5l0:5ng|5o0:5oc|5oe:5oh|5p0:5ph|5pl:5pm|5q0:5qh|5r0:5rc|5re:5rg|5s0:5tm|5tu:5u5|5u7:5u8|5uk:5uq|5v0:5v9|60g:60p|610:63n|640:658|7g0:7kr|7l0:7np|7o0:7ol|7oo:7ot|7p0:7q5|7q8:7qd|7qg:7qn|7qv:7rt|7s0:7tk|7tm:7ts|7u2:7u4|7u6:7uc|7ug:7uj|7um:7ur|7v0:7vc|7vi:7vk|7vm:7vs|88a:88j|88p:88t|89a:89d|89f:89h|89j:89p|89t:89v|8a5:8a9|8b0:8c3|8pm:8rq|94s:979|c05:c07|c11:c19|c1h:c1l|c1o:c1s|c21:c4m|c4t:c4v|c51:c7q|c7s:c7v|c85:c9c|c9h:cce|ccg:cdn|cfg:cgs|ch0:ci3|cj0:cjr|cjv:clg|cm0:cmb|cmg:cnu|co0:crm|crr:cut|cv0:cvu|d00:jdl|jg0:17t5|1800:194c|1b00:1lt3|1m00:1uhd|1uhg:1uja|1uo0:1uo6|1uoj:1uon|1vp1:1vpq|1vq1:1vqq|1vr6:1vtu|1vu2:1vu7|1vua:1vuf|1vui:1vun|1vuq:1vus|20o0:20ou|20p0:20p3|20pg:20qa|2100:2115|2118:212d|3k00:3k7l|3k80:3k96|3k9a:3kb6|3kba:3kbi|3kc3:3kc4|3kcc:3kd9|3kde:3ket|3l00:3l2k|3l2m:3l4s|3l4u:3l4v|3l55:3l56|3l59:3l5c|3l5e:3l5p|3l5t:3l60|3l62:3l63|3l65:3l85|3l87:3l8a|3l8d:3l8k|3l8m:3l8s|3l8u:3l9p|3l9r:3l9u|3la0:3la4|3laa:3lag|3lai:3ll3|3ll8:3lu9|4000:59mm|5u00:5ugt|u000:vvvt|10000:11vvt",s:"3l52|3l5r|3la6|1c9|5a|5l|5q|283|2ag|2di|2en|2iu|2k3|2kd|2m9|2mg|2n0|2q0|2qn|2s3|2ss|2un|35u|36u|3an|3dt|3k4|3ka|3kd|3l5|3l7|3lt|3m6|3pm|3po|3rv|3s5|3uf|41c|41h|41o|47r|4i8|4io|4k8|4lg|4m0|4og|5us|ne|7qp|7qr|7qt|7tu|80e|83h|83v|882|887|88l|894|896|898|rq|s6|sc|8sl"}};class d{constructor(e,t){this.singles=new Set,this.ranges=[],this.mappings=new Map;const n=l[e];this.name=e,n?(n.s&&(this.singles=new Set(n.s.split("|").map(e=>parseInt(e,32)))),n.r&&(this.ranges=n.r.split("|").map(e=>{const[t,n]=e.split(":");return[parseInt(t,32),parseInt(n,32)]})),n.m&&(this.mappings=new Map(n.m.split("|").map(e=>{const[t,n]=e.split(":"),i=n.split(";").map(e=>parseInt(e,32));return[parseInt(t,32),i]})))):t&&(this.singles=new Set(t))}contains(e){if(this.singles.has(e))return!0;let t=0,n=this.ranges.length-1;for(;t<=n;){const i=Math.floor((t+n)/2),r=this.ranges[i];if(e<r[0])n=i-1;else{if(!(e>r[1]))return!0;t=i+1}}return!1}hasMapping(e){return this.mappings.has(e)||this.contains(e)}map(e){return this.contains(e)&&!this.mappings.has(e)?String.fromCodePoint(e).toLowerCase().codePointAt(0):this.mappings.get(e)||null}}const p=new d("A.1"),f=new d("B.1"),m=new d("B.2"),g=(new d("B.3"),new d("C.1.1")),v=new d("C.1.2"),y=new d("C.2.1"),b=new d("C.2.2"),_=new d("C.3"),w=new d("C.4"),S=new d("C.5"),C=new d("C.6"),E=new d("C.7"),k=new d("C.8"),x=new d("C.9"),I=new d("D.1"),O=new d("D.2");function j(e,t,n){const i=a.a.ucs2.decode(n);let r=[];for(const n of i){if(!t&&e.unassigned.contains(n))throw new Error("Unassigned codepoint: x"+n.toString(16));let i=!1;for(const t of e.mappings){if(!t.hasMapping(n))continue;i=!0;const e=t.map(n);e&&(Array.isArray(e)?r=r.concat(e):r.push(e))}i||r.push(n)}let s=r;if(e.normalize){const e=a.a.ucs2.encode(r).normalize("NFKC");s=a.a.ucs2.decode(e)}let o=!1,c=!1;for(const n of s){for(const t of e.prohibited)if(t.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));if(!t&&e.unassigned.contains(n))throw new Error("Prohibited code point: x"+n.toString(16));e.bidirectional&&(o=o||I.contains(n),c=c||O.contains(n))}if(e.bidirectional){if(o&&c)throw new Error("String contained both LCat and RandALCat code points");if(o&&(!I.contains(s[0])||!I.contains(s[s.length-1])))throw new Error("String containing RandALCat code points must start and end with RandALCat code points")}return a.a.ucs2.encode(s)}f.map=()=>null,g.contains=e=>32===e,v.map=e=>v.contains(e)?32:null;const T={bidirectional:!0,mappings:[f,m],normalize:!0,prohibited:[v,b,_,w,S,C,E,k,x],unassigned:p};const R=new d("NodePrepProhibited",[34,38,39,47,58,60,62,64]),A={bidirectional:!0,mappings:[f,m],normalize:!0,prohibited:[g,v,y,b,_,w,S,C,E,k,x,R],unassigned:p};const P={bidirectional:!0,mappings:[f],normalize:!0,prohibited:[v,y,b,_,w,S,C,E,k,x],unassigned:p};function D(e,t={}){let n=e.local;t.escaped||(n=G(e.local));const i=t.prepared?e:M({local:n,domain:e.domain,resource:e.resource}),r=n?`${n}@${i.domain}`:i.domain;return i.resource?`${r}/${i.resource}`:r}function M(e){let t=e.local||"",n=e.domain,i=e.resource||"";return t&&(t=function(e,t=!0){return j(A,t,e)}(t)),i&&(i=function(e,t=!0){return j(P,t,e)}(i)),"."===n[n.length-1]&&(n=n.slice(0,n.length-1)),n=function(e,t=!0){return j(T,t,e)}(n.split(".").map(a.a.toUnicode).join(".")),{domain:n,local:t,resource:i}}function q(e=""){let t="",n="",i="";const r=e.indexOf("/");r>0&&(i=e.slice(r+1),e=e.slice(0,r));const s=e.indexOf("@");s>0&&(t=e.slice(0,s),e=e.slice(s+1)),n=e;const o=M({domain:n,local:t,resource:i});return{bare:D({local:o.local,domain:o.domain},{escaped:!0,prepared:!0}),domain:o.domain,full:D(o,{escaped:!0,prepared:!0}),local:W(o.local),resource:o.resource}}function N(e,t){const n=new Set;if(n.add(void 0),n.add(""),e){const t=q(e);n.add(t.full),n.add(t.bare),n.add(t.domain)}if(t){const e=q(t);n.add(e.domain),n.add(e.bare),n.add(e.full)}return n}function F(e,t){if(!e||!t)return!1;const n=q(e),i=q(t);return n.local===i.local&&n.domain===i.domain}function L(e){return!!q(e).resource}function U(e=""){return q(e).domain}function B(e=""){return q(e).resource}function z(e=""){return q(e).bare}function G(e=""){return e.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function W(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}var H,V=Object.freeze({__proto__:null,create:D,prepare:M,parse:q,allowedResponders:N,equal:function(e,t){if(!e||!t)return!1;const n=q(e),i=q(t);return n.local===i.local&&n.domain===i.domain&&n.resource===i.resource},equalBare:F,isBare:function(e){return!L(e)},isFull:L,getLocal:function(e=""){return q(e).local},getDomain:U,getResource:B,toBare:z,escapeLocal:G,unescapeLocal:W,parseURI:function(e){const t=new URL(e);if("xmpp:"!==t.protocol)throw new Error("Invalid XMPP URI, wrong protocol: "+t.protocol);const n=t.hostname?t.username?D({domain:decodeURIComponent(t.hostname),local:decodeURIComponent(t.username)},{escaped:!0}):decodeURIComponent(t.hostname):void 0,i=q(decodeURIComponent(n?t.pathname.substr(1):t.pathname)).full,r=t.search&&t.search.indexOf(";")>=1,s=r?t.search.substr(t.search.indexOf(";")+1):"",o=t.search?decodeURIComponent(t.search.substr(1,r?t.search.indexOf(";")-1:void 0)):void 0,a={};for(const e of s.split(";")){const[t,n]=e.split("=").map(decodeURIComponent);if(a[t]){const e=a[t];Array.isArray(e)?e.push(n):a[t]=[e,n]}else a[t]=n}return{action:o,identity:n,jid:i,parameters:a}},toURI:function(e){const t=["xmpp:"],n=(e,n)=>{const i=q(e);i.local&&(t.push(encodeURIComponent(G(i.local))),t.push("@")),t.push(encodeURIComponent(i.domain)),n&&i.resource&&(t.push("/"),t.push(encodeURIComponent(i.resource)))};e.identity&&(t.push("//"),n(e.identity,!1),e.jid&&t.push("/")),e.jid&&n(e.jid,!0),e.action&&(t.push("?"),t.push(encodeURIComponent(e.action)));for(let[n,i]of Object.entries(e.parameters||{})){Array.isArray(i)||(i=[i]);for(const e of i)t.push(";"),t.push(encodeURIComponent(n)),void 0!==e&&(t.push("="),t.push(encodeURIComponent(e)))}return t.join("")}});!function(e){e.NotWellFormed="not-well-formed",e.RestrictedXML="restricted-xml",e.AlreadyClosed="already-closed",e.UnknownRoot="unknown-stream-root"}(H||(H={}));class $ extends Error{constructor(e){super(e.text),this.isJXTError=!0,this.condition=e.condition,this.text=e.text}static notWellFormed(e){return new $({condition:H.NotWellFormed,text:e})}static restrictedXML(e){return new $({condition:H.RestrictedXML,text:e})}static alreadyClosed(e){return new $({condition:H.AlreadyClosed,text:e})}static unknownRoot(e){return new $({condition:H.UnknownRoot,text:e})}}const J={'"':"&quot;","&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;"},Y={"&amp;":"&","&apos;":"'","&gt;":">","&lt;":"<","&quot;":'"'},Q=/&([a-zA-Z0-9]+|#[0-9]+|#x[0-9a-fA-F]+);/g,K=/&|<|>|"|'/g,X=/&|<|>/g;function Z(e){return J[e]}function ee(e){return e.replace(K,Z)}function te(e){return e.replace(Q,e=>function(e){if(Y[e])return Y[e];const t=e.startsWith("&#x"),n=parseInt(e.substring(t?3:2,e.length-1),t?16:10);if(9===n||10===n||13===n||32<=n&&n<=55295||57344<=n&&n<=65533||65536<=n&&n<=1114111)return String.fromCodePoint(n);throw $.restrictedXML("Prohibited entity: "+e)}(e))}function ne(e){return e.replace(X,Z)}function ie(e,t=[],n=""){const i=new Set(e.map(e=>e.toLowerCase()));for(let e of t.map(e=>e.toLowerCase()))if("*"!==e)for(;e.length>0;){if(i.has(e))return e;e=e.substring(0,e.lastIndexOf("-")).toLowerCase(),e.lastIndexOf("-")===e.length-2&&(e=e.substring(0,e.lastIndexOf("-")))}return n}class re{constructor(e,t={},n=[]){this.name=e,this.attributes=t,this.children=[],this.optionalNamespaces={};for(const e of n)if("string"!=typeof e){const t=new re(e.name,e.attributes,e.children);t.parent=this,this.children.push(t)}else this.children.push(e)}getName(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name}getNamespace(){if(this.name.indexOf(":")>=0){const e=this.name.substr(0,this.name.indexOf(":"));return this.findNamespaceForPrefix(e)}return this.findNamespaceForPrefix()}getNamespaceContext(){let e={};this.parent&&(e=this.parent.getNamespaceContext());for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")){const i=t.substr(6);e[n]=i}return e}getDefaultNamespace(){return this.attributes.xmlns?this.attributes.xmlns:this.parent?this.parent.getDefaultNamespace():""}getNamespaceRoot(e){if(this.parent){const t=this.parent.getNamespaceRoot(e);if(t)return t}for(const[t,n]of Object.entries(this.attributes))if(t.startsWith("xmlns:")&&n===e)return this;if(this.optionalNamespaces[e])return this}getAttribute(e,t){if(!t)return this.attributes[e];const n=this.getNamespaceContext();return n[t]?this.attributes[[n[t],e].join(":")]:void 0}getChild(e,t){return this.getChildren(e,t)[0]}getChildren(e,t){const n=[];for(const i of this.children)"string"==typeof i||i.getName()!==e||t&&i.getNamespace()!==t||n.push(i);return n}getText(){let e="";for(const t of this.children)"string"==typeof t&&(e+=t);return e}appendChild(e){return this.children.push(e),"string"!=typeof e&&(e.parent=this),e}setAttribute(e,t,n=!1){this.attributes[e]=t||void 0,""===t&&n&&(this.attributes[e]=t)}addOptionalNamespace(e,t){this.optionalNamespaces[t]=e}useNamespace(e,t){return this.optionalNamespaces[t]&&(e=this.optionalNamespaces[t]),this.setAttribute(`xmlns:${e}`,t),e}toJSON(){const e=this.children.map(e=>"string"==typeof e?e:e?e.toJSON():void 0).filter(e=>!!e),t={};for(const e of Object.keys(this.attributes))void 0!==this.attributes[e]&&null!==this.attributes[e]&&(t[e]=this.attributes[e]);return{attributes:t,children:e,name:this.name}}toString(){let e=this.openTag(!0);if(this.children.length){for(const t of this.children)"string"==typeof t?e+=ne(t):t&&(e+=t.toString());e+=this.closeTag()}return e}openTag(e=!1){let t="";t+=`<${this.name}`;for(const e of Object.keys(this.attributes)){const n=this.attributes[e];void 0!==n&&(t+=` ${e}="${ee(n.toString())}"`)}return e&&0===this.children.length?t+="/>":t+=">",t}closeTag(){return`</${this.name}>`}findNamespaceForPrefix(e){if(e){const t="xmlns:"+e;if(this.attributes[t])return this.attributes[t];if(this.parent)return this.parent.findNamespaceForPrefix(e)}else{if(this.attributes.xmlns)return this.attributes.xmlns;if(this.parent)return this.parent.findNamespaceForPrefix()}return""}}const se=new Set(["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul"]),oe=new Set(["style"]),ae=new Map([["a",new Set(["href","style"])],["body",new Set(["style","xml:lang"])],["blockquote",oe],["br",oe],["cite",oe],["em",oe],["img",new Set(["alt","height","src","style","width"])],["li",oe],["ol",oe],["p",oe],["span",oe],["strong",oe],["ul",oe]]),ce=new Map([["font-style",/normal|italic|oblique|inherit/i],["font-weight",/normal|bold|bolder|lighter|inherit|\d\d\d/i],["text-decoration",/none|underline|overline|line-through|blink|inherit/i]]),ue=e=>!!e.match(/^(https?|xmpp|cid|mailto|ftps?|im|ircs?|sips?|tel|geo|bitcoin|magnet):/i)&&e,he=e=>!!e.match(/^[0-9]*$/)&&e,le={alt:e=>e,height:he,href:ue,src:ue,style:e=>{const t=`;${e}`.replace(/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//g,"").replace(/\/\*.*/,"").replace(/\\([a-fA-F0-9]{1,6})\s?/,(e,t)=>String.fromCharCode(parseInt(t,16))).match(/;\s*([a-z\-]+)\s*:\s*([^;]*[^\s;])\s*/g),n=[];if(!t)return!1;for(const e of t){const t=e.match(/^;\s*([a-z\-]+)\s*:\s*([^;]*[^\s])\s*$/);if(!t)continue;const i=ce.get(t[1]);if(i){const e=t[2].match(i);e&&n.push(`${t[1]}:${e[0]}`)}}return!!n.length&&n.join("")},width:he},de=e=>{if("string"==typeof e)return;let t=[];for(const n of e.children){if(!n)continue;if("string"==typeof n){t.push(n);continue}const e=pe(n);Array.isArray(e)?t=t.concat(e):e&&t.push(e)}const n={};return"body"===e.name?(void 0!==e.attributes.xmlns&&(n.xmlns=e.attributes.xmlns),e.attributes.style&&(n.style=e.attributes.style),void 0!==e.attributes["xml:lang"]&&(n["xml:lang"]=e.attributes["xml:lang"]),{attributes:n,children:t,name:"body"}):void 0},pe=e=>{if("string"==typeof e)return e;if(!se.has(e.name)){if("script"===e.name)return;return(e=>{let t=[];for(const n of e.children)if("string"==typeof n)t.push(n);else if(n){const e=pe(n);e&&(Array.isArray(e)?t=t.concat(e):t.push(e))}return t})(e)}const t=e.children.map(pe).filter(e=>void 0!==e),n={};for(const t of Object.keys(e.attributes)){const i=ae.get(e.name);if(!i||!i.has(t))continue;let r=e.attributes[t];r&&(r=le[t](r),r&&(n[t]=r))}return{attributes:n,children:t,name:e.name}};function fe(e){return e>=32}function me(e){return 32===e||10===e||13===e||9===e}function ge(e,t={}){const n=new ve(t);let i,r,s=null;if(n.on("text",e=>{r&&r.children.push(e)}),n.on("startElement",(e,t)=>{const n=new re(e,t);i||(i=n),r=r?r.appendChild(n):n}),n.on("endElement",e=>{r&&e===r.name?r.parent?r=r.parent:i||(i=r,r=void 0):n.emit("error",$.notWellFormed())}),n.on("error",e=>{s=e}),n.write(e),n.end(),s)throw s;return i}class ve extends s.EventEmitter{constructor(e={}){super(),this.allowComments=!0,this.endTag=!1,this.recordStart=0,this.state=9,this.haveDeclaration=!1,void 0!==e.allowComments&&(this.allowComments=e.allowComments)}write(e){let t=0;for(this.remainder&&(e=this.remainder+e,t=void 0!==this.remainderPos?this.remainderPos:this.remainder.length,this.remainderPos=void 0,this.remainder=void 0);t<e.length;t++){const n=e.charCodeAt(t);switch(this.state){case 9:if(60===n){const n=this.endRecording(e,t);if(n){let e;try{e=te(n)}catch(e){return void this.emit("error",e)}this.emit("text",e)}this.state=8,this.recordStart=t+1,this.attributes={}}break;case 4:if(62===n&&this.lookBehindMatch(e,t,"]]")){const n=this.endRecording(e,t-2);n&&this.emit("text",n),this.state=9}break;case 8:if(47===n&&this.recordStart===t)this.recordStart=t+1,this.endTag=!0;else{if(33===n){if(this.allowComments){const n=this.lookAheadMatch(e,t,"--");if(1===n){this.recordStart=void 0,this.state=5;break}if(0===n)return void this.waitForData(e,t)}const n=this.lookAheadMatch(e,t,"[CDATA[");if(1===n){this.recordStart=t+8,this.state=4;break}return 0===n?void this.waitForData(e,t):void this.emit("error",$.restrictedXML())}if(63===n){if(this.recordStart=void 0,!this.haveDeclaration){const n=this.lookAheadMatch(e,t,"xml",!0);if(1===n){this.recordStart=t+4,this.state=10;break}if(0===n)return void this.waitForData(e,t)}return void this.emit("error",$.restrictedXML())}fe(n)&&!me(n)&&47!==n&&62!==n&&60!==n||(this.tagName=this.endRecording(e,t),t--,this.state=7)}break;case 5:62===n&&(this.lookBehindMatch(e,t,"--")||this.lookBehindMatch(e,t,"]]"))&&(this.state=9);break;case 10:if((120===n||88===n)&&this.lookBehindMatch(e,t,"?",!0))break;if((109===n||77===n)&&this.lookBehindMatch(e,t,"?x",!0))break;if((108===n||78===n)&&this.lookBehindMatch(e,t,"?xm",!0))break;if(me(n)){this.haveDeclaration=!0,this.state=6;break}return void this.emit("error",$.restrictedXML());case 6:62===n&&this.lookBehindMatch(e,t,"?")&&(this.state=9);break;case 7:62===n||60===n?(this.handleTagOpening(this.endTag,this.tagName,this.attributes),this.tagName=void 0,this.attributes=void 0,this.endTag=!1,this.selfClosing=!1,this.state=9,this.recordStart=t+1):47===n?this.selfClosing=!0:fe(n)&&32!==n&&(this.recordStart=t,this.state=1);break;case 1:fe(n)&&!me(n)&&61!==n||(this.attributeName=this.endRecording(e,t),61===n?this.state=2:(t--,this.state=0));break;case 0:if(me(n))break;if(61===n){this.state=2;break}return void this.emit("error",$.notWellFormed());case 2:if(me(n))break;if(34===n||39===n){this.attributeQuote=n,this.state=3,this.recordStart=t+1;break}return void this.emit("error",$.notWellFormed());case 3:if(n===this.attributeQuote){let n;try{n=te(this.endRecording(e,t))}catch(e){return void this.emit("error",e)}if(void 0!==this.attributes[this.attributeName])return void this.emit("error",$.notWellFormed());this.attributes[this.attributeName]=n,this.attributeName=void 0,this.state=7}}}void 0!==this.recordStart&&this.recordStart<=e.length&&(this.remainder=e.slice(this.recordStart),this.recordStart=0)}end(e){e&&this.write(e),this.write=()=>{}}endRecording(e,t){if(void 0!==this.recordStart){const n=e.slice(this.recordStart,t);return this.recordStart=void 0,n}return""}handleTagOpening(e,t,n){e?this.emit("endElement",t):(this.emit("startElement",t,n),this.selfClosing&&this.emit("endElement",t))}waitForData(e,t){this.remainder=e.substr(t),this.remainderPos=t}lookAheadMatch(e,t,n,i=!1){const r=n.length;let s=e.substr(t+1,r);return i&&(s=s.toLowerCase()),s.length===r&&s===n?1:s.length<r&&n.startsWith(s)?0:-1}lookBehindMatch(e,t,n,i=!1){return!(t-n.length<0)&&(i?e.substr(t-n.length,n.length).toLowerCase()===n:e.substr(t-n.length,n.length)===n)}}function ye(e,t,n,i){if(i){e=e||i.getNamespace();const n=i.getNamespaceRoot(e);if(n){t=`${n.useNamespace("",e)}:${t}`}}const r=new re(t);return t.indexOf(":")<0&&(!n||e!==n)&&r.setAttribute("xmlns",e),r}function be(e,t){return(e.getAttribute("xml:lang")||t||"").toLowerCase()}function _e(e,t){const n=[];for(const i of e)n.push(be(i,t.lang));let i;return i=t.resolveLanguage?t.resolveLanguage(n,t.acceptLanguages||[],t.lang):t.lang,i||""}function we(e,t,n,i){const r=e.getChildren(n,t),s=be(e);return r.length?i?r.filter(e=>{if(be(e,s)===i)return!0}):r:[]}function Se(e,t,n,i){t=t||e.getNamespace();const r=we(e,t,n,i);if(r.length)return r[0];const s=ye(t,n,e.getDefaultNamespace(),e),o=be(e,i);return i&&o!==i&&s.setAttribute("xml:lang",i),e.appendChild(s),s}function Ce(e){return{importer(t){const n=t.getAttribute(e.name,e.namespace);return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n)return;const i=e.writeValue(n);if(i||e.emitEmpty)if(e.namespace&&e.prefix){let n;const r=t.getNamespaceRoot(e.namespace);if(r)n=r.useNamespace(e.prefix,e.namespace);else{const i=t.getNamespaceContext();i[e.namespace]||(n=t.useNamespace(e.prefix,e.namespace),i[e.namespace]=n)}t.setAttribute(`${n}:${e.name}`,i,e.emitEmpty)}else t.setAttribute(e.name,i,e.emitEmpty)}}}function Ee(e,t){return(n,i,r={})=>(r=Object.assign({staticDefault:i},r),Ce(Object.assign(Object.assign({name:n},e),t?t(r):r)))}function ke(e,t){return(n,i,r,s,o={})=>(o=Object.assign({staticDefault:s},o),Ce(Object.assign(Object.assign({name:r,namespace:i,prefix:n},e),t?t(o):o)))}function xe(e){const t=e.converter||Ce(Object.assign(Object.assign({},e),{namespace:e.attributeNamespace}));return{importer(n,i){const r=n.getChild(e.element,e.namespace||n.getNamespace());return r?t.importer(r,i):e.dynamicDefault?e.dynamicDefault():e.staticDefault},exporter(n,i,r){if(void 0!==i){const s=Se(n,e.namespace||n.getNamespace(),e.element);t.exporter(s,i,r)}}}}function Ie(e,t){return(n,i,r,s,o={})=>(o=Object.assign({staticDefault:s},o),xe(Object.assign(Object.assign({element:i,name:r,namespace:n},e),t?t(o):o)))}function Oe(e){return{importer(t){const n=t.getText();return n?e.parseValue(n):e.dynamicDefault?e.dynamicDefault(n):e.staticDefault},exporter(t,n){if(void 0===n)return;const i=e.writeValue(n);i&&t.children.push(i)}}}function je(e){const t=Oe(e);return{importer(n,i){const r=we(n,e.namespace||n.getNamespace(),e.element),s=_e(r,i);if(!r.length)return e.dynamicDefault?e.dynamicDefault():e.staticDefault;if(e.matchLanguage)for(const e of r)if(be(e,i.lang)===s)return t.importer(e,i);return t.importer(r[0],i)},exporter(n,i,r){if(void 0!==i){const s=Se(n,e.namespace||n.getNamespace(),e.element,e.matchLanguage?r.lang:void 0);t.exporter(s,i,r)}}}}const Te={parseValue:e=>e,writeValue:e=>e},Re={parseValue:e=>parseInt(e,10),writeValue:e=>e.toString()},Ae={parseValue:e=>parseFloat(e),writeValue:e=>e.toString()},Pe={parseValue:e=>"true"===e||"1"===e||"false"!==e&&"0"!==e&&void 0,writeValue:e=>e?"1":"0"},De={parseValue:e=>new Date(e),writeValue:e=>"string"==typeof e?e:e.toISOString()},Me={parseValue:e=>JSON.parse(e),writeValue:e=>JSON.stringify(e)},qe=(t="utf8")=>({parseValue:n=>("base64"===t&&"="===n&&(n=""),e.from(n.trim(),t)),writeValue:n=>{let i;return i="string"==typeof n?e.from(n).toString(t):n?n.toString(t):"","base64"===t&&(i=i||"="),i}}),Ne={parseValue:e=>{let t=-1;"-"===e.charAt(0)&&(t=1,e=e.slice(1));const n=e.split(":");return(60*parseInt(n[0],10)+parseInt(n[1],10))*t},writeValue:e=>{if("string"==typeof e)return e;{let t="-";e<0&&(e=-e,t="+");const n=e/60,i=e%60;return t+=(n<10?"0":"")+n+":"+(i<10?"0":"")+i,t}}},Fe=Ee(Te,e=>Object.assign({dynamicDefault:e.emitEmpty?t=>""===t?"":e.staticDefault:void 0},e)),Le=Ee(Pe),Ue=Ee(Re),Be=(Ee(Ae),Ee(De)),ze=ke(Te),Ge=ke(Pe),We=(ke(Re),ke(Ae),ke(De),Ie(Te)),He=Ie(Pe),Ve=Ie(Re),$e=(Ie(Ae),Ie(De)),Je=e=>Oe(Object.assign({staticDefault:e},Te)),Ye=()=>Oe(Object.assign({},Me)),Qe=(e="utf8")=>Oe(Object.assign({},qe(e)));function Ke(){return{importer:(e,t)=>be(e,t.lang),exporter(e,t,n){t&&t.toLowerCase()!==n.lang?e.setAttribute("xml:lang",t):e.setAttribute("xml:lang",void 0)}}}const Xe=(e,t,n)=>je(Object.assign({element:t,matchLanguage:!0,namespace:e,staticDefault:n},Te)),Ze=(e,t,n="utf8")=>je(Object.assign({element:t,matchLanguage:!0,namespace:e},qe(n))),et=(e,t)=>je(Object.assign({element:t,namespace:e},De)),tt=(e,t,n)=>je(Object.assign({element:t,namespace:e,staticDefault:n},Re)),nt=(e,t,n)=>je(Object.assign({element:t,namespace:e,staticDefault:n},Ae)),it=(e,t)=>je(Object.assign({element:t,namespace:e},Me));function rt(e,t){return je(Object.assign({element:t,namespace:e,staticDefault:0},Ne))}function st(e,t){return{importer(n){if(n.getChild(t,e||n.getNamespace()))return!0},exporter(n,i){i&&Se(n,e||n.getNamespace(),t)}}}const ot=(e,t,n)=>{if(!n)return;let i=t;for(const t of e)i=Se(i,t.namespace||i.getNamespace(),t.element);i.children.push(n.toString())};function at(e,t){return{importer(n){let i=n;for(const n of e)if(i=i.getChild(n.element,n.namespace||i.getNamespace()),!i)return t;return i.getText()||t},exporter(t,n){ot(e,t,n)}}}function ct(e,t){return{importer(n){let i=n;for(const t of e)if(i=i.getChild(t.element,t.namespace||i.getNamespace()),!i)return;const r=i.getText();return r?parseInt(r,10):t||void 0},exporter(t,n){ot(e,t,n)}}}function ut(e){return{importer(t){let n=t;for(const t of e)if(n=n.getChild(t.element,t.namespace||n.getNamespace()),!n)return!1;return!0},exporter(t,n){if(!n)return;let i=t;for(const t of e)i=Se(i,t.namespace||i.getNamespace(),t.element)}}}function ht(e,t,n){const i=new Map,r=new Map;for(const e of t)"string"==typeof e?(i.set(e,e),r.set(e,e)):(i.set(e[1],e[0]),r.set(e[0],e[1]));return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&i.has(n.getName()))return i.get(n.getName());return n},exporter(t,n){r.has(n)&&Se(t,e,r.get(n))}}}function lt(e,t,n,i){const r=new Set(t),s=new Set(n);return{importer(t){for(const n of t.children)if("string"!=typeof n&&n.getNamespace()===(e||t.getNamespace())&&r.has(n.getName())){for(const i of n.children)if("string"!=typeof i&&i.getNamespace()===(e||t.getNamespace())&&s.has(i.getName()))return[n.getName(),i.getName()];return[n.getName()]}return i},exporter(t,n){const i=Se(t,e,n[0]);n[1]&&Se(i,e,n[1])}}}function dt(e,t){return{importer(n,i){const r=[],s=we(n,e||n.getNamespace(),t),o=_e(s,i);for(const e of s)be(e,i.lang)===o&&r.push(e.getText());return r},exporter(n,i,r){for(const s of i){const i=ye(e||n.getNamespace(),t,r.namespace,n);i.children.push(s),n.appendChild(i)}}}}function pt(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(t)}return r},exporter(i,r,s){for(const o of r){const r=ye(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,o),i.appendChild(r)}}}}function ft(e,t,n){return{importer(i){const r=[],s=i.getChildren(t,e||i.getNamespace());for(const e of s){const t=e.getAttribute(n);void 0!==t&&r.push(parseInt(t,10))}return r},exporter(i,r,s){for(const o of r){const r=ye(e||i.getNamespace(),t,s.namespace,i);r.setAttribute(n,o.toString()),i.appendChild(r)}}}}function mt(e,t){return{importer(n,i){const r=[],s=we(n,e||n.getNamespace(),t),o=new Set;for(const e of s){const t=e.getText();if(t){const n=be(e,i.lang);if(o.has(n))continue;r.push({lang:n,value:t}),o.add(n)}}return o.size>0?r:void 0},exporter(n,i,r){for(const s of i){const i=s.value;if(i){const o=ye(e||n.getNamespace(),t,r.namespace,n);s.lang!==r.lang&&o.setAttribute("xml:lang",s.lang),o.children.push(i),n.appendChild(o)}}}}}function gt(e,t){const n=new Map,i=new Map;for(const e of t)"string"==typeof e?(n.set(e,e),i.set(e,e)):(n.set(e[1],e[0]),i.set(e[0],e[1]));return{importer(t){const i=[];for(const r of t.children)"string"!=typeof r&&r.getNamespace()===(e||t.getNamespace())&&n.has(r.getName())&&i.push(n.get(r.getName()));return i},exporter(t,n){for(const r of n)Se(t,e,i.get(r))}}}function vt(e,t,n,i=!1){return{importer(r,s){const o=r.getChild(t,e||r.getNamespace());if(!o)return;const a=[];for(const e of o.children)if("string"!=typeof e&&s.registry.getImportKey(e)===n){const t=s.registry.import(e);t&&a.push(t)}return i?a:a[0]},exporter(i,r,s){let o=[];o=Array.isArray(r)?r:[r];const a=[];for(const t of o){const r=s.registry.export(n,t,Object.assign(Object.assign({},s),{namespace:e||i.getNamespace()||void 0}));r&&a.push(r)}if(a.length){const n=Se(i,e||i.getNamespace(),t);for(const e of a)n.appendChild(e)}}}}function yt(e){return{exporter:()=>{},importer:()=>e}}function bt(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=we(i,e||i.getNamespace(),t),o=_e(s,r);for(const e of s)if(be(e,r.lang)===o)return n?r.sanitizers[n](e.toJSON()):e.toJSON();return s[0]?n?r.sanitizers[n](s[0].toJSON()):s[0].toJSON():void 0},exporter(i,r,s){if("string"==typeof r){r=ge(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])return;r=s.sanitizers[n](r)}if(!r)return;const o=Se(i,e||i.getNamespace(),t,s.lang);for(const e of r.children)"string"==typeof e?o.appendChild(e):e&&o.appendChild(new re(e.name,e.attributes,e.children))}}}function _t(e,t,n){return{importer(i,r){if(n&&(!r.sanitizers||!r.sanitizers[n]))return;const s=[],o=new Set,a=we(i,e||i.getNamespace(),t);for(const e of a){let t=e.toJSON();if(n&&(t=r.sanitizers[n](t)),t){const n=be(e,r.lang);if(o.has(n))continue;s.push({lang:n,value:t}),o.add(n)}}return o.size>0?s:void 0},exporter(i,r,s){for(const o of r){let r=o.value;if("string"==typeof r){r=ge(`<${t} xmlns="${e||i.getNamespace()}">${r}</${t}>`).toJSON()}if(r&&n){if(!s.sanitizers||!s.sanitizers[n])continue;r=s.sanitizers[n](r)}if(r){const n=ye(e||i.getNamespace(),t,s.namespace,i);i.appendChild(n),o.lang!==s.lang&&n.setAttribute("xml:lang",o.lang);for(const e of r.children)"string"==typeof e?n.appendChild(e):n.appendChild(new re(e.name,e.attributes,e.children))}}}}}function wt(e,t,n,i){return{importer(r,s){const o={},a=we(r,e,t),c=Fe(n).importer,u=Fe(i).importer;for(const e of a)o[c(e,s)]=u(e,s);return o},exporter(r,s,o){const a=Fe(n).exporter,c=Fe(i).exporter,u=e||r.getNamespace();for(const[e,n]of Object.entries(s)){const i=ye(u,t,o.namespace,r);a(i,e,o),s[e]&&c(i,n,o),r.appendChild(i)}}}}class St{constructor(){this.parents=new Set,this.placeholder=!1,this.typeField="",this.defaultType="",this.languageField="lang",this.typeValues=new Map,this.typeOrders=new Map,this.importers=new Map,this.exporters=new Map,this.children=new Map,this.childrenIndex=new Map,this.implicitChildren=new Set,this.contexts=new Map}addChild(e,t,n=!1,i,r){const s={multiple:n||!1,name:e,selector:i,translator:t},o=this.children.get(e);if(!o){s.translator.parents.add(this),this.children.set(e,s);for(const[n]of t.importers)this.implicitChildren.has(n)||this.childrenIndex.set(n,e);return void(r&&this.implicitChildren.add(r))}const a=o.translator;o.multiple=n,i&&o.selector&&i!==o.selector&&(o.selector=void 0);for(const[n,i]of t.importers)a.updateDefinition({contexts:t.contexts,element:i.element,exporterOrdering:new Map,exporters:new Map,importerOrdering:i.fieldOrders,importers:i.fields,namespace:i.namespace,optionalNamespaces:new Map,type:a.typeValues.get(n)}),this.implicitChildren.has(n)||this.childrenIndex.set(n,e);for(const[e,n]of t.exporters)a.updateDefinition({contexts:t.contexts,element:n.element,exporterOrdering:n.fieldOrders,exporters:n.fields,importerOrdering:new Map,importers:new Map,namespace:n.namespace,optionalNamespaces:n.optionalNamespaces,type:e})}addContext(e,t,n,i,r,s=!1){t&&(e=`${e}[${t}]`);let o=this.contexts.get(e);o||(o={typeField:"",typeValues:new Map}),s&&(o.impliedType=r),o.typeField=n||"",o.typeValues.set(i,r),this.contexts.set(e,o)}getChild(e){const t=this.children.get(e);if(t)return t.translator}getImportKey(e){return this.childrenIndex.get(`{${e.getNamespace()}}${e.getName()}`)}updateDefinition(e){const t=`{${e.namespace}}${e.element}`,n=this.importers.get(t)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace};for(const[t,i]of e.importers)n.fields.set(t,i);for(const[t,i]of e.importerOrdering)n.fieldOrders.set(t,i);this.importers.set(t,n);const i=this.exporters.get(e.type||this.defaultType)||{element:e.element,fieldOrders:new Map,fields:new Map,namespace:e.namespace,optionalNamespaces:e.optionalNamespaces};for(const[t,n]of e.exporters)i.fields.set(t,n);for(const[t,n]of e.exporterOrdering)i.fieldOrders.set(t,n);for(const[t,n]of e.optionalNamespaces)i.optionalNamespaces.set(t,n);this.exporters.set(e.type||this.defaultType,i);for(const[t,n]of e.contexts){const e=this.contexts.get(t)||{impliedType:void 0,typeField:n.typeField,typeValues:new Map};e.typeField||(e.typeField=n.typeField),e.impliedType||(e.impliedType=n.impliedType);for(const[t,i]of n.typeValues)e.typeValues.set(t,i);this.contexts.set(t,e)}if(e.type)this.typeValues.set(t,e.type),e.typeOrder&&this.typeOrders.set(e.type,e.typeOrder);else if(this.typeField&&!e.type){for(const[,t]of this.importers){for(const[n,i]of e.importers)t.fields.set(n,i);for(const[n,i]of e.importerOrdering)t.fieldOrders.set(n,i)}for(const[,t]of this.exporters){for(const[n,i]of e.exporters)t.fields.set(n,i);for(const[n,i]of e.exporterOrdering)t.fieldOrders.set(n,i)}}}replaceWith(e){for(const[t,n]of this.children)e.children.set(t,n);for(const[t,n]of this.childrenIndex)e.childrenIndex.set(t,n);for(const[t,n]of this.contexts)e.contexts.set(t,n);for(const t of this.implicitChildren)e.implicitChildren.add(t);for(const t of this.parents)for(const n of t.children.values())n.translator===this&&(n.translator=e);this.parents=new Set}import(e,t){const n=`{${e.getNamespace()}}${e.getName()}`,i={},r=this.importers.get(n);if(!r)return;const s=this.typeValues.get(n),o=t.path||"";let a;if(t.pathSelector&&(a=this.contexts.get(`${o}[${t.pathSelector}]`)),a||(a=this.contexts.get(o)),a){if(!a.impliedType){const e=a.typeValues.get(n);e&&(i[a.typeField]=e)}}else this.typeField&&s&&s!==this.defaultType&&(i[this.typeField]=s);const c=Object.assign(Object.assign({},t),{data:i,importer:r,lang:(e.getAttribute("xml:lang")||t.lang||"").toLowerCase(),pathSelector:s,translator:this}),u=[...r.fieldOrders.entries()].sort((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0),h=u.filter(e=>e[1]>=0),l=u.filter(e=>e[1]<0);for(const[n]of h){const s=r.fields.get(n);c.path=`${t.path}.${n}`;const o=s(e,c);null!=o&&(i[n]=o)}for(const n of e.children){if("string"==typeof n)continue;const e=`{${n.getNamespace()}}${n.getName()}`,r=this.childrenIndex.get(e);if(!r)continue;c.path=`${t.path}.${r}`;const{translator:o,multiple:a,selector:u}=this.children.get(r);if(!u||u===s){const e=o.import(n,c);void 0!==e&&(a?(i[r]||(i[r]=[]),i[r].push(e)):i[r]?i[r]=o.resolveCollision(i[r],e):i[r]=e)}}for(const[n]of l){const s=r.fields.get(n);c.path=`${t.path}.${n}`;const o=s(e,c);null!=o&&(i[n]=o)}return i}export(e,t){if(!e)return;let n=this.defaultType;const i=t.path||"";let r;t.pathSelector&&(r=this.contexts.get(`${i}[${t.pathSelector}]`)),r||(r=this.contexts.get(i)),r?n=r.impliedType||e[r.typeField]||this.defaultType:this.typeField&&(n=e[this.typeField]||this.defaultType);const s=this.exporters.get(n);if(!s)return;const o=ye(s.namespace,s.element,t.namespace,t.element);t.element&&(o.parent=t.element);for(const[e,t]of s.optionalNamespaces)o.addOptionalNamespace(e,t);const a=Object.assign(Object.assign({},t),{data:e,element:o,exporter:s,lang:(e[this.languageField]||t.lang||"").toLowerCase(),namespace:o.getDefaultNamespace(),pathSelector:n,translator:this}),c=s.fields.get(this.languageField);c&&c(o,e[this.languageField],t);const u=Object.keys(e);u.sort((e,t)=>(s.fieldOrders.get(e)||1e5)-(s.fieldOrders.get(t)||1e5));for(const i of u){if(i===this.languageField)continue;const r=e[i],c=s.fields.get(i);if(c){c(o,r,a);continue}const u=this.children.get(i);if(!u)continue;a.path=`${t.path?t.path+".":""}${i}`;const{translator:h,multiple:l,selector:d}=u;if(!d||d===n){let e;e=l?r:[r];for(const t of e){const e=h.export(t,a);e&&o.appendChild(e)}}}return o}resolveCollision(e,t){return(this.typeOrders.get(e[this.typeField]||this.defaultType)||0)<=(this.typeOrders.get(t[this.typeField]||this.defaultType)||0)?e:t}}class Ct{constructor(){this.languageResolver=ie,this.translators=new Map,this.root=new St}setLanguageResolver(e){this.languageResolver=e}import(e,t={registry:this}){if(!this.hasTranslator(e.getNamespace(),e.getName()))return;return t.acceptLanguages?t.acceptLanguages=t.acceptLanguages.map(e=>e.toLowerCase()):t.acceptLanguages=[],t.lang&&(t.lang=t.lang.toLowerCase()),t.resolveLanguage||(t.resolveLanguage=this.languageResolver),t.path=this.getImportKey(e),t.sanitizers||(t.sanitizers={xhtmlim:de}),this.getOrCreateTranslator(e.getNamespace(),e.getName()).import(e,Object.assign(Object.assign({},t),{registry:this}))}export(e,t,n={registry:this}){n.acceptLanguages?n.acceptLanguages=n.acceptLanguages.map(e=>e.toLowerCase()):n.acceptLanguages=[],n.lang&&(n.lang=n.lang.toLowerCase()),n.sanitizers||(n.sanitizers={xhtmlim:de}),n.path=e;const i=e.split(".").filter(e=>""!==e);let r=this.root;for(const e of i){const t=r.getChild(e);if(!t)return;r=t}return r.export(t,Object.assign(Object.assign({},n),{registry:this}))}getImportKey(e,t=""){const n=t?this.walkToTranslator(t.split(".")):this.root;if(n)return n.getImportKey(e)}define(e){if(Array.isArray(e)){for(const t of e)"object"==typeof t?this.define(t):t(this);return}if("object"!=typeof e)return void e(this);const t=e;t.aliases=t.aliases||[],t.path&&!t.aliases.includes(t.path)&&t.aliases.push(t.path);const n=t.aliases.map(e=>"string"==typeof e?{path:e}:e).sort((e,t)=>{const n=e.path.split(".").length;return t.path.split(".").length-n});let i;if(this.hasTranslator(t.namespace,t.element)&&(i=this.getOrCreateTranslator(t.namespace,t.element)),!i){let e;for(const t of n){const n=this.walkToTranslator(t.path.split("."));if(n&&!n.placeholder){i=n;break}n&&(e=n)}e&&!i&&(i=e,i.placeholder=!1)}i||(i=this.getOrCreateTranslator(t.namespace,t.element)),this.indexTranslator(t.namespace,t.element,i);const r=t.fields||{},s=new Map,o=new Map,a=new Map,c=new Map;t.typeField&&(i.typeField=t.typeField),t.defaultType&&(i.defaultType=t.defaultType),t.languageField&&(i.languageField=t.languageField);for(const e of Object.keys(r)){const t=r[e];s.set(e,t.importer),a.set(e,t.importOrder||t.order||0),o.set(e,t.exporter),c.set(e,t.exportOrder||t.order||0)}if(t.childrenExportOrder)for(const[e,n]of Object.entries(t.childrenExportOrder))c.set(e,n||0);const u=new Map;for(const[e,n]of Object.entries(t.optionalNamespaces||{}))u.set(e,n);i.updateDefinition({contexts:new Map,element:t.element,exporterOrdering:c,exporters:o,importerOrdering:a,importers:s,namespace:t.namespace,optionalNamespaces:u,type:t.type,typeOrder:t.typeOrder});for(const e of n)"string"==typeof e?this.alias(t.namespace,t.element,e):this.alias(t.namespace,t.element,e.path,e.multiple,e.selector,e.contextField,t.type,e.impliedType);for(const e of n){const t=this.walkToTranslator(e.path.split("."));t&&t!==i&&t.replaceWith(i)}}alias(e,t,n,i=!1,r,s,o,a=!1){const c=this.getOrCreateTranslator(e,t);c.placeholder=!1;const u=n.split(".").filter(e=>""!==e),h=u.pop(),l=this.walkToTranslator(u,!0),d=`{${e}}${t}`;o&&(s||a)&&c.addContext(n,r,s,d,o,a),l.addChild(h,c,i,r,d)}walkToTranslator(e,t=!1){let n=this.root;for(const i of e){let e=n.getChild(i);if(!e){if(!t)return;e=new St,e.placeholder=!0,n.addChild(i,e)}n=e}return n}hasTranslator(e,t){return this.translators.has(`{${e}}${t}`)}getOrCreateTranslator(e,t){let n=this.translators.get(`{${e}}${t}`);return n||(n=new St,this.indexTranslator(e,t,n)),n}indexTranslator(e,t,n){this.translators.set(`{${e}}${t}`,n)}}const Et="urn:ietf:params:xml:ns:xmpp-bind",kt="jabber:client",xt="urn:ietf:params:xml:ns:xmpp-sasl",It="urn:ietf:params:xml:ns:xmpp-session",Ot="urn:ietf:params:xml:ns:xmpp-stanzas",jt="http://etherx.jabber.org/streams",Tt="urn:ietf:params:xml:ns:xmpp-streams",Rt="urn:ietf:params:xml:ns:xmpp-tls",At="urn:ietf:params:xml:ns:xmpp-framing",Pt="jabber:x:data",Dt="jabber:iq:privacy",Mt="http://jabber.org/protocol/disco#info",qt="http://jabber.org/protocol/disco#items",Nt="http://jabber.org/protocol/address",Ft="http://jabber.org/protocol/muc",Lt="http://jabber.org/protocol/muc#admin",Ut="http://jabber.org/protocol/muc#owner",Bt="http://jabber.org/protocol/muc#user",zt="http://jabber.org/protocol/ibb",Gt="http://jabber.org/protocol/commands",Wt="http://jabber.org/protocol/rsm",Ht="http://jabber.org/protocol/pubsub",Vt="http://jabber.org/protocol/pubsub#errors",$t="http://jabber.org/protocol/pubsub#event",Jt="http://jabber.org/protocol/pubsub#owner",Yt="http://jabber.org/protocol/bytestreams",Qt="jabber:x:oob",Kt="http://www.w3.org/1999/xhtml",Xt="http://jabber.org/protocol/xhtml-im",Zt="http://jabber.org/protocol/geoloc",en="urn:xmpp:avatar:data",tn="urn:xmpp:avatar:metadata",nn="http://jabber.org/protocol/chatstates",rn="http://jabber.org/protocol/mood",sn="http://jabber.org/protocol/activity",on="http://jabber.org/protocol/tune",an="http://jabber.org/protocol/xdata-validate",cn="http://jabber.org/protocol/httpbind",un="http://jabber.org/protocol/shim",hn="http://jabber.org/protocol/compress",ln="http://jabber.org/protocol/xdata-layout",dn="http://jabber.org/protocol/rosterx",pn=e=>`${e}+notify`,fn="urn:xmpp:jingle:1",mn="urn:xmpp:jingle:apps:rtp:1",gn="urn:xmpp:jingle:apps:rtp:info:1",vn="http://jabber.org/protocol/nick",yn="urn:xmpp:jingle:transports:ice-udp:1",bn="urn:xmpp:jingle:transports:raw-udp:1",_n="urn:xmpp:sm:3",wn="urn:xmpp:delay",Sn="urn:xmpp:bob",Cn="urn:xmpp:jingle:apps:file-transfer:5",En="urn:xmpp:jingle:apps:xmlstream:0",kn="urn:xmpp:jingle:transports:s5b:1",xn="urn:xmpp:jingle:transports:ibb:1",In="urn:xmpp:carbons:2",On="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",jn="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",Tn="urn:xmpp:forward:0",Rn="urn:xmpp:hashes:2",An=e=>`urn:xmpp:hash-function-text-names:${e}`,Pn="urn:xmpp:rtt:0",Dn="urn:xmpp:mam:2",Mn="urn:xmpp:hats:0",qn="urn:xmpp:chat-markers:0",Nn="urn:xmpp:hints",Fn="urn:xmpp:json:0",Ln="urn:xmpp:jingle:apps:rtp:ssma:0",Un="urn:xmpp:push:0",Bn="urn:xmpp:http:upload:0",zn="urn:xmpp:jingle:transports:ice:0",Gn="eu.siacs.conversations.axolotl",Wn="http://docs.oasis-open.org/ns/xri/xrd-1.0";const Hn=Fe,Vn=We;function $n(e,t,n){return{aliases:Array.isArray(n)?n:[n],element:t,fields:{},namespace:e}}function Jn(e){return{element:"message",fields:e,namespace:kt}}function Yn(e){return{element:"presence",fields:e,namespace:kt}}function Qn(e){return{element:"iq",fields:e,namespace:kt}}function Kn(e){return{element:"features",fields:e,namespace:jt}}function Xn(e){return{element:"error",fields:e,namespace:Ot,path:"stanzaError"}}class Zn extends c.Transform{constructor(e){super({objectMode:!0}),this.closedStream=!1,this.wrappedStream=!1,this.registry=e.registry,this.acceptLanguages=e.acceptLanguages||[],e.wrappedStream&&(this.wrappedStream=!0,this.rootImportKey=e.rootKey),this.parser=new ve({allowComments:e.allowComments}),this.parser.on("error",e=>{this.destroy(e)}),this.parser.on("startElement",(e,t)=>{if(this.destroyed)return;if(this.closedStream)return this.destroy($.alreadyClosed());const n=new re(e,t),i=this.registry.getImportKey(n);if(this.wrappedStream&&!this.rootElement){if(this.rootImportKey&&i!==this.rootImportKey)return this.destroy($.unknownRoot());const e=this.registry.import(n,{acceptLanguages:this.acceptLanguages,lang:this.lang});return e?(this.rootElement=n,void this.push({event:"stream-start",kind:i,stanza:e,xml:n})):this.destroy($.notWellFormed())}this.currentElement?this.currentElement=this.currentElement.appendChild(n):this.currentElement=n}),this.parser.on("endElement",e=>{if(!this.destroyed){if(this.wrappedStream&&!this.currentElement)return this.rootElement&&e===this.rootElement.name?(this.closedStream=!0,this.push({event:"stream-end",kind:this.rootImportKey,stanza:{},xml:this.rootElement}),this.end()):(this.closedStream=!0,this.destroy($.notWellFormed()));if(!this.currentElement||e!==this.currentElement.name)return this.closedStream=!0,this.destroy($.notWellFormed());if(this.currentElement.parent)this.currentElement=this.currentElement.parent;else{this.wrappedStream&&(this.currentElement.parent=this.rootElement);const e=this.registry.getImportKey(this.currentElement),t=this.registry.import(this.currentElement,{acceptLanguages:this.acceptLanguages,lang:this.lang});t&&this.push({kind:e,stanza:t,xml:this.currentElement}),this.currentElement=void 0}}}),this.parser.on("text",e=>{this.currentElement&&this.currentElement.children.push(e)})}_transform(e,t,n){this.parser.write(e.toString()),n()}}class ei extends c.Transform{constructor(t,n,i="be"){super(),this._block=e.alloc(t),this._finalSize=n,this._blockSize=t,this._bigEndian="be"===i,this._len=0}_transform(e,t,n){let i=null;try{this.update(e,t)}catch(e){i=e}n(i)}_flush(e){let t=null;try{this.push(this.digest())}catch(e){t=e}e(t)}update(t,n){"string"==typeof t&&(n=n||"utf8",t=e.from(t,n));const i=this._block,r=this._blockSize,s=t.length;let o=this._len;for(let e=0;e<s;){const n=o%r,a=Math.min(s-e,r-n);for(let r=0;r<a;r++)i[n+r]=t[e+r];o+=a,e+=a,o%r==0&&this._update(i)}return this._len+=s,this}digest(e){const t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));const n=8*this._len;if(n<=4294967295)this._bigEndian?(this._block.writeUInt32BE(0,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)):(this._block.writeUInt32LE(n,this._blockSize-8),this._block.writeUInt32LE(0,this._blockSize-4));else{const e=(4294967295&n)>>>0,t=(n-e)/4294967296;this._bigEndian?(this._block.writeUInt32BE(t,this._blockSize-8),this._block.writeUInt32BE(e,this._blockSize-4)):(this._block.writeUInt32LE(e,this._blockSize-8),this._block.writeUInt32LE(t,this._blockSize-4))}this._update(this._block);const i=this._hash();return e?i.toString(e):i}_update(e){throw new Error("_update must be implemented by subclass")}_hash(){throw new Error("_update must be implemented by subclass")}}function ti(e,t){return e<<t|e>>>32-t}function ni(e,t,n,i,r,s,o){return ti(e+(t&n|~t&i)+r+s|0,o)+t|0}function ii(e,t,n,i,r,s,o){return ti(e+(t&i|n&~i)+r+s|0,o)+t|0}function ri(e,t,n,i,r,s,o){return ti(e+(t^n^i)+r+s|0,o)+t|0}function si(e,t,n,i,r,s,o){return ti(e+(n^(t|~i))+r+s|0,o)+t|0}const oi=[1518500249,1859775393,-1894007588,-899497514];function ai(e){return e<<5|e>>>27}function ci(e){return e<<30|e>>>2}function ui(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}class hi extends ei{constructor(){super(64,56),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this._w=new Array(80)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<80;++n)t[n]=(c=t[n-3]^t[n-8]^t[n-14]^t[n-16])<<1|c>>>31;var c;for(let e=0;e<80;++e){const n=~~(e/20),c=ai(i)+ui(n,r,s,o)+a+t[e]+oi[n]|0;a=o,o=s,s=ci(r),r=i,i=c}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0}_hash(){const t=e.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t}}const li=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function di(e,t,n){return n^e&(t^n)}function pi(e,t,n){return e&t|n&(e|t)}function fi(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function mi(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function gi(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}class vi extends ei{constructor(){super(64,56),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=new Array(64)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e,c=0|this._f,u=0|this._g,h=0|this._h;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<64;++n)t[n]=0|(((l=t[n-2])>>>17|l<<15)^(l>>>19|l<<13)^l>>>10)+t[n-7]+gi(t[n-15])+t[n-16];var l;for(let e=0;e<64;++e){const n=h+mi(a)+di(a,c,u)+li[e]+t[e]|0,l=fi(i)+pi(i,r,s)|0;h=u,u=c,c=a,a=o+n|0,o=s,s=r,r=i,i=n+l|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0,this._f=c+this._f|0,this._g=u+this._g|0,this._h=h+this._h|0}_hash(){const t=e.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t}}const yi=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function bi(e,t,n){return n^e&(t^n)}function _i(e,t,n){return e&t|n&(e|t)}function wi(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function Si(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function Ci(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function Ei(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function ki(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function xi(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function Ii(e,t){return e>>>0<t>>>0?1:0}class Oi extends ei{constructor(){super(128,112),this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this._w=new Array(160)}_update(e){const t=this._w;let n,i,r=0|this._ah,s=0|this._bh,o=0|this._ch,a=0|this._dh,c=0|this._eh,u=0|this._fh,h=0|this._gh,l=0|this._hh,d=0|this._al,p=0|this._bl,f=0|this._cl,m=0|this._dl,g=0|this._el,v=0|this._fl,y=0|this._gl,b=0|this._hl,_=0;for(_=0;_<32;_+=2)t[_]=e.readInt32BE(4*_),t[_+1]=e.readInt32BE(4*_+4);for(;_<160;_+=2){let e=t[_-30],r=t[_-30+1];const s=Ci(e,r),o=Ei(r,e);e=t[_-4],r=t[_-4+1];const a=ki(e,r),c=xi(r,e),u=t[_-14],h=t[_-14+1],l=t[_-32],d=t[_-32+1];i=o+h|0,n=s+u+Ii(i,o)|0,i=i+c|0,n=n+a+Ii(i,c)|0,i=i+d|0,n=n+l+Ii(i,d)|0,t[_]=n,t[_+1]=i}for(let e=0;e<160;e+=2){n=t[e],i=t[e+1];const _=_i(r,s,o),w=_i(d,p,f),S=wi(r,d),C=wi(d,r),E=Si(c,g),k=Si(g,c),x=yi[e],I=yi[e+1],O=bi(c,u,h),j=bi(g,v,y);let T=b+k|0,R=l+E+Ii(T,b)|0;T=T+j|0,R=R+O+Ii(T,j)|0,T=T+I|0,R=R+x+Ii(T,I)|0,T=T+i|0,R=R+n+Ii(T,i)|0;const A=C+w|0,P=S+_+Ii(A,C)|0;l=h,b=y,h=u,y=v,u=c,v=g,g=m+T|0,c=a+R+Ii(g,m)|0,a=o,m=f,o=s,f=p,s=r,p=d,d=T+A|0,r=R+P+Ii(d,T)|0}this._al=this._al+d|0,this._bl=this._bl+p|0,this._cl=this._cl+f|0,this._dl=this._dl+m|0,this._el=this._el+g|0,this._fl=this._fl+v|0,this._gl=this._gl+y|0,this._hl=this._hl+b|0,this._ah=this._ah+r+Ii(this._al,d)|0,this._bh=this._bh+s+Ii(this._bl,p)|0,this._ch=this._ch+o+Ii(this._cl,f)|0,this._dh=this._dh+a+Ii(this._dl,m)|0,this._eh=this._eh+c+Ii(this._el,g)|0,this._fh=this._fh+u+Ii(this._fl,v)|0,this._gh=this._gh+h+Ii(this._gl,y)|0,this._hh=this._hh+l+Ii(this._hl,b)|0}_hash(){const t=e.allocUnsafe(64);function n(e,n,i){t.writeInt32BE(e,i),t.writeInt32BE(n,i+4)}return n(this._ah,this._al,0),n(this._bh,this._bl,8),n(this._ch,this._cl,16),n(this._dh,this._dl,24),n(this._eh,this._el,32),n(this._fh,this._fl,40),n(this._gh,this._gl,48),n(this._hh,this._hl,56),t}}const ji=new Map([["md5",class extends ei{constructor(){super(64,56,"le"),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._m=new Array(16)}_update(e){const t=this._m;for(let n=0;n<16;++n)t[n]=e.readInt32LE(4*n);let n=this._a,i=this._b,r=this._c,s=this._d;n=ni(n,i,r,s,t[0],3614090360,7),s=ni(s,n,i,r,t[1],3905402710,12),r=ni(r,s,n,i,t[2],606105819,17),i=ni(i,r,s,n,t[3],3250441966,22),n=ni(n,i,r,s,t[4],4118548399,7),s=ni(s,n,i,r,t[5],1200080426,12),r=ni(r,s,n,i,t[6],2821735955,17),i=ni(i,r,s,n,t[7],4249261313,22),n=ni(n,i,r,s,t[8],1770035416,7),s=ni(s,n,i,r,t[9],2336552879,12),r=ni(r,s,n,i,t[10],4294925233,17),i=ni(i,r,s,n,t[11],2304563134,22),n=ni(n,i,r,s,t[12],1804603682,7),s=ni(s,n,i,r,t[13],4254626195,12),r=ni(r,s,n,i,t[14],2792965006,17),i=ni(i,r,s,n,t[15],1236535329,22),n=ii(n,i,r,s,t[1],4129170786,5),s=ii(s,n,i,r,t[6],3225465664,9),r=ii(r,s,n,i,t[11],643717713,14),i=ii(i,r,s,n,t[0],3921069994,20),n=ii(n,i,r,s,t[5],3593408605,5),s=ii(s,n,i,r,t[10],38016083,9),r=ii(r,s,n,i,t[15],3634488961,14),i=ii(i,r,s,n,t[4],3889429448,20),n=ii(n,i,r,s,t[9],568446438,5),s=ii(s,n,i,r,t[14],3275163606,9),r=ii(r,s,n,i,t[3],4107603335,14),i=ii(i,r,s,n,t[8],1163531501,20),n=ii(n,i,r,s,t[13],2850285829,5),s=ii(s,n,i,r,t[2],4243563512,9),r=ii(r,s,n,i,t[7],1735328473,14),i=ii(i,r,s,n,t[12],2368359562,20),n=ri(n,i,r,s,t[5],4294588738,4),s=ri(s,n,i,r,t[8],2272392833,11),r=ri(r,s,n,i,t[11],1839030562,16),i=ri(i,r,s,n,t[14],4259657740,23),n=ri(n,i,r,s,t[1],2763975236,4),s=ri(s,n,i,r,t[4],1272893353,11),r=ri(r,s,n,i,t[7],4139469664,16),i=ri(i,r,s,n,t[10],3200236656,23),n=ri(n,i,r,s,t[13],681279174,4),s=ri(s,n,i,r,t[0],3936430074,11),r=ri(r,s,n,i,t[3],3572445317,16),i=ri(i,r,s,n,t[6],76029189,23),n=ri(n,i,r,s,t[9],3654602809,4),s=ri(s,n,i,r,t[12],3873151461,11),r=ri(r,s,n,i,t[15],530742520,16),i=ri(i,r,s,n,t[2],3299628645,23),n=si(n,i,r,s,t[0],4096336452,6),s=si(s,n,i,r,t[7],1126891415,10),r=si(r,s,n,i,t[14],2878612391,15),i=si(i,r,s,n,t[5],4237533241,21),n=si(n,i,r,s,t[12],1700485571,6),s=si(s,n,i,r,t[3],2399980690,10),r=si(r,s,n,i,t[10],4293915773,15),i=si(i,r,s,n,t[1],2240044497,21),n=si(n,i,r,s,t[8],1873313359,6),s=si(s,n,i,r,t[15],4264355552,10),r=si(r,s,n,i,t[6],2734768916,15),i=si(i,r,s,n,t[13],1309151649,21),n=si(n,i,r,s,t[4],4149444226,6),s=si(s,n,i,r,t[11],3174756917,10),r=si(r,s,n,i,t[2],718787259,15),i=si(i,r,s,n,t[9],3951481745,21),this._a=this._a+n|0,this._b=this._b+i|0,this._c=this._c+r|0,this._d=this._d+s|0}_hash(){const t=e.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t}}],["sha-1",hi],["sha-256",vi],["sha-512",Oi],["sha1",hi],["sha256",vi],["sha512",Oi]]);function Ti(e){e=e.toLowerCase();const t=ji.get(e);if(t)return new t;throw new Error("Unsupported hash algorithm: "+e)}const Ri=e.alloc(128);class Ai extends c.Transform{constructor(t,n){super(),"string"==typeof n&&(n=e.from(n));const i="sha512"===t?128:64;this._alg=t,n.length>i?n=Ti(t).update(n).digest():n.length<i&&(n=e.concat([n,Ri],i)),this._ipad=e.alloc(i),this._opad=e.alloc(i);for(let e=0;e<i;e++)this._ipad[e]=54^n[e],this._opad[e]=92^n[e];this._hash=Ti(t).update(this._ipad)}_transform(e,t,n){let i;try{this.update(e,t)}catch(e){i=e}finally{n(i)}}_flush(e){let t;try{this.push(this._final())}catch(e){t=e}e(t)}_final(){const e=this._hash.digest();return Ti(this._alg).update(this._opad).update(e).digest()}update(e,t){return this._hash.update(e,t),this}digest(t){const n=this._final()||e.alloc(0);return t?n.toString(t):n}}let Pi;function Di(t){const n=new Uint8Array(t);return t>0&&(Pi.crypto||Pi.msCrypto).getRandomValues(n),e.from(n.buffer)}"undefined"!=typeof window?Pi=window:void 0!==i&&(Pi=i);const Mi=fetch,qi=WebSocket;class Ni{constructor(e){this.authenticated=!1,this.mutuallyAuthenticated=!1,this.name=e}getCacheableCredentials(){return null}processChallenge(e){}processSuccess(e){this.authenticated=!0,e&&this.processChallenge(e)}finalize(){return{authenticated:this.authenticated,mutuallyAuthenticated:this.mutuallyAuthenticated}}}class Fi{constructor(){this.mechanisms=[]}register(e,t,n){this.mechanisms.push({constructor:t,name:e.toUpperCase(),priority:n||this.mechanisms.length}),this.mechanisms.sort((e,t)=>t.priority-e.priority)}disable(e){const t=e.toUpperCase();this.mechanisms=this.mechanisms.filter(e=>e.name!==t)}createMechanism(e){const t=e.map(e=>e.toUpperCase());for(const e of this.mechanisms)for(const n of t)if(n===e.name)return new e.constructor(e.name);return null}}function Li(t,n){const i=[];if(t.length>n.length)for(let e=0;e<n.length;e++)i.push(t[e]^n[e]);else for(let e=0;e<t.length;e++)i.push(t[e]^n[e]);return e.from(i)}function Ui(e,t,n="sha-1"){return function(e,t){return new Ai(e.toLowerCase(),t)}(n,e).update(t).digest()}function Bi(e=32){return Di(e).toString("hex")}function zi(e){const t={},n=e.toString().split(/,(?=(?:[^"]|"[^"]*")*$)/);for(let e=0,i=n.length;e<i;e++){const i=/(\w+)=["]?([^"]+)["]?$/.exec(n[e]);i&&(t[i[1]]=i[2])}return t}class Gi extends Ni{getExpectedCredentials(){return{optional:["trace"],required:[]}}createResponse(t){return e.from(t.trace||"")}}class Wi extends Ni{getExpectedCredentials(){return{optional:["authzid"],required:[]}}createResponse(t){return e.from(t.authzid||"")}}class Hi extends Ni{getExpectedCredentials(){return{optional:["authzid"],required:["username","password"]}}createResponse(t){return e.from((t.authzid||"")+"\0"+t.username+"\0"+t.password)}}class Vi extends Ni{constructor(e){super(e),this.name=e}getExpectedCredentials(){return{optional:[],required:["token"]}}createResponse(t){return e.from(t.token)}}class $i extends Ni{constructor(e){super(e),this.providesMutualAuthentication=!1,this.name=e}processChallenge(e){const t=zi(e);this.authenticated=!!t.rspauth,this.realm=t.realm,this.nonce=t.nonce,this.charset=t.charset}getExpectedCredentials(){return{optional:["authzid","realm","clientNonce"],required:["host","password","serviceName","serviceType","username"]}}createResponse(t){if(this.authenticated)return null;let n=t.serviceType+"/"+t.host;t.serviceName&&t.host!==t.serviceName&&(n+="/"+t.serviceName);const i=t.realm||this.realm||"",r=t.clientNonce||Bi(16),s="00000001";let o="";o+='username="'+t.username+'"',i&&(o+=',realm="'+i+'"'),o+=',nonce="'+this.nonce+'"',o+=',cnonce="'+r+'"',o+=",nc="+s,o+=",qop=auth",o+=',digest-uri="'+n+'"';const a=Ti("md5").update(t.username).update(":").update(i).update(":").update(t.password).digest(),c=Ti("md5").update(a).update(":").update(this.nonce).update(":").update(r);t.authzid&&c.update(":").update(t.authzid);const u=c.digest("hex"),h=Ti("md5").update("AUTHENTICATE:").update(n).digest("hex");return o+=",response="+Ti("md5").update(u).update(":").update(this.nonce).update(":").update(s).update(":").update(r).update(":").update("auth").update(":").update(h).digest("hex"),"utf-8"===this.charset&&(o+=",charset=utf-8"),t.authzid&&(o+='authzid="'+t.authzid+'"'),e.from(o)}}class Ji{constructor(e){this.providesMutualAuthentication=!0,this.name=e,this.state="INITIAL",this.useChannelBinding=this.name.toLowerCase().endsWith("-plus"),this.algorithm=this.name.toLowerCase().split("scram-")[1].split("-plus")[0]}getExpectedCredentials(){const e=["username","password"];return this.useChannelBinding&&e.push("tlsUnique"),{optional:["authzid"],required:e}}getCacheableCredentials(){return this.cache}createResponse(e){switch(this.state){case"INITIAL":return this.initialResponse(e);case"CHALLENGE":return this.challengeResponse(e)}return null}processChallenge(t){const n=zi(t);this.salt=e.from(n.s||"","base64"),this.iterationCount=parseInt(n.i,10),this.nonce=n.r,this.verifier=n.v,this.error=n.e,this.challenge=t}processSuccess(e){this.processChallenge(e)}finalize(e){return this.verifier?this.serverSignature.toString("base64")!==this.verifier?{authenticated:!1,error:"Mutual authentication failed",mutuallyAuthenticated:!1}:{authenticated:!0,mutuallyAuthenticated:!0}:{authenticated:!1,error:this.error,mutuallyAuthenticated:!1}}initialResponse(t){const n=this.escapeUsername(t.authzid),i=this.escapeUsername(t.username);this.clientNonce=t.clientNonce||Bi();let r="n";t.tlsUnique&&(r=this.useChannelBinding?"p=tls-unique":"y"),this.gs2Header=e.from(n?`${r},a=${n},`:`${r},,`),this.clientFirstMessageBare=e.from(`n=${i},r=${this.clientNonce}`);const s=e.concat([this.gs2Header,this.clientFirstMessageBare]);return this.state="CHALLENGE",s}challengeResponse(t){const n=e.from("Client Key"),i=e.from("Server Key"),r=e.concat([this.gs2Header,t.tlsUnique||e.from("")]).toString("base64"),s=e.from(`c=${r},r=${this.nonce}`);let o,a,c;const u=t.salt&&0===e.compare(t.salt,this.salt);u&&t.clientKey&&t.serverKey?(a=e.from(t.clientKey),c=e.from(t.serverKey)):u&&t.saltedPassword?(o=e.from(t.saltedPassword),a=Ui(o,n,this.algorithm),c=Ui(o,i,this.algorithm)):(o=function(t,n,i,r="sha-1"){let s=Ui(t,e.concat([n,e.from("00000001","hex")]),r),o=s;for(let e=0;e<i-1;e++)s=Ui(t,s,r),o=Li(o,s);return o}(e.from(t.password||""),this.salt,this.iterationCount,this.algorithm),a=Ui(o,n,this.algorithm),c=Ui(o,i,this.algorithm));const h=function(e,t="sha-1"){return Ti(t).update(e).digest()}(a,this.algorithm),l=e.from(","),d=e.concat([this.clientFirstMessageBare,l,this.challenge,l,s]),p=Li(a,Ui(h,d,this.algorithm)).toString("base64");this.serverSignature=Ui(c,d,this.algorithm);const f=e.concat([s,e.from(`,p=${p}`)]);return this.state="FINAL",this.cache={clientKey:a,salt:this.salt,saltedPassword:o,serverKey:c},f}escapeUsername(e=""){const t=[];for(const n of e)","===n?t.push("=2C"):"="===n?t.push("=3D"):t.push(n);return t.join("")}}function Yi(e){e.getAccountInfo=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({account:{},to:t,type:"get"})).account})),e.updateAccount=(t,n)=>e.sendIQ({account:n,to:t,type:"set"}),e.deleteAccount=t=>e.sendIQ({account:{remove:!0},to:t,type:"set"}),e.getPrivateData=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({privateStorage:{[t]:{}},type:"get"})).privateStorage[t]})),e.setPrivateData=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return e.sendIQ({privateStorage:{[t]:n},type:"set"})})),e.getVCard=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({to:t,type:"get",vcard:{format:"vcard-temp"}})).vcard})),e.publishVCard=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",vcard:t})})),e.enableNotifications=(t,n,i=[])=>e.sendIQ({push:{action:"enable",form:{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/pubsub#publish-options"},...i],type:"submit"},jid:t,node:n},type:"set"}),e.disableNotifications=(t,n)=>e.sendIQ({push:{action:"disable",jid:t,node:n},type:"set"})}function Qi(e){e.disco.addFeature(pn(tn)),e.on("pubsub:published",t=>{if(t.pubsub.items.node!==tn)return;const n=t.pubsub.items.published[0].content;e.emit("avatar",{avatars:n.versions||[],jid:t.from,source:"pubsub"})}),e.on("presence",t=>{t.vcardAvatar&&"string"==typeof t.vcardAvatar&&e.emit("avatar",{avatars:[{id:t.vcardAvatar}],jid:t.from,source:"vcard"})}),e.publishAvatar=(t,n)=>e.publish("",en,{data:n,itemType:en},t),e.useAvatars=(t,n=[])=>e.publish("",tn,{itemType:tn,pointers:n,versions:t},"current"),e.getAvatar=(t,n)=>e.getItem(t,en,n)}function Ki(e){e.registerFeature("bind",300,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){try{const i=yield e.sendIQ({bind:{resource:e.config.resource},type:"set"});e.features.negotiated.bind=!0,e.emit("session:prebind",i.bind.jid);const r=!t.legacySession||t.legacySession&&t.legacySession.optional;return!e.sessionStarted&&r&&e.emit("session:started",e.jid),n()}catch(e){return console.error(e),n("disconnect","JID binding failed")}}))),e.registerFeature("legacySession",1e3,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(e.sessionStarted||t.legacySession&&t.legacySession.optional)return e.features.negotiated.session=!0,n();try{return yield e.sendIQ({legacySession:!0,type:"set"}),e.features.negotiated.session=!0,e.sessionStarted||(e.sessionStarted=!0,e.emit("session:started",e.jid)),n()}catch(e){return n("disconnect","Session requeset failed")}}))),e.on("session:started",()=>{e.sessionStarted=!0}),e.on("session:prebind",t=>{e.jid=t,e.emit("session:bound",e.jid)}),e.on("disconnected",()=>{e.sessionStarted=!1,e.features.negotiated.bind=!1,e.features.negotiated.session=!1})}function Xi(e){e.disco.addFeature(Gt),e.disco.addItem({name:"Ad-Hoc Commands",node:Gt}),e.getCommands=t=>e.getDiscoItems(t,Gt)}const Zi=[];for(let e=0;e<256;++e)Zi[e]=(e+256).toString(16).substr(1);function er(e,t,n=(()=>{})){return Object(r.a)(this,void 0,void 0,(function*(){let i;const r=yield Promise.race([e,new Promise((e,r)=>{i=setTimeout(()=>r(n()),t)})]);return i&&clearTimeout(i),r}))}function tr(e){return Object(r.a)(this,void 0,void 0,(function*(){return new Promise(t=>{setTimeout(()=>t(),e)})}))}function nr(t,n){const i="string"==typeof t?e.from(t,"utf8"):t,r="string"==typeof n?e.from(n,"utf8"):n;return i.compare(r)}function ir(){const e=Di(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=0;return[Zi[e[t++]],Zi[e[t++]],Zi[e[t++]],Zi[e[t++]],"-",Zi[e[t++]],Zi[e[t++]],"-",Zi[e[t++]],Zi[e[t++]],"-",Zi[e[t++]],Zi[e[t++]],"-",Zi[e[t++]],Zi[e[t++]],Zi[e[t++]],Zi[e[t++]],Zi[e[t++]],Zi[e[15]]].join("")}const rr=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(?:Z|((\+|-)([\d|:]*)))?$/;var sr=Object.freeze({__proto__:null,timeoutPromise:er,sleep:tr,octetCompare:nr,uuid:ir,reviveData:function(t,n){return n&&"string"==typeof n&&rr.test(n)?new Date(n):n&&"object"==typeof n&&"Buffer"===n.type&&Array.isArray(n.data)?e.from(n):n}});function or(e,t){e.features.negotiated.clientStateIndication&&e.send("csi",{type:t})}function ar(e){e.disco.addFeature("urn:xmpp:ping"),e.on("iq:get:ping",t=>{e.sendIQResult(t)}),e.on("disconnected",()=>{e.disableKeepAlive(),e.features.negotiated.streamManagement=!1,e.features.negotiated.clientStateIndication=!1}),e.markActive=()=>or(e,"active"),e.markInactive=()=>or(e,"inactive"),e.ping=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({ping:!0,to:t,type:"get"})})),e.enableKeepAlive=(t={})=>{const n=t.interval||300,i=t.timeout||e.config.timeout||15;e._keepAliveInterval=setInterval((function(){return Object(r.a)(this,void 0,void 0,(function*(){if(e.sessionStarted)try{yield er(function(e){return new Promise((t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(e.sm.started)e.once("stream:management:ack",()=>t()),e.sm.request();else try{yield e.ping(),t()}catch(e){e.error&&"timeout"!==e.error.condition?t():n()}})))}(e),1e3*i)}catch(t){e.emit("stream:error",{condition:"connection-timeout",text:"Server did not respond in "+i+" seconds"}),e.transport&&(e.transport.hasStream=!1,e.transport.disconnect())}}))}),1e3*n)},e.disableKeepAlive=()=>{e._keepAliveInterval&&(clearInterval(e._keepAliveInterval),delete e._keepAliveInterval)};const t=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){if(!e.config.useStreamManagement)return n();const t=i=>{switch(i.type){case"enabled":return e.sm.enabled(i),e.features.negotiated.streamManagement=!0,e.off("sm",t),n();case"resumed":return e.sm.resumed(i),e.features.negotiated.streamManagement=!0,e.features.negotiated.bind=!0,e.sessionStarted=!0,e.emit("stream:management:resumed",i),e.off("sm",t),n("break");case"failed":e.sm.failed(i),e.emit("session:end"),e.off("sm",t),n()}};e.on("sm",t),e.sm.id?e.sm.id&&e.sm.allowResume?e.sm.resume():(e.off("sm",t),n()):e.features.negotiated.bind?e.sm.enable():(e.off("sm",t),n())}));e.registerFeature("streamManagement",200,t),e.registerFeature("streamManagement",500,t),e.registerFeature("clientStateIndication",400,(t,n)=>{e.features.negotiated.clientStateIndication=!0,n()})}function cr(t){return new e(t.replace(/</g,"&lt;"),"utf-8")}function ur(e=[]){const t=[];for(const n of e)"FORM_TYPE"!==n.name&&t.push({name:cr(n.name),values:(n.rawValues||[]).map(e=>cr(e)).sort(nr)});t.sort((e,t)=>nr(e.name,t.name));const n=[];for(const e of t){n.push(e.name);for(const t of e.values)n.push(t)}return n}function hr(t,n){const i=[],r=new e("<"),s=(e,t)=>{i.push(e),i.push(r),t&&i.push(t)},o=function(e=[]){const t=[],n=new Set;for(const{category:i,type:r,lang:s,name:o}of e){const e=`${i}/${r}/${s||""}/${o||""}`;if(n.has(e))return null;n.add(e),t.push(cr(e))}return t.sort(nr),t}(t.identities),a=function(e=[]){const t=[],n=new Set;for(const i of e){if(n.has(i))return null;n.add(i),t.push(cr(i))}return t.sort(nr),t}(t.features),c=function(e=[]){const t=[],n=new Set;for(const i of e){let e;for(const t of i.fields||[])if("FORM_TYPE"===t.name&&"hidden"===t.type&&t.rawValues&&1===t.rawValues.length){e=cr(t.rawValues[0]);break}if(e){if(n.has(e.toString()))return null;n.add(e.toString()),t.push({type:e,form:i})}}t.sort((e,t)=>nr(e.type,t.type));const i=[];for(const e of t){i.push(e.type);const t=ur(e.form.fields);for(const e of t)i.push(e)}return i}(t.extensions);if(!o||!a||!c)return null;for(const e of o)s(e);for(const e of a)s(e);for(const e of c)s(e);let u=Ti(n).update(e.concat(i)).digest("base64"),h=4-u.length%4;4===h&&(h=0);for(let e=0;e<h;e++)u+="=";return u}class lr{constructor(){this.capsAlgorithms=["sha-1"],this.features=new Map,this.identities=new Map,this.extensions=new Map,this.items=new Map,this.caps=new Map,this.features.set("",new Set),this.identities.set("",[]),this.extensions.set("",[])}getNodeInfo(e){return{extensions:[...this.extensions.get(e)||[]],features:[...this.features.get(e)||[]],identities:[...this.identities.get(e)||[]]}}addFeature(e,t=""){this.features.has(t)||this.features.set(t,new Set),this.features.get(t).add(e)}addIdentity(e,t=""){this.identities.has(t)||this.identities.set(t,[]),this.identities.get(t).push(e)}addItem(e,t=""){this.items.has(t)||this.items.set(t,[]),this.items.get(t).push(e)}addExtension(e,t=""){this.extensions.has(t)||this.extensions.set(t,[]),this.extensions.get(t).push(e)}updateCaps(e,t=this.capsAlgorithms){const n={extensions:[...this.extensions.get("")],features:[...this.features.get("")],identities:[...this.identities.get("")],type:"info"};for(const i of t){const t=hr(n,i);if(!t){this.caps.delete(i);continue}this.caps.set(i,{algorithm:i,node:e,value:t});const r=`${e}#${t}`;for(const e of n.features)this.addFeature(e,r);for(const e of n.identities)this.addIdentity(e,r);for(const e of n.extensions)this.addExtension(e,r);this.identities.set(r,n.identities),this.features.set(r,new Set(n.features)),this.extensions.set(r,n.extensions)}return[...this.caps.values()]}getCaps(){return[...this.caps.values()]}}function dr(e){e.disco=new lr,e.disco.addFeature(Mt),e.disco.addFeature(qt),e.disco.addIdentity({category:"client",type:"web"}),e.registerFeature("caps",100,(t,n)=>{const i=U(e.jid)||e.config.server;e.emit("disco:caps",{caps:t.legacyCapabilities||[],jid:i}),e.features.negotiated.caps=!0,n()}),e.getDiscoInfo=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"info"},to:t,type:"get"});return Object.assign({extensions:[],features:[],identities:[]},i.disco)})),e.getDiscoItems=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield e.sendIQ({disco:{node:n,type:"items"},to:t,type:"get"});return Object.assign({items:[]},i.disco)})),e.updateCaps=()=>{const t=e.config.capsNode||"https://stanzajs.org";return e.disco.updateCaps(t)},e.getCurrentCaps=()=>{const t=e.disco.getCaps();if(!t)return;const n=`${t[0].node}#${t[0].value}`;return{info:e.disco.getNodeInfo(n),legacyCapabilities:t}},e.on("presence",t=>{t.legacyCapabilities&&e.emit("disco:caps",{caps:t.legacyCapabilities,jid:t.from})}),e.on("iq:get:disco",t=>{const{type:n,node:i}=t.disco;"info"===n&&e.sendIQResult(t,{disco:Object.assign(Object.assign({},e.disco.getNodeInfo(i||"")),{node:i,type:"info"})}),"items"===n&&e.sendIQResult(t,{disco:{items:e.disco.items.get(i||"")||[],type:"items"}})})}const pr={Bosh:cn,Client:kt,Component:"jabber:component:accept",Server:"jabber:server"},fr={AccountDisabled:"account-disabled",CredentialsExpired:"credentials-expired",EncryptionRequired:"encryption-required",IncorrectEncoding:"incorrect-encoding",InvalidAuthzid:"invalid-authzid",InvalidMechanism:"invalid-mechanism",MalformedRequest:"malformed-request",MechanismTooWeak:"mechanism-too-weak",NotAuthorized:"not-authorized",TemporaryAuthFailure:"temporary-auth-failure"},mr={BadFormat:"bad-format",BadNamespacePrefix:"bad-namespace-prefix",Conflict:"conflict",ConnectionTimeout:"connection-timeout",HostGone:"host-gone",HostUnknown:"host-unknown",ImproperAddressing:"improper-addressing",InternalServerError:"internal-server-error",InvalidFrom:"invalid-from",InvalidId:"invalid-id",InvalidNamespace:"invalid-namespace",InvalidXML:"invalid-xml",NotAuthorized:"not-authorized",NotWellFormed:"not-well-formed",PolicyViolation:"policy-violation",RemoteConnectionFailed:"remote-connection-failed",Reset:"reset",ResourceConstraint:"resource-constraint",RestrictedXML:"restricted-xml",SeeOtherHost:"see-other-host",SystemShutdown:"system-shutdown",UndefinedCondition:"undefined-condition",UnsupportedEncoding:"unsupported-encoding",UnsupportedStanzaType:"unsupported-stanza-type",UnsupportedVersion:"unsupported-version"},gr={BadRequest:"bad-request",Conflict:"conflict",FeatureNotImplemented:"feature-not-implemented",Forbidden:"forbidden",Gone:"gone",InternalServerError:"internal-server-error",ItemNotFound:"item-not-found",JIDMalformed:"jid-malformed",NotAcceptable:"not-acceptable",NotAllowed:"not-allowed",NotAuthorized:"not-authorized",PolicyViolation:"policy-violation",RecipientUnavailable:"recipient-unavailable",Redirect:"redirect",RegistrationRequired:"registration-required",RemoteServerNotFound:"remote-server-not-found",RemoteServerTimeout:"remote-server-timeout",ResourceConstraint:"resource-constraint",ServiceUnavailable:"service-unavailable",SubscriptionRequired:"subscription-required",UndefinedCondition:"undefined-condition",UnexpectedRequest:"unexpected-request"},vr={Boolean:"boolean",Fixed:"fixed",Hidden:"hidden",JID:"jid-single",JIDMultiple:"jid-multi",List:"list-single",ListMultiple:"list-multi",Password:"text-private",Text:"text-single",TextMultiple:"text-multi",TextPrivate:"text-private"},yr={AffiliationChanged:"101",AffiliationLost:"321",Banned:"301",Error:"333",Kicked:"307",LoggingDisabled:"171",LoggingEnabled:"170",MembershipLost:"322",NickChanged:"303",NickChangedByService:"210",NonAnonymous:"172",NonAnonymousRoom:"100",NonPrivacyConfigurationChange:"104",RoomCreated:"201",SelfPresence:"110",SemiAnonymous:"173",Shutdown:"332",UnavailableMembersListed:"102",UnavailableMembersNotListed:"103"},br={ClosedNode:"closed-node",ConfigurationRequired:"configuration-required",InvalidJID:"invalid-jid",InvalidOptions:"invalid-options",InvalidPayload:"invalid-payload",InvalidSubscriptionId:"invalid-subid",ItemForbidden:"item-forbidden",ItemRequired:"item-required",JIDRequired:"jid-required",MaxItemsExceeded:"max-items-exceeded",MaxNodesExceeded:"max-nodes-exceeded",NodeIdRequired:"nodeid-required",NotInRosterGroup:"not-in-roster-group",NotSubscribed:"not-subscribed",PayloadRequired:"payload-required",PayloadTooBig:"payload-too-big",PendingSubscription:"pending-subscription",PresenceSubscriptionRequired:"presence-subscription-required",SubscriptionIdRequired:"subid-required",TooManySubscriptions:"too-many-subscriptions",Unsupported:"unsupported",UnsupportedAccessModel:"unsupported-access-model"},_r={Active:"active",Composing:"composing",Gone:"gone",Inactive:"inactive",Paused:"paused"},wr={Initiator:"initiator",Responder:"responder"},Sr={Inactive:"inactive",Receive:"recvonly",Send:"sendonly",SendReceive:"sendrecv"},Cr={Both:"both",Initiator:"initiator",None:"none",Responder:"responder"},Er={ContentAccept:"content-accept",ContentAdd:"content-add",ContentModify:"content-modify",ContentReject:"content-reject",ContentRemove:"content-remove",DescriptionInfo:"description-info",SecurityInfo:"security-info",SessionAccept:"session-accept",SessionInfo:"session-info",SessionInitiate:"session-initiate",SessionTerminate:"session-terminate",TransportAccept:"transport-accept",TransportInfo:"transport-info",TransportReject:"transport-reject",TransportReplace:"transport-replace"},kr={OutOfOrder:"out-of-order",TieBreak:"tie-break",UnknownContent:"unknown-content",UnknownSession:"unknown-session",UnsupportedInfo:"unsupported-info"},xr={AlternativeSession:"alternative-session",Busy:"busy",Cancel:"cancel",ConnectivityError:"connectivity-error",Decline:"decline",Expired:"expired",FailedApplication:"failed-application",FailedTransport:"failed-transport",GeneralError:"general-error",Gone:"gone",IncompatibleParameters:"incompatible-parameters",MediaError:"media-error",SecurityError:"security-error",Success:"success",Timeout:"timeout",UnsupportedApplications:"unsupported-applications",UnsupportedTransports:"unsupported-transports"},Ir=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lost","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","satisfied","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"],Or=["doing_chores","drinking","eating","exercising","grooming","having_appointment","inactive","relaxing","talking","traveling","undefined","working"],jr=["at_the_spa","brushing_teeth","buying_groceries","cleaning","coding","commuting","cooking","cycling","cycling","dancing","day_off","doing_maintenance","doing_the_dishes","doing_the_laundry","driving","fishing","gaming","gardening","getting_a_haircut","going_out","hanging_out","having_a_beer","having_a_snack","having_breakfast","having_coffee","having_dinner","having_lunch","having_tea","hiding","hiking","in_a_car","in_a_meeting","in_real_life","jogging","on_a_bus","on_a_plane","on_a_train","on_a_trip","on_the_phone","on_vacation","on_video_phone","other","partying","playing_sports","praying","reading","rehearsing","running","running_an_errand","scheduled_holiday","shaving","shopping","skiing","sleeping","smoking","socializing","studying","sunbathing","swimming","taking_a_bath","taking_a_shower","thinking","walking","walking_the_dog","watching_a_movie","watching_tv","working_out","writing"],Tr=(e,t)=>`{${e}}${t}`,Rr=Tr(gn,"mute"),Ar=Tr(gn,"unmute"),Pr=Tr(gn,"hold"),Dr=Tr(gn,"unhold"),Mr=Tr(gn,"active"),qr=Tr(gn,"ringing"),Nr=Tr(Cn,"checksum");Tr(Cn,"received");function Fr(e){return Object.keys(e).map(t=>e[t])}function Lr(e,t=Cr.Both){const n=e===wr.Initiator;switch(t){case Cr.Initiator:return n?Sr.Send:Sr.Receive;case Cr.Responder:return n?Sr.Receive:Sr.Send;case Cr.Both:return Sr.SendReceive}return Sr.Inactive}function Ur(e,t=Sr.SendReceive){const n=e===wr.Initiator;switch(t){case Sr.Send:return n?Cr.Initiator:Cr.Responder;case Sr.Receive:return n?Cr.Responder:Cr.Initiator;case Sr.SendReceive:return Cr.Both}return Cr.None}function Br(e){e.disco.addFeature("jid\\20escaping"),e.disco.addFeature(wn),e.disco.addFeature("urn:xmpp:eme:0"),e.disco.addFeature(Tn),e.disco.addFeature(Rn),e.disco.addFeature("urn:xmpp:hashes:1"),e.disco.addFeature("urn:xmpp:idle:1"),e.disco.addFeature(Fn),e.disco.addFeature(Qt),e.disco.addFeature("urn:xmpp:psa"),e.disco.addFeature("urn:xmpp:reference:0"),e.disco.addFeature(un),e.disco.addFeature(Pt),e.disco.addFeature("urn:xmpp:media-element"),e.disco.addFeature(an),e.disco.addFeature(ln);const t=["sha-1","sha-256","sha-512","md5"];for(const n of t)e.disco.addFeature(An(n));e.disco.addFeature("urn:xmpp:time"),e.disco.addFeature("jabber:iq:version"),e.on("iq:get:softwareVersion",t=>e.sendIQResult(t,{softwareVersion:e.config.softwareVersion||{name:"stanzajs.org",version:"12.4.5"}})),e.on("iq:get:time",t=>{const n=new Date;e.sendIQResult(t,{time:{tzo:n.getTimezoneOffset(),utc:n}})}),e.getSoftwareVersion=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({softwareVersion:{},to:t,type:"get"})).softwareVersion})),e.getTime=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({time:{},to:t,type:"get"})).time})),e.getLastActivity=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({lastActivity:{},to:t,type:"get"})).lastActivity}))}function zr(e){e.features={handlers:{},negotiated:{},order:[]},e.registerFeature=function(t,n,i){this.features.order.push({name:t,priority:n}),this.features.order.sort((e,t)=>e.priority-t.priority),this.features.handlers[t]=i.bind(e)},e.on("features",t=>Object(r.a)(this,void 0,void 0,(function*(){const n=[],i=e.features.negotiated,r=e.features.handlers;for(const s of e.features.order){const e=s.name;t[e]&&r[e]&&!i[e]&&n.push(()=>new Promise(n=>{i[e]?n():r[e](t,(e,t)=>{e?n({command:e,message:t}):n()})}))}for(const t of n){let n="",i="";try{const e=yield t();e&&(n=e.command,i=e.message||"")}catch(e){n="disconnect",i=e.message,console.error(e)}if(n)return"restart"===n&&e.transport&&e.transport.restart(),void("disconnect"===n&&(e.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+i}),e.disconnect()))}})))}function Gr(e,t){return Object(r.a)(this,void 0,void 0,(function*(){"string"==typeof t&&(t={host:t});const n=Object.assign({json:!0,ssl:!0,xrd:!0},t),i=n.ssl?"https://":"http://";return function(e){return Object(r.a)(this,void 0,void 0,(function*(){try{const t=yield Promise.all(e.map(e=>e.then(e=>Promise.reject(e),e=>Promise.resolve(e))));return Promise.reject(t)}catch(e){return Promise.resolve(e)}}))}([Mi(`${i}${n.host}/.well-known/host-meta.json`).then(e=>Object(r.a)(this,void 0,void 0,(function*(){if(!e.ok)throw new Error("could-not-fetch-json");return e.json()}))),Mi(`${i}${n.host}/.well-known/host-meta`).then(t=>Object(r.a)(this,void 0,void 0,(function*(){if(!t.ok)throw new Error("could-not-fetch-xml");const n=ge(yield t.text());if(n)return e.import(n)})))])}))}function Wr(e,t){e.discoverBindings=e=>Object(r.a)(this,void 0,void 0,(function*(){try{const n=yield Gr(t,e),i={bosh:[],websocket:[]},r=n.links||[];for(const e of r)e.href&&"urn:xmpp:alt-connections:websocket"===e.rel&&i.websocket.push(e.href),e.href&&"urn:xmpp:alt-connections:xbosh"===e.rel&&i.bosh.push(e.href);return i}catch(e){return{}}}))}function Hr(e){const t=Object(u.getMediaSections)(e),n=Object(u.getDescription)(e),i={groups:[],media:[]};for(const e of Object(u.matchPrefix)(n,"a=group:")){const t=e.split(" "),n=t.shift().substr(8);i.groups.push({mids:t,semantics:n})}for(const e of t){const t=Object(u.getKind)(e),r=Object(u.isRejected)(e),s=Object(u.parseMLine)(e),o={direction:Object(u.getDirection)(e,n),kind:t,mid:Object(u.getMid)(e),protocol:s.protocol};if(r||(o.iceParameters=Object(u.getIceParameters)(e,n),o.dtlsParameters=Object(u.getDtlsParameters)(e,n),o.setup=Object(u.matchPrefix)(e,"a=setup:")[0].substr(8)),"audio"===t||"video"===t){o.rtpParameters=Object(u.parseRtpParameters)(e),o.rtpEncodingParameters=Object(u.parseRtpEncodingParameters)(e),o.rtcpParameters=Object(u.parseRtcpParameters)(e);const t=Object(u.parseMsid)(e);o.streams=t?[t]:[]}else"application"===t&&(o.sctp=Object(u.parseSctpDescription)(e));o.candidates=Object(u.matchPrefix)(e,"a=candidate:").map(u.parseCandidate),i.media.push(o)}return i}function Vr(e){const t=[];t.push(Object(u.writeSessionBoilerplate)(e.sessionId,e.sessionVersion),"a=msid-semantic:WMS *\r\n"),e.iceLite&&t.push("a=ice-lite\r\n");for(const n of e.groups||[])t.push(`a=group:${n.semantics} ${n.mids.join(" ")}\r\n`);for(const n of e.media||[]){const e=!(n.iceParameters&&n.dtlsParameters);if("application"===n.kind&&n.sctp)t.push(Object(u.writeSctpDescription)(n,n.sctp));else if(n.rtpParameters){let i=Object(u.writeRtpDescription)(n.kind,n.rtpParameters);e&&(i=i.replace(`m=${n.kind} 9 `,`m=${n.kind} 0 `)),t.push(i),t.push(`a=${n.direction||"sendrecv"}\r\n`);for(const e of n.streams||[])t.push(`a=msid:${e.stream} ${e.track}\r\n`);if(n.rtcpParameters&&n.rtcpParameters.cname&&(t.push(`a=ssrc:${n.rtcpParameters.ssrc} cname:${n.rtcpParameters.cname}\r\n`),n.rtpEncodingParameters&&n.rtpEncodingParameters[0].rtx)){const e=n.rtpEncodingParameters[0];t.push(`a=ssrc-group:FID ${e.ssrc} ${e.rtx.ssrc}\r\n`),t.push(`a=ssrc:${e.rtx.ssrc} cname:${n.rtcpParameters.cname}\r\n`)}}if(void 0!==n.mid&&t.push(`a=mid:${n.mid}\r\n`),n.iceParameters&&t.push(Object(u.writeIceParameters)(n.iceParameters)),n.dtlsParameters&&n.setup&&t.push(Object(u.writeDtlsParameters)(n.dtlsParameters,n.setup)),n.candidates&&n.candidates.length)for(const e of n.candidates)t.push(`a=${Object(u.writeCandidate)(e)}`)}return t.join("")}function $r(e,t){const n=e.rtpParameters,i=e.rtcpParameters||{},r=e.rtpEncodingParameters||[];let s=!1;r&&r.length&&(s=!!r[0].ssrc);const o={applicationType:mn,codecs:[],headerExtensions:[],media:e.kind,rtcpMux:i.mux,rtcpReducedSize:i.reducedSize,sourceGroups:[],sources:[],ssrc:s?r[0].ssrc.toString():void 0,streams:[]};for(const e of n.headerExtensions||[])o.headerExtensions.push({id:e.id,senders:e.direction&&"sendrecv"!==e.direction?Ur(t,e.direction):void 0,uri:e.uri});i.ssrc&&i.cname&&(o.sources=[{parameters:{cname:i.cname},ssrc:i.ssrc.toString()}]),s&&r[0]&&r[0].rtx&&(o.sourceGroups=[{semantics:"FID",sources:[r[0].ssrc.toString(),r[0].rtx.ssrc.toString()]}]);for(const t of e.streams||[])o.streams.push({id:t.stream,track:t.track});for(const e of n.codecs||[]){const t={channels:e.channels,clockRate:e.clockRate,id:e.payloadType.toString(),maxptime:e.maxptime?e.maxptime.toString():void 0,name:e.name,parameters:e.parameters,rtcpFeedback:e.rtcpFeedback};for(const n of Object.keys(e.parameters||{}))"ptime"===n&&(t.ptime=e.parameters[n].toString());o.codecs.push(t)}return o}function Jr(e){return{component:e.component,foundation:e.foundation,generation:void 0,id:void 0,ip:e.ip,network:void 0,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}function Yr(e,t){const n=e.iceParameters,i=e.dtlsParameters,r={candidates:[],transportType:t};n&&(r.usernameFragment=n.usernameFragment,r.password=n.password),i&&(r.fingerprints=i.fingerprints.map(t=>({algorithm:t.algorithm,setup:e.setup,value:t.value}))),e.sctp&&(r.sctp=e.sctp);for(const t of e.candidates||[])r.candidates.push(Jr(t));return r}function Qr(e,t,n){return{contents:e.media.map(e=>({application:"audio"===e.kind||"video"===e.kind?$r(e,t):{applicationType:"datachannel",protocol:e.protocol},creator:wr.Initiator,name:e.mid,senders:Ur(t,e.direction),transport:Yr(e,n)})),groups:e.groups?e.groups.map(e=>({contents:e.mids,semantics:e.semantics})):[]}}function Kr(e,t){const n=e.application||{},i=e.transport,r=n&&n.applicationType===mn,s={direction:Lr(t,e.senders),kind:n.media||"application",mid:e.name,protocol:r?"UDP/TLS/RTP/SAVPF":"UDP/DTLS/SCTP"};if(r){if(s.rtcpParameters={mux:n.rtcpMux,reducedSize:n.rtcpReducedSize},n.sources&&n.sources.length){const e=n.sources[0];s.rtcpParameters.ssrc=parseInt(e.ssrc,10),e.parameters&&(s.rtcpParameters.cname=e.parameters.cname)}if(s.rtpParameters={codecs:[],fecMechanisms:[],headerExtensions:[]},n.streams){s.streams=[];for(const e of n.streams)s.streams.push({stream:e.id,track:e.track})}if(n.ssrc&&(s.rtpEncodingParameters=[{ssrc:parseInt(n.ssrc,10)}],n.sourceGroups&&n.sourceGroups.length)){const e=n.sourceGroups[0];s.rtpEncodingParameters[0].rtx={ssrc:parseInt(e.sources[1],10)}}for(const e of n.codecs||[]){const t=e.parameters||{},n=[];for(const t of e.rtcpFeedback||[])n.push({parameter:t.parameter,type:t.type});s.rtpParameters.codecs.push({channels:e.channels,clockRate:e.clockRate,name:e.name,numChannels:e.channels,parameters:t,payloadType:parseInt(e.id,10),rtcpFeedback:n})}for(const e of n.headerExtensions||[])s.rtpParameters.headerExtensions.push({direction:e.senders&&"both"!==e.senders?Lr(t,e.senders):void 0,id:e.id,uri:e.uri})}if(i&&(i.usernameFragment&&i.password&&(s.iceParameters={password:i.password,usernameFragment:i.usernameFragment}),i.fingerprints&&i.fingerprints.length)){s.dtlsParameters={fingerprints:[],role:"auto"};for(const e of i.fingerprints)s.dtlsParameters.fingerprints.push({algorithm:e.algorithm,value:e.value});i.sctp&&(s.sctp=i.sctp),s.setup=i.fingerprints[0].setup}return s}function Xr(e,t){const n={groups:[],media:[]};for(const t of e.groups||[])n.groups.push({mids:t.contents,semantics:t.semantics});for(const i of e.contents||[])n.media.push(Kr(i,t));return n}const Zr={condition:gr.BadRequest},es={condition:gr.FeatureNotImplemented,jingleError:kr.UnsupportedInfo,type:"modify"};class ts{constructor(e){this.parent=e.parent,this.sid=e.sid||ir(),this.peerID=e.peerID,this.role=e.initiator?wr.Initiator:wr.Responder,this._sessionState="starting",this._connectionState="starting",this.pendingApplicationTypes=e.applicationTypes||[],this.pendingAction=void 0,this.processingQueue=Object(h.a)((e,t)=>Object(r.a)(this,void 0,void 0,(function*(){if("ended"===this.state)return"local"===e.type&&e.reject&&e.reject(new Error("Session ended")),void(t&&t());if("local"===e.type){this._log("debug","Processing local action:",e.name);try{const t=yield e.handler();e.resolve(t)}catch(t){e.reject(t)}return void(t&&t())}const{action:n,changes:i,cb:r}=e;return this._log("debug","Processing remote action:",n),new Promise(e=>{const s=(n,i)=>{r(n,i),t&&t(),e()};switch(n){case Er.ContentAccept:return this.onContentAccept(i,s);case Er.ContentAdd:return this.onContentAdd(i,s);case Er.ContentModify:return this.onContentModify(i,s);case Er.ContentReject:return this.onContentReject(i,s);case Er.ContentRemove:return this.onContentRemove(i,s);case Er.DescriptionInfo:return this.onDescriptionInfo(i,s);case Er.SecurityInfo:return this.onSecurityInfo(i,s);case Er.SessionAccept:return this.onSessionAccept(i,s);case Er.SessionInfo:return this.onSessionInfo(i,s);case Er.SessionInitiate:return this.onSessionInitiate(i,s);case Er.SessionTerminate:return this.onSessionTerminate(i,s);case Er.TransportAccept:return this.onTransportAccept(i,s);case Er.TransportInfo:return this.onTransportInfo(i,s);case Er.TransportReject:return this.onTransportReject(i,s);case Er.TransportReplace:return this.onTransportReplace(i,s);default:this._log("error","Invalid or unsupported action: "+n),s({condition:gr.BadRequest})}})})),1)}get isInitiator(){return this.role===wr.Initiator}get peerRole(){return this.isInitiator?wr.Responder:wr.Initiator}get state(){return this._sessionState}set state(e){e!==this._sessionState&&(this._log("info","Changing session state to: "+e),this._sessionState=e,this.parent&&this.parent.emit("sessionState",this,e))}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._log("info","Changing connection state to: "+e),this._connectionState=e,this.parent&&this.parent.emit("connectionState",this,e))}send(e,t){(t=t||{}).sid=this.sid,t.action=e,new Set([Er.ContentAccept,Er.ContentAdd,Er.ContentModify,Er.ContentReject,Er.ContentRemove,Er.SessionAccept,Er.SessionInitiate,Er.TransportAccept,Er.TransportReject,Er.TransportReplace]).has(e)?this.pendingAction=e:this.pendingAction=void 0,this.parent.signal(this,{id:ir(),jingle:t,to:this.peerID,type:"set"})}processLocal(e,t){return new Promise((n,i)=>{this.processingQueue.push({handler:t,name:e,reject:i,resolve:n,type:"local"},1)})}process(e,t,n){this.processingQueue.push({action:e,cb:n,changes:t,type:"remote"},2)}start(e,t){this._log("error","Can not start base sessions"),this.end("unsupported-applications",!0)}accept(e,t){this._log("error","Can not accept base sessions"),this.end("unsupported-applications")}cancel(){this.end("cancel")}decline(){this.end("decline")}end(e="success",t=!1){this.state="ended",this.processingQueue.kill(),"string"==typeof e&&(e={condition:e}),t||this.send("session-terminate",{reason:e}),this.parent.emit("terminated",this,e),this.parent.forgetSession(this)}_log(e,t,...n){this.parent&&(t=this.sid+": "+t,this.parent.emit("log:"+e,t,...n))}onSessionInitiate(e,t){t()}onSessionAccept(e,t){t()}onSessionTerminate(e,t){this.end(e.reason,!0),t()}onSessionInfo(e,t){e.info?t(es):t()}onSecurityInfo(e,t){t(es)}onDescriptionInfo(e,t){t(es)}onTransportInfo(e,t){t(es)}onContentAdd(e,t){t(),this.send(Er.ContentReject,{reason:{condition:xr.FailedApplication,text:"content-add is not supported"}})}onContentAccept(e,t){t(Zr)}onContentReject(e,t){t(Zr)}onContentModify(e,t){t(Zr)}onContentRemove(e,t){t(Zr)}onTransportReplace(e,t){t(),this.send(Er.TransportReject,{reason:{condition:xr.FailedTransport,text:"transport-replace is not supported"}})}onTransportAccept(e,t){t(Zr)}onTransportReject(e,t){t(Zr)}}class ns extends ts{constructor(e){super(e),this.transportType=yn,this.pc=new RTCPeerConnection(Object.assign(Object.assign({},e.config),{iceServers:e.iceServers}),e.constraints),this.pc.addEventListener("iceconnectionstatechange",()=>{this.onIceStateChange()}),this.pc.addEventListener("icecandidate",e=>{e.candidate?this.onIceCandidate(e):this.onIceEndOfCandidates()}),this.restrictRelayBandwidth(),this.bitrateLimit=0,this.maxRelayBandwidth=e.maxRelayBandwidth,this.candidateBuffer=[],this.restartingIce=!1}end(e="success",t=!1){this.pc.close(),super.end(e,t)}restartIce(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.isInitiator){void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this.restartingIce=!0;try{yield this.processLocal("restart-ice",()=>Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.pc.createOffer({iceRestart:!0}),t=Hr(e.sdp);this.send(Er.TransportInfo,{contents:t.media.map(e=>({creator:wr.Initiator,name:e.mid,transport:Yr(e,this.transportType)})),sid:this.sid}),yield this.pc.setLocalDescription(e)})))}catch(e){this._log("error","Could not create WebRTC offer",e),this.end(xr.FailedTransport,!0)}}}))}setMaximumBitrate(e){return Object(r.a)(this,void 0,void 0,(function*(){if(this.maximumBitrate&&(e=Math.min(e,this.maximumBitrate)),this.currentBitrate=e,!(window.RTCRtpSender&&"getParameters"in window.RTCRtpSender.prototype))return;const t=this.pc.getSenders().find(e=>!!e.track&&"video"===e.track.kind);if(!t)return;let n="";window.navigator&&window.navigator.mozGetUserMedia?n="firefox":window.navigator&&window.navigator.webkitGetUserMedia&&(n="chrome");const i=t.getParameters();"firefox"!==n||i.encodings||(i.encodings=[{}]),0===e?delete i.encodings[0].maxBitrate:(i.encodings.length||(i.encodings[0]={}),i.encodings[0].maxBitrate=e);try{yield this.processLocal("set-bitrate",()=>Object(r.a)(this,void 0,void 0,(function*(){if("chrome"===n)yield t.setParameters(i);else if("firefox"===n)if("stable"!==this.pc.signalingState)yield t.setParameters(i);else if(this.pc.localDescription&&"offer"===this.pc.localDescription.type){yield t.setParameters(i);const e=yield this.pc.createOffer();yield this.pc.setLocalDescription(e),yield this.pc.setRemoteDescription(this.pc.remoteDescription),yield this.processBufferedCandidates()}else if(this.pc.localDescription&&"answer"===this.pc.localDescription.type){yield t.setParameters(i),yield this.pc.setRemoteDescription(this.pc.remoteDescription),yield this.processBufferedCandidates();const e=yield this.pc.createAnswer();yield this.pc.setLocalDescription(e)}})))}catch(e){this._log("error","setParameters failed",e)}}))}onTransportInfo(e,t){return Object(r.a)(this,void 0,void 0,(function*(){if(e.contents&&e.contents[0]&&e.contents[0].transport.gatheringComplete){try{"stable"===this.pc.signalingState?yield this.pc.addIceCandidate(null):this.candidateBuffer.push(null)}catch(e){this._log("debug","Could not add null ICE candidate")}finally{t()}return}if(this.pc.remoteDescription){const n=this.pc.remoteDescription,i=Hr(n.sdp),r=i.media.find(t=>t.mid===e.contents[0].name).iceParameters.usernameFragment,s=e.contents[0].transport.usernameFragment;if(s&&r!==s){if(e.contents.forEach((e,t)=>{const n=e.transport;i.media[t].iceParameters={password:n.password,usernameFragment:n.usernameFragment},i.media[t].candidates=[]}),"offer"===n.type){try{yield this.pc.setRemoteDescription(n),yield this.processBufferedCandidates();const e=yield this.pc.createAnswer(),i=Hr(e.sdp);this.send(Er.TransportInfo,{contents:i.media.map(e=>({creator:wr.Initiator,name:e.mid,transport:Yr(e,this.transportType)})),sid:this.sid}),yield this.pc.setLocalDescription(e),t()}catch(e){this._log("error","Could not do remote ICE restart",e),t(e),this.end(xr.FailedTransport)}return}try{yield this.pc.setRemoteDescription(n),yield this.processBufferedCandidates(),t()}catch(e){this._log("error","Could not do local ICE restart",e),t(e),this.end(xr.FailedTransport)}}}const n=(e.contents||[]).map(e=>{const t=e.name,n=(e.transport.candidates||[]).map(e=>Object(r.a)(this,void 0,void 0,(function*(){const n=Object(u.writeCandidate)(function(e){return{address:e.ip,component:e.component,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,tcpType:e.tcpType,type:e.type}}(e));let i;const r=this.pc.remoteDescription.sdp,s=Object(u.getMediaSections)(r);for(let e=0;e<s.length;e++)if(Object(u.getMid)(s[e])===t){i=e;break}if("stable"===this.pc.signalingState)try{yield this.pc.addIceCandidate({sdpMid:t,sdpMLineIndex:i,candidate:n})}catch(e){this._log("error","Could not add ICE candidate",e)}else this.candidateBuffer.push({sdpMid:t,sdpMLineIndex:i,candidate:n})})));return Promise.all(n)});try{yield Promise.all(n),t()}catch(e){t(e)}}))}onSessionAccept(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this.state="active";const n=Vr(Xr(e,this.peerRole));try{yield this.pc.setRemoteDescription({type:"answer",sdp:n}),yield this.processBufferedCandidates(),this.parent.emit("accepted",this,void 0),t()}catch(e){this._log("error",`Could not process WebRTC answer: ${e}`),t({condition:"general-error"})}}))}onSessionTerminate(e,t){this._log("info","Terminating session"),this.pc.close(),super.end(e.reason,!0),t()}onIceCandidate(e){if(!e.candidate.candidate)return;const t=Object(u.parseCandidate)(e.candidate.candidate),n=function(e,t,n){return{contents:[{creator:wr.Initiator,name:e,transport:{candidates:[Jr(t)],transportType:n,usernameFragment:t.usernameFragment||void 0}}]}}(e.candidate.sdpMid,t,this.transportType);n.contents.forEach((e,t)=>{const n=e.transport;if(!n.usernameFragment){const e=Hr(this.pc.localDescription.sdp);n.usernameFragment=e.media[t].iceParameters.usernameFragment}}),this._log("info","Discovered new ICE candidate",n),this.send(Er.TransportInfo,n)}onIceEndOfCandidates(){this._log("info","ICE end of candidates");const e=Hr(this.pc.localDescription.sdp).media[0];this.send(Er.TransportInfo,{contents:[{creator:wr.Initiator,name:e.mid,transport:{gatheringComplete:!0,transportType:this.transportType,usernameFragment:e.iceParameters.usernameFragment}}]})}onIceStateChange(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected",this.restartingIce=!1;break;case"disconnected":if("stable"===this.pc.signalingState?this.connectionState="interrupted":this.connectionState="disconnected",this.restartingIce)return void this.end(xr.FailedTransport);this.maybeRestartIce();break;case"failed":if("failed"===this.connectionState||this.restartingIce)return void this.end(xr.FailedTransport);this.connectionState="failed",this.restartIce();break;case"closed":this.connectionState="disconnected",this.restartingIce?this.end(xr.FailedTransport):this.end()}}processBufferedCandidates(){return Object(r.a)(this,void 0,void 0,(function*(){for(const e of this.candidateBuffer)try{yield this.pc.addIceCandidate(e)}catch(e){this._log("error","Could not add ICE candidate",e)}this.candidateBuffer=[]}))}restrictRelayBandwidth(){window.RTCRtpSender&&"getParameters"in window.RTCRtpSender.prototype&&this.pc.addEventListener("iceconnectionstatechange",()=>Object(r.a)(this,void 0,void 0,(function*(){if("completed"!==this.pc.iceConnectionState&&"connected"!==this.pc.iceConnectionState)return;if(this._firstTimeConnected)return;this._firstTimeConnected=!0;const e=yield this.pc.getStats();let t;if(e.forEach(n=>{"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))}),t||e.forEach(e=>{"candidate-pair"===e.type&&e.selected&&(t=e)}),t){let n=!1;if(t.remoteCandidateId){const i=e.get(t.remoteCandidateId);i&&"relay"===i.candidateType&&(n=!0)}if(t.localCandidateId){const i=e.get(t.localCandidateId);i&&"relay"===i.candidateType&&(n=!0)}n&&(this.maximumBitrate=this.maxRelayBandwidth,this.currentBitrate&&this.setMaximumBitrate(Math.min(this.currentBitrate,this.maximumBitrate)))}})))}maybeRestartIce(){this.isInitiator&&(void 0!==this._maybeRestartingIce&&clearTimeout(this._maybeRestartingIce),this._maybeRestartingIce=setTimeout(()=>{delete this._maybeRestartingIce,"disconnected"===this.pc.iceConnectionState&&this.restartIce()},2e3))}}class is extends s.EventEmitter{constructor(e={}){super(),this.config=Object.assign({chunkSize:16384,hash:"sha-1"},e),this.file=void 0,this.channel=void 0,this.hash=Ti(this.config.hash)}send(e,t){if(this.file&&this.channel)return;this.file=e,this.channel=t,this.channel.binaryType="arraybuffer";const n=new FileReader;let i=0,r=!1;n.addEventListener("load",t=>{const n=t.target.result;r=!1,i+=n.byteLength,this.channel.send(n),this.hash.update(new Uint8Array(n)),this.emit("progress",i,e.size,n),i<e.size?this.channel.bufferedAmount<=this.channel.bufferedAmountLowThreshold&&s():(this.emit("progress",e.size,e.size,null),this.emit("sentFile",{algorithm:this.config.hash,name:e.name,size:e.size,value:this.hash.digest()}))});const s=()=>{if(r||i>=e.size)return;r=!0;const t=e.slice(i,i+this.config.chunkSize);n.readAsArrayBuffer(t)};t.bufferedAmountLowThreshold=8*this.config.chunkSize,t.onbufferedamountlow=()=>{s()},s()}}class rs extends s.EventEmitter{constructor(e={}){super(),this.config=Object.assign({hash:"sha-1"},e),this.receiveBuffer=[],this.received=0,this.channel=void 0,this.hash=Ti(this.config.hash)}receive(e,t){this.metadata=e,this.channel=t,this.channel.binaryType="arraybuffer",this.channel.onmessage=e=>{const t=e.data.byteLength;this.received+=t,this.receiveBuffer.push(e.data),e.data&&this.hash.update(new Uint8Array(e.data)),this.emit("progress",this.received,this.metadata.size,e.data),this.received===this.metadata.size?(this.metadata.actualhash=this.hash.digest("hex"),this.emit("receivedFile",new Blob(this.receiveBuffer),this.metadata),this.receiveBuffer=[]):this.received>this.metadata.size&&(console.error("received more than expected, discarding..."),this.receiveBuffer=[])}}}class ss extends ns{constructor(e){super(e),this.sender=void 0,this.receiver=void 0,this.file=void 0}start(e,t){return Object(r.a)(this,void 0,void 0,(function*(){if(t=t||(()=>{}),!e||"function"==typeof e)throw new Error("File object required");this.state="pending",this.role="initiator",this.file=e,this.sender=new is,this.sender.on("progress",(e,t)=>{this._log("info","Send progress "+e+"/"+t)}),this.sender.on("sentFile",e=>{this._log("info","Sent file",e.name),this.send(Er.SessionInfo,{info:{creator:wr.Initiator,file:{hashes:[{algorithm:e.algorithm,value:e.value}]},infoType:Nr,name:this.contentName}}),this.parent.emit("sentFile",this,e)}),this.channel=this.pc.createDataChannel("filetransfer",{ordered:!0}),this.channel.onopen=()=>{this.sender.send(this.file,this.channel)};try{yield this.processLocal(Er.SessionInitiate,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1}),n=Qr(Hr(t.sdp),this.role,this.transportType);this.contentName=n.contents[0].name,n.sid=this.sid,n.action=Er.SessionInitiate,n.contents[0].application={applicationType:Cn,file:{date:e.lastModified?new Date(e.lastModified):void 0,hashesUsed:[{algorithm:"sha-1"}],name:e.name,size:e.size}},this.send("session-initiate",n),yield this.pc.setLocalDescription(t)}))),t()}catch(e){return this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Accepted incoming session"),this.role="responder",this.state="active",e=e||(()=>{});try{yield this.processLocal(Er.SessionAccept,()=>Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.pc.createAnswer(),t=Qr(Hr(e.sdp),this.role,this.transportType);t.sid=this.sid,t.action="session-accept",t.contents.forEach(e=>{e.creator="initiator"}),this.contentName=t.contents[0].name,this.send("session-accept",t),yield this.pc.setLocalDescription(e)}))),e()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}onSessionInitiate(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.role="responder",this.state="pending",this.transportType=e.contents[0].transport.transportType;const n=Vr(Xr(e,this.peerRole)),i=e.contents[0].application,r=i.file.hashesUsed?i.file.hashesUsed:i.file.hashes||[];this.receiver=new rs({hash:r[0]&&r[0].algorithm}),this.receiver.on("progress",(e,t)=>{this._log("info","Receive progress "+e+"/"+t)}),this.receiver.on("receivedFile",e=>{this.receivedFile=e,this._maybeReceivedFile()}),this.receiver.metadata=i.file,this.pc.addEventListener("datachannel",e=>{this.channel=e.channel,this.receiver.receive(this.receiver.metadata,e.channel)});try{yield this.pc.setRemoteDescription({type:"offer",sdp:n}),yield this.processBufferedCandidates(),t()}catch(e){this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionInfo(e,t){const n=e.info;n&&n.file&&n.file.hashes&&(this.receiver.metadata.hashes=n.file.hashes,this.receiver.metadata.actualhash&&this._maybeReceivedFile(),t())}_maybeReceivedFile(){if(this.receiver.metadata.hashes&&this.receiver.metadata.hashes.length){for(const e of this.receiver.metadata.hashes||[])if(e.value&&e.value.toString("hex")===this.receiver.metadata.actualhash)return this._log("info","File hash matches"),this.parent.emit("receivedFile",this,this.receivedFile,this.receiver.metadata),void this.end("success");this._log("error","File hash does not match"),this.end("media-error")}}}function os(e){const t=e.application;if(t.streams&&t.streams.length&&t.sources&&t.sources.length){const e=t.streams[0];t.sources[0].parameters.msid=`${e.id} ${e.track}`,t.sourceGroups&&t.sourceGroups.length>0&&t.sources.push({parameters:{cname:t.sources[0].parameters.cname,msid:`${e.id} ${e.track}`},ssrc:t.sourceGroups[0].sources[1]})}}class as extends ns{constructor(e){if(super(e),this._ringing=!1,this.pc.addEventListener("track",e=>{this.onAddTrack(e.track,e.streams[0])}),e.stream)for(const t of e.stream.getTracks())this.addTrack(t,e.stream)}get ringing(){return this._ringing}set ringing(e){e!==this._ringing&&(this._ringing=e)}get streams(){return"closed"!==this.pc.signalingState?this.pc.getRemoteStreams():[]}start(e,t){return Object(r.a)(this,arguments,void 0,(function*(){this.state="pending",1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>{}),e=e||{},this.role="initiator",this.offerOptions=e;try{yield this.processLocal(Er.SessionInitiate,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createOffer(e),n=Qr(Hr(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=Er.SessionInitiate;for(const e of n.contents||[])e.creator="initiator",os(e);yield this.pc.setLocalDescription(t),this.send("session-initiate",n)}))),t()}catch(e){this._log("error","Could not create WebRTC offer",e),this.end("failed-application",!0)}}))}accept(e,t){return Object(r.a)(this,arguments,void 0,(function*(){1===arguments.length&&"function"==typeof e&&(t=e,e={}),t=t||(()=>{}),e=e||{},this._log("info","Accepted incoming session"),this.state="active",this.role="responder";try{yield this.processLocal(Er.SessionAccept,()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.pc.createAnswer(e),n=Qr(Hr(t.sdp),this.role,this.transportType);n.sid=this.sid,n.action=Er.SessionAccept;for(const e of n.contents||[])e.creator="initiator";yield this.pc.setLocalDescription(t),this.send("session-accept",n)}))),t()}catch(e){this._log("error","Could not create WebRTC answer",e),this.end("failed-application")}}))}end(e="success",t=!1){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.end(e,t)}ring(){return this.processLocal("ring",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Ringing on incoming session"),this.ringing=!0,this.send(Er.SessionInfo,{info:{infoType:qr}})})))}mute(e,t){return this.processLocal("mute",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Muting",t),this.send(Er.SessionInfo,{info:{creator:e,infoType:Rr,name:t}})})))}unmute(e,t){return this.processLocal("unmute",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Unmuting",t),this.send(Er.SessionInfo,{info:{creator:e,infoType:Ar,name:t}})})))}hold(){return this.processLocal("hold",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Placing on hold"),this.send("session-info",{info:{infoType:Pr}})})))}resume(){return this.processLocal("resume",()=>Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Resuming from hold"),this.send("session-info",{info:{infoType:Mr}})})))}addTrack(e,t,n){return this.processLocal("addtrack",()=>Object(r.a)(this,void 0,void 0,(function*(){this.pc.addTrack?this.pc.addTrack(e,t):this.pc.addStream(t),n&&n()})))}removeTrack(e,t){return Object(r.a)(this,void 0,void 0,(function*(){return this.processLocal("removetrack",()=>Object(r.a)(this,void 0,void 0,(function*(){if(this.pc.removeTrack(e),t)return t()})))}))}onAddTrack(e,t){this._log("info","Track added"),this.parent.emit("peerTrackAdded",this,e,t)}onRemoveTrack(e){this._log("info","Track removed"),this.parent.emit("peerTrackRemoved",this,e)}onSessionInitiate(e,t){return Object(r.a)(this,void 0,void 0,(function*(){this._log("info","Initiating incoming session"),this.state="pending",this.role="responder",this.transportType=e.contents[0].transport.transportType;const n=Xr(e,this.peerRole);n.media.forEach(e=>{e.streams||(e.streams=[{stream:"legacy",track:e.kind}])});const i=Vr(n);try{return yield this.pc.setRemoteDescription({type:"offer",sdp:i}),yield this.processBufferedCandidates(),t()}catch(e){return this._log("error","Could not create WebRTC answer",e),t({condition:"general-error"})}}))}onSessionTerminate(e,t){for(const e of this.pc.getReceivers())this.onRemoveTrack(e.track);super.onSessionTerminate(e,t)}onSessionInfo(e,t){const n=e.info||{infoType:""};switch(n.infoType){case qr:return this._log("info","Outgoing session is ringing"),this.ringing=!0,this.parent.emit("ringing",this),t();case Pr:return this._log("info","On hold"),this.parent.emit("hold",this),t();case Dr:case Mr:return this._log("info","Resuming from hold"),this.parent.emit("resumed",this),t();case Rr:return this._log("info","Muting",n),this.parent.emit("mute",this,n),t();case Ar:return this._log("info","Unmuting",n),this.parent.emit("unmute",this,n),t()}return t()}}class cs extends s.EventEmitter{constructor(e={}){super(),e=e||{},this.selfID=e.selfID,this.sessions={},this.peers={},this.iceServers=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],this.prepareSession=e.prepareSession||(e=>e.applicationTypes.indexOf(mn)>=0?new as(e):e.applicationTypes.indexOf(Cn)>=0?new ss(e):void 0),this.performTieBreak=e.performTieBreak||((e,t)=>{const n=(t.jingle.contents||[]).map(e=>{if(e.application)return e.application.applicationType});return(e.pendingApplicationTypes||[]).filter(e=>n.includes(e)).length>0}),this.config=Object.assign({debug:!1,peerConnectionConfig:{bundlePolicy:e.bundlePolicy||"balanced",iceTransportPolicy:e.iceTransportPolicy||"all",rtcpMuxPolicy:e.rtcpMuxPolicy||"require",sdpSemantics:e.sdpSemantics||"plan-b"},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]}},e)}addICEServer(e){"string"==typeof e&&(e={urls:e}),this.iceServers.push(e)}resetICEServers(){this.iceServers=[]}addSession(e){e.parent=this;const t=e.sid,n=e.peerID;return this.sessions[t]=e,this.peers[n]||(this.peers[n]=[]),this.peers[n].push(e),this.emit("createdSession",e),e}forgetSession(e){const t=this.peers[e.peerID]||[];t.length&&t.splice(t.indexOf(e),1),delete this.sessions[e.sid]}createMediaSession(e,t,n){const i=new as({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:786432,parent:this,peerID:e,sid:t,stream:n});return this.addSession(i),i}createFileTransferSession(e,t){const n=new ss({config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!0,maxRelayBandwidth:786432,parent:this,peerID:e,sid:t});return this.addSession(n),n}endPeerSessions(e,t,n=!1){const i=this.peers[e]||[];delete this.peers[e],i.forEach(e=>{e.end(t||"gone",n)})}endAllSessions(e,t=!1){Object.keys(this.peers).forEach(n=>{this.endPeerSessions(n,e,t)})}process(e){const t=this,n=e.jingle?e.jingle.sid:void 0;let i=n?this.sessions[n]:void 0;const r=e.id,s=e.from;if(!s)return;if("error"===e.type){const t=e.error&&"tie-break"===e.error.jingleError;return i&&"pending"===i.state&&t?i.end("alternative-session",!0):void(i&&(i.pendingAction=void 0))}if("result"===e.type)return void(i&&(i.pendingAction=void 0));const o=e.jingle.action,a=e.jingle.contents||[],c=a.map(e=>e.application?e.application.applicationType:void 0),u=a.map(e=>e.transport?e.transport.transportType:void 0);if(o!==Er.SessionInitiate){if(!i)return"session-terminate"===o?void this.emit("send",{id:r,to:s,type:"result"}):(this._log("error","Unknown session",n),this._sendError(s,r,{condition:"item-not-found",jingleError:"unknown-session"}));if(i.peerID!==s||"ended"===i.state)return this._log("error","Session has ended, or action has wrong sender"),this._sendError(s,r,{condition:"item-not-found",jingleError:"unknown-session"});if("session-accept"===o&&"pending"!==i.state)return this._log("error","Tried to accept session twice",n),this._sendError(s,r,{condition:"unexpected-request",jingleError:"out-of-order"});if("session-terminate"!==o&&o===i.pendingAction&&(this._log("error","Tie break during pending request"),i.isInitiator))return this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}else if(i){if(i.peerID!==s)return this._log("error","Duplicate sid from new sender"),this._sendError(s,r,{condition:"service-unavailable"});if("pending"!==i.state)return this._log("error","Someone is doing this wrong"),this._sendError(s,r,{condition:"unexpected-request",jingleError:"out-of-order"});if(this.selfID&&this.selfID>i.peerID&&this.performTieBreak(i,e))return this._log("error","Tie break new session because of duplicate sids"),this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}else if(this.peers[s]&&this.peers[s].length)for(let t=0,i=this.peers[s].length;t<i;t++){const i=this.peers[s][t];if(i&&"pending"===i.state&&n&&nr(i.sid,n)>0&&this.performTieBreak(i,e))return this._log("info","Tie break session-initiate"),this._sendError(s,r,{condition:"conflict",jingleError:"tie-break"})}if("session-initiate"===o){if(!a.length)return t._sendError(s,r,{condition:"bad-request"});i=this._createIncomingSession({applicationTypes:c,config:this.config.peerConnectionConfig,constraints:this.config.peerConnectionConstraints,iceServers:this.iceServers,initiator:!1,parent:this,peerID:s,sid:n,transportTypes:u},e)}i.process(o,e.jingle,t=>{t?(this._log("error","Could not process request",e,t),this._sendError(s,r,t)):(this.emit("send",{id:r,to:s,type:"result"}),"session-initiate"===o&&this.emit("incoming",i))})}signal(e,t){const n=t.jingle&&t.jingle.action;e.isInitiator&&n===Er.SessionInitiate&&this.emit("outgoing",e),this.emit("send",t)}_createIncomingSession(e,t){let n;return this.prepareSession&&(n=this.prepareSession(e,t)),n||(n=new ts(e)),this.addSession(n),n}_sendError(e,t,n){n.type||(n.type="cancel"),this.emit("send",{error:n,id:t,to:e,type:"error"})}_log(e,t,...n){this.emit("log:"+e,t,...n)}}let us;try{us=window}catch(e){us=i}function hs(e){const t=e.jingle=new cs;if(e.disco.addFeature(fn),us.RTCPeerConnection){const t=[mn,On,jn,Ln,"urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0",zn,yn,"urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:file-transfer:3","urn:xmpp:jingle:transports:dtls-sctp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"];for(const n of t)e.disco.addFeature(n)}const n=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];for(const i of n)t.on(i,(t,n)=>{e.emit("jingle:"+i,t,n)});t.on("createdSession",t=>{e.emit("jingle:created",t)}),t.on("send",n=>Object(r.a)(this,void 0,void 0,(function*(){try{if("set"===n.type){const i=yield e.sendIQ(n);i.jingle||(i.jingle={}),i.jingle.sid=n.jingle.sid,t.process(i)}"result"===n.type&&e.sendIQResult({type:"set",id:n.id,from:n.to},n),"error"===n.type&&e.sendIQError({type:"set",id:n.id,from:n.to},n)}catch(e){console.error(e),e.jingle||(e.jingle={}),e.jingle.sid=n.jingle.sid,t.process(e)}}))),e.on("session:bound",e=>{t.selfID=e}),e.on("iq:set:jingle",e=>{t.process(e)}),e.on("unavailable",e=>{t.endPeerSessions(e.from,void 0,!0)}),e.getServices=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=(yield e.sendIQ({externalServices:{type:n},to:t,type:"get"})).externalServices;return i.services=i.services||[],i})),e.getServiceCredentials=(t,n,i,s)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({externalServiceCredentials:{host:n,port:s,type:i},to:t,type:"get"})).externalServiceCredentials})),e.discoverICEServers=()=>Object(r.a)(this,void 0,void 0,(function*(){try{const t=(yield e.getServices(e.config.server)).services||[],n=[];for(const e of t){const t={urls:[]},i=`${e.type}:${e.host}`,r=e.port?`:${e.port}`:"",s=e.transport?`?transport=${e.transport}`:"";"stun"!==e.type&&"stuns"!==e.type||(t.urls=[`${i}${r}`]),"turn"!==e.type&&"turns"!==e.type||(e.username&&(t.username=e.username),e.password&&(t.credential=e.password),t.urls=[`${i}${r}${s}`]),t.urls.length&&n.push(t)}for(const t of n)e.jingle.addICEServer(t);return n}catch(e){return[]}}))}function ls(e){e.getHistorySearchForm=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"query"},to:t,type:"get"})).archive.form})),e.searchHistory=(t,n={})=>Object(r.a)(this,void 0,void 0,(function*(){const i=e.nextId();let r="";"string"==typeof t?r=t:(r=t.to||"",n=t),n.queryId=i;const s=n.form||{};s.type="submit";const o=s.fields||[],a=[{name:"FORM_TYPE",type:"hidden",value:Dn}];n.with&&a.push({name:"with",type:"text-single",value:n.with}),n.start&&a.push({name:"start",type:"text-single",value:n.start.toISOString()}),n.end&&a.push({name:"end",type:"text-single",value:n.end.toISOString()}),s.fields=function(e,t){const n=[],i=new Map;for(const e of t)e.name&&i.set(e.name,e);const r=new Set;for(const t of e)t.name&&i.has(t.name)?(n.push(Object.assign(Object.assign({},t),i.get(t.name))),r.add(t.name)):n.push(Object.assign({},t));for(const e of t)(!e.name||e.name&&!r.has(e.name))&&n.push(Object.assign({},e));return n}(a,o),n.form=s;const c=N(e.jid,r),u=[],h=e=>{c.has(e.from)&&e.archive&&e.archive.queryId===i&&u.push(e.archive)};e.on("mam:item",h);try{const t=yield e.sendIQ({archive:n,id:i,to:r,type:"set"});return Object.assign(Object.assign({},t.archive),{results:u})}finally{e.off("mam:item",h)}})),e.getHistoryPreferences=()=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({archive:{type:"preferences"},type:"get"})).archive})),e.setHistoryPreferences=t=>e.sendIQ({archive:Object.assign({type:"preferences"},t),type:"set"}),e.on("message",t=>{t.archive&&e.emit("mam:item",t)})}const ds=new Set(["chat","headline","normal"]),ps=new Set(["chat","groupchat","normal"]),fs=(e,t)=>e.marker&&"markable"===e.marker.type&&!1!==t.config.chatMarkers;function ms(e,t){return Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({carbons:{action:t},type:"set"})}))}function gs(e,t,n){if(fs(t,e)){const i="groupchat"===t.type?z(t.from):t.from;e.sendMessage({body:"",marker:{id:t.id,type:n},to:i,type:t.type})}}function vs(e){e.disco.addFeature("urn:xmpp:attention:0"),e.disco.addFeature(qn),e.disco.addFeature(nn),e.disco.addFeature("urn:xmpp:message-correct:0"),e.disco.addFeature("urn:xmpp:receipts"),e.disco.addFeature(Pn),e.enableCarbons=()=>ms(e,"enable"),e.disableCarbons=()=>ms(e,"disable"),e.markReceived=t=>gs(e,t,"received"),e.markDisplayed=t=>gs(e,t,"displayed"),e.markAcknowledged=t=>gs(e,t,"acknowledged"),e.getAttention=(t,n={})=>e.sendMessage(Object.assign(Object.assign({},n),{requestingAttention:!0,to:t,type:"headline"})),e.on("message",t=>{if(t.carbon&&F(t.from,e.jid)){const n=t.carbon.forward.message;n.delay||(n.delay=t.carbon.forward.delay||{timestamp:new Date(Date.now())}),(e=>!!e.carbon&&"received"===e.carbon.type)(t)&&(e.emit("carbon:received",t),e.emit("message",n)),(e=>!!e.carbon&&"sent"===e.carbon.type)(t)&&(e.emit("carbon:sent",t),e.emit("message:sent",n,!0))}if((e=>!!e.forms&&e.forms.length>0)(t)&&e.emit("dataform",t),t.requestingAttention&&e.emit("attention",t),(e=>!!e.rtt)(t)&&e.emit("rtt",t),(e=>!!e.replace)(t)&&e.emit("replace",t),(e=>!!e.chatState)(t)&&ps.has(t.type||"normal")&&e.emit("chat:state",t),fs(t,e)&&e.markReceived(t),t.marker&&"markable"!==t.marker.type&&e.emit(`marker:${t.marker.type}`,t),(e=>!!e.receipt)(t)){!1!==e.config.sendReceipts&&ds.has(t.type||"normal")&&"request"===t.receipt.type&&e.sendMessage({id:t.id,receipt:{id:t.id,type:"received"},to:t.from,type:t.type}),"received"===t.receipt.type&&e.emit("receipt",t)}})}function ys(e){function t(){const t=e.joiningRooms;e.joiningRooms=new Map;for(const[n,i]of t)e.joinRoom(n,i);const n=e.joinedRooms;e.joinedRooms=new Map;for(const[t,i]of n)e.joinRoom(t,i)}e.disco.addFeature(Ft),e.disco.addFeature("jabber:x:conference"),e.disco.addFeature(Mn),e.joinedRooms=new Map,e.joiningRooms=new Map,e.on("session:started",t),e.on("stream:management:resumed",t),e.on("message",t=>{if("groupchat"===t.type&&t.hasSubject)e.emit("muc:topic",{from:t.from,room:z(t.from),topic:t.subject||""});else if(t.muc)if("direct-invite"===t.muc.type||!t.muc.invite&&t.legacyMUC){const n="direct-invite"===t.muc.type?t.muc:t.legacyMUC;e.emit("muc:invite",{from:t.from,password:n.password,reason:n.reason,room:n.jid,thread:n.thread,type:"direct"})}else t.muc.invite?e.emit("muc:invite",{from:t.muc.invite[0].from,password:t.muc.password,reason:t.muc.invite[0].reason,room:t.from,thread:t.muc.invite[0].thread,type:"mediated"}):t.muc.decline?e.emit("muc:declined",{from:t.muc.decline.from,reason:t.muc.decline.reason,room:t.from}):e.emit("muc:other",t)}),e.on("presence",t=>{const n=z(t.from);if(e.joiningRooms.has(n)&&"error"===t.type)return e.joiningRooms.delete(n),e.emit("muc:failed",t),void e.emit("muc:error",t);if(!function(e){return!!e.muc}(t))return;const i=t.muc.statusCodes&&t.muc.statusCodes.indexOf(yr.SelfPresence)>=0;if("error"!==t.type){if("unavailable"===t.type)return e.emit("muc:unavailable",t),i&&(e.emit("muc:leave",t),e.joinedRooms.delete(n)),void(t.muc.destroy&&e.emit("muc:destroyed",{newRoom:t.muc.destroy.jid,password:t.muc.destroy.password,reason:t.muc.destroy.reason,room:n}));e.emit("muc:available",t),i&&!e.joinedRooms.has(n)&&(e.emit("muc:join",t),e.joinedRooms.set(n,B(t.from)),e.joiningRooms.delete(n))}else e.emit("muc:error",t)}),e.joinRoom=(t,n,i={})=>{t=z(t),e.joiningRooms.set(t,n),e.sendPresence(Object.assign(Object.assign({},i),{muc:Object.assign(Object.assign({},i.muc),{type:"join"}),to:`${t}/${n}`}))},e.leaveRoom=(t,n,i={})=>{e.sendPresence(Object.assign(Object.assign({},i),{to:`${t}/${n}`,type:"unavailable"}))},e.ban=(t,n,i)=>e.setRoomAffiliation(t,n,"outcast",i),e.kick=(t,n,i)=>e.setRoomRole(t,n,"none",i),e.invite=(t,n=[])=>{Array.isArray(n)||(n=[n]),e.sendMessage({muc:{invite:n,type:"info"},to:t})},e.directInvite=(t,n,i={})=>{e.sendMessage({muc:Object.assign(Object.assign({},i),{jid:t,type:"direct-invite"}),to:n})},e.declineInvite=(t,n,i)=>{e.sendMessage({muc:{decline:{reason:i,to:n},type:"info"},to:t})},e.changeNick=(t,n)=>{e.sendPresence({to:`${z(t)}/${n}`})},e.setSubject=(t,n)=>{e.sendMessage({subject:n,to:t,type:"groupchat"})},e.getReservedNick=t=>Object(r.a)(this,void 0,void 0,(function*(){try{const n=(yield e.getDiscoInfo(t,"x-roomuser-item")).identities[0];if(n.name)return n.name;throw new Error("No nickname reserved")}catch(e){throw new Error("No nickname reserved")}})),e.requestRoomVoice=t=>{e.sendMessage({forms:[{fields:[{name:"FORM_TYPE",type:"hidden",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}],type:"submit"}],to:t})},e.setRoomAffiliation=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{affiliation:i,jid:n,reason:r}]},to:t,type:"set"}),e.setRoomRole=(t,n,i,r)=>e.sendIQ({muc:{type:"user-list",users:[{nick:n,reason:r,role:i}]},to:t,type:"set"}),e.getRoomMembers=(t,n={})=>e.sendIQ({muc:{type:"user-list",users:[n]},to:t,type:"get"}),e.getRoomConfig=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.sendIQ({muc:{type:"configure"},to:t,type:"get"});if(!n.muc.form)throw new Error("No configuration form returned");return n.muc.form})),e.configureRoom=(t,n={})=>e.sendIQ({muc:{form:Object.assign(Object.assign({},n),{type:"submit"}),type:"configure"},to:t,type:"set"}),e.destroyRoom=(t,n={})=>e.sendIQ({muc:{destroy:n,type:"configure"},to:t,type:"set"}),e.getUniqueRoomName=function(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield this.sendIQ({muc:{type:"unique"},to:e,type:"get"});if(!t.muc.name)throw new Error("No unique name returned");return t.muc.name}))},e.getBookmarks=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.getPrivateData("bookmarks");return t&&t.rooms?t.rooms:[]})),e.setBookmarks=t=>e.setPrivateData("bookmarks",{rooms:t}),e.addBookmark=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.getBookmarks(),i=[];let r=!1;for(const e of n)F(e.jid,t.jid)?(i.push(Object.assign(Object.assign({},e),t)),r=!0):i.push(e);return r||i.push(t),e.setBookmarks(i)})),e.removeBookmark=t=>Object(r.a)(this,void 0,void 0,(function*(){const n=(yield e.getBookmarks()).filter(e=>!F(e.jid,t));return e.setBookmarks(n)}))}function bs(e){e.disco.addFeature(sn),e.disco.addFeature(Zt),e.disco.addFeature(rn),e.disco.addFeature(vn),e.disco.addFeature(on),e.disco.addFeature(pn(sn)),e.disco.addFeature(pn(Zt)),e.disco.addFeature(pn(rn)),e.disco.addFeature(pn(vn)),e.disco.addFeature(pn(on)),e.publishActivity=t=>e.publish("",sn,Object.assign({itemType:sn},t)),e.publishGeoLoc=t=>e.publish("",Zt,Object.assign({itemType:Zt},t)),e.publishMood=t=>e.publish("",rn,Object.assign({itemType:rn},t)),e.publishNick=t=>e.publish("",vn,{itemType:vn,nick:t}),e.publishTune=t=>e.publish("",on,Object.assign({itemType:on},t)),e.on("pubsub:published",t=>{const n=t.pubsub.items.published[0].content;switch(t.pubsub.items.node){case sn:return e.emit("activity",{activity:n,jid:t.from});case Zt:return e.emit("geoloc",{geoloc:n,jid:t.from});case rn:return e.emit("mood",{jid:t.from,mood:n});case vn:return e.emit("nick",{jid:t.from,nick:n.nick});case on:return e.emit("tune",{jid:t.from,tune:t.pubsub.items.published[0].content})}})}function _s(e){e.disco.addFeature(`${un}#SubID`,un),e.on("message",t=>{!function(e){return!!e.pubsub&&!(e.pubsub.context&&"user"!==e.pubsub.context||!e.pubsub.affiliations)}(t)?function(e){return!!e.pubsub}(t)&&(e.emit("pubsub:event",t),!function(e){return!!e.pubsub.items&&!!e.pubsub.items.published}(t)?!function(e){return!!e.pubsub.items&&!!e.pubsub.items.retracted}(t)?!function(e){return"purge"===e.pubsub.eventType}(t)?!function(e){return"purge"===e.pubsub.eventType}(t)?!function(e){return"subscription"===e.pubsub.eventType}(t)?function(e){return"configuration"===e.pubsub.eventType}(t)&&e.emit("pubsub:config",t):e.emit("pubsub:subscription",t):e.emit("pubsub:deleted",t):e.emit("pubsub:purged",t):e.emit("pubsub:retracted",t):e.emit("pubsub:published",t)):e.emit("pubsub:affiliations",t)}),e.subscribeToNode=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i={};let r;"string"==typeof n?(i.node=n,i.jid=z(e.jid)):(i.node=n.node,i.jid=n.jid||(n.useBareJID?z(e.jid):e.jid),r=n.options);const s=yield e.sendIQ({pubsub:{context:"user",subscribe:i,subscriptionOptions:r?{form:r}:void 0},to:t,type:"set"}),o=s.pubsub.subscription||{};return s.pubsub.subscriptionOptions&&(o.options=s.pubsub.subscriptionOptions.form),o})),e.unsubscribeFromNode=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i={};"string"==typeof n?(i.node=n,i.jid=z(e.jid)):(i.node=n.node,i.subid=n.subid,i.jid=n.jid||(n.useBareJID?z(e.jid):e.jid));const r=yield e.sendIQ({pubsub:{context:"user",unsubscribe:i},to:t,type:"set"});return r.pubsub&&r.pubsub.subscription?r.pubsub.subscription:Object.assign(Object.assign({},i),{state:"none"})})),e.publish=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",publish:{item:{content:i,id:r},node:n}},to:t,type:"set"}),e.getItem=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",fetch:{items:[{id:i}],node:n}},to:t,type:"get"})).pubsub.fetch.items[0]})),e.getItems=(t,n,i={})=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",fetch:{max:i.max,node:n},paging:i},to:t,type:"get"})).pubsub.fetch})),e.retract=(t,n,i,r)=>e.sendIQ({pubsub:{context:"user",retract:{id:i,node:n,notify:r}},to:t,type:"set"}),e.purgeNode=(t,n)=>e.sendIQ({pubsub:{context:"owner",purge:n},to:t,type:"set"}),e.deleteNode=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",destroy:{node:n,redirect:i}},to:t,type:"set"}),e.createNode=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){const r=yield e.sendIQ({pubsub:{configure:i?{form:i}:void 0,context:"user",create:{node:n}},to:t,type:"set"});return r.pubsub&&r.pubsub.create?r.pubsub.create:{node:n}})),e.getSubscriptions=(t,n={})=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"user",subscriptions:n},to:t,type:"get"})).pubsub.subscriptions})),e.getAffiliations=(t,n)=>e.sendIQ({pubsub:{affiliations:{node:n}},to:t,type:"get"}),e.getNodeSubscribers=(t,n,i={})=>("string"==typeof n?i.node=n:i=Object.assign(Object.assign({},i),n),e.sendIQ({pubsub:{context:"owner",subscriptions:i},to:t,type:"get"})),e.updateNodeSubscriptions=(t,n,i)=>e.sendIQ({pubsub:{context:"owner",subscriptions:{items:i,node:n}},to:t,type:"set"}),e.getNodeAffiliations=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{affiliations:{node:n},context:"owner"},to:t,type:"get"})).pubsub.affiliations})),e.updateNodeAffiliations=(t,n,i)=>e.sendIQ({pubsub:{affiliations:{items:i,node:n},context:"owner"},to:t,type:"set"}),e.getNodeConfig=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{configure:{node:n},context:"owner"},to:t,type:"get"})).pubsub.configure.form||{}})),e.getDefaultNodeConfig=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{context:"owner",defaultConfiguration:{}},to:t,type:"get"})).pubsub.defaultConfiguration.form||{}})),e.configureNode=(t,n,i)=>Object(r.a)(this,void 0,void 0,(function*(){return e.sendIQ({pubsub:{configure:{form:i,node:n},context:"owner"},to:t,type:"set"})})),e.getDefaultSubscriptionOptions=t=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({pubsub:{defaultSubscriptionOptions:{}},to:t,type:"get"})).pubsub.defaultSubscriptionOptions.form||{}}))}function ws(e){function t(t,n){return Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({blockList:{action:t,jids:[n]},type:"set"})}))}e.on("iq:set:roster",t=>{if(!N(e.jid).has(t.from))return e.sendIQError(t,{error:{condition:"service-unavailable",type:"cancel"}});e.emit("roster:update",t),e.sendIQResult(t)}),e.on("iq:set:blockList",t=>{const n=t.blockList;e.emit(n.action,{jids:n.jids||[]}),e.sendIQResult(t)}),e.getRoster=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({roster:{version:e.config.rosterVer},type:"get"});if(t.roster){const n=t.roster.version;return n&&(e.config.rosterVer=n,e.emit("roster:ver",n)),t.roster.items=t.roster.items||[],t.roster}return{items:[]}})),e.updateRosterItem=t=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({roster:{items:[t]},type:"set"})})),e.removeRosterItem=t=>e.updateRosterItem({jid:t,subscription:"remove"}),e.subscribe=t=>{e.sendPresence({type:"subscribe",to:t})},e.unsubscribe=t=>{e.sendPresence({type:"unsubscribe",to:t})},e.acceptSubscription=t=>{e.sendPresence({type:"subscribed",to:t})},e.denySubscription=t=>{e.sendPresence({type:"unsubscribed",to:t})},e.getBlocked=()=>Object(r.a)(this,void 0,void 0,(function*(){const t=yield e.sendIQ({blockList:{action:"list"},type:"get"});return Object.assign({jids:[]},t.blockList)})),e.block=e=>Object(r.a)(this,void 0,void 0,(function*(){return t("block",e)})),e.unblock=e=>Object(r.a)(this,void 0,void 0,(function*(){return t("unblock",e)})),e.goInvisible=(t=!1)=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{probe:t,type:"invisible"}})})),e.goVisible=()=>Object(r.a)(this,void 0,void 0,(function*(){yield e.sendIQ({type:"set",visiblity:{type:"visible"}})}))}function Ss(e){e.registerFeature("sasl",100,(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){const i=e.sasl.createMechanism(t.sasl.mechanisms),s=t=>Object(r.a)(this,void 0,void 0,(function*(){if(i)switch(t.type){case"success":return e.features.negotiated.sasl=!0,e.off("sasl",s),e.emit("auth:success",e.config.credentials),void n("restart");case"challenge":i.processChallenge(t.value);try{const t=yield e.getCredentials(),n=i.createResponse(t);n||""===n?e.send("sasl",{type:"response",value:n}):e.send("sasl",{type:"response"});const r=i.getCacheableCredentials();r&&(e.config.credentials||(e.config.credentials={}),e.config.credentials=Object.assign(Object.assign({},e.config.credentials),r),e.emit("credentials:update",e.config.credentials))}catch(t){console.error(t),e.send("sasl",{type:"abort"})}return;case"failure":case"abort":return e.off("sasl",s),e.emit("auth:failed"),void n("disconnect","authentication failed")}}));if(!i)return e.off("sasl",s),e.emit("auth:failed"),n("disconnect","authentication failed");e.on("sasl",s),e.once("disconnected",()=>{e.features.negotiated.sasl=!1,e.off("sasl",s)});try{const t=yield e.getCredentials();e.send("sasl",{mechanism:i.name,type:"auth",value:i.createResponse(t)})}catch(t){console.error(t),e.send("sasl",{type:"abort"})}})))}function Cs(e){function t(t){return Object(r.a)(this,void 0,void 0,(function*(){const n=yield e.getDiscoInfo(t);if(!n.features||!n.features.includes(Bn))return;let i;for(const e of n.extensions||[]){const n=e.fields||[];if(n.some(e=>"FORM_TYPE"===e.name&&e.value===Bn)){const e=n.find(e=>"max-file-size"===e.name);return e&&(i=parseInt(e.value,10)),{jid:t,maxSize:i}}}}))}e.disco.addFeature(Sn),e.getBits=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({bits:{cid:n},to:t,type:"get"})).bits})),e.getUploadService=(n=U(e.jid))=>Object(r.a)(this,void 0,void 0,(function*(){const i=yield t(n);if(i)return i;const r=yield e.getDiscoItems(n);for(const e of r.items||[]){if(!e.jid)continue;const n=yield t(e.jid);if(n)return n}throw new Error("No upload service discovered on: "+n)})),e.getUploadSlot=(t,n)=>Object(r.a)(this,void 0,void 0,(function*(){return(yield e.sendIQ({httpUpload:Object.assign({type:"request"},n),to:t,type:"get"})).httpUpload}))}function Es(e){e.use(zr),e.use(dr),e.use(Ki),e.use(ar),e.use(Wr),e.use(Ss)}function ks(e){e.use(Yi),e.use(vs),e.use(Qi),e.use(Xi),e.use(Br),e.use(hs),e.use(ls),e.use(ys),e.use(bs),e.use(_s),e.use(ws),e.use(Cs)}const xs={aliases:["features.legacySession","iq.legacySession"],element:"session",fields:{optional:st(null,"optional")},namespace:It},Is={defaultType:"stream",element:"stream",fields:{from:Fe("from"),id:Fe("id"),lang:Ke(),to:Fe("to"),version:Fe("version")},namespace:jt,path:"stream",type:"stream",typeField:"action"},Os={element:"features",namespace:jt,path:"features"},js={element:"error",fields:{alternateLanguageText:mt(Tt,"text"),condition:ht(Tt,Fr(mr),mr.UndefinedCondition),seeOtherHost:Xe(Tt,mr.SeeOtherHost),text:Xe(Tt,"text")},namespace:jt,path:"streamError"},Ts=Object.values(pr).map(e=>({aliases:["stanzaError","message.error","presence.error","iq.error"],defaultType:kt,element:"error",fields:{alternateLanguageText:mt(Ot,"text"),by:Hn("by"),condition:ht(Ot,Fr(gr),gr.UndefinedCondition),gone:Xe(Ot,gr.Gone),redirect:Xe(Ot,gr.Redirect),text:Xe(Ot,"text"),type:Fe("type")},namespace:e,type:e,typeField:"streamType"})),Rs=new Set(["from","id","lang","to","type","payloadType","error"]),As=Object.values(pr).map(e=>({defaultType:kt,element:"iq",fields:{from:Hn("from"),id:Fe("id"),lang:Ke(),payloadType:{order:-1e4,importer(e,t){if("get"!==t.data.type&&"set"!==t.data.type)return;if(1!==e.children.filter(e=>"string"!=typeof e).length)return"invalid-payload-count";const n=Object.keys(t.data).filter(e=>!Rs.has(e));return 1!==n.length?"unknown-payload":n[0]}},to:Hn("to"),type:Fe("type")},namespace:e,path:"iq",type:e,typeField:"streamType"})),Ps=Object.values(pr).map(e=>({defaultType:kt,element:"message",fields:{from:Hn("from"),id:Fe("id"),lang:Ke(),to:Hn("to")},namespace:e,path:"message",type:e,typeField:"streamType"})),Ds=Object.values(pr).map(e=>({defaultType:kt,element:"presence",fields:{from:Hn("from"),id:Fe("id"),lang:Ke(),to:Hn("to")},namespace:e,path:"presence",type:e,typeField:"streamType"})),Ms=[Is,Os,js,...Ts,...[{element:"mechanisms",fields:{mechanisms:dt(null,"mechanism")},namespace:xt,path:"features.sasl"},{element:"abort",namespace:xt,path:"sasl",type:"abort",typeField:"type"},{element:"auth",fields:{mechanism:Fe("mechanism"),value:Qe("base64")},namespace:xt,path:"sasl",type:"auth",typeField:"type"},{element:"challenge",fields:{value:Qe("base64")},namespace:xt,path:"sasl",type:"challenge",typeField:"type"},{element:"response",fields:{value:Qe("base64")},namespace:xt,path:"sasl",type:"response",typeField:"type"},{element:"success",fields:{value:Qe("base64")},namespace:xt,path:"sasl",type:"success",typeField:"type"},{element:"failure",fields:{alternateLanguageText:mt(xt,"text"),condition:ht(xt,Fr(fr)),text:Xe(xt,"text")},namespace:xt,path:"sasl",type:"failure",typeField:"type"}],...[{aliases:["features.tls"],defaultType:"start",element:"starttls",fields:{required:st(null,"required")},namespace:Rt,path:"tls",type:"start",typeField:"type"},{element:"proceed",namespace:Rt,path:"tls",type:"proceed",typeField:"type"},{element:"failure",namespace:Rt,path:"tls",type:"failure",typeField:"type"}],...As,...Ps,...Ds,{aliases:["features.bind","iq.bind"],element:"bind",fields:{jid:Xe(null,"jid"),resource:Xe(null,"resource")},namespace:Et}],qs=[Kn({rosterPreApproval:st("urn:xmpp:features:pre-approval","sub"),rosterVersioning:st("urn:xmpp:features:rosterver","ver")}),Jn({alternateLanguageBodies:mt(null,"body"),alternateLanguageSubjects:mt(null,"subject"),body:Xe(null,"body"),hasSubject:st(null,"subject"),parentThread:We(null,"thread","parent"),subject:Xe(null,"subject"),thread:Xe(null,"thread"),type:Fe("type")}),Yn({alternateLanguageStatuses:mt(null,"status"),priority:tt(null,"priority",0),show:Xe(null,"show"),status:Xe(null,"status"),type:Fe("type")}),{element:"query",fields:{version:Fe("ver",void 0,{emitEmpty:!0})},namespace:"jabber:iq:roster",path:"iq.roster"},{aliases:[{path:"iq.roster.items",multiple:!0}],element:"item",fields:{groups:dt(null,"group"),jid:Hn("jid"),name:Fe("name"),pending:Fe("ask"),preApproved:Le("approved"),subscription:Fe("subscription")},namespace:"jabber:iq:roster"}],Ns=[{element:"open",fields:{from:Fe("from"),id:Fe("id"),lang:Ke(),to:Fe("to"),version:Fe("version")},namespace:At,path:"stream",type:"open"},{element:"close",fields:{seeOtherURI:Fe("see-other-uri")},namespace:At,path:"stream",type:"close"}],Fs=[{aliases:[{path:"message.forms",multiple:!0}],element:"x",fields:{instructions:Object.assign(Object.assign({},dt(null,"instructions")),{exportOrder:2}),reported:Object.assign(Object.assign({},vt(null,"reported","dataformField",!0)),{exportOrder:3}),title:Object.assign(Object.assign({},Xe(null,"title")),{exportOrder:1}),type:Fe("type")},namespace:Pt,optionalNamespaces:{xdv:an},path:"dataform"},{aliases:[{path:"dataform.fields",multiple:!0},{path:"dataform.items.fields",multiple:!0}],element:"field",fields:{description:Xe(null,"desc"),label:Fe("label"),name:Fe("var"),rawValues:Object.assign(Object.assign({},dt(null,"value")),{exporter:()=>null}),required:st(null,"required"),type:Fe("type"),value:{importer(e,t){const n=e.getAttribute("type"),i=dt(Pt,"value").importer(e,t),r=i[0];switch(n){case vr.TextMultiple:case vr.ListMultiple:case vr.JIDMultiple:return i;case vr.Hidden:case vr.Fixed:return 1===i.length?r:i;case vr.Boolean:if(r)return"1"===r||"true"===r;break;default:return r}},exporter(e,t,n){const i=dt(null,"value");let r=[];const s=n.data&&n.data.rawValues?n.data.rawValues[0]:void 0;if("boolean"==typeof t)r="true"===s||"false"===s?[s]:[t?"1":"0"];else if(Array.isArray(t))for(const e of t)r.push(e.toString());else r=[t.toString()];i.exporter(e,r,Object.assign({},n,{namespace:Pt}))}}},namespace:Pt,path:"dataformField"},{aliases:[{path:"dataform.fields.options",multiple:!0}],element:"option",fields:{label:Fe("label"),value:Xe(null,"value")},namespace:Pt},{aliases:[{path:"dataform.items",multiple:!0}],element:"item",namespace:Pt},{element:"validate",fields:{listMax:Ve(null,"list-range","max"),listMin:Ve(null,"list-range","min"),method:ht(null,["basic","open","range","regex"],"basic"),rangeMax:We(null,"range","max"),rangeMin:We(null,"range","min"),regex:Xe(null,"regex"),type:Fe("datatype","xs:string")},namespace:an,path:"dataform.fields.validation"}],Ls=[{aliases:["presence.legacyLastActivity","iq.lastActivity"],element:"query",fields:{seconds:Ue("seconds"),status:Je()},namespace:"jabber:iq:last"}],Us=[{element:"query",fields:{activeList:We(null,"active","name"),defaultList:We(null,"default","name")},namespace:Dt,path:"iq.privacy"},{aliases:[{path:"iq.privacy.lists",multiple:!0}],element:"list",fields:{name:Fe("name")},namespace:Dt},{aliases:[{path:"iq.privacy.lists.items",multiple:!0}],element:"item",fields:{action:Fe("action"),incomingPresence:st(null,"presence-in"),iq:st(null,"iq"),messages:st(null,"message"),order:Ue("order"),outgoingPresence:st(null,"presence-out"),type:Fe("type"),value:Fe("value")},namespace:Dt}],Bs=[{aliases:["iq.disco","message.disco","features.disco"],childrenExportOrder:{identities:100},element:"query",fields:{features:pt(null,"feature","var"),node:Fe("node")},namespace:Mt,path:"disco",type:"info",typeField:"type"},{aliases:[{path:"disco.identities",selector:"info",multiple:!0}],element:"identity",fields:{category:Fe("category"),lang:Ke(),name:Fe("name"),type:Fe("type")},namespace:Mt},{aliases:[{path:"disco.items",multiple:!0,selector:"items"}],element:"item",fields:{jid:Hn("jid"),name:Fe("name"),node:Fe("node")},namespace:qt},{aliases:[{path:"disco.items",multiple:!0,selector:"info"}],element:"item",fields:{category:Hn("category"),lang:Ke(),name:Fe("name"),type:Fe("type")},namespace:Mt},$n(Pt,"x",[{path:"disco.extensions",multiple:!0,selector:"info"}]),$n(Wt,"set",[{path:"disco.paging",selector:"items"}]),{aliases:["iq.disco","message.disco","features.disco"],element:"query",fields:{node:Fe("node")},namespace:qt,path:"disco",type:"items",typeField:"type"}],zs=[Jn({addresses:vt(Nt,"addresses","extendedAddress",!0)}),Yn({addresses:vt(Nt,"addresses","extendedAddress",!0)}),{element:"address",fields:{alternateLanguageDescriptions:mt(null,"desc"),delivered:Le("delivered"),description:Fe("desc"),jid:Hn("jid"),node:Fe("node"),type:Fe("type"),uri:Fe("uri")},namespace:Nt,path:"extendedAddress"}],Gs=[$n(Pt,"x",[{path:"iq.muc.form",selector:"configure"}]),{defaultType:"info",element:"x",fields:{password:Xe(null,"password")},namespace:Ft,path:"presence.muc",type:"join",typeField:"type"},{aliases:[{path:"presence.muc.history",selector:"join"}],element:"history",fields:{maxCharacters:Ue("maxchars"),maxStanzas:Ue("maxstanzas"),seconds:Ue("seconds"),since:Be("since")},namespace:Ft},{aliases:["presence.muc","message.muc"],defaultType:"info",element:"x",fields:{action:ht(null,["invite","decline","destroy"]),actor:vt(null,"item","mucactor"),affiliation:We(null,"item","affiliation"),jid:Vn(null,"item","jid"),nick:We(null,"item","nick"),password:Xe(null,"password"),reason:at([{namespace:null,element:"item"},{namespace:null,element:"reason"}]),role:We(null,"item","role"),statusCodes:pt(null,"status","code")},namespace:Bt,type:"info",typeField:"type",typeOrder:1},{element:"actor",fields:{jid:Hn("jid"),nick:Fe("nick")},namespace:Bt,path:"mucactor"},{element:"destroy",fields:{jid:Hn("jid"),reason:Xe(null,"reason")},namespace:Bt,path:"presence.muc.destroy"},{aliases:[{path:"message.muc.invite",multiple:!0}],element:"invite",fields:{continue:st(null,"continue"),from:Hn("from"),reason:Xe(null,"reason"),thread:We(null,"continue","thread"),to:Hn("to")},namespace:Bt},{element:"decline",fields:{from:Hn("from"),reason:Xe(null,"reason"),to:Hn("to")},namespace:Bt,path:"message.muc",type:"decline"},{element:"query",namespace:Lt,path:"iq.muc",type:"user-list",typeField:"type"},{aliases:[{path:"iq.muc.users",multiple:!0,selector:"user-list"}],element:"item",fields:{affiliation:Fe("affiliation"),jid:Hn("jid"),nick:Fe("nick"),reason:Xe(null,"reason"),role:Fe("role")},namespace:Lt},{aliases:["iq.muc.users.actor"],element:"actor",fields:{jid:Hn("jid"),nick:Fe("nick")},namespace:Lt},{element:"query",namespace:Ut,path:"iq.muc",type:"configure",typeField:"type"},{aliases:[{path:"iq.muc.destroy",selector:"configure"}],element:"destroy",fields:{jid:Hn("jid"),password:Xe(null,"password"),reason:Xe(null,"reason")},namespace:Ut},{element:"x",fields:{action:yt("invite"),continue:Le("continue"),jid:Hn("jid"),legacyReason:Je(),password:Fe("password"),reason:Fe("reason"),thread:Fe("thread")},namespace:"jabber:x:conference",path:"message.muc",type:"direct-invite",typeOrder:2},{element:"unique",fields:{name:Je()},namespace:"http://jabber.org/protocol/muc#unique",path:"iq.muc",type:"unique"},Jn({legacyMUC:{exporter(e,t,n){const i=n.registry?n.registry.export("message.muc",Object.assign(Object.assign({},t),{type:"direct-invite"})):void 0;i&&e.appendChild(i)},exportOrder:100001,importer(e,t){if(!we(e,Bt,"x")[0])return;const n=we(e,"jabber:x:conference","x")[0];return n&&t.registry?t.registry.import(n,Object.assign(Object.assign({},t),{path:"message"})):void 0},importOrder:-1}})],Ws=[{aliases:["iq.ibb","message.ibb"],element:"open",fields:{ack:{importer:(e,t)=>"message"!==Fe("stanza","iq").importer(e,t),exporter(e,t,n){Fe("stanza").exporter(e,t?"iq":"message",n)}},blockSize:Ue("block-size"),sid:Fe("sid")},namespace:zt,type:"open",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"close",fields:{sid:Fe("sid")},namespace:zt,type:"close",typeField:"action"},{aliases:["iq.ibb","message.ibb"],element:"data",fields:{data:Qe("base64"),seq:Ue("seq"),sid:Fe("sid")},namespace:zt,type:"data",typeField:"action"}],Hs=[{aliases:[{path:"bookmarkStorage",impliedType:!0},{path:"iq.privateStorage.bookmarks",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"storage",namespace:"storage:bookmarks",type:"storage:bookmarks",typeField:"itemType"},{aliases:[{path:"bookmarkStorage.rooms",multiple:!0}],element:"conference",fields:{autoJoin:Le("autojoin"),jid:Hn("jid"),name:Fe("name"),nick:Xe(null,"nick"),password:Xe(null,"password")},namespace:"storage:bookmarks"}],Vs={element:"query",namespace:"jabber:iq:private",path:"iq.privateStorage"},$s=[$n(Pt,"x",["iq.command.form"]),Xn({commandError:ht(Gt,["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"])}),{element:"command",fields:{action:Fe("action"),node:Fe("node"),sid:Fe("sessionid"),status:Fe("status")},namespace:Gt,path:"iq.command"},{element:"actions",fields:{complete:st(null,"complete"),execute:Fe("execute"),next:st(null,"next"),prev:st(null,"prev")},namespace:Gt,path:"iq.command.availableActions"},{aliases:[{path:"iq.command.notes",multiple:!0}],element:"note",fields:{type:Fe("type"),value:Je()},namespace:Gt}],Js="vcardTemp.records";function Ys(e,t){return{aliases:[{multiple:!0,path:Js}],element:e,fields:{value:Je()},namespace:"vcard-temp",type:t,typeField:"type"}}const Qs=[{aliases:[{path:"iq.vcard"}],defaultType:"vcard-temp",element:"vCard",fields:{fullName:Xe(null,"FN")},namespace:"vcard-temp",path:"vcardTemp",type:"vcard-temp",typeField:"format"},{element:"N",fields:{additional:Object.assign(Object.assign({},Xe(null,"MIDDLE")),{order:3}),family:Object.assign(Object.assign({},Xe(null,"FAMILY")),{order:1}),given:Object.assign(Object.assign({},Xe(null,"GIVEN")),{order:2}),prefix:Object.assign(Object.assign({},Xe(null,"PREFIX")),{order:4}),suffix:Object.assign(Object.assign({},Xe(null,"SUFFIX")),{order:5})},namespace:"vcard-temp",path:"vcardTemp.name"},Ys("NICKNAME","nickname"),Ys("BDAY","birthday"),Ys("JABBERID","jid"),Ys("TZ","timezone"),Ys("TITLE","title"),Ys("ROLE","role"),Ys("URL","url"),Ys("NOTE","note"),Ys("SORT-STRING","sort"),Ys("UID","uid"),Ys("REV","revision"),Ys("PRODID","productId"),Ys("DESC","description"),{aliases:[{multiple:!0,path:Js}],element:"EMAIL",fields:{preferred:st(null,"PREF"),types:gt(null,[["home","HOME"],["work","WORK"],["internet","INTERNET"]]),value:Xe(null,"USERID")},namespace:"vcard-temp",type:"email"},{aliases:[{path:Js,multiple:!0}],element:"ORG",fields:{units:Object.assign(Object.assign({},dt(null,"ORGUNIT")),{order:2}),value:Object.assign(Object.assign({},Xe(null,"ORGNAME")),{order:1})},namespace:"vcard-temp",type:"organization",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"ADR",fields:{city:Xe(null,"LOCALITY"),code:Xe(null,"PCODE"),country:Xe(null,"CTRY"),pobox:Xe(null,"POBOX"),preferred:st(null,"PREF"),region:Xe(null,"REGION"),street:Xe(null,"STREET"),street2:Xe(null,"EXTADD"),types:gt(null,[["home","HOME"],["work","WORK"],["domestic","DOM"],["international","INTL"],["postal","POSTAL"],["parcel","PARCEL"]])},namespace:"vcard-temp",type:"address",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"LABEL",fields:{lines:dt(null,"LINE"),preferred:st(null,"PREF"),types:gt(null,[["home","HOME"],["work","WORK"]])},namespace:"vcard-temp",type:"addressLabel",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"TEL",fields:{preferred:st(null,"PREF"),types:gt(null,[["home","HOME"],["work","WORK"],["cell","CELL"],["fax","FAX"],["voice","VOICE"],["msg","MSG"]]),value:Xe(null,"NUMBER","")},namespace:"vcard-temp",type:"tel",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"PHOTO",fields:{data:Xe(null,"BINVAL"),mediaType:Xe(null,"TYPE"),url:Xe(null,"EXTVAL")},namespace:"vcard-temp",type:"photo",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"LOGO",fields:{data:Xe(null,"BINVAL"),mediaType:Xe(null,"TYPE"),url:Xe(null,"EXTVAL")},namespace:"vcard-temp",type:"logo",typeField:"type"},{aliases:[{multiple:!0,path:Js}],element:"CATEGORIES",fields:{value:dt(null,"KEYWORD")},namespace:"vcard-temp",type:"categories",typeField:"type"}],Ks=[$n(Pt,"x",["iq.search.form"]),{element:"query",fields:{email:Xe(null,"email"),familyName:Xe(null,"last"),givenName:Xe(null,"first"),instructions:Xe(null,"instructions"),nick:Xe(null,"nick")},namespace:"jabber:iq:search",path:"iq.search"},{aliases:[{path:"iq.search.items",multiple:!0}],element:"item",fields:{email:Xe(null,"email"),familyName:Xe(null,"last"),givenName:Xe(null,"first"),jid:Hn("jid"),nick:Xe(null,"nick")},namespace:"jabber:iq:search"}],Xs={aliases:["iq.pubsub.paging"],element:"set",fields:{after:Xe(null,"after"),before:Xe(null,"before"),count:tt(null,"count"),first:Xe(null,"first"),firstIndex:Ve(null,"first","index"),index:tt(null,"index"),last:Xe(null,"last"),max:tt(null,"max")},namespace:Wt,path:"paging"},Zs={configurable:st(null,"subscribe-options"),configurationRequired:ut([{namespace:null,element:"subscribe-options"},{namespace:null,element:"required"}]),jid:Hn("jid"),node:Fe("node"),state:Fe("subscription"),subid:Fe("subid")},eo={node:Fe("node")},to=[{aliases:["pubsub","iq.pubsub","message.pubsub"],childrenExportOrder:{configure:0,create:100,publish:100,subscribe:100,subscriptionOptions:0},defaultType:"user",element:"pubsub",fields:{publishOptions:vt(null,"publish-options","dataform")},namespace:Ht,type:"user",typeField:"context"},{aliases:["pubsub","iq.pubsub","message.pubsub"],defaultType:"user",element:"pubsub",fields:{purge:We(null,"purge","node")},namespace:Jt,type:"owner",typeField:"context"},$n(Pt,"x",["iq.pubsub.configure.form","iq.pubsub.defaultConfiguration.form","iq.pubsub.defaultSubscriptionOptions.form","iq.pubsub.subscriptionOptions.forms","message.pubsub.configuration.form"]),$n(Wt,"set",["iq.pubsub.fetch.paging"]),Xn({pubsubError:ht(Vt,Fr(br)),pubsubUnsupportedFeature:We(Vt,"unsupported","feature")}),{element:"subscribe",fields:{jid:Hn("jid"),node:Fe("node")},namespace:Ht,path:"iq.pubsub.subscribe"},{element:"unsubscribe",fields:{jid:Hn("jid"),node:Fe("node"),subid:Fe("subid")},namespace:Ht,path:"iq.pubsub.unsubscribe"},{element:"options",fields:{jid:Hn("jid"),node:Fe("node"),subid:Fe("subid")},namespace:Ht,path:"iq.pubsub.subscriptionOptions"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"user",impliedType:!0}],element:"subscriptions",fields:{jid:Hn("jid"),node:Fe("node")},namespace:Ht,type:"user"},{aliases:[{path:"iq.pubsub.subscriptions",selector:"owner",impliedType:!0}],element:"subscriptions",fields:{jid:Hn("jid"),node:Fe("node")},namespace:Jt,type:"owner"},{aliases:["iq.pubsub.subscription",{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"user"}],element:"subscription",fields:Zs,namespace:Ht},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.subscriptions.items",selector:"owner"}],element:"subscription",fields:Zs,namespace:Jt},{aliases:[{path:"iq.pubsub.affiliations",selector:"user",impliedType:!0},{path:"message.pubsub.affiliations",selector:"user",impliedType:!0}],element:"affiliations",fields:eo,namespace:Ht,type:"user"},{aliases:[{path:"iq.pubsub.affiliations",selector:"owner",impliedType:!0}],element:"affiliations",fields:eo,namespace:Jt,type:"owner"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"user"},{impliedType:!0,multiple:!0,path:"message.pubsub.affiliations.items",selector:"user"}],element:"affiliation",fields:{affiliation:Fe("affiliation"),jid:Hn("jid"),node:Fe("node")},namespace:Ht,type:"user"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.pubsub.affiliations.items",selector:"owner"}],element:"affiliation",fields:{affiliation:Fe("affiliation"),jid:Hn("jid"),node:Fe("node")},namespace:Jt,type:"owner"},{element:"create",fields:eo,namespace:Ht,path:"iq.pubsub.create"},{aliases:[{path:"iq.pubsub.destroy",selector:"owner"}],element:"delete",fields:{node:Fe("node"),redirect:We(null,"redirect","uri")},namespace:Jt},{aliases:[{path:"iq.pubsub.configure",selector:"owner",impliedType:!0}],element:"configure",fields:eo,namespace:Jt,type:"owner"},{aliases:[{path:"iq.pubsub.configure",selector:"user",impliedType:!0}],element:"configure",fields:eo,namespace:Ht,type:"user"},{element:"default",fields:{},namespace:Ht,path:"iq.pubsub.defaultSubscriptionOptions"},{element:"default",fields:{},namespace:Jt,path:"iq.pubsub.defaultConfiguration"},{element:"publish",fields:eo,namespace:Ht,path:"iq.pubsub.publish"},{element:"retract",fields:{id:We(null,"item","id"),node:Fe("node"),notify:Le("notify")},namespace:Ht,path:"iq.pubsub.retract"},{element:"items",fields:{max:Ue("max_items"),node:Fe("node")},namespace:Ht,path:"iq.pubsub.fetch"},{aliases:["pubsubitem","iq.pubsub.publish.item",{multiple:!0,path:"iq.pubsub.fetch.items"}],element:"item",fields:{id:Fe("id"),publisher:Hn("publisher")},namespace:Ht},{element:"event",fields:{eventType:ht(null,["purge","delete","subscription","configuration","items"])},namespace:$t,path:"message.pubsub",type:"event",typeField:"context"},{aliases:[{path:"message.pubsub.items.published",multiple:!0}],element:"item",fields:{id:Fe("id"),publisher:Hn("publisher")},namespace:$t,path:"pubsubeventitem"},{element:"purge",fields:eo,namespace:$t,path:"message.pubsub.purge"},{element:"delete",fields:{node:Fe("node"),redirect:We(null,"redirect","uri")},namespace:$t,path:"message.pubsub.delete"},{element:"subscription",fields:{expires:(no="expiry",{importer(e){const t=e.getAttribute(no);return"presence"===t?t:t?new Date(t):void 0},exporter(e,t){let n;n="string"==typeof t?t:t.toISOString(),e.setAttribute(no,n)}}),jid:Hn("jid"),node:Fe("node"),subid:Fe("subid"),type:Fe("subscription")},namespace:$t,path:"message.pubsub.subscription"},{element:"configuration",fields:eo,namespace:$t,path:"message.pubsub.configuration"},{element:"items",fields:{node:Fe("node"),retracted:pt(null,"retracted","id")},namespace:$t,path:"message.pubsub.items"}];var no;const io=[{element:"query",fields:{activate:Xe(null,"activate"),address:Fe("dstaddr"),candidateUsed:Vn(null,"streamhost-used","jid"),mode:Fe("mode","tcp"),sid:Fe("sid"),udpSuccess:We(null,"udpsuccess","dstaddr")},namespace:Yt,path:"iq.socks5"},{aliases:[{multiple:!0,path:"iq.socks5.candidates"}],element:"streamhost",fields:{host:Fe("host"),jid:Hn("jid"),port:Ue("port"),uri:Fe("uri")},namespace:Yt}],ro=[{aliases:[{multiple:!0,path:"message.links"}],element:"x",fields:{description:Xe(null,"desc"),url:Xe(null,"url")},namespace:Qt},{element:"query",fields:{description:Xe(null,"desc"),url:Xe(null,"url")},namespace:"jabber:iq:oob",path:"iq.transferLink"}],so={element:"html",fields:{alternateLanguageBodies:_t(Kt,"body","xhtmlim"),body:bt(Kt,"body","xhtmlim")},namespace:Xt,path:"message.html"},oo=[Kn({inbandRegistration:st("http://jabber.org/features/iq-register","register")}),$n(Pt,"x",["iq.account.form"]),$n(Qt,"x",["iq.account.registrationLink"]),{element:"query",fields:{address:Xe(null,"address"),date:et(null,"date"),email:Xe(null,"email"),familyName:Xe(null,"last"),fullName:Xe(null,"name"),givenName:Xe(null,"first"),instructions:Xe(null,"instructions"),key:Xe(null,"key"),locality:Xe(null,"city"),misc:Xe(null,"misc"),nick:Xe(null,"nick"),password:Xe(null,"password"),phone:Xe(null,"phone"),postalCode:Xe(null,"zip"),region:Xe(null,"state"),registered:st(null,"registered"),remove:st(null,"remove"),text:Xe(null,"text"),uri:Xe(null,"uri"),username:Xe(null,"username")},namespace:"jabber:iq:register",path:"iq.account"}],ao={aliases:[{path:"message.geoloc",impliedType:!0},{path:"dataform.fields.geoloc",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"geoloc",fields:{accuracy:nt(null,"accuracy"),altitude:nt(null,"alt"),altitudeAccuracy:nt(null,"altaccuracy"),area:Xe(null,"area"),building:Xe(null,"building"),country:Xe(null,"country"),countryCode:Xe(null,"countrycode"),datum:Xe(null,"datum"),description:Xe(null,"description"),error:nt(null,"error"),floor:Xe(null,"floor"),heading:nt(null,"bearing"),lang:Ke(),latitude:nt(null,"lat"),locality:Xe(null,"locality"),longitude:nt(null,"lon"),postalCode:Xe(null,"postalcode"),region:Xe(null,"region"),room:Xe(null,"room"),speed:nt(null,"speed"),street:Xe(null,"street"),text:Xe(null,"text"),timestamp:et(null,"timestamp"),tzo:rt(null,"tzo"),uri:Xe(null,"uri")},namespace:Zt,type:Zt},co=[{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"data",fields:{data:Qe("base64")},namespace:en,path:"avatar",type:en,typeField:"itemType"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"metadata",namespace:tn,path:"avatar",type:tn,typeField:"itemType"},{aliases:[{multiple:!0,path:"avatar.versions",selector:tn}],element:"info",fields:{bytes:Ue("bytes"),height:Ue("height"),id:Fe("id"),mediaType:Fe("type"),uri:Fe("url"),width:Ue("width")},namespace:tn},{aliases:[{multiple:!0,path:"avatar.pointers",selector:tn}],element:"pointer",fields:{bytes:Ue("bytes"),height:Ue("height"),id:Fe("id"),mediaType:Fe("type"),uri:Fe("url"),width:Ue("width")},namespace:tn}];var uo=Jn({chatState:ht(nn,Fr(_r))});const ho={element:"query",fields:{name:Xe(null,"name"),os:Xe(null,"os"),version:Xe(null,"version")},namespace:"jabber:iq:version",path:"iq.softwareVersion"},lo={aliases:[{path:"message.mood",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"mood",fields:{alternateLanguageText:mt(null,"text"),text:Xe(null,"text"),value:ht(null,Ir)},namespace:rn,type:rn},po={aliases:[{path:"activity",impliedType:!0},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"activity",fields:{activity:lt(null,Or,jr),alternateLanguageText:mt(null,"text"),text:Xe(null,"text")},namespace:sn,type:sn},fo={element:"handshake",fields:{value:Qe("hex")},namespace:"jabber:component:accept",path:"handshake"},mo={aliases:[{path:"presence.legacyCapabilities",multiple:!0},{path:"features.legacyCapabilities",multiple:!0}],element:"c",fields:{algorithm:Fe("hash"),legacy:yt(!0),node:Fe("node"),value:Fe("ver")},namespace:"http://jabber.org/protocol/caps"},go={aliases:[{impliedType:!0,path:"tune"},{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"tune",fields:{artist:Xe(null,"artist"),length:tt(null,"length"),rating:tt(null,"rating"),source:Xe(null,"source"),title:Xe(null,"title"),track:Xe(null,"track"),uri:Xe(null,"uri")},namespace:on,type:on},vo=["dataformLayout",{multiple:!0,path:"dataformLayout.contents"},{multiple:!0,path:"dataform.layout.contents"}],yo=[{aliases:[{multiple:!0,path:"dataform.layout"}],element:"page",fields:{label:Fe("label")},namespace:ln},{aliases:vo,element:"section",fields:{label:Fe("label")},namespace:ln,type:"section",typeField:"type"},{aliases:vo,element:"text",fields:{value:Je()},namespace:ln,type:"text",typeField:"type"},{aliases:vo,element:"fieldref",fields:{field:Fe("var")},namespace:ln,type:"fieldref",typeField:"type"},{aliases:vo,element:"reportedref",namespace:ln,type:"reportedref",typeField:"type"}];function bo(){return{importer(e,t){let n=we(e,On,"rtcp-fb");const i=Fe("type").importer,r=Fe("subtype").importer,s=Fe("value").importer,o=[];for(const e of n){const n=i(e,t),s=r(e,t);o.push(s?{type:n,parameter:s}:{type:n})}n=we(e,On,"rtcp-fb-trr-int");for(const e of n){const n=s(e,t);o.push(n?{type:"trr-int",parameter:n}:{type:"trr-int"})}return o},exporter(e,t,n){const i=Fe("type").exporter,r=Fe("subtype").exporter,s=Fe("value").exporter;for(const o of t){let t;"trr-int"===o.type?(t=ye(On,"rtcp-fb-trr-int",n.namespace,e),o.parameter&&s(t,o.parameter,n)):(t=ye(On,"rtcp-fb",n.namespace,e),i(t,o.type,n),o.parameter&&r(t,o.parameter,n)),e.appendChild(t)}}}}const _o="iq.jingle.info",wo=e=>[{element:"transport",fields:{gatheringComplete:st(null,"gathering-complete"),password:Fe("pwd"),usernameFragment:Fe("ufrag")},namespace:e,path:"iq.jingle.contents.transport",type:e,typeField:"transportType"},{aliases:[{impliedType:!0,path:"iq.jingle.contents.transport.remoteCandidate",selector:e}],element:"remote-candidate",fields:{component:Ue("component"),ip:Fe("ip"),port:Ue("port")},namespace:e,type:e,typeField:"transportType"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:e}],element:"candidate",fields:{component:Ue("component"),foundation:Fe("foundation"),generation:Ue("generation"),id:Fe("id"),ip:Fe("ip"),network:Ue("network"),port:Ue("port"),priority:Ue("priority"),protocol:Fe("protocol"),relatedAddress:Fe("rel-addr"),relatedPort:Fe("rel-port"),tcpType:Fe("tcptype"),type:Fe("type")},namespace:e,type:e,typeField:"transportType"}];const So="message.marker";const Co=[xs,Ms,qs,Ns,Fs,Ls,Us,Bs,zs,Gs,Ws,Hs,Vs,$s,Qs,Ks,Xs,to,io,ro,so,oo,ao,co,uo,ho,lo,po,fo,mo,go,{element:"body",fields:{acceptMediaTypes:Fe("accept"),ack:Ue("ack"),authId:Fe("authid"),characterSets:Fe("charsets"),condition:Fe("condition"),from:Hn("from"),key:Fe("key"),lang:Ke(),maxClientRequests:Ue("requests"),maxHoldOpen:Ue("hold"),maxInactivityTime:Ue("inactivity"),maxSessionPause:Ue("maxpause"),maxWaitTime:Ue("wait"),mediaType:Fe("content"),minPollingInterval:Ue("polling"),newKey:Fe("newkey"),pauseSession:Ue("pause"),report:Ue("report"),rid:Ue("rid"),route:Fe("string"),seeOtherURI:Xe(null,"uri"),sid:Fe("sid"),stream:Fe("stream"),time:Ue("time"),to:Hn("to"),type:Fe("type"),version:Fe("ver"),xmppRestart:Ge("xmpp","urn:xmpp:xbosh","restart"),xmppRestartLogic:Ge("xmpp","urn:xmpp:xbosh","restartlogic"),xmppVersion:ze("xmpp","urn:xmpp:xbosh","version")},namespace:cn,path:"bosh"},[Jn({headers:vt(un,"headers","header",!0)}),Yn({headers:vt(un,"headers","header",!0)}),{element:"header",fields:{name:Fe("name"),value:Je()},namespace:un,path:"header"}],[{element:"compression",fields:{methods:dt(null,"method")},namespace:"http://jabber.org/features/compress",path:"features.compression"},{element:"compress",fields:{method:Xe(null,"method")},namespace:hn,path:"compression",type:"start",typeField:"type"},{aliases:["error.compressionError"],element:"failure",fields:{condition:ht(null,["unsupported-method","setup-failed","processing-failed"])},namespace:hn,path:"compression",type:"failure",typeField:"type"},{element:"compressed",namespace:hn,path:"compression",type:"success",typeField:"type"}],yo,[Jn({rosterExchange:vt(dn,"x","rosterExchange",!0)}),Qn({rosterExchange:vt(dn,"x","rosterExchange",!0)}),{element:"item",fields:{action:Fe("action"),groups:dt(null,"group"),jid:Hn("jid"),name:Fe("name")},namespace:dn,path:"rosterExchange"}],Yn({vcardAvatar:{importer(e){const t=we(e,"vcard-temp:x:update","x");if(!t.length)return;const n=we(t[0],"vcard-temp:x:update","photo");return!n.length||n[0].getText()},exporter(e,t){const n=Se(e,"vcard-temp:x:update","x");if(""===t)Se(n,"vcard-temp:x:update","photo");else{if(!0===t)return;if(t){Se(n,"vcard-temp:x:update","photo").children.push(t)}}}}}),[Jn({captcha:vt("urn:xmpp:captcha","captcha","dataform")}),Qn({captcha:vt("urn:xmpp:captcha","captcha","dataform")})],[Xn({jingleError:ht("urn:xmpp:jingle:errors:1",Fr(kr))}),{element:"jingle",fields:{action:Fe("action"),initiator:Hn("initiator"),responder:Hn("responder"),sid:Fe("sid")},namespace:fn,path:"iq.jingle"},{aliases:[{multiple:!0,path:"iq.jingle.contents"}],element:"content",fields:{creator:Fe("creator"),disposition:Fe("disposition","session"),name:Fe("name"),senders:Fe("senders","both")},namespace:fn},{element:"reason",fields:{alternativeSession:Xe(null,"alternative-session"),condition:ht(null,Fr(xr)),text:Xe(null,"text")},namespace:fn,path:"iq.jingle.reason"}],[{aliases:["iq.jingle.contents.application"],childrenExportOrder:{codecs:4,encryption:5,headerExtensions:6,sourceGroups:8,sources:7,streams:9},element:"description",fields:{media:Fe("media"),rtcpFeedback:Object.assign(Object.assign({},bo()),{exportOrder:3}),rtcpMux:Object.assign(Object.assign({},st(null,"rtcp-mux")),{exportOrder:1}),rtcpReducedSize:Object.assign(Object.assign({},st(null,"rtcp-reduced-size")),{exportOrder:2}),ssrc:Fe("ssrc")},namespace:mn,optionalNamespaces:{rtcpf:On,rtph:jn},type:mn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.headerExtensions",selector:mn}],element:"rtp-hdrext",fields:{id:Ue("id"),senders:Fe("senders"),uri:Fe("uri")},namespace:jn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.codecs",selector:mn},"rtpcodec"],element:"payload-type",fields:{channels:Ue("channels"),clockRate:Ue("clockrate"),id:Fe("id"),maxptime:Ue("maxptime"),name:Fe("name"),parameters:wt(mn,"parameter","name","value"),ptime:Ue("ptime"),rtcpFeedback:bo()},namespace:mn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sources",selector:mn}],element:"source",fields:{parameters:wt(Ln,"parameter","name","value"),ssrc:Fe("ssrc")},namespace:Ln},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.sourceGroups",selector:mn}],element:"ssrc-group",fields:{semantics:Fe("semantics"),sources:pt(null,"source","ssrc")},namespace:Ln},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.streams",selector:mn}],element:"stream",fields:{id:Fe("id"),track:Fe("track")},namespace:"urn:xmpp:jingle:apps:rtp:msid:0"},{aliases:[{path:"iq.jingle.contents.application.encryption",selector:mn}],element:"encryption",fields:{required:Le("required")},namespace:mn},{aliases:[{multiple:!0,path:"iq.jingle.contents.application.encryption.sdes",selector:mn}],element:"crypto",fields:{cryptoSuite:Fe("crypto-suite"),keyParameters:Fe("key-params"),sessionParameters:Fe("session-params"),tag:Ue("tag")},namespace:mn},{aliases:[{path:"iq.jingle.contents.application.encryption.zrtp",selector:mn}],element:"zrtp-hash",fields:{value:Qe("hex"),version:Fe("version")},namespace:mn},{element:"mute",fields:{creator:Fe("creator"),name:Fe("name")},namespace:gn,path:_o,type:Rr},{element:"unmute",fields:{creator:Fe("creator"),name:Fe("name")},namespace:gn,path:_o,type:Ar},{element:"hold",namespace:gn,path:_o,type:Pr},{element:"unhold",namespace:gn,path:_o,type:Dr},{element:"active",namespace:gn,path:_o,type:Mr},{element:"ringing",namespace:gn,path:_o,type:qr}],[Jn({nick:Xe(vn,"nick")}),Yn({nick:Xe(vn,"nick")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"nick",fields:{nick:Je()},namespace:vn,type:vn}],[...wo(zn),...wo(yn)],[{element:"transport",fields:{gatheringComplete:st(null,"gathering-complete"),password:Fe("pwd"),usernameFragment:Fe("ufrag")},namespace:bn,path:"iq.jingle.contents.transport",type:bn,typeField:"transportType"},{aliases:[{impliedType:!0,multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:bn}],element:"candidate",fields:{component:Ue("component"),foundation:Fe("foundation"),generation:Ue("generation"),id:Fe("id"),ip:Fe("ip"),port:Ue("port"),type:Fe("type")},namespace:bn,type:bn,typeField:"transportType"}],[{element:"request",namespace:"urn:xmpp:receipts",path:"message.receipt",type:"request",typeField:"type"},{element:"received",fields:{id:Fe("id")},namespace:"urn:xmpp:receipts",path:"message.receipt",type:"received",typeField:"type"}],[{element:"invisible",fields:{probe:Le("probe")},namespace:"urn:xmpp:invisible:0",path:"iq.visibility",type:"invisible",typeField:"type"},{element:"visible",namespace:"urn:xmpp:invisible:0",path:"iq.visibility",type:"visible"}],[Xn({blocked:st("urn:xmpp:blocking:errors","blocked")}),{element:"blocklist",fields:{jids:pt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"list",typeField:"action"},{element:"block",fields:{jids:pt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"block",typeField:"action"},{element:"unblock",fields:{jids:pt(null,"item","jid")},namespace:"urn:xmpp:blocking",path:"iq.blockList",type:"unblock",typeField:"action"}],[Kn({streamManagement:st(_n,"sm")}),{element:"a",fields:{handled:Ue("h",0)},namespace:_n,path:"sm",type:"ack",typeField:"type"},{element:"r",namespace:_n,path:"sm",type:"request",typeField:"type"},{element:"enable",fields:{allowResumption:Le("resume")},namespace:_n,path:"sm",type:"enable",typeField:"type"},{element:"enabled",fields:{id:Fe("id"),resume:Le("resume")},namespace:_n,path:"sm",type:"enabled",typeField:"type"},{element:"resume",fields:{handled:Ue("h",0),previousSession:Fe("previd")},namespace:_n,path:"sm",type:"resume",typeField:"type"},{element:"resumed",fields:{handled:Ue("h",0),previousSession:Fe("previd")},namespace:_n,path:"sm",type:"resumed",typeField:"type"},{element:"failed",fields:{handled:Ue("h",0)},namespace:_n,path:"sm",type:"failed",typeField:"type"}],Qn({ping:st("urn:xmpp:ping","ping")}),{element:"time",fields:{tzo:rt(null,"tzo"),utc:et(null,"utc")},namespace:"urn:xmpp:time",path:"iq.time"},{aliases:["message.delay","presence.delay"],element:"delay",fields:{from:Hn("from"),reason:Je(),timestamp:Be("stamp")},namespace:wn},[{aliases:["iq.externalServiceCredentials"],defaultType:"1",element:"credentials",fields:{expires:$e(null,"service","expires"),host:We(null,"service","host"),name:We(null,"service","name"),password:We(null,"service","password"),port:Ve(null,"service","port"),restricuted:He(null,"service","restricted"),transport:We(null,"service","transport"),type:We(null,"service","type"),username:We(null,"service","username")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"},{aliases:["iq.externalServices"],defaultType:"1",element:"services",fields:{type:Fe("type")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"},{aliases:[{path:"iq.externalServices.services",multiple:!0}],defaultType:"1",element:"service",fields:{expires:Be("expires"),host:Fe("host"),name:Fe("name"),password:Fe("password"),port:Ue("port"),restricuted:Le("restricted"),transport:Fe("transport"),type:Fe("type"),username:Fe("username")},namespace:"urn:xmpp:extdisco:1",type:"1",typeField:"version"}],[{element:"media",fields:{height:Ue("height"),width:Ue("width")},namespace:"urn:xmpp:media-element",path:"dataform.fields.media"},{aliases:[{multiple:!0,path:"dataform.fields.media.sources"}],element:"uri",fields:{mediaType:Fe("type"),uri:Je()},namespace:"urn:xmpp:media-element"}],Jn({requestingAttention:st("urn:xmpp:attention:0","attention")}),{aliases:["iq.bits",{path:"message.bits",multiple:!0},{path:"presence.bits",multiple:!0},{path:"iq.jingle.bits",multiple:!0}],element:"data",fields:{cid:Fe("cid"),data:Qe("base64"),maxAge:Ue("max-age"),mediaType:Fe("type")},namespace:Sn},[$n(Rn,"hash",[{path:"file.hashes",multiple:!0}]),$n(Rn,"hash-used",[{path:"file.hashesUsed",multiple:!0}]),$n("urn:xmpp:thumbs:1","thumbnail",[{path:"file.thumbnails",multiple:!0}]),{aliases:["file",{path:"iq.jingle.contents.application.file",selector:Cn},{path:"iq.jingle.info.file",selector:`{${Cn}}checksum`}],element:"file",fields:{date:et(null,"date"),description:Xe(null,"desc"),mediaType:Xe(null,"media-type"),name:Xe(null,"name"),size:tt(null,"size")},namespace:Cn},{element:"range",fields:{length:Ue("length"),offset:Ue("offset",0)},namespace:Cn,path:"file.range"},{element:"description",namespace:Cn,path:"iq.jingle.contents.application",type:Cn,typeField:"applicationType"},{element:"received",fields:{creator:Fe("creator"),name:Fe("name")},namespace:Cn,path:"iq.jingle.info",type:`{${Cn}}received`,typeField:"infoType"},{element:"checksum",fields:{creator:Fe("creator"),name:Fe("name")},namespace:Cn,path:"iq.jingle.info",type:`{${Cn}}checksum`,typeField:"infoType"}],{element:"description",namespace:En,path:"iq.jingle.contents.application",type:En,typeField:"applicationType"},[{element:"transport",fields:{activated:We(null,"activated","cid"),address:Fe("dstaddr"),candidateError:st(null,"candidate-error"),candidateUsed:We(null,"candidate-used","cid"),mode:Fe("mode","tcp"),proxyError:st(null,"proxy-error"),sid:Fe("sid")},namespace:kn,path:"iq.jingle.contents.transport",type:kn,typeField:"transportType"},{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.candidates",selector:kn}],element:"candidate",fields:{cid:Fe("cid"),host:Fe("host"),jid:Hn("jid"),port:Ue("port"),priority:Ue("priority"),type:Fe("type"),uri:Fe("uri")},namespace:kn}],{element:"transport",fields:{ack:{importer:(e,t)=>"message"!==Fe("stanza","iq").importer(e,t),exporter(e,t,n){Fe("stanza").exporter(e,t?"iq":"message",n)}},blockSize:Ue("block-size"),sid:Fe("sid")},namespace:xn,path:"iq.jingle.contents.transport",type:xn,typeField:"transportType"},[$n(Sn,"data",[{path:"iq.jingle.bits",multiple:!0}]),{element:"thumbnail",fields:{height:Ue("height"),mediaType:Fe("media-type"),uri:Fe("uri"),width:Ue("width")},namespace:"urn:xmpp:thumbs:1",path:"thumbnail"}],[$n(Tn,"forwarded",["message.carbon.forward"]),{element:"enable",namespace:In,path:"iq.carbons",type:"enable",typeField:"action"},{element:"disable",namespace:In,path:"iq.carbons",type:"disable",typeField:"action"},{element:"sent",namespace:In,path:"message.carbon",type:"sent",typeField:"type"},{element:"received",namespace:In,path:"message.carbon",type:"received",typeField:"type"}],[...Object.values(pr).map(e=>$n(e,"message",["forward.message"])),...Object.values(pr).map(e=>$n(e,"presence",["forward.presence"])),...Object.values(pr).map(e=>$n(e,"iq",["forward.iq"])),$n(wn,"delay",["forward.delay"]),{aliases:["message.forward"],element:"forwarded",namespace:Tn,path:"forward"}],[{defaultType:"2",element:"hash",fields:{algorithm:Fe("algo"),value:Qe("base64"),version:yt("2")},namespace:Rn,path:"hash",typeField:"version"},{element:"hash-used",fields:{algorithm:Fe("algo"),version:yt("2")},namespace:Rn,path:"hashUsed"},{element:"hash",fields:{algorithm:Fe("algo"),value:Qe("hex"),version:yt("1")},namespace:"urn:xmpp:hashes:1",path:"hash",typeField:"version"}],[{element:"rtt",fields:{event:Fe("event","edit"),id:Fe("id"),seq:Ue("seq")},namespace:Pn,path:"message.rtt"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"t",fields:{position:Ue("p"),text:Je()},namespace:Pn,type:"insert",typeField:"type"},{aliases:[{path:"message.rtt.actions",multiple:!0}],element:"e",fields:{length:Ue("n",1),position:Ue("p")},namespace:Pn,type:"erase",typeField:"type"},{aliases:[{multiple:!0,path:"message.rtt.actions"}],element:"w",fields:{duration:Ue("n",0)},namespace:Pn,type:"wait",typeField:"type"}],Jn({replace:We("urn:xmpp:message-correct:0","replace","id")}),[$n(Pt,"x",["iq.archive.form"]),$n(Tn,"forwarded",["message.archive.item"]),$n(Wt,"set",["iq.archive.paging"]),{defaultType:"query",element:"query",fields:{queryId:Fe("queryid")},namespace:Dn,path:"iq.archive",type:"query",typeField:"type"},{element:"fin",fields:{complete:Le("complete"),stable:Le("stable")},namespace:Dn,path:"iq.archive",type:"result"},{element:"prefs",fields:{default:Fe("default")},namespace:Dn,path:"iq.archive",type:"preferences"},{element:"result",fields:{id:Fe("id"),queryId:Fe("queryid")},namespace:Dn,path:"message.archive"}],[Yn({hats:vt(Mn,"hats","hat",!0)}),{element:"hat",fields:{id:Fe("name"),name:Fe("displayName")},namespace:Mn,path:"hat"}],Yn({idleSince:et("urn:xmpp:idle:1","since")}),{aliases:[{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:yn},{multiple:!0,path:"iq.jingle.contents.transport.fingerprints",selector:zn},{multiple:!0,path:"iq.jingle.contents.application.encryption.dtls",selector:mn}],element:"fingerprint",fields:{algorithm:Fe("hash"),setup:Fe("setup"),value:Je()},namespace:"urn:xmpp:jingle:apps:dtls:0"},[{element:"markable",namespace:qn,path:So,type:"markable",typeField:"type"},{element:"received",fields:{id:Fe("id")},namespace:qn,path:So,type:"received"},{element:"displayed",fields:{id:Fe("id")},namespace:qn,path:So,type:"displayed"},{element:"acknowledged",fields:{id:Fe("id")},namespace:qn,path:So,type:"acknowledged"}],Jn({processingHints:{importer(e){const t={};let n=!1;for(const i of e.children)if("string"!=typeof i&&i.getNamespace()===Nn)switch(i.getName()){case"no-copy":t.noCopy=!0,n=!0;break;case"no-permanent-store":t.noPermanentStore=!0,n=!0;break;case"no-store":t.noStore=!0,n=!0;break;case"store":t.store=!0,n=!0}return n?t:void 0},exporter(e,t,n){t.noCopy&&e.appendChild(ye(Nn,"no-copy",n.namespace,e)),t.noPermanentStore&&e.appendChild(ye(Nn,"no-permanent-store",n.namespace,e)),t.noStore&&e.appendChild(ye(Nn,"no-store",n.namespace,e)),t.store&&e.appendChild(ye(Nn,"store",n.namespace,e))}}}),[Jn({json:it(Fn,"json")}),{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"json",fields:{json:Ye()},namespace:Fn,type:Fn}],[{aliases:[{path:"iq.jingle.groups",multiple:!0}],element:"group",fields:{contents:pt(null,"content","name"),semantics:Fe("semantics")},namespace:"urn:xmpp:jingle:apps:grouping:0"}],{aliases:[{path:"iq.jingle.contents.transport.sctp",selector:yn},{path:"iq.jingle.contents.transport.sctp",selector:zn}],element:"sctpmap",fields:{port:Ue("number"),protocol:Fe("protocol"),streams:Fe("streams")},namespace:"urn:xmpp:jingle:transports:dtls-sctp:1"},[{element:"active",namespace:"urn:xmpp:csi:0",path:"csi",type:"active",typeField:"state"},{element:"inactive",namespace:"urn:xmpp:csi:0",path:"csi",type:"inactive",typeField:"state"}],[$n(Pt,"x",["iq.push.form","pushNotification.form"]),{element:"enable",fields:{jid:Hn("jid"),node:Fe("node")},namespace:Un,path:"iq.push",type:"enable",typeField:"action"},{element:"disable",fields:{jid:Hn("jid"),node:Fe("node")},namespace:Un,path:"iq.push",type:"disable",typeField:"action"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"notification",namespace:Un,path:"pushNotification",type:Un,typeField:"itemType"}],[Jn({originId:We("urn:xmpp:sid:0","origin-id","id")}),{aliases:[{path:"message.stanzaIds",multiple:!0}],element:"stanza-id",fields:{by:Hn("by"),id:Fe("id")},namespace:"urn:xmpp:sid:0"}],[Xn({httpUploadError:ht(Bn,["file-too-large","retry"]),httpUploadMaxFileSize:ct([{namespace:Bn,element:"file-too-large"},{namespace:Bn,element:"max-file-size"}]),httpUploadRetry:$e(Bn,"retry","stamp")}),{element:"request",fields:{mediaType:Fe("content-type"),name:Fe("filename"),size:Ue("size")},namespace:Bn,path:"iq.httpUpload",type:"request",typeField:"type"},{element:"slot",fields:{download:We(null,"get","url")},namespace:Bn,path:"iq.httpUpload",type:"slot"},{aliases:[{path:"iq.httpUpload.upload",selector:"slot"}],element:"put",fields:{url:Fe("url")},namespace:Bn},{aliases:[{path:"iq.httpUpload.upload.headers",multiple:!0}],element:"header",fields:{name:Fe("name"),value:Je()},namespace:Bn}],{element:"encryption",fields:{id:Fe("namespace"),name:Fe("name")},namespace:"urn:xmpp:eme:0",path:"message.encryptionMethod"},[{aliases:["message.omemo"],element:"encrypted",fields:{payload:Ze(null,"payload","base64")},namespace:Gn,path:"omemo"},{element:"header",fields:{iv:Ze(null,"iv","base64"),sid:Ue("sid")},namespace:Gn,path:"omemo.header"},{aliases:[{path:"omemo.header.keys",multiple:!0}],element:"key",fields:{preKey:Le("prekey"),rid:Ue("rid"),value:Qe("base64")},namespace:Gn},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"list",fields:{devices:ft(null,"device","id")},namespace:Gn,type:"eu.siacs.conversations.axolotl.devicelist",typeField:"itemType"},{element:"preKeyPublic",fields:{id:Ue("preKeyId"),value:Qe("base64")},namespace:Gn,path:"omemoPreKey"},{element:"signedPreKeyPublic",fields:{id:Ue("signedPreKeyId"),value:Qe("base64")},namespace:Gn,path:"omemoDevice.signedPreKeyPublic"},{aliases:[{path:"pubsubcontent",contextField:"itemType"},{path:"pubsubitem.content",contextField:"itemType"},{path:"pubsubeventitem.content",contextField:"itemType"},{path:"iq.pubsub.publish.items",contextField:"itemType"}],element:"bundle",fields:{identityKey:Ze(null,"identityKey","base64"),preKeys:vt(null,"prekeys","omemoPreKey",!0),signedPreKeySignature:Ze(null,"signedPreKeySignature","base64")},namespace:Gn,path:"omemoDevice",type:"eu.siacs.conversations.axolotl.bundles",typeField:"itemType"}],[{element:"XRD",fields:{subject:Xe(null,"Subject")},namespace:Wn,path:"xrd"},{aliases:[{path:"xrd.links",multiple:!0}],element:"Link",fields:{href:Fe("href"),rel:Fe("rel"),type:Fe("type")},namespace:Wn}]];const Eo=Math.pow(2,32),ko=(e,t)=>(e%t+t)%t;class xo{constructor(e){this.allowResume=!0,this.lastAck=0,this.handled=0,this.windowSize=1,this.unacked=[],this.pendingAck=!1,this.inboundStarted=!1,this.outboundStarted=!1,this.client=e,this.id=void 0,this.allowResume=!0,this.started=!1,this.cacheHandler=()=>null,this._reset()}get started(){return this.outboundStarted&&this.inboundStarted}set started(e){e||(this.outboundStarted=!1,this.inboundStarted=!1)}load(e){this.id=e.id,this.allowResume=!0,this.handled=e.handled,this.lastAck=e.lastAck,this.unacked=e.unacked,e.jid&&(this.client.jid=e.jid,this.client.emit("session:bound",e.jid))}cache(e){this.cacheHandler=e}enable(){this.client.send("sm",{allowResumption:this.allowResume,type:"enable"}),this.handled=0,this.pendingAck=!1,this.outboundStarted=!0}resume(){this.client.send("sm",{handled:this.handled,previousSession:this.id,type:"resume"}),this.pendingAck=!1,this.outboundStarted=!0}enabled(e){this.id=e.id,this.handled=0,this.inboundStarted=!0,this._cache()}resumed(e){this.id=e.previousSession,void 0!==e.handled&&this.process(e,!0),this.inboundStarted=!0,this._cache()}failed(e){void 0!==e.handled&&this.process(e);for(const[e,t]of this.unacked)this.client.emit("stanza:failed",{kind:e,stanza:t});this._reset(),this._cache()}ack(){this.client.send("sm",{handled:this.handled,type:"ack"})}request(){this.pendingAck=!0,this.client.send("sm",{type:"request"})}process(e,t=!1){if(void 0===e.handled)return;const n=ko(e.handled-this.lastAck,Eo);this.pendingAck=!1;for(let e=0;e<n&&this.unacked.length>0;e++){const[e,t]=this.unacked.shift();this.client.emit("stanza:acked",{kind:e,stanza:t})}if(this.lastAck=e.handled,t){const e=this.unacked;this.unacked=[];for(const[t,n]of e)this.client.send(t,n)}this._cache(),this.needAck()&&this.request()}track(e,t){"message"!==e&&"presence"!==e&&"iq"!==e||this.outboundStarted&&(this.unacked.push([e,t]),this._cache(),this.needAck()&&this.request())}handle(){this.inboundStarted&&(this.handled=ko(this.handled+1,Eo),this._cache())}needAck(){return!this.pendingAck&&this.unacked.length>=this.windowSize}_cache(){this.cacheHandler({handled:this.handled,id:this.id,jid:this.client.jid,lastAck:this.lastAck,unacked:this.unacked})}_reset(){this.inboundStarted=!1,this.outboundStarted=!1,this.lastAck=0,this.handled=0,this.unacked=[],this.pendingAck=!1}}class Io{constructor(e,t,n){this.maxRequests=2,this.maxHoldOpen=1,this.minPollingInterval=5,this.client=e,this.sm=t,this.stanzas=n,this.sendBuffer=[],this.requests=new Set,this.authenticated=!1,this.lastResponseTime=Date.now(),this.pollingInterval=setInterval(()=>{this.authenticated&&0===this.requests.size&&0===this.sendBuffer.length&&Date.now()-this.lastResponseTime>=1e3*this.minPollingInterval&&this.longPoll()},1e3)}connect(e){if(this.config=Object.assign({maxRetries:5,rid:Math.ceil(9999999999*Math.random()),wait:30},e),this.hasStream=!1,this.sm.started=!1,this.url=this.config.url,this.sid=this.config.sid,this.rid=this.config.rid,this.requests.clear(),this.sid)return this.hasStream=!0,this.stream={},this.client.emit("connected"),this.client.emit("session:prebind",this.config.jid),void this.client.emit("session:started");this.rid++,this.request({lang:this.config.lang,maxHoldOpen:1,maxWaitTime:this.config.wait,to:this.config.server,version:"1.6",xmppVersion:"1.0"})}disconnect(){clearInterval(this.pollingInterval),this.hasStream?(this.rid++,this.request({type:"terminate"})):(this.stream=void 0,this.sid=void 0,this.rid=void 0,this.client.emit("disconnected",void 0))}restart(){this.hasStream=!1,this.rid++,this.request({lang:this.config.lang,to:this.config.server,xmppRestart:!0})}send(e,t){if(t){const n=this.stanzas.export(e,t);n&&this.sendBuffer.push(n.toString())}else this.sendBuffer.push(e);this.longPoll()}longPoll(){const e=!this.maxRequests||this.requests.size<this.maxRequests,t=!this.maxRequests||this.sendBuffer.length>0&&this.requests.size<this.maxRequests;if(!this.sid||!e&&!t)return;const n=this.sendBuffer;this.sendBuffer=[],this.rid++,this.request({},n)}request(t,n=[]){return Object(r.a)(this,void 0,void 0,(function*(){const i=this.rid;this.requests.add(i),t.rid=this.rid,t.sid=this.sid;const s=this.stanzas.export("bosh",t),o=[s.openTag(),...n,s.closeTag()].join("");this.client.emit("raw","outgoing",o);try{const n=yield function(e,t,n,i=5){return Object(r.a)(this,void 0,void 0,(function*(){let r=0;for(;r<=i;){try{const i=yield er(Mi(e,t),1e3*n,()=>new Error("Request timed out"));if(!i.ok)throw new Error("HTTP Status Error: "+i.status);return i.text()}catch(e){if(r+=1,r>i)throw e}yield tr(1e3*Math.pow(r,2))}throw new Error("Request failed")}))}(this.url,{body:o,headers:{"Content-Type":"text/xml"},method:"POST"},1.1*this.config.wait,this.config.maxRetries);if(this.requests.delete(i),this.lastResponseTime=Date.now(),n){const t=e.from(n,"utf8").toString().trim();if(""===t)return;this.client.emit("raw","incoming",t);const i=new Zn({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,rootKey:"bosh",wrappedStream:!0});i.on("error",e=>{const t={condition:mr.InvalidXML};return this.client.emit("stream:error",t,e),this.send("error",t),this.disconnect()}),i.on("data",e=>{if("stream-start"===e.event)return"terminate"===e.stanza.type?(this.hasStream=!1,this.rid=void 0,this.sid=void 0,this.client.emit("bosh:terminate",e.stanza),this.client.emit("stream:end"),void this.client.emit("disconnected",void 0)):void(this.hasStream||(this.hasStream=!0,this.stream=e.stanza,this.sid=e.stanza.sid||this.sid,this.maxHoldOpen=e.stanza.maxHoldOpen||this.maxHoldOpen,this.maxRequests=e.stanza.maxRequests||this.maxRequests,this.minPollingInterval=e.stanza.minPollingInterval||this.minPollingInterval,this.client.emit("stream:start",e.stanza)));e.event||this.client.emit("stream:data",e.stanza,e.kind)}),i.write(t)}"terminate"===t.type&&(this.closing=!0),!this.hasStream||this.closing||!this.authenticated||this.requests.size&&!this.sendBuffer.length||(clearTimeout(this.idleTimeout),this.idleTimeout=setTimeout(()=>{this.longPoll()},100))}catch(e){this.hasStream=!1,this.client.emit("stream:error",{condition:"connection-timeout"},e),this.disconnect()}}))}}class Oo{constructor(t,n,i){this.sm=n,this.stanzas=i,this.closing=!1,this.client=t,this.sendQueue=Object(h.a)((t,n)=>{this.conn&&(t=e.from(t,"utf8").toString(),this.client.emit("raw","outgoing",t),1===this.conn.readyState&&this.conn.send(t)),n()},1)}connect(t){this.config=t,this.hasStream=!1,this.closing=!1,this.parser=new Zn({acceptLanguages:this.config.acceptLanguages,allowComments:!1,lang:this.config.lang,registry:this.stanzas,wrappedStream:!1}),this.parser.on("data",e=>{const t=e.kind,n=e.stanza;if("stream"===t){if("open"===n.action)return this.hasStream=!0,this.stream=n,this.client.emit("stream:start",n);if("close"===n.action)return this.client.emit("stream:end"),this.disconnect()}this.client.emit("stream:data",n,t)}),this.parser.on("error",e=>{const t={condition:mr.InvalidXML};return this.client.emit("stream:error",t,e),this.send(this.stanzas.export("error",t).toString()),this.disconnect()}),this.conn=new qi(t.url,"xmpp"),this.conn.onerror=e=>{e.preventDefault&&e.preventDefault(),console.error(e)},this.conn.onclose=e=>{this.client.emit("disconnected",e)},this.conn.onopen=()=>{this.sm.started=!1,this.client.emit("connected"),this.send(this.startHeader())},this.conn.onmessage=t=>{const n=e.from(t.data,"utf8").toString();this.client.emit("raw","incoming",n),this.parser&&this.parser.write(n)}}disconnect(){this.conn&&!this.closing&&this.hasStream?(this.closing=!0,this.send(this.closeHeader())):(this.hasStream=!1,this.stream=void 0,this.conn&&1===this.conn.readyState&&this.conn.close(),this.conn=void 0)}send(e,t){if(t){const n=this.stanzas.export(e,t);n&&this.sendQueue.push(n.toString(),0)}else this.sendQueue.push(e,0)}restart(){this.hasStream=!1,this.send(this.startHeader())}startHeader(){return this.stanzas.export("stream",{action:"open",lang:this.config.lang,to:this.config.server,version:"1.0"}).toString()}closeHeader(){return this.stanzas.export("stream",{action:"close"}).toString()}}class jo extends s.EventEmitter{constructor(e={}){super(),this.setMaxListeners(100),this.off=this.removeListener,this._initConfig(e),this.jid="",this.sasl=new Fi,this.sasl.register("EXTERNAL",Wi,1e3),this.sasl.register("SCRAM-SHA-256-PLUS",Ji,350),this.sasl.register("SCRAM-SHA-256",Ji,300),this.sasl.register("SCRAM-SHA-1-PLUS",Ji,250),this.sasl.register("SCRAM-SHA-1",Ji,200),this.sasl.register("DIGEST-MD5",$i,100),this.sasl.register("X-OAUTH2",Vi,100),this.sasl.register("PLAIN",Hi,1),this.sasl.register("ANONYMOUS",Gi,0),this.stanzas=new Ct,this.stanzas.define(Co),this.use(Es),this.sm=new xo(this),this.transports={bosh:Io,websocket:Oo},this.on("stream:data",(e,t)=>{if(this.emit(t,e),"message"===t||"presence"===t||"iq"===t)this.sm.handle(),this.emit("stanza",e);else if("sm"===t)return"ack"===e.type&&(this.emit("stream:management:ack",e),this.sm.process(e)),void("request"===e.type&&this.sm.ack());e.id&&this.emit(t+":id:"+e.id,e)}),this.on("disconnected",()=>{this.transport&&delete this.transport}),this.on("auth:success",()=>{this.transport&&(this.transport.authenticated=!0)}),this.on("iq",e=>{const t=e.type,n=e.payloadType,i="iq:"+t+":"+n;if("get"===t||"set"===t){if("invalid-payload-count"===n)return this.sendIQError(e,{error:{condition:"bad-request",type:"modify"}});if("unknown-payload"===n||0===this.listenerCount(i))return this.sendIQError(e,{error:{condition:"service-unavailable",type:"cancel"}});this.emit(i,e)}}),this.on("message",e=>{const t=e.alternateLanguageBodies&&e.alternateLanguageBodies.length||e.links&&e.links.length,n=e.marker&&"markable"!==e.marker.type;t&&!n&&("chat"===e.type||"normal"===e.type?this.emit("chat",e):"groupchat"===e.type&&this.emit("groupchat",e)),"error"===e.type&&this.emit("message:error",e)}),this.on("presence",e=>{let t=e.type||"available";"error"===t&&(t="presence:error"),this.emit(t,e)})}get stream(){return this.transport?this.transport.stream:void 0}emit(e,...t){const n=super.emit(e,...t);return"raw"===e?(super.emit(`raw:${t[0]}`,t[1]),super.emit("raw:*",`raw:${t[0]}`,t[1]),super.emit("*",`raw:${t[0]}`,t[1])):super.emit("*",e,...t),n}use(e){"function"==typeof e&&e(this,this.stanzas,this.config)}nextId(){return ir()}getCredentials(){return Object(r.a)(this,void 0,void 0,(function*(){return this._getConfiguredCredentials()}))}connect(){return Object(r.a)(this,void 0,void 0,(function*(){const e=["websocket","bosh"];let t;for(const n of e){let e=this.config.transports[n];if(e){if("string"==typeof e)e={url:e};else if(!0===e){if(!t)try{t=yield this.discoverBindings(this.config.server)}catch(e){console.error(e);continue}if(t[n]=(t[n]||[]).filter(e=>e.startsWith("wss:")||e.startsWith("https:")),!t[n]||!t[n].length)continue;e={url:t[n][0]}}return this.transport=new this.transports[n](this,this.sm,this.stanzas),void this.transport.connect(Object.assign({acceptLanguages:this.config.acceptLanguages||["en"],jid:this.config.jid,lang:this.config.lang||"en",server:this.config.server,url:e.url},e))}}return console.error("No endpoints found for the requested transports."),this.disconnect()}))}disconnect(){this.sessionStarted&&!this.sm.started&&this.emit("session:end"),this.sessionStarted=!1,this.transport?this.transport.disconnect():this.emit("disconnected")}send(e,t){this.sm.track(e,t),this.transport&&this.transport.send(e,t)}sendMessage(e){const t=e.id||this.nextId(),n=Object.assign({id:t,originId:t},e);return this.emit("message:sent",n,!1),this.send("message",n),n.id}sendPresence(e={}){const t=Object.assign({id:this.nextId()},e);return this.send("presence",t),t.id}sendIQ(e){const t=Object.assign({id:this.nextId()},e),n=N(this.jid,e.to),i="iq:id:"+t.id,r=new Promise((e,t)=>{const r=s=>{n.has(s.from)&&("result"!==s.type&&"error"!==s.type||(this.off(i,r),"result"===s.type?e(s):t(s)))};this.on(i,r)});return this.send("iq",t),er(r,1e3*(this.config.timeout||15),()=>({error:{condition:"timeout"},id:t.id,type:"error"}))}sendIQResult(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"result"}))}sendIQError(e,t){this.send("iq",Object.assign(Object.assign({},t),{id:e.id,to:e.from,type:"error"}))}sendStreamError(e){this.emit("stream:error",e),this.send("error",e),this.disconnect()}_getConfiguredCredentials(){const e=this.config.credentials||{},t=q(this.config.jid||""),n=e.username||t.local,i=e.host||t.domain;return Object.assign({host:i,password:this.config.password,realm:i,serviceName:i,serviceType:"xmpp",username:n},e)}_initConfig(e={}){const t=this.config||{};this.config=Object.assign(Object.assign({jid:"",transports:{bosh:!0,websocket:!0},useStreamManagement:!0},t),e),this.config.server||(this.config.server=U(this.config.jid)),this.config.password&&(this.config.credentials=this.config.credentials||{},this.config.credentials.password=this.config.password,delete this.config.password)}}function To(e){const t=new jo(e);return t.use(ks),t}}).call(this,n(12).Buffer,n(7))},function(e,t,n){var i,r;
/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */!function(s){"use strict";var o,a={};a.VERSION="1.6.0";var c={},u=function(e,t){return function(){return t.apply(e,arguments)}},h=function(){var e,t,n=arguments,i=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in i||!n[t].hasOwnProperty(e)||(i[e]=n[t][e]);return i},l=function(e,t){return{value:e,name:t}};a.TRACE=l(1,"TRACE"),a.DEBUG=l(2,"DEBUG"),a.INFO=l(3,"INFO"),a.TIME=l(4,"TIME"),a.WARN=l(5,"WARN"),a.ERROR=l(8,"ERROR"),a.OFF=l(99,"OFF");var d=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};d.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},trace:function(){this.invoke(a.TRACE,arguments)},debug:function(){this.invoke(a.DEBUG,arguments)},info:function(){this.invoke(a.INFO,arguments)},warn:function(){this.invoke(a.WARN,arguments)},error:function(){this.invoke(a.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"end"])},invoke:function(e,t){o&&this.enabledFor(e)&&o(t,h({level:e},this.context))}};var p,f=new d({filterLevel:a.OFF});(p=a).enabledFor=u(f,f.enabledFor),p.trace=u(f,f.trace),p.debug=u(f,f.debug),p.time=u(f,f.time),p.timeEnd=u(f,f.timeEnd),p.info=u(f,f.info),p.warn=u(f,f.warn),p.error=u(f,f.error),p.log=p.info,a.setHandler=function(e){o=e},a.setLevel=function(e){for(var t in f.setLevel(e),c)c.hasOwnProperty(t)&&c[t].setLevel(e)},a.getLevel=function(){return f.getLevel()},a.get=function(e){return c[e]||(c[e]=new d(h({name:e},f.context)))},a.createDefaultHandler=function(e){(e=e||{}).formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(i,r){i=Array.prototype.slice.call(i);var s,o=console.log;r.level===a.TIME?(s=(r.name?"["+r.name+"] ":"")+i[0],"start"===i[1]?console.time?console.time(s):t[s]=(new Date).getTime():console.timeEnd?console.timeEnd(s):n(o,[s+": "+((new Date).getTime()-t[s])+"ms"])):(r.level===a.WARN&&console.warn?o=console.warn:r.level===a.ERROR&&console.error?o=console.error:r.level===a.INFO&&console.info?o=console.info:r.level===a.DEBUG&&console.debug?o=console.debug:r.level===a.TRACE&&console.trace&&(o=console.trace),e.formatter(i,r),n(o,i))}},a.useDefaults=function(e){a.setLevel(e&&e.defaultLevel||a.DEBUG),a.setHandler(a.createDefaultHandler(e))},void 0===(r="function"==typeof(i=a)?i.call(t,n,t,e):i)||(e.exports=r)}()},function(e,t,n){for(var i=self.crypto||self.msCrypto,r="-_",s=36;s--;)r+=s.toString(36);for(s=36;s---10;)r+=s.toString(36).toUpperCase();e.exports=function(e){var t="",n=i.getRandomValues(new Uint8Array(e||21));for(s=e||21;s--;)t+=r[63&n[s]];return t}},function(e,t,n){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);return{usernameFragment:(n=n.concat(i.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:n.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var s=n[r],o=i.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=i.parseRtpMap(o),c=i.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?i.parseFmtp(c[0]):{},a.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(i.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))})),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)}));var r=0;return t.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)})),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=i.writeExtmap(e)})),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,u=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t}),n.push(i),s&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},n.push(i))}})),0===n.length&&c&&n.push({ssrc:c});var h=i.matchPrefix(e,"b=");return h.length&&(h=0===h[0].indexOf("b=TIAS:")?parseInt(h[0].substr(7),10):0===h[0].indexOf("b=AS:")?1e3*parseInt(h[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=h}))),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var s=i.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},i.parseSctpDescription=function(e){var t,n=i.parseMLine(e),r=i.matchPrefix(e,"a=max-message-size:");r.length>0&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536);var s=i.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(i.matchPrefix(e,"a=sctpmap:").length>0){var o=i.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},i.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var s=i.writeRtpDescription(e.kind,t);if(s+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),s},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=i},function(e,t,n){"use strict";var i=n(28),r="object"==typeof self&&self&&self.Object===Object&&self,s=i.a||r||Function("return this")();t.a=s},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},,function(e,t,n){var i;i=function(){var e=!0;function t(t){function n(e){var n=t.match(e);return n&&n.length>1&&n[1]||""}function i(e){var n=t.match(e);return n&&n.length>1&&n[2]||""}var r,o=n(/(ipod|iphone|ipad)/i).toLowerCase(),a=!/like android/i.test(t)&&/android/i.test(t),c=/nexus\s*[0-6]\s*/i.test(t),u=!c&&/nexus\s*[0-9]+/i.test(t),h=/CrOS/.test(t),l=/silk/i.test(t),d=/sailfish/i.test(t),p=/tizen/i.test(t),f=/(web|hpw)(o|0)s/i.test(t),m=/windows phone/i.test(t),g=(/SamsungBrowser/i.test(t),!m&&/windows/i.test(t)),v=!o&&!l&&/macintosh/i.test(t),y=!a&&!d&&!p&&!f&&/linux/i.test(t),b=i(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),_=n(/version\/(\d+(\.\d+)?)/i),w=/tablet/i.test(t)&&!/tablet pc/i.test(t),S=!w&&/[^-]mobi/i.test(t),C=/xbox/i.test(t);/opera/i.test(t)?r={name:"Opera",opera:e,version:_||n(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(t)?r={name:"Opera",opera:e,version:n(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||_}:/SamsungBrowser/i.test(t)?r={name:"Samsung Internet for Android",samsungBrowser:e,version:_||n(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/Whale/i.test(t)?r={name:"NAVER Whale browser",whale:e,version:n(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i)}:/MZBrowser/i.test(t)?r={name:"MZ Browser",mzbrowser:e,version:n(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/coast/i.test(t)?r={name:"Opera Coast",coast:e,version:_||n(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/focus/i.test(t)?r={name:"Focus",focus:e,version:n(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i)}:/yabrowser/i.test(t)?r={name:"Yandex Browser",yandexbrowser:e,version:_||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?r={name:"UC Browser",ucbrowser:e,version:n(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?r={name:"Maxthon",maxthon:e,version:n(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?r={name:"Epiphany",epiphany:e,version:n(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?r={name:"Puffin",puffin:e,version:n(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?r={name:"Sleipnir",sleipnir:e,version:n(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?r={name:"K-Meleon",kMeleon:e,version:n(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(r={name:"Windows Phone",osname:"Windows Phone",windowsphone:e},b?(r.msedge=e,r.version=b):(r.msie=e,r.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?r={name:"Internet Explorer",msie:e,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:h?r={name:"Chrome",osname:"Chrome OS",chromeos:e,chromeBook:e,chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(t)?r={name:"Microsoft Edge",msedge:e,version:b}:/vivaldi/i.test(t)?r={name:"Vivaldi",vivaldi:e,version:n(/vivaldi\/(\d+(\.\d+)?)/i)||_}:d?r={name:"Sailfish",osname:"Sailfish OS",sailfish:e,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?r={name:"SeaMonkey",seamonkey:e,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(r={name:"Firefox",firefox:e,version:n(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(r.firefoxos=e,r.osname="Firefox OS")):l?r={name:"Amazon Silk",silk:e,version:n(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?r={name:"PhantomJS",phantom:e,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?r={name:"SlimerJS",slimer:e,version:n(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?r={name:"BlackBerry",osname:"BlackBerry OS",blackberry:e,version:_||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(r={name:"WebOS",osname:"WebOS",webos:e,version:_||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(r.touchpad=e)):/bada/i.test(t)?r={name:"Bada",osname:"Bada",bada:e,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:p?r={name:"Tizen",osname:"Tizen",tizen:e,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||_}:/qupzilla/i.test(t)?r={name:"QupZilla",qupzilla:e,version:n(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||_}:/chromium/i.test(t)?r={name:"Chromium",chromium:e,version:n(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||_}:/chrome|crios|crmo/i.test(t)?r={name:"Chrome",chrome:e,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:a?r={name:"Android",version:_}:/safari|applewebkit/i.test(t)?(r={name:"Safari",safari:e},_&&(r.version=_)):o?(r={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},_&&(r.version=_)):r=/googlebot/i.test(t)?{name:"Googlebot",googlebot:e,version:n(/googlebot\/(\d+(\.\d+))/i)||_}:{name:n(/^(.*)\/(.*) /),version:i(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(r.name=r.name||"Blink",r.blink=e):(r.name=r.name||"Webkit",r.webkit=e),!r.version&&_&&(r.version=_)):!r.opera&&/gecko\//i.test(t)&&(r.name=r.name||"Gecko",r.gecko=e,r.version=r.version||n(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||!a&&!r.silk?!r.windowsphone&&o?(r[o]=e,r.ios=e,r.osname="iOS"):v?(r.mac=e,r.osname="macOS"):C?(r.xbox=e,r.osname="Xbox"):g?(r.windows=e,r.osname="Windows"):y&&(r.linux=e,r.osname="Linux"):(r.android=e,r.osname="Android");var E="";r.windows?E=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(n(/Windows ((NT|XP)( \d\d?.\d)?)/i)):r.windowsphone?E=n(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r.mac?E=(E=n(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?E=(E=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):a?E=n(/android[ \/-](\d+(\.\d+)*)/i):r.webos?E=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?E=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?E=n(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(E=n(/tizen[\/\s](\d+(\.\d+)*)/i)),E&&(r.osversion=E);var k=!r.windows&&E.split(".")[0];return w||u||"ipad"==o||a&&(3==k||k>=4&&!S)||r.silk?r.tablet=e:(S||"iphone"==o||"ipod"==o||a||c||r.blackberry||r.webos||r.bada)&&(r.mobile=e),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.whale&&1===s([r.version,"1.0"])||r.mzbrowser&&1===s([r.version,"6.0"])||r.focus&&1===s([r.version,"1.0"])||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=e:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=e:r.x=e,r}var n=t("undefined"!=typeof navigator&&navigator.userAgent||"");function i(e){return e.split(".").length}function r(e,t){var n,i=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)i.push(t(e[n]));return i}function s(e){for(var t=Math.max(i(e[0]),i(e[1])),n=r(e,(function(e){var n=t-i(e);return r((e+=new Array(n+1).join(".0")).split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));--t>=0;){if(n[0][t]>n[1][t])return 1;if(n[0][t]!==n[1][t])return-1;if(0===t)return 0}}function o(e,i,r){var o=n;"string"==typeof i&&(r=i,i=void 0),void 0===i&&(i=!1),r&&(o=t(r));var a=""+o.version;for(var c in e)if(e.hasOwnProperty(c)&&o[c]){if("string"!=typeof e[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(e));return s([a,e[c]])<0}return i}return n.test=function(e){for(var t=0;t<e.length;++t){var i=e[t];if("string"==typeof i&&i in n)return!0}return!1},n.isUnsupportedBrowser=o,n.compareVersions=s,n.check=function(e,t,n){return!o(e,t,n)},n._detect=t,n.detect=t,n},e.exports?e.exports=i():n(91)("bowser",i)},function(e,t,n){(function(e,i){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(s){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i&&i;o.global!==o&&o.window!==o&&o.self;var a,c=2147483647,u=/^xn--/,h=/[^\x20-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function m(e){throw new RangeError(d[e])}function g(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function v(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+g((e=e.replace(l,".")).split("."),t).join(".")}function y(e){for(var t,n,i=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function b(e){return g(e,(function(e){var t="";return e>65535&&(t+=f((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=f(e)})).join("")}function _(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,n){var i=0;for(e=n?p(e/700):e>>1,e+=p(e/t);e>455;i+=36)e=p(e/35);return p(i+36*e/(e+38))}function S(e){var t,n,i,r,s,o,a,u,h,l,d,f=[],g=e.length,v=0,y=128,_=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&m("not-basic"),f.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<g;){for(s=v,o=1,a=36;r>=g&&m("invalid-input"),((u=(d=e.charCodeAt(r++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||u>p((c-v)/o))&&m("overflow"),v+=u*o,!(u<(h=a<=_?1:a>=_+26?26:a-_));a+=36)o>p(c/(l=36-h))&&m("overflow"),o*=l;_=w(v-s,t=f.length+1,0==s),p(v/t)>c-y&&m("overflow"),y+=p(v/t),v%=t,f.splice(v++,0,y)}return b(f)}function C(e){var t,n,i,r,s,o,a,u,h,l,d,g,v,b,S,C=[];for(g=(e=y(e)).length,t=128,n=0,s=72,o=0;o<g;++o)(d=e[o])<128&&C.push(f(d));for(i=r=C.length,r&&C.push("-");i<g;){for(a=c,o=0;o<g;++o)(d=e[o])>=t&&d<a&&(a=d);for(a-t>p((c-n)/(v=i+1))&&m("overflow"),n+=(a-t)*v,t=a,o=0;o<g;++o)if((d=e[o])<t&&++n>c&&m("overflow"),d==t){for(u=n,h=36;!(u<(l=h<=s?1:h>=s+26?26:h-s));h+=36)S=u-l,b=36-l,C.push(f(_(l+S%b,0))),u=p(S/b);C.push(f(_(u,0))),s=w(n,v,i==r),n=0,++i}++n,++t}return C.join("")}a={version:"1.4.1",ucs2:{decode:y,encode:b},decode:S,encode:C,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+C(e):e}))},toUnicode:function(e){return v(e,(function(e){return u.test(e)?S(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(78)(e),n(7))},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty,r="~";function s(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,h=this._events[a],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,n),!0;case 4:return h.fn.call(h.context,t,n,i),!0;case 5:return h.fn.call(h.context,t,n,i,s),!0;case 6:return h.fn.call(h.context,t,n,i,s,o),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var d,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),l){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,n);break;case 4:h[u].fn.call(h[u].context,t,n,i);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];h[u].fn.apply(h[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||c(this,s);else{for(var a=0,u=[],h=o.length;a<h;a++)(o[a].fn!==t||i&&!o[a].once||n&&o[a].context!==n)&&u.push(o[a]);u.length?this._events[s]=1===u.length?u[0]:u:c(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n(75),r=n(76),s=n(77);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|f(t,n),r=(e=a(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?a(e,0):d(e,t);if("Buffer"===t.type&&s(t.data))return d(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(h(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(i)return U(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return j(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return k(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function v(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=c.from(t,i)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,o=1,a=e.length,c=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){var h=-1;for(s=n;s<a;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===c)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var l=!0,d=0;d<c;d++)if(u(e,s+d)!==u(t,d)){l=!1;break}if(l)return s}return-1}function b(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");i>s/2&&(i=s/2);for(var o=0;o<i;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[n+o]=a}return o}function _(e,t,n,i){return z(U(t,e.length-n),e,n,i)}function w(e,t,n,i){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function S(e,t,n,i){return w(e,t,n,i)}function C(e,t,n,i){return z(B(t),e,n,i)}function E(e,t,n,i){return z(function(e,t){for(var n,i,r,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),i=n>>8,r=n%256,s.push(r),s.push(i);return s}(t,e.length-n),e,n,i)}function k(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,o,a,c,u=e[r],h=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(s=e[r+1]))&&(c=(31&u)<<6|63&s)>127&&(h=c);break;case 3:s=e[r+1],o=e[r+2],128==(192&s)&&128==(192&o)&&(c=(15&u)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:s=e[r+1],o=e[r+2],a=e[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|1023&h),i.push(h),r+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,i){return h(t),t<=0?a(e,t):void 0!==n?"string"==typeof i?a(e,t).fill(n,i):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=c.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,i,r){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(r>>>=0)-(i>>>=0),o=(n>>>=0)-(t>>>=0),a=Math.min(s,o),u=this.slice(i,r),h=e.slice(t,n),l=0;l<a;++l)if(u[l]!==h[l]){s=u[l],o=h[l];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function O(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function j(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=L(e[s]);return r}function T(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}function R(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,i,r,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function P(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,s=Math.min(e.length-n,2);r<s;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,s=Math.min(e.length-n,4);r<s;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function M(e,t,n,i,r,s){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,i,s){return s||M(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function N(e,t,n,i,s){return s||M(e,0,n,8),r.write(e,t,n,i,52,8),n+8}c.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var r=t-e;n=new c(r,void 0);for(var s=0;s<r;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},c.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),r.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),r.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),r.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),r.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);A(this,e,t,n,r-1,-r)}var s=0,o=1,a=0;for(this[t]=255&e;++s<n&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);A(this,e,t,n,r-1,-r)}var s=n-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return N(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return N(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var o=c.isBuffer(e)?e:U(new c(e,i).toString()),a=o.length;for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var i=e.length,r=null,s=[],o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function B(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(7))},function(e,t,n){"use strict";(function(e){var i=n(28),r="object"==typeof exports&&exports&&!exports.nodeType&&exports,s=r&&"object"==typeof e&&e&&!e.nodeType&&e,o=s&&s.exports===r&&i.a.process,a=function(){try{var e=s&&s.require&&s.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();t.a=a}).call(this,n(34)(e))},function(e,t){var n,i,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var c,u=[],h=!1,l=-1;function d(){h&&c&&(h=!1,c.length?u=c.concat(u):l=-1,u.length&&p())}function p(){if(!h){var e=a(d);h=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){(function(i){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))}),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(93)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(14))},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,s=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var r,s,o,a;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),o=s[t]),void 0===o)o=s[t]=n,++e._eventsCount;else if("function"==typeof o?o=s[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=h(e))>0&&o.length>r&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=d.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):g(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var u=c.length,h=g(c,u);for(n=0;n<u;++n)s(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,s,o;if(u(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){"use strict";var i=n(73),r=n(74);function s(e,t){return t.encode?t.strict?i(e):encodeURIComponent(e):e}t.extract=function(e){return e.split("?")[1]||""},t.parse=function(e,t){var n=function(e){var t;switch(e.arrayFormat){case"index":return function(e,n,i){t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===i[e]&&(i[e]={}),i[e][t[1]]=n):i[e]=n};case"bracket":return function(e,n,i){t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==i[e]?i[e]=[].concat(i[e],n):i[e]=[n]:i[e]=n};default:return function(e,t,n){void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=r({arrayFormat:"none"},t)),i=Object.create(null);return"string"!=typeof e?i:(e=e.trim().replace(/^(\?|#|&)/,""))?(e.split("&").forEach((function(e){var t=e.replace(/\+/g," ").split("="),r=t.shift(),s=t.length>0?t.join("="):void 0;s=void 0===s?null:decodeURIComponent(s),n(decodeURIComponent(r),s,i)})),Object.keys(i).sort().reduce((function(e,t){var n=i[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((function(e,t){return Number(e)-Number(t)})).map((function(e){return t[e]})):t}(n):e[t]=n,e}),Object.create(null))):i},t.stringify=function(e,t){var n=function(e){switch(e.arrayFormat){case"index":return function(t,n,i){return null===n?[s(t,e),"[",i,"]"].join(""):[s(t,e),"[",s(i,e),"]=",s(n,e)].join("")};case"bracket":return function(t,n){return null===n?s(t,e):[s(t,e),"[]=",s(n,e)].join("")};default:return function(t,n){return null===n?s(t,e):[s(t,e),"=",s(n,e)].join("")}}}(t=r({encode:!0,strict:!0,arrayFormat:"none"},t));return e?Object.keys(e).sort().map((function(i){var r=e[i];if(void 0===r)return"";if(null===r)return s(i,t);if(Array.isArray(r)){var o=[];return r.slice().forEach((function(e){void 0!==e&&o.push(n(i,e,o.length))})),o.join("&")}return s(i,t)+"="+s(r,t)})).filter((function(e){return e.length>0})).join("&"):""}},function(e,t,n){"use strict";(function(e){var i=n(6),r=n(64),s="object"==typeof exports&&exports&&!exports.nodeType&&exports,o=s&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===s?i.a.Buffer:void 0,c=(a?a.isBuffer:void 0)||r.a;t.a=c}).call(this,n(34)(e))},function(e,t,n){(t=e.exports=n(41)).Stream=t,t.Readable=t,t.Writable=n(44),t.Duplex=n(20),t.Transform=n(46),t.PassThrough=n(87)},function(e,t,n){"use strict";var i=n(25),r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var s=n(23);s.inherits=n(24);var o=n(41),a=n(44);s.inherits(l,o);for(var c=r(a.prototype),u=0;u<c.length;u++){var h=c[u];l.prototype[h]||(l.prototype[h]=a.prototype[h])}function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),i.nextTick(t,e)}},function(e,t,n){function i(e){if(e)return function(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}(e)}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<i.length;r++)if((n=i[r])===t||n.fn===t){i.splice(r,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){var i,r=n(103),s=n(53),o=n(105),a=n(106),c=n(107);"undefined"!=typeof ArrayBuffer&&(i=n(38));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=u||h;t.protocol=3;var d=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=r(d),f={type:"error",data:"parser error"},m=n(108);function g(e,t,n){for(var i=new Array(e.length),r=a(e.length,n),s=function(e,n,r){t(n,(function(t,n){i[e]=n,r(t,i)}))},o=0;o<e.length;o++)s(o,e[o],r)}t.encodePacket=function(e,n,i,r){"function"==typeof n&&(r=n,n=!1),"function"==typeof i&&(r=i,i=null);var s=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,i){if(!n)return t.encodeBase64Packet(e,i);var r=e.data,s=new Uint8Array(r),o=new Uint8Array(1+r.byteLength);o[0]=d[e.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return i(o.buffer)}(e,n,r);if(void 0!==m&&s instanceof m)return function(e,n,i){if(!n)return t.encodeBase64Packet(e,i);if(l)return function(e,n,i){if(!n)return t.encodeBase64Packet(e,i);var r=new FileReader;return r.onload=function(){t.encodePacket({type:e.type,data:r.result},n,!0,i)},r.readAsArrayBuffer(e.data)}(e,n,i);var r=new Uint8Array(1);r[0]=d[e.type];var s=new m([r.buffer,e.data]);return i(s)}(e,n,r);if(s&&s.base64)return function(e,n){var i="b"+t.packets[e.type]+e.data.data;return n(i)}(e,r);var o=d[e.type];return void 0!==e.data&&(o+=i?c.encode(String(e.data),{strict:!1}):String(e.data)),r(""+o)},t.encodeBase64Packet=function(e,n){var i,r="b"+t.packets[e.type];if(void 0!==m&&e.data instanceof m){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];n(r+e)},s.readAsDataURL(e.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var o=new Uint8Array(e.data),a=new Array(o.length),c=0;c<o.length;c++)a[c]=o[c];i=String.fromCharCode.apply(null,a)}return r+=btoa(i),n(r)},t.decodePacket=function(e,n,i){if(void 0===e)return f;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(i&&!1===(e=function(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return f;var r=e.charAt(0);return Number(r)==r&&p[r]?e.length>1?{type:p[r],data:e.substring(1)}:{type:p[r]}:f}r=new Uint8Array(e)[0];var s=o(e,1);return m&&"blob"===n&&(s=new m([s])),{type:p[r],data:s}},t.decodeBase64Packet=function(e,t){var n=p[e.charAt(0)];if(!i)return{type:n,data:{base64:!0,data:e.substr(1)}};var r=i.decode(e.substr(1));return"blob"===t&&m&&(r=new m([r])),{type:n,data:r}},t.encodePayload=function(e,n,i){"function"==typeof n&&(i=n,n=null);var r=s(e);if(n&&r)return m&&!l?t.encodePayloadAsBlob(e,i):t.encodePayloadAsArrayBuffer(e,i);if(!e.length)return i("0:");g(e,(function(e,i){t.encodePacket(e,!!r&&n,!1,(function(e){i(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return i(t.join(""))}))},t.decodePayload=function(e,n,i){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,i);var r;if("function"==typeof n&&(i=n,n=null),""===e)return i(f,0,1);for(var s,o,a="",c=0,u=e.length;c<u;c++){var h=e.charAt(c);if(":"===h){if(""===a||a!=(s=Number(a)))return i(f,0,1);if(a!=(o=e.substr(c+1,s)).length)return i(f,0,1);if(o.length){if(r=t.decodePacket(o,n,!1),f.type===r.type&&f.data===r.data)return i(f,0,1);if(!1===i(r,c+s,u))return}c+=s,a=""}else a+=h}return""!==a?i(f,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));g(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var i=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),r=new Uint8Array(i),s=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);n=i.buffer}r[s++]=t?0:1;var a=n.byteLength.toString();for(o=0;o<a.length;o++)r[s++]=parseInt(a[o]);r[s++]=255;for(i=new Uint8Array(n),o=0;o<i.length;o++)r[s++]=i[o]})),n(r.buffer)}))},t.encodePayloadAsBlob=function(e,n){g(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),r=0;r<e.length;r++)i[r]=e.charCodeAt(r);e=i.buffer,t[0]=0}var s=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),o=new Uint8Array(s.length+1);for(r=0;r<s.length;r++)o[r]=parseInt(s[r]);if(o[s.length]=255,m){var a=new m([t.buffer,o.buffer,e]);n(null,a)}}))}),(function(e,t){return n(new m(t))}))},t.decodePayloadAsBinary=function(e,n,i){"function"==typeof n&&(i=n,n=null);for(var r=e,s=[];r.byteLength>0;){for(var a=new Uint8Array(r),c=0===a[0],u="",h=1;255!==a[h];h++){if(u.length>310)return i(f,0,1);u+=a[h]}r=o(r,2+u.length),u=parseInt(u);var l=o(r,0,u);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var d=new Uint8Array(l);l="";for(h=0;h<d.length;h++)l+=String.fromCharCode(d[h])}s.push(l),r=o(r,u)}var p=s.length;s.forEach((function(e,r){i(t.decodePacket(e,n,!0),r,p)}))}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(12).Buffer)},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,i,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,i)}));case 4:return t.nextTick((function(){e.call(null,n,i,r)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return t.nextTick((function(){e.apply(null,s)}))}}}:e.exports=t}).call(this,n(14))},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),i=0,r=n.length;i<r;i++){var s=n[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.a=n}).call(this,n(7))},function(e,t,n){var i=n(92),r=n(35),s=n(50),o=n(15)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r=i(e),c=r.source,u=r.id,h=r.path,l=a[u]&&h in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(o("ignoring socket cache for %s",c),n=s(c,t)):(a[u]||(o("new io instance for %s",c),a[u]=s(c,t)),n=a[u]),r.query&&!t.query&&(t.query=r.query),n.socket(r.path,t)}t.protocol=r.protocol,t.connect=c,t.Manager=n(50),t.Socket=n(56)},function(e,t,n){"use strict";var i=function(e){return e&&2===e.CLOSING},r=function(e,t,n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})},s=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},o=["onopen","onclose","onmessage","onerror"],a=function(e,t,n){var c,u,h=this;void 0===n&&(n={});var l=0,d=0,p=!0,f=null,m={};if(!(this instanceof a))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var g={constructor:"undefined"!=typeof WebSocket&&i(WebSocket)?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1};if(Object.keys(g).filter((function(e){return n.hasOwnProperty(e)})).forEach((function(e){return g[e]=n[e]})),!i(g.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var v=g.debug?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,["RWS:"].concat(e))}:function(){},y=function(e,t){return setTimeout((function(){var n=new Error(t);n.code=e,Array.isArray(m.error)&&m.error.forEach((function(e){return(0,e[0])(n)})),c.onerror&&c.onerror(n)}),0)},b=function(){v("handleClose",{shouldRetry:p}),d++,v("retries count:",d),d>g.maxRetries?y("EHOSTDOWN","Too many failed connection attempts"):(l=l?function(e,t){var n=t*e.reconnectionDelayGrowFactor;return n>e.maxReconnectionDelay?e.maxReconnectionDelay:n}(g,l):s(g),v("handleClose - reconnectDelay:",l),p&&setTimeout(_,l))},_=function(){if(p){v("connect");var n=c,i="function"==typeof e?e():e;for(var a in c=new g.constructor(i,t),u=setTimeout((function(){v("timeout"),c.close(),y("ETIMEDOUT","Connection timeout")}),g.connectionTimeout),v("bypass properties"),c)["addEventListener","removeEventListener","close","send"].indexOf(a)<0&&r(c,h,a);c.addEventListener("open",(function(){clearTimeout(u),v("open"),l=s(g),v("reconnectDelay:",l),d=0})),c.addEventListener("close",b),function(e,t,n){Object.keys(n).forEach((function(t){n[t].forEach((function(n){var i=n[0],r=n[1];e.addEventListener(t,i,r)}))})),t&&o.forEach((function(n){e[n]=t[n]}))}(c,n,m),c.onclose=c.onclose||f,f=null}};v("init"),_(),this.close=function(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t="");var i=void 0===n?{}:n,r=i.keepClosed,s=void 0!==r&&r,o=i.fastClose,a=void 0===o||o,u=i.delay,h=void 0===u?0:u;if(v("close - params:",{reason:t,keepClosed:s,fastClose:a,delay:h,retriesCount:d,maxRetries:g.maxRetries}),p=!s&&d<=g.maxRetries,h&&(l=h),c.close(e,t),a){var y={code:e,reason:t,wasClean:!0};b(),c.removeEventListener("close",b),Array.isArray(m.close)&&m.close.forEach((function(e){var t=e[0],n=e[1];t(y),c.removeEventListener("close",t,n)})),c.onclose&&(f=c.onclose,c.onclose(y),c.onclose=null)}},this.send=function(e){c.send(e)},this.addEventListener=function(e,t,n){Array.isArray(m[e])?m[e].some((function(e){return e[0]===t}))||m[e].push([t,n]):m[e]=[[t,n]],c.addEventListener(e,t,n)},this.removeEventListener=function(e,t,n){Array.isArray(m[e])&&(m[e]=m[e].filter((function(e){return e[0]!==t}))),c.removeEventListener(e,t,n)}};e.exports=a},function(e,t,n){"use strict";function i(e){return function(...t){var n=t.pop();return e.call(this,t,n)}}n.d(t,"a",(function(){return Y}));var r="function"==typeof setImmediate&&setImmediate,s="object"==typeof process&&"function"==typeof process.nextTick;function o(e){setTimeout(e,0)}function a(e){return(t,...n)=>e(()=>t(...n))}var c=a(r?setImmediate:s?process.nextTick:o);function u(e){return d(e)?function(...t){const n=t.pop();return h(e.apply(this,t),n)}:i((function(t,n){var i;try{i=e.apply(this,t)}catch(e){return n(e)}if(i&&"function"==typeof i.then)return h(i,n);n(null,i)}))}function h(e,t){return e.then(e=>{l(t,null,e)},e=>{l(t,e&&e.message?e:new Error(e))})}function l(e,t,n){try{e(t,n)}catch(e){c(e=>{throw e},e)}}function d(e){return"AsyncFunction"===e[Symbol.toStringTag]}function p(e){if("function"!=typeof e)throw new Error("expected a function");return d(e)?u(e):e}function f(e,t=e.length){if(!t)throw new Error("arity is undefined");function n(...n){return"function"==typeof n[t-1]?e.apply(this,n):new Promise((i,r)=>{n[t-1]=(e,...t)=>{if(e)return r(e);i(t.length>1?t:t[0])},e.apply(this,n)})}return Object.defineProperty(n,"name",{value:`awaitable(${e.name})`}),n}function m(e){return function(t,...n){return f((function(i){var r=this;return e(t,(e,t)=>{p(e).apply(r,n.concat(t))},i)}))}}function g(e,t,n,i){t=t||[];var r=[],s=0,o=p(n);return e(t,(e,t,n)=>{var i=s++;o(e,(e,t)=>{r[i]=t,n(e)})},e=>{i(e,r)})}function v(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0}const y={};function b(e){function t(...t){if(null!==e){var n=e;e=null,n.apply(this,t)}}return Object.assign(t,e),t}function _(e){if(v(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t,n,i,r,s=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()}(e);return s?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(s):(n=(t=e)?Object.keys(t):[],i=-1,r=n.length,function(){var e=n[++i];return i<r?{value:t[e],key:e}:null})}function w(e){return function(...t){if(null===e)throw new Error("Callback was already called.");var n=e;e=null,n.apply(this,t)}}function S(e,t,n,i){let r=!1,s=!1,o=!1,a=0,c=0;function u(){a>=t||o||r||(o=!0,e.next().then(({value:e,done:t})=>{if(!s&&!r){if(o=!1,t)return r=!0,void(a<=0&&i(null));a++,n(e,c,h),c++,u()}}).catch(l))}function h(e,t){if(a-=1,!s)return e?l(e):!1===e?(r=!0,void(s=!0)):t===y||r&&a<=0?(r=!0,i(null)):void u()}function l(e){s||(o=!1,r=!0,i(e))}u()}var C=e=>(t,n,i)=>{if(i=b(i),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return i(null);if("AsyncGenerator"===t[Symbol.toStringTag])return S(t,e,n,i);if(function(e){return"function"==typeof e[Symbol.asyncIterator]}(t))return S(t[Symbol.asyncIterator](),e,n,i);var r=_(t),s=!1,o=!1,a=0,c=!1;function u(e,t){if(!o)if(a-=1,e)s=!0,i(e);else if(!1===e)s=!0,o=!0;else{if(t===y||s&&a<=0)return s=!0,i(null);c||h()}}function h(){for(c=!0;a<e&&!s;){var t=r();if(null===t)return s=!0,void(a<=0&&i(null));a+=1,n(t.value,t.key,w(u))}c=!1}h()};var E=f((function(e,t,n,i){return C(t)(e,p(n),i)}),4);function k(e,t,n){n=b(n);var i=0,r=0,{length:s}=e,o=!1;function a(e,t){!1===e&&(o=!0),!0!==o&&(e?n(e):++r!==s&&t!==y||n(null))}for(0===s&&n(null);i<s;i++)t(e[i],i,w(a))}function x(e,t,n){return E(e,1/0,t,n)}var I=f((function(e,t,n){return(v(e)?k:x)(e,p(t),n)}),3);var O=f((function(e,t,n){return g(I,e,t,n)}),3);m(O);var j=f((function(e,t,n){return E(e,1,t,n)}),3);var T=f((function(e,t,n){return g(j,e,t,n)}),3);m(T);Symbol("promiseCallback");class R{constructor(){this.head=this.tail=null,this.length=0}removeLink(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e}empty(){for(;this.head;)this.shift();return this}insertAfter(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1}insertBefore(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1}unshift(e){this.head?this.insertBefore(this.head,e):A(this,e)}push(e){this.tail?this.insertAfter(this.tail,e):A(this,e)}shift(){return this.head&&this.removeLink(this.head)}pop(){return this.tail&&this.removeLink(this.tail)}toArray(){return[...this]}*[Symbol.iterator](){for(var e=this.head;e;)yield e.data,e=e.next}remove(e){for(var t=this.head;t;){var{next:n}=t;e(t)&&this.removeLink(t),t=n}return this}}function A(e,t){e.length=1,e.head=e.tail=t}function P(e,t,n){if(null==t)t=1;else if(0===t)throw new RangeError("Concurrency must not be zero");var i=p(e),r=0,s=[];const o={error:[],drain:[],saturated:[],unsaturated:[],empty:[]};function a(e,t){return e?t?void(o[e]=o[e].filter(e=>e!==t)):o[e]=[]:Object.keys(o).forEach(e=>o[e]=[])}function u(e,...t){o[e].forEach(e=>e(...t))}var h=!1;function l(e,t,n,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");var r,s;function o(e,...t){return e?n?s(e):r():t.length<=1?r(t[0]):void r(t)}v.started=!0;var a={data:e,callback:n?o:i||o};if(t?v._tasks.unshift(a):v._tasks.push(a),h||(h=!0,c(()=>{h=!1,v.process()})),n||!i)return new Promise((e,t)=>{r=e,s=t})}function d(e){return function(t,...n){r-=1;for(var i=0,o=e.length;i<o;i++){var a=e[i],c=s.indexOf(a);0===c?s.shift():c>0&&s.splice(c,1),a.callback(t,...n),null!=t&&u("error",t,a.data)}r<=v.concurrency-v.buffer&&u("unsaturated"),v.idle()&&u("drain"),v.process()}}function f(e){return!(0!==e.length||!v.idle())&&(c(()=>u("drain")),!0)}const m=e=>t=>{if(!t)return new Promise((t,n)=>{!function(e,t){const n=(...i)=>{a(e,n),t(...i)};o[e].push(n)}(e,(e,i)=>{if(e)return n(e);t(i)})});a(e),function(e,t){o[e].push(t)}(e,t)};var g=!1,v={_tasks:new R,*[Symbol.iterator](){yield*v._tasks[Symbol.iterator]()},concurrency:t,payload:n,buffer:t/4,started:!1,paused:!1,push(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>l(e,!1,!1,t))}return l(e,!1,!1,t)},pushAsync(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>l(e,!1,!0,t))}return l(e,!1,!0,t)},kill(){a(),v._tasks.empty()},unshift(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>l(e,!0,!1,t))}return l(e,!0,!1,t)},unshiftAsync(e,t){if(Array.isArray(e)){if(f(e))return;return e.map(e=>l(e,!0,!0,t))}return l(e,!0,!0,t)},remove(e){v._tasks.remove(e)},process(){if(!g){for(g=!0;!v.paused&&r<v.concurrency&&v._tasks.length;){var e=[],t=[],n=v._tasks.length;v.payload&&(n=Math.min(n,v.payload));for(var o=0;o<n;o++){var a=v._tasks.shift();e.push(a),s.push(a),t.push(a.data)}r+=1,0===v._tasks.length&&u("empty"),r===v.concurrency&&u("saturated");var c=w(d(e));i(t,c)}g=!1}},length:()=>v._tasks.length,running:()=>r,workersList:()=>s,idle:()=>v._tasks.length+r===0,pause(){v.paused=!0},resume(){!1!==v.paused&&(v.paused=!1,c(v.process))}};return Object.defineProperties(v,{saturated:{writable:!1,value:m("saturated")},unsaturated:{writable:!1,value:m("unsaturated")},empty:{writable:!1,value:m("empty")},drain:{writable:!1,value:m("drain")},error:{writable:!1,value:m("error")}}),v}f((function(e,t,n,i){i=b(i);var r=p(n);return j(e,(e,n,i)=>{r(t,e,(e,n)=>{t=n,i(e)})},e=>i(e,t))}),4);var D=f((function(e,t,n,i){return g(C(t),e,n,i)}),4);var M=f((function(e,t,n,i){var r=p(n);return D(e,t,(e,t)=>{r(e,(e,...n)=>e?t(e):t(e,n))},(e,t)=>{for(var n=[],r=0;r<t.length;r++)t[r]&&(n=n.concat(...t[r]));return i(e,n)})}),4);f((function(e,t,n){return M(e,1/0,t,n)}),3);f((function(e,t,n){return M(e,1,t,n)}),3);function q(e,t){return(n,i,r,s)=>{var o,a=!1;const c=p(r);n(i,(n,i,r)=>{c(n,(i,s)=>i||!1===i?r(i):e(s)&&!o?(a=!0,o=t(!0,n),r(null,y)):void r())},e=>{if(e)return s(e);s(null,a?o:t(!1))})}}f((function(e,t,n){return q(e=>e,(e,t)=>t)(I,e,t,n)}),3);f((function(e,t,n,i){return q(e=>e,(e,t)=>t)(C(t),e,n,i)}),4);f((function(e,t,n){return q(e=>e,(e,t)=>t)(C(1),e,t,n)}),3);function N(e){return(t,...n)=>p(t)(...n,(t,...n)=>{"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&n.forEach(t=>console[e](t)))})}N("dir");f((function(e,t,n){n=w(n);var i,r=p(e),s=p(t);function o(e,...t){if(e)return n(e);!1!==e&&(i=t,s(...t,a))}function a(e,t){return e?n(e):!1!==e?t?void r(o):n(null,...i):void 0}return a(null,!0)}),3);function F(e){return(t,n,i)=>e(t,i)}f((function(e,t,n){return I(e,F(p(t)),n)}),3);var L=f((function(e,t,n,i){return C(t)(e,F(p(n)),i)}),4);var U=f((function(e,t,n){return L(e,1,t,n)}),3);function B(e){return d(e)?e:function(...t){var n=t.pop(),i=!0;t.push((...e)=>{i?c(()=>n(...e)):n(...e)}),e.apply(this,t),i=!1}}f((function(e,t,n){return q(e=>!e,e=>!e)(I,e,t,n)}),3);f((function(e,t,n,i){return q(e=>!e,e=>!e)(C(t),e,n,i)}),4);f((function(e,t,n){return q(e=>!e,e=>!e)(j,e,t,n)}),3);function z(e,t,n,i){var r=new Array(t.length);e(t,(e,t,i)=>{n(e,(e,n)=>{r[t]=!!n,i(e)})},e=>{if(e)return i(e);for(var n=[],s=0;s<t.length;s++)r[s]&&n.push(t[s]);i(null,n)})}function G(e,t,n,i){var r=[];e(t,(e,t,i)=>{n(e,(n,s)=>{if(n)return i(n);s&&r.push({index:t,value:e}),i(n)})},e=>{if(e)return i(e);i(null,r.sort((e,t)=>e.index-t.index).map(e=>e.value))})}function W(e,t,n,i){return(v(t)?z:G)(e,t,p(n),i)}f((function(e,t,n){return W(I,e,t,n)}),3);f((function(e,t,n,i){return W(C(t),e,n,i)}),4);f((function(e,t,n){return W(j,e,t,n)}),3);f((function(e,t){var n=w(t),i=p(B(e));return function e(t){if(t)return n(t);!1!==t&&i(e)}()}),2);f((function(e,t,n,i){var r=p(n);return D(e,t,(e,t)=>{r(e,(n,i)=>n?t(n):t(n,{key:i,val:e}))},(e,t)=>{for(var n={},{hasOwnProperty:r}=Object.prototype,s=0;s<t.length;s++)if(t[s]){var{key:o}=t[s],{val:a}=t[s];r.call(n,o)?n[o].push(a):n[o]=[a]}return i(e,n)})}),4);N("log");f((function(e,t,n,i){i=b(i);var r={},s=p(n);return C(t)(e,(e,t,n)=>{s(e,t,(e,i)=>{if(e)return n(e);r[t]=i,n(e)})},e=>i(e,r))}),4);a(s?process.nextTick:r?setImmediate:o),f((e,t,n)=>{var i=v(t)?[]:{};e(t,(e,t,n)=>{p(e)((e,...r)=>{r.length<2&&([r]=r),i[t]=r,n(e)})},e=>n(e,i))},3);function H(e,t){var n=p(e);return P((e,t)=>{n(e[0],t)},t,1)}class V{constructor(){this.heap=[],this.pushCount=Number.MIN_SAFE_INTEGER}get length(){return this.heap.length}empty(){return this.heap=[],this}percUp(e){let t;for(;e>0&&J(this.heap[e],this.heap[t=$(e)]);){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}percDown(e){let t;for(;(t=1+(e<<1))<this.heap.length&&(t+1<this.heap.length&&J(this.heap[t+1],this.heap[t])&&(t+=1),!J(this.heap[e],this.heap[t]));){let n=this.heap[e];this.heap[e]=this.heap[t],this.heap[t]=n,e=t}}push(e){e.pushCount=++this.pushCount,this.heap.push(e),this.percUp(this.heap.length-1)}unshift(e){return this.heap.push(e)}shift(){let[e]=this.heap;return this.heap[0]=this.heap[this.heap.length-1],this.heap.pop(),this.percDown(0),e}toArray(){return[...this]}*[Symbol.iterator](){for(let e=0;e<this.heap.length;e++)yield this.heap[e].data}remove(e){let t=0;for(let n=0;n<this.heap.length;n++)e(this.heap[n])||(this.heap[t]=this.heap[n],t++);this.heap.splice(t);for(let e=$(this.heap.length-1);e>=0;e--)this.percDown(e);return this}}function $(e){return(e+1>>1)-1}function J(e,t){return e.priority!==t.priority?e.priority<t.priority:e.pushCount<t.pushCount}function Y(e,t){var n=H(e,t);return n._tasks=new V,n.push=function(e,t=0,i=(()=>{})){if("function"!=typeof i)throw new Error("task callback must be a function");if(n.started=!0,Array.isArray(e)||(e=[e]),0===e.length&&n.idle())return c(()=>n.drain());for(var r=0,s=e.length;r<s;r++){var o={data:e[r],priority:t,callback:i};n._tasks.push(o)}c(n.process)},delete n.unshift,n}f((function(e,t){if(t=b(t),!Array.isArray(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var n=0,i=e.length;n<i;n++)p(e[n])(t)}),2);function Q(e,t,n,i){const r=p(n);return W(e,t,(e,t)=>{r(e,(e,n)=>{t(e,!n)})},i)}f((function(e,t,n){return Q(I,e,t,n)}),3);f((function(e,t,n,i){return Q(C(t),e,n,i)}),4);f((function(e,t,n){return Q(j,e,t,n)}),3);f((function(e,t,n){return q(Boolean,e=>e)(I,e,t,n)}),3);f((function(e,t,n,i){return q(Boolean,e=>e)(C(t),e,n,i)}),4);f((function(e,t,n){return q(Boolean,e=>e)(j,e,t,n)}),3);f((function(e,t,n){var i=p(t);return O(e,(e,t)=>{i(e,(n,i)=>{if(n)return t(n);t(n,{value:e,criteria:i})})},(e,t)=>{if(e)return n(e);n(null,t.sort(r).map(e=>e.value))});function r(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}}),3);f((function(e,t){var n,i=null;return U(e,(e,t)=>{p(e)((e,...r)=>{if(!1===e)return t(e);r.length<2?[n]=r:n=r,i=e,t(e?null:{})})},()=>t(i,n))}));f((function(e,t,n){n=w(n);var i=p(t),r=p(e),s=[];function o(e,...t){if(e)return n(e);s=t,!1!==e&&r(a)}function a(e,t){return e?n(e):!1!==e?t?void i(o):n(null,...s):void 0}return r(a)}),3);f((function(e,t){if(t=b(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var n=0;function i(t){p(e[n++])(...t,w(r))}function r(r,...s){if(!1!==r)return r||n===e.length?t(r,...s):void i(s)}i([])}))},,function(e,t,n){var i=n(12),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),s(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){var i=n(95)("socket.io-parser"),r=n(21),s=n(98),o=n(48),a=n(49);function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=l;var u=t.ERROR+'"encode error"';function h(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var r=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===r)return u;n+=r}return i("encoded %j as %s",e,n),n}function l(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,n){(i("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){s.removeBlobs(e,(function(e){var n=s.deconstructPacket(e),i=h(n.packet),r=n.buffers;r.unshift(i),t(r)}))}(e,n):n([h(e)])},r(l.prototype),l.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n=0,r={type:Number(e.charAt(0))};if(null==t.types[r.type])return p("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(var s="";"-"!==e.charAt(++n)&&(s+=e.charAt(n),n!=e.length););if(s!=Number(s)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(n+1))for(r.nsp="";++n;){if(","===(c=e.charAt(n)))break;if(r.nsp+=c,n===e.length)break}else r.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(r.id="";++n;){var c;if(null==(c=e.charAt(n))||Number(c)!=c){--n;break}if(r.id+=e.charAt(n),n===e.length)break}r.id=Number(r.id)}if(e.charAt(++n)){var u=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(n));if(!(!1!==u&&(r.type===t.ERROR||o(u))))return p("invalid payload");r.data=u}return i("decoded %s as %j",e,r),r}(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new d(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){var i=n(101);e.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||i))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}},function(e,t,n){var i=n(22),r=n(21);function s(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=s,r(s.prototype),s.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(e){var t=i.decodePacket(e,this.socket.binaryType);this.onPacket(t)},s.prototype.onPacket=function(e){this.emit("packet",e)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),i=0;i<e.length;i++)n[e.charCodeAt(i)]=i;t.encode=function(t){var n,i=new Uint8Array(t),r=i.length,s="";for(n=0;n<r;n+=3)s+=e[i[n]>>2],s+=e[(3&i[n])<<4|i[n+1]>>4],s+=e[(15&i[n+1])<<2|i[n+2]>>6],s+=e[63&i[n+2]];return r%3==2?s=s.substring(0,s.length-1)+"=":r%3==1&&(s=s.substring(0,s.length-2)+"=="),s},t.decode=function(e){var t,i,r,s,o,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var h=new ArrayBuffer(a),l=new Uint8Array(h);for(t=0;t<c;t+=4)i=n[e.charCodeAt(t)],r=n[e.charCodeAt(t+1)],s=n[e.charCodeAt(t+2)],o=n[e.charCodeAt(t+3)],l[u++]=i<<2|r>>4,l[u++]=(15&r)<<4|s>>2,l[u++]=(3&s)<<6|63&o;return h}}()},function(e,t,n){"use strict";t.__esModule=!0;var i=n(59);t.default=i.default,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(114))},,function(e,t,n){"use strict";(function(t,i){var r=n(25);e.exports=b;var s,o=n(79);b.ReadableState=y;n(16).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(42),u=n(33).Buffer,h=t.Uint8Array||function(){};var l=n(23);l.inherits=n(24);var d=n(80),p=void 0;p=d&&d.debuglog?d.debuglog("stream"):function(){};var f,m=n(81),g=n(43);l.inherits(b,c);var v=["error","close","destroy","pause","resume"];function y(e,t){e=e||{};var i=t instanceof(s=s||n(20));this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(f||(f=n(45).StringDecoder),this.decoder=new f(e.encoding),this.encoding=e.encoding)}function b(e){if(s=s||n(20),!(this instanceof b))return new b(e);this._readableState=new y(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function _(e,t,n,i,r){var s,o=e._readableState;null===t?(o.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,C(e)}(e,o)):(r||(s=function(e,t){var n;i=t,u.isBuffer(i)||i instanceof h||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var i;return n}(o,t)),s?e.emit("error",s):o.objectMode||t&&t.length>0?("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),i?o.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,o,t,!0):o.ended?e.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(t=o.decoder.write(t),o.objectMode||0!==t.length?w(e,o,t,!1):k(e,o)):w(e,o,t,!1))):i||(o.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(o)}function w(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&C(e)),k(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=u.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},b.prototype.unshift=function(e){return _(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return f||(f=n(45).StringDecoder),this._readableState.decoder=new f(e),this._readableState.encoding=e,this};function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(p("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(E,e):E(e))}function E(e){p("emit readable"),e.emit("readable"),j(e)}function k(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(x,e,t))}function x(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(p("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function I(e){p("readable nexttick read 0"),e.read(0)}function O(e,t){t.reading||(p("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),j(e),t.flowing&&!t.reading&&e.read(0)}function j(e){var t=e._readableState;for(p("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var i;e<t.head.data.length?(i=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):i=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,i=1,r=n.data;e-=r.length;for(;n=n.next;){var s=n.data,o=e>s.length?s.length:e;if(o===s.length?r+=s:r+=s.slice(0,e),0===(e-=o)){o===s.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(o));break}++i}return t.length-=i,r}(e,t):function(e,t){var n=u.allocUnsafe(e),i=t.head,r=1;i.data.copy(n),e-=i.data.length;for(;i=i.next;){var s=i.data,o=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,o),0===(e-=o)){o===s.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=s.slice(o));break}++r}return t.length-=r,n}(e,t);return i}(e,t.buffer,t.decoder),n);var n}function R(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(A,t,e))}function A(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){p("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return p("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?R(this):C(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&R(this),null;var i,r=t.needReadable;return p("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&p("length less than watermark",r=!0),t.ended||t.reading?p("reading or ended",r=!1):r&&(p("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(n,t))),null===(i=e>0?T(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&R(this)),null!==i&&this.emit("data",i),i},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,p("pipe count=%d opts=%j",s.pipesCount,t);var c=(!t||!1!==t.end)&&e!==i.stdout&&e!==i.stderr?h:b;function u(t,i){p("onunpipe"),t===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,p("cleanup"),e.removeListener("close",v),e.removeListener("finish",y),e.removeListener("drain",l),e.removeListener("error",g),e.removeListener("unpipe",u),n.removeListener("end",h),n.removeListener("end",b),n.removeListener("data",m),d=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function h(){p("onend"),e.end()}s.endEmitted?r.nextTick(c):n.once("end",c),e.on("unpipe",u);var l=function(e){return function(){var t=e._readableState;p("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,j(e))}}(n);e.on("drain",l);var d=!1;var f=!1;function m(t){p("ondata"),f=!1,!1!==e.write(t)||f||((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==P(s.pipes,e))&&!d&&(p("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function g(t){p("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function v(){e.removeListener("finish",y),b()}function y(){p("onfinish"),e.removeListener("close",v),b()}function b(){p("unpipe"),n.unpipe(e)}return n.on("data",m),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?o(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",v),e.once("finish",y),e.emit("pipe",n),s.flowing||(p("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<r;s++)i[s].emit("unpipe",this,n);return this}var o=P(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},b.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&C(this):r.nextTick(I,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(p("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(O,e,t))}(this,e)),this},b.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(p("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(p("wrapped data"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r)||(n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var s=0;s<v.length;s++)e.on(v[s],this.emit.bind(this,v[s]));return this._read=function(t){p("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=T}).call(this,n(7),n(14))},function(e,t,n){e.exports=n(16).EventEmitter},function(e,t,n){"use strict";var i=n(25);function r(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(i.nextTick(r,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,i,r){var s=n(25);function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;e.entry=null;for(;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?i:s.nextTick;y.WritableState=v;var u=n(23);u.inherits=n(24);var h={deprecate:n(85)},l=n(42),d=n(33).Buffer,p=r.Uint8Array||function(){};var f,m=n(43);function g(){}function v(e,t){a=a||n(20),e=e||{};var i=t instanceof a;this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,u=e.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(u||0===u)?u:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?(s.nextTick(r,i),s.nextTick(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(r(i),e._writableState.errorEmitted=!0,e.emit("error",i),E(e,t))}(e,n,i,t,r);else{var o=S(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),i?c(_,e,n,o,r):_(e,n,o,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function y(e){if(a=a||n(20),!(f.call(y,this)||this instanceof a))return new y(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function b(e,t,n,i,r,s,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,n?e._writev(r,t.onwrite):e._write(r,s,t.onwrite),t.sync=!1}function _(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),E(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var i=t.bufferedRequestCount,r=new Array(i),s=t.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)r[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;r.allBuffers=c,b(e,t,!0,t.length,r,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,h=n.encoding,l=n.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,h,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function C(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),E(e,t)}))}function E(e,t){var n=S(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,s.nextTick(C,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(y,l),v.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(v.prototype,"buffer",{get:h.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&(e&&e._writableState instanceof v)}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,n){var i,r=this._writableState,o=!1,a=!r.objectMode&&(i=e,d.isBuffer(i)||i instanceof p);return a&&!d.isBuffer(e)&&(e=function(e){return d.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=g),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),s.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var r=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),s.nextTick(i,o),r=!1),r}(this,r,e,n))&&(r.pendingcb++,o=function(e,t,n,i,r,s){if(!n){var o=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=d.from(t,n));return t}(t,i,r);i!==o&&(n=!0,r="buffer",i=o)}var a=t.objectMode?1:i.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:s,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,a,i,r,s);return c}(this,r,a,e,t,n)),o},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(e,t,n){t.ending=!0,E(e,t),n&&(t.finished?s.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(14),n(83).setImmediate,n(7))},function(e,t,n){"use strict";var i=n(86).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=l,t=3;break;default:return this.write=d,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}t.StringDecoder=s,s.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},s.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=o(t[i]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=o(t[i]))>=0)return r>0&&(e.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=o(t[i]))>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=o;var i=n(20),r=n(23);function s(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);i.call(this,e),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=n(24),r.inherits(o,i),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,i.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;i.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,r=e.indexOf("["),s=e.indexOf("]");-1!=r&&-1!=s&&(e=e.substring(0,r)+e.substring(r,s).replace(/:/g,";")+e.substring(s,e.length));for(var o=n.exec(e||""),a={},c=14;c--;)a[i[c]]=o[c]||"";return-1!=r&&-1!=s&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){e.exports=function(e){return n&&t.isBuffer(e)||i&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))};var n="function"==typeof t&&"function"==typeof t.isBuffer,i="function"==typeof ArrayBuffer}).call(this,n(12).Buffer)},function(e,t,n){var i=n(99),r=n(56),s=n(21),o=n(35),a=n(57),c=n(58),u=n(15)("socket.io-client:manager"),h=n(55),l=n(113),d=Object.prototype.hasOwnProperty;function p(e,t){if(!(this instanceof p))return new p(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||o;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=p,p.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},p.prototype.updateSocketIds=function(){for(var e in this.nsps)d.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},p.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},s(p.prototype),p.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},p.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},p.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=i(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var s=a(n,"open",(function(){r.onopen(),e&&e()})),o=a(n,"error",(function(t){if(u("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var h=setTimeout((function(){u("connect attempt timed out after %d",c),s.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(s),this.subs.push(o),this},p.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(e){this.decoder.add(e)},p.prototype.ondecoded=function(e){this.emit("packet",e)},p.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},p.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new r(this,e,t),this.nsps[e]=n;var i=this;n.on("connecting",s),n.on("connect",(function(){n.id=i.generateId(e)})),this.autoConnect&&s()}function s(){~h(i.connecting,n)||i.connecting.push(n)}return n},p.prototype.destroy=function(e){var t=h(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},p.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var i=0;i<n.length;i++)t.engine.write(n[i],e.options);t.encoding=!1,t.processPacketQueue()})))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},p.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},p.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){var i=n(36),r=n(102),s=n(109),o=n(110);t.polling=function(e){var t=!1,n=!1,o=!1!==e.jsonp;if("undefined"!=typeof location){var a="https:"===location.protocol,c=location.port;c||(c=a?443:80),t=e.hostname!==location.hostname||c!==e.port,n=e.secure!==a}if(e.xdomain=t,e.xscheme=n,"open"in new i(e)&&!e.forceJSONP)return new r(e);if(!o)throw new Error("JSONP disabled");return new s(e)},t.websocket=o},function(e,t,n){var i=n(37),r=n(26),s=n(22),o=n(27),a=n(54),c=n(15)("engine.io-client:polling");e.exports=h;var u=null!=new(n(36))({xdomain:!1}).responseType;function h(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),i.call(this,e)}o(h,i),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(c("we are currently polling - waiting to pause"),i++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--i||n()}))),this.writable||(c("we are currently writing - waiting to pause"),i++,this.once("drain",(function(){c("pre-pause writing complete"),--i||n()})))}else n()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(e){var t=this;c("polling got data %s",e);s.decodePayload(e,this.socket.binaryType,(function(e,n,i){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},h.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};s.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},h.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){(function(t){var i=n(104),r=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);e.exports=function e(n){if(!n||"object"!=typeof n)return!1;if(i(n)){for(var r=0,a=n.length;r<a;r++)if(e(n[r]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||s&&n instanceof Blob||o&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&e(n[c]))return!0;return!1}}).call(this,n(12).Buffer)},function(e,t,n){"use strict";var i,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s={},o=0,a=0;function c(e){var t="";do{t=r[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function u(){var e=c(+new Date);return e!==i?(o=0,i=e):e+"."+c(o++)}for(;a<64;a++)s[r[a]]=a;u.encode=c,u.decode=function(e){var t=0;for(a=0;a<e.length;a++)t=64*t+s[e.charAt(a)];return t},e.exports=u},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}},function(e,t,n){var i=n(35),r=n(21),s=n(112),o=n(57),a=n(58),c=n(15)("socket.io-client:socket"),u=n(26),h=n(53);e.exports=p;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=r.prototype.emit;function p(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[o(e,"open",a(this,"onopen")),o(e,"packet",a(this,"onpacket")),o(e,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(l.hasOwnProperty(e))return d.apply(this,arguments),this;var t=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:h(t))?i.BINARY_EVENT:i.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?u.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:i.CONNECT,query:e})}else this.packet({type:i.CONNECT})},p.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===i.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(e);break;case i.ACK:case i.BINARY_ACK:this.onack(e);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);c("sending ack %j",r),t.packet({type:h(r)?i.BINARY_ACK:i.ACK,id:e,data:r})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags.compress=e,this},p.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var i=n.call(arguments,2);return function(){return t.apply(e,i.concat(n.call(arguments)))}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(o,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return{next:o(0),throw:o(1),return:o(2)};function o(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=i[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};t.__esModule=!0;var s=function(){function e(e){this.promiseResolverQueue=[],this.permits=e}return e.prototype.getPermits=function(){return this.permits},e.prototype.wait=function(){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):[2,new Promise((function(t){return e.promiseResolverQueue.push(t)}))]}))}))},e.prototype.acquire=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.wait()]}))}))},e.prototype.waitFor=function(e){return i(this,void 0,void 0,(function(){var t,n,i=this;return r(this,(function(r){return this.permits>0?(this.permits-=1,[2,Promise.resolve(!0)]):(t=function(e){},n=new Promise((function(e){t=e})),this.promiseResolverQueue.push(t),setTimeout((function(){var e=i.promiseResolverQueue.indexOf(t);-1!==e&&i.promiseResolverQueue.splice(e,1),t(!1)}),e),[2,n])}))}))},e.prototype.tryAcquire=function(){return this.permits>0&&(this.permits-=1,!0)},e.prototype.drainPermits=function(){if(this.permits>0){var e=this.permits;return this.permits=0,e}return 0},e.prototype.signal=function(){if(this.permits+=1,this.permits>1&&this.promiseResolverQueue.length>0)throw new Error("this.permits should never be > 0 when there is someone waiting.");if(1===this.permits&&this.promiseResolverQueue.length>0){this.permits-=1;var e=this.promiseResolverQueue.shift();e&&e(!0)}},e.prototype.release=function(){this.signal()},e.prototype.execute=function(e){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.wait()];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,,4,5]),[4,e()];case 3:return[2,t.sent()];case 4:return this.signal(),[7];case 5:return[2]}}))}))},e}();t.default=s},function(e,t,i){var r;(function(){var i=function(e){return e instanceof i?e:this instanceof i?void(this.EXIFwrapped=e):new i(e)};e.exports&&(t=e.exports=i),t.EXIF=i;var s=i.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},o=i.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},a=i.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},c=i.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},u=i.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function h(e){return!!e.exifdata}function l(e,t){function n(n){var r=d(n);e.exifdata=r||{};var s=function(e){var t=new DataView(e);0;if(255!=t.getUint8(0)||216!=t.getUint8(1))return!1;var n=2,i=e.byteLength,r=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};for(;n<i;){if(r(t,n)){var s=t.getUint8(n+7);s%2!=0&&(s+=1),0===s&&(s=4);var o=n+8+s,a=t.getUint16(n+6+s);return f(e,o,a)}n++}}(n);if(e.iptcdata=s||{},i.isXmpEnabled){var o=function(e){if(!("DOMParser"in self))return;var t=new DataView(e);0;if(255!=t.getUint8(0)||216!=t.getUint8(1))return!1;var n=2,i=e.byteLength,r=new DOMParser;for(;n<i-4;){if("http"==v(t,n,4)){var s=n-1,o=t.getUint16(n-2)-1,a=v(t,s,o),c=a.indexOf("xmpmeta>")+8,u=(a=a.substring(a.indexOf("<x:xmpmeta"),c)).indexOf("x:xmpmeta")+10;return a=a.slice(0,u)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+a.slice(u),_(r.parseFromString(a,"text/xml"))}n++}}(n);e.xmpdata=o||{}}t&&t.call(e)}if(e.src)if(/^data\:/i.test(e.src))n(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),i=n.length,r=new ArrayBuffer(i),s=new Uint8Array(r),o=0;o<i;o++)s[o]=n.charCodeAt(o);return r}(e.src));else if(/^blob\:/i.test(e.src)){(s=new FileReader).onload=function(e){n(e.target.result)},function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},n.send()}(e.src,(function(e){s.readAsArrayBuffer(e)}))}else{var r=new XMLHttpRequest;r.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";n(r.response),r=null},r.open("GET",e.src,!0),r.responseType="arraybuffer",r.send(null)}else if(self.FileReader&&(e instanceof self.Blob||e instanceof self.File)){var s;(s=new FileReader).onload=function(e){n(e.target.result)},s.readAsArrayBuffer(e)}}function d(e){var t=new DataView(e);if(255!=t.getUint8(0)||216!=t.getUint8(1))return!1;for(var n=2,i=e.byteLength;n<i;){if(255!=t.getUint8(n))return!1;if(225==t.getUint8(n+1))return y(t,n+4,t.getUint16(n+2));n+=2+t.getUint16(n+2)}}var p={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function f(e,t,n){for(var i,r,s,o,a=new DataView(e),c={},u=t;u<t+n;)28===a.getUint8(u)&&2===a.getUint8(u+1)&&(o=a.getUint8(u+2))in p&&((s=a.getInt16(u+3))+5,r=p[o],i=v(a,u+5,s),c.hasOwnProperty(r)?c[r]instanceof Array?c[r].push(i):c[r]=[c[r],i]:c[r]=i),u++;return c}function m(e,t,n,i,r){var s,o,a=e.getUint16(n,!r),c={};for(o=0;o<a;o++)s=n+12*o+2,c[i[e.getUint16(s,!r)]]=g(e,s,t,n,r);return c}function g(e,t,n,i,r){var s,o,a,c,u,h,l=e.getUint16(t+2,!r),d=e.getUint32(t+4,!r),p=e.getUint32(t+8,!r)+n;switch(l){case 1:case 7:if(1==d)return e.getUint8(t+8,!r);for(s=d>4?p:t+8,o=[],c=0;c<d;c++)o[c]=e.getUint8(s+c);return o;case 2:return v(e,s=d>4?p:t+8,d-1);case 3:if(1==d)return e.getUint16(t+8,!r);for(s=d>2?p:t+8,o=[],c=0;c<d;c++)o[c]=e.getUint16(s+2*c,!r);return o;case 4:if(1==d)return e.getUint32(t+8,!r);for(o=[],c=0;c<d;c++)o[c]=e.getUint32(p+4*c,!r);return o;case 5:if(1==d)return u=e.getUint32(p,!r),h=e.getUint32(p+4,!r),(a=new Number(u/h)).numerator=u,a.denominator=h,a;for(o=[],c=0;c<d;c++)u=e.getUint32(p+8*c,!r),h=e.getUint32(p+4+8*c,!r),o[c]=new Number(u/h),o[c].numerator=u,o[c].denominator=h;return o;case 9:if(1==d)return e.getInt32(t+8,!r);for(o=[],c=0;c<d;c++)o[c]=e.getInt32(p+4*c,!r);return o;case 10:if(1==d)return e.getInt32(p,!r)/e.getInt32(p+4,!r);for(o=[],c=0;c<d;c++)o[c]=e.getInt32(p+8*c,!r)/e.getInt32(p+4+8*c,!r);return o}}function v(e,t,i){var r="";for(n=t;n<t+i;n++)r+=String.fromCharCode(e.getUint8(n));return r}function y(e,t){if("Exif"!=v(e,t,4))return!1;var n,i,r,h,l,d=t+6;if(18761==e.getUint16(d))n=!1;else{if(19789!=e.getUint16(d))return!1;n=!0}if(42!=e.getUint16(d+2,!n))return!1;var p=e.getUint32(d+4,!n);if(p<8)return!1;if((i=m(e,d,d+p,o,n)).ExifIFDPointer)for(r in h=m(e,d,d+i.ExifIFDPointer,s,n)){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":h[r]=u[r][h[r]];break;case"ExifVersion":case"FlashpixVersion":h[r]=String.fromCharCode(h[r][0],h[r][1],h[r][2],h[r][3]);break;case"ComponentsConfiguration":h[r]=u.Components[h[r][0]]+u.Components[h[r][1]]+u.Components[h[r][2]]+u.Components[h[r][3]]}i[r]=h[r]}if(i.GPSInfoIFDPointer)for(r in l=m(e,d,d+i.GPSInfoIFDPointer,a,n)){switch(r){case"GPSVersionID":l[r]=l[r][0]+"."+l[r][1]+"."+l[r][2]+"."+l[r][3]}i[r]=l[r]}return i.thumbnail=function(e,t,n,i){var r=function(e,t,n){var i=e.getUint16(t,!n);return e.getUint32(t+2+12*i,!n)}(e,t+n,i);if(!r)return{};if(r>e.byteLength)return{};var s=m(e,t,t+r,c,i);if(s.Compression)switch(s.Compression){case 6:if(s.JpegIFOffset&&s.JpegIFByteCount){var o=t+s.JpegIFOffset,a=s.JpegIFByteCount;s.blob=new Blob([new Uint8Array(e.buffer,o,a)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",s.Compression)}else 2==s.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return s}(e,d,p,n),i}function b(e){var t={};if(1==e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);t["@attributes"][i.nodeName]=i.nodeValue}}}else if(3==e.nodeType)return e.nodeValue;if(e.hasChildNodes())for(var r=0;r<e.childNodes.length;r++){var s=e.childNodes.item(r),o=s.nodeName;if(null==t[o])t[o]=b(s);else{if(null==t[o].push){var a=t[o];t[o]=[],t[o].push(a)}t[o].push(b(s))}}return t}function _(e){try{var t={};if(e.children.length>0)for(var n=0;n<e.children.length;n++){var i=e.children.item(n),r=i.attributes;for(var s in r){var o=r[s],a=o.nodeName,c=o.nodeValue;void 0!==a&&(t[a]=c)}var u=i.nodeName;if(void 0===t[u])t[u]=b(i);else{if(void 0===t[u].push){var h=t[u];t[u]=[],t[u].push(h)}t[u].push(b(i))}}else t=e.textContent;return t}catch(e){console.log(e.message)}}i.enableXmp=function(){i.isXmpEnabled=!0},i.disableXmp=function(){i.isXmpEnabled=!1},i.getData=function(e,t){return!((self.Image&&e instanceof self.Image||self.HTMLImageElement&&e instanceof self.HTMLImageElement)&&!e.complete)&&(h(e)?t&&t.call(e):l(e,t),!0)},i.getTag=function(e,t){if(h(e))return e.exifdata[t]},i.getIptcTag=function(e,t){if(h(e))return e.iptcdata[t]},i.getAllTags=function(e){if(!h(e))return{};var t,n=e.exifdata,i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},i.getAllIptcTags=function(e){if(!h(e))return{};var t,n=e.iptcdata,i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},i.pretty=function(e){if(!h(e))return"";var t,n=e.exifdata,i="";for(t in n)n.hasOwnProperty(t)&&("object"==typeof n[t]?n[t]instanceof Number?i+=t+" : "+n[t]+" ["+n[t].numerator+"/"+n[t].denominator+"]\r\n":i+=t+" : ["+n[t].length+" values]\r\n":i+=t+" : "+n[t]+"\r\n");return i},i.readFromBinaryFile=function(e){return d(e)},void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}).call(this)},function(e,t,n){var i=n(88),r=n(89);e.exports=r.bind(null,i)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const i=n(90),r=[];for(let e=0;e<256;++e)r[e]=(e+256).toString(16).substr(1);t.timeoutPromise=async function(e,t,n=(()=>{})){let i;const r=await Promise.race([e,new Promise((e,r)=>{i=setTimeout(()=>r(n()),t)})]);return i&&clearTimeout(i),r},t.sleep=async function(e){return new Promise(t=>{setTimeout(()=>t(),e)})},t.octetCompare=function(t,n){const i="string"==typeof t?e.from(t,"utf8"):t,r="string"==typeof n?e.from(n,"utf8"):n;return i.compare(r)},t.uuid=function(){const e=i.randomBytes(16);e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=0;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[15]]].join("")};const s=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(?:Z|((\+|-)([\d|:]*)))?$/;t.reviveData=function(t,n){return n&&"string"==typeof n&&s.test(n)?new Date(n):n&&"object"==typeof n&&"Buffer"===n.type&&Array.isArray(n.data)?e.from(n):n}}).call(this,n(12).Buffer)},function(e,t,n){(function(i){var r;!function(){var s;function o(e){var t,n,i,r="",s=-1;if(e&&e.length)for(i=e.length;(s+=1)<i;)t=e.charCodeAt(s),n=s+1<i?e.charCodeAt(s+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),s+=1),t<=127?r+=String.fromCharCode(t):t<=2047?r+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?r+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(r+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return r}function a(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function u(e,t){for(var n,i=t?"0123456789ABCDEF":"0123456789abcdef",r="",s=0,o=e.length;s<o;s+=1)n=e.charCodeAt(s),r+=i.charAt(n>>>4&15)+i.charAt(15&n);return r}function h(e){var t,n=32*e.length,i="";for(t=0;t<n;t+=8)i+=String.fromCharCode(e[t>>5]>>>24-t%32&255);return i}function l(e){var t,n=32*e.length,i="";for(t=0;t<n;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function d(e){var t,n=8*e.length,i=Array(e.length>>2),r=i.length;for(t=0;t<r;t+=1)i[t]=0;for(t=0;t<n;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function p(e){var t,n=8*e.length,i=Array(e.length>>2),r=i.length;for(t=0;t<r;t+=1)i[t]=0;for(t=0;t<n;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<24-t%32;return i}function f(e,t){var n,i,r,s,o,a,c,u,h=t.length,l=Array();for(s=(a=Array(Math.ceil(e.length/2))).length,n=0;n<s;n+=1)a[n]=e.charCodeAt(2*n)<<8|e.charCodeAt(2*n+1);for(;a.length>0;){for(o=Array(),r=0,n=0;n<a.length;n+=1)r=(r<<16)+a[n],r-=(i=Math.floor(r/h))*h,(o.length>0||i>0)&&(o[o.length]=i);l[l.length]=r,a=o}for(c="",n=l.length-1;n>=0;n--)c+=t.charAt(l[n]);for(u=Math.ceil(8*e.length/(Math.log(t.length)/Math.log(2))),n=c.length;n<u;n+=1)c=t[0]+c;return c}function m(e,t){var n,i,r,s="",o=e.length;for(t=t||"=",n=0;n<o;n+=3)for(r=e.charCodeAt(n)<<16|(n+1<o?e.charCodeAt(n+1)<<8:0)|(n+2<o?e.charCodeAt(n+2):0),i=0;i<4;i+=1)8*n+6*i>8*e.length?s+=t:s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-i)&63);return s}s={VERSION:"1.0.6",Base64:function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="=",n=!0;this.encode=function(i){var r,s,a,c="",u=i.length;for(t=t||"=",i=n?o(i):i,r=0;r<u;r+=3)for(a=i.charCodeAt(r)<<16|(r+1<u?i.charCodeAt(r+1)<<8:0)|(r+2<u?i.charCodeAt(r+2):0),s=0;s<4;s+=1)c+=8*r+6*s>8*u?t:e.charAt(a>>>6*(3-s)&63);return c},this.decode=function(i){var r,s,o,a,c,u,h,l,d="",p=[];if(!i)return i;r=l=0,i=i.replace(new RegExp("\\"+t,"gi"),"");do{s=(h=e.indexOf(i.charAt(r+=1))<<18|e.indexOf(i.charAt(r+=1))<<12|(c=e.indexOf(i.charAt(r+=1)))<<6|(u=e.indexOf(i.charAt(r+=1))))>>16&255,o=h>>8&255,a=255&h,p[l+=1]=64===c?String.fromCharCode(s):64===u?String.fromCharCode(s,o):String.fromCharCode(s,o,a)}while(r<i.length);return d=p.join(""),d=n?function(e){var t,n,i,r,s,o,a=[];if(t=n=i=r=s=0,e&&e.length)for(o=e.length,e+="";t<o;)n+=1,(i=e.charCodeAt(t))<128?(a[n]=String.fromCharCode(i),t+=1):i>191&&i<224?(r=e.charCodeAt(t+1),a[n]=String.fromCharCode((31&i)<<6|63&r),t+=2):(r=e.charCodeAt(t+1),s=e.charCodeAt(t+2),a[n]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&s),t+=3);return a.join("")}(d):d},this.setPad=function(e){return t=e||t,this},this.setTab=function(t){return e=t||e,this},this.setUTF8=function(e){return"boolean"==typeof e&&(n=e),this}},CRC32:function(e){var t,n,i,r=0,s=0;for(e=o(e),t=["00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 ","79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 ","84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F ","63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD ","A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC ","51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 ","B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 ","06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 ","E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 ","12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 ","D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 ","33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 ","CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 ","9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E ","7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D ","806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 ","60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA ","AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 ","5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 ","B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 ","05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 ","F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA ","11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 ","D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F ","30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E ","C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D"].join(""),r^=-1,n=0,i=e.length;n<i;n+=1)s=255&(r^e.charCodeAt(n)),r=r>>>8^"0x"+t.substr(9*s,8);return(-1^r)>>>0},MD5:function(e){var t=!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase,n=e&&"string"==typeof e.pad?e.pad:"=",i=!e||"boolean"!=typeof e.utf8||e.utf8;function r(e){return l(h(d(e=i?o(e):e),8*e.length))}function s(e,t){var n,r,s,a,c;for(e=i?o(e):e,t=i?o(t):t,(n=d(e)).length>16&&(n=h(n,8*e.length)),r=Array(16),s=Array(16),c=0;c<16;c+=1)r[c]=909522486^n[c],s[c]=1549556828^n[c];return a=h(r.concat(d(t)),512+8*t.length),l(h(s.concat(a),640))}function h(e,t){var n,i,r,s,o,c=1732584193,u=-271733879,h=-1732584194,l=271733878;for(e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t,n=0;n<e.length;n+=16)i=c,r=u,s=h,o=l,c=g(c,u,h,l,e[n+0],7,-680876936),l=g(l,c,u,h,e[n+1],12,-389564586),h=g(h,l,c,u,e[n+2],17,606105819),u=g(u,h,l,c,e[n+3],22,-1044525330),c=g(c,u,h,l,e[n+4],7,-176418897),l=g(l,c,u,h,e[n+5],12,1200080426),h=g(h,l,c,u,e[n+6],17,-1473231341),u=g(u,h,l,c,e[n+7],22,-45705983),c=g(c,u,h,l,e[n+8],7,1770035416),l=g(l,c,u,h,e[n+9],12,-1958414417),h=g(h,l,c,u,e[n+10],17,-42063),u=g(u,h,l,c,e[n+11],22,-1990404162),c=g(c,u,h,l,e[n+12],7,1804603682),l=g(l,c,u,h,e[n+13],12,-40341101),h=g(h,l,c,u,e[n+14],17,-1502002290),c=v(c,u=g(u,h,l,c,e[n+15],22,1236535329),h,l,e[n+1],5,-165796510),l=v(l,c,u,h,e[n+6],9,-1069501632),h=v(h,l,c,u,e[n+11],14,643717713),u=v(u,h,l,c,e[n+0],20,-373897302),c=v(c,u,h,l,e[n+5],5,-701558691),l=v(l,c,u,h,e[n+10],9,38016083),h=v(h,l,c,u,e[n+15],14,-660478335),u=v(u,h,l,c,e[n+4],20,-405537848),c=v(c,u,h,l,e[n+9],5,568446438),l=v(l,c,u,h,e[n+14],9,-1019803690),h=v(h,l,c,u,e[n+3],14,-187363961),u=v(u,h,l,c,e[n+8],20,1163531501),c=v(c,u,h,l,e[n+13],5,-1444681467),l=v(l,c,u,h,e[n+2],9,-51403784),h=v(h,l,c,u,e[n+7],14,1735328473),c=y(c,u=v(u,h,l,c,e[n+12],20,-1926607734),h,l,e[n+5],4,-378558),l=y(l,c,u,h,e[n+8],11,-2022574463),h=y(h,l,c,u,e[n+11],16,1839030562),u=y(u,h,l,c,e[n+14],23,-35309556),c=y(c,u,h,l,e[n+1],4,-1530992060),l=y(l,c,u,h,e[n+4],11,1272893353),h=y(h,l,c,u,e[n+7],16,-155497632),u=y(u,h,l,c,e[n+10],23,-1094730640),c=y(c,u,h,l,e[n+13],4,681279174),l=y(l,c,u,h,e[n+0],11,-358537222),h=y(h,l,c,u,e[n+3],16,-722521979),u=y(u,h,l,c,e[n+6],23,76029189),c=y(c,u,h,l,e[n+9],4,-640364487),l=y(l,c,u,h,e[n+12],11,-421815835),h=y(h,l,c,u,e[n+15],16,530742520),c=b(c,u=y(u,h,l,c,e[n+2],23,-995338651),h,l,e[n+0],6,-198630844),l=b(l,c,u,h,e[n+7],10,1126891415),h=b(h,l,c,u,e[n+14],15,-1416354905),u=b(u,h,l,c,e[n+5],21,-57434055),c=b(c,u,h,l,e[n+12],6,1700485571),l=b(l,c,u,h,e[n+3],10,-1894986606),h=b(h,l,c,u,e[n+10],15,-1051523),u=b(u,h,l,c,e[n+1],21,-2054922799),c=b(c,u,h,l,e[n+8],6,1873313359),l=b(l,c,u,h,e[n+15],10,-30611744),h=b(h,l,c,u,e[n+6],15,-1560198380),u=b(u,h,l,c,e[n+13],21,1309151649),c=b(c,u,h,l,e[n+4],6,-145523070),l=b(l,c,u,h,e[n+11],10,-1120210379),h=b(h,l,c,u,e[n+2],15,718787259),u=b(u,h,l,c,e[n+9],21,-343485551),c=a(c,i),u=a(u,r),h=a(h,s),l=a(l,o);return Array(c,u,h,l)}function p(e,t,n,i,r,s){return a(c(a(a(t,e),a(i,s)),r),n)}function g(e,t,n,i,r,s,o){return p(t&n|~t&i,e,t,r,s,o)}function v(e,t,n,i,r,s,o){return p(t&i|n&~i,e,t,r,s,o)}function y(e,t,n,i,r,s,o){return p(t^n^i,e,t,r,s,o)}function b(e,t,n,i,r,s,o){return p(n^(t|~i),e,t,r,s,o)}this.hex=function(e){return u(r(e),t)},this.b64=function(e){return m(r(e),n)},this.any=function(e,t){return f(r(e),t)},this.raw=function(e){return r(e)},this.hex_hmac=function(e,n){return u(s(e,n),t)},this.b64_hmac=function(e,t){return m(s(e,t),n)},this.any_hmac=function(e,t,n){return f(s(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&(t=e),this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(i=e),this}},SHA1:function(e){var t=!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase,n=e&&"string"==typeof e.pad?e.pad:"=",i=!e||"boolean"!=typeof e.utf8||e.utf8;function r(e){return h(l(p(e=i?o(e):e),8*e.length))}function s(e,t){var n,r,s,a,c;for(e=i?o(e):e,t=i?o(t):t,(n=p(e)).length>16&&(n=l(n,8*e.length)),r=Array(16),s=Array(16),a=0;a<16;a+=1)r[a]=909522486^n[a],s[a]=1549556828^n[a];return c=l(r.concat(p(t)),512+8*t.length),h(l(s.concat(c),672))}function l(e,t){var n,i,r,s,o,u,h,l,p=Array(80),f=1732584193,m=-271733879,v=-1732584194,y=271733878,b=-1009589776;for(e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t,n=0;n<e.length;n+=16){for(s=f,o=m,u=v,h=y,l=b,i=0;i<80;i+=1)p[i]=i<16?e[n+i]:c(p[i-3]^p[i-8]^p[i-14]^p[i-16],1),r=a(a(c(f,5),d(i,m,v,y)),a(a(b,p[i]),g(i))),b=y,y=v,v=c(m,30),m=f,f=r;f=a(f,s),m=a(m,o),v=a(v,u),y=a(y,h),b=a(b,l)}return Array(f,m,v,y,b)}function d(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function g(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}this.hex=function(e){return u(r(e),t)},this.b64=function(e){return m(r(e),n)},this.any=function(e,t){return f(r(e),t)},this.raw=function(e){return r(e)},this.hex_hmac=function(e,t){return u(s(e,t))},this.b64_hmac=function(e,t){return m(s(e,t),n)},this.any_hmac=function(e,t,n){return f(s(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&(t=e),this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(i=e),this}},SHA256:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t,n=e&&"string"==typeof e.pad?e.pad:"=",i=!e||"boolean"!=typeof e.utf8||e.utf8;function r(e,t){return h(_(p(e=t?o(e):e),8*e.length))}function s(e,t){e=i?o(e):e,t=i?o(t):t;var n,r=0,s=p(e),a=Array(16),c=Array(16);for(s.length>16&&(s=_(s,8*e.length));r<16;r+=1)a[r]=909522486^s[r],c[r]=1549556828^s[r];return n=_(a.concat(p(t)),512+8*t.length),h(_(c.concat(n),768))}function c(e,t){return e>>>t|e<<32-t}function l(e,t){return e>>>t}function d(e,t,n){return e&t^~e&n}function g(e,t,n){return e&t^e&n^t&n}function v(e){return c(e,2)^c(e,13)^c(e,22)}function y(e){return c(e,6)^c(e,11)^c(e,25)}function b(e){return c(e,7)^c(e,18)^l(e,3)}function _(e,n){var i,r,s,o,u,h,p,f,m,_,w,S,C,E=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],k=new Array(64);for(e[n>>5]|=128<<24-n%32,e[15+(n+64>>9<<4)]=n,m=0;m<e.length;m+=16){for(i=E[0],r=E[1],s=E[2],o=E[3],u=E[4],h=E[5],p=E[6],f=E[7],_=0;_<64;_+=1)k[_]=_<16?e[_+m]:a(a(a(c(C=k[_-2],17)^c(C,19)^l(C,10),k[_-7]),b(k[_-15])),k[_-16]),w=a(a(a(a(f,y(u)),d(u,h,p)),t[_]),k[_]),S=a(v(i),g(i,r,s)),f=p,p=h,h=u,u=a(o,w),o=s,s=r,r=i,i=a(w,S);E[0]=a(i,E[0]),E[1]=a(r,E[1]),E[2]=a(s,E[2]),E[3]=a(o,E[3]),E[4]=a(u,E[4]),E[5]=a(h,E[5]),E[6]=a(p,E[6]),E[7]=a(f,E[7])}return E}this.hex=function(e){return u(r(e,i))},this.b64=function(e){return m(r(e,i),n)},this.any=function(e,t){return f(r(e,i),t)},this.raw=function(e){return r(e,i)},this.hex_hmac=function(e,t){return u(s(e,t))},this.b64_hmac=function(e,t){return m(s(e,t),n)},this.any_hmac=function(e,t,n){return f(s(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(i=e),this},t=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998]},SHA512:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t,n=e&&"string"==typeof e.pad?e.pad:"=",i=!e||"boolean"!=typeof e.utf8||e.utf8;function r(e){return h(a(p(e=i?o(e):e),8*e.length))}function s(e,t){e=i?o(e):e,t=i?o(t):t;var n,r=0,s=p(e),c=Array(32),u=Array(32);for(s.length>32&&(s=a(s,8*e.length));r<32;r+=1)c[r]=909522486^s[r],u[r]=1549556828^s[r];return n=a(c.concat(p(t)),1024+8*t.length),h(a(u.concat(n),1536))}function a(e,n){var i,r,s,o=new Array(80),a=new Array(16),u=[new c(1779033703,-205731576),new c(-1150833019,-2067093701),new c(1013904242,-23791573),new c(-1521486534,1595750129),new c(1359893119,-1377402159),new c(-1694144372,725511199),new c(528734635,-79577749),new c(1541459225,327033209)],h=new c(0,0),p=new c(0,0),f=new c(0,0),m=new c(0,0),w=new c(0,0),S=new c(0,0),C=new c(0,0),E=new c(0,0),k=new c(0,0),x=new c(0,0),I=new c(0,0),O=new c(0,0),j=new c(0,0),T=new c(0,0),R=new c(0,0),A=new c(0,0),P=new c(0,0);for(void 0===t&&(t=[new c(1116352408,-685199838),new c(1899447441,602891725),new c(-1245643825,-330482897),new c(-373957723,-2121671748),new c(961987163,-213338824),new c(1508970993,-1241133031),new c(-1841331548,-1357295717),new c(-1424204075,-630357736),new c(-670586216,-1560083902),new c(310598401,1164996542),new c(607225278,1323610764),new c(1426881987,-704662302),new c(1925078388,-226784913),new c(-2132889090,991336113),new c(-1680079193,633803317),new c(-1046744716,-815192428),new c(-459576895,-1628353838),new c(-272742522,944711139),new c(264347078,-1953704523),new c(604807628,2007800933),new c(770255983,1495990901),new c(1249150122,1856431235),new c(1555081692,-1119749164),new c(1996064986,-2096016459),new c(-1740746414,-295247957),new c(-1473132947,766784016),new c(-1341970488,-1728372417),new c(-1084653625,-1091629340),new c(-958395405,1034457026),new c(-710438585,-1828018395),new c(113926993,-536640913),new c(338241895,168717936),new c(666307205,1188179964),new c(773529912,1546045734),new c(1294757372,1522805485),new c(1396182291,-1651133473),new c(1695183700,-1951439906),new c(1986661051,1014477480),new c(-2117940946,1206759142),new c(-1838011259,344077627),new c(-1564481375,1290863460),new c(-1474664885,-1136513023),new c(-1035236496,-789014639),new c(-949202525,106217008),new c(-778901479,-688958952),new c(-694614492,1432725776),new c(-200395387,1467031594),new c(275423344,851169720),new c(430227734,-1194143544),new c(506948616,1363258195),new c(659060556,-544281703),new c(883997877,-509917016),new c(958139571,-976659869),new c(1322822218,-482243893),new c(1537002063,2003034995),new c(1747873779,-692930397),new c(1955562222,1575990012),new c(2024104815,1125592928),new c(-2067236844,-1578062990),new c(-1933114872,442776044),new c(-1866530822,593698344),new c(-1538233109,-561857047),new c(-1090935817,-1295615723),new c(-965641998,-479046869),new c(-903397682,-366583396),new c(-779700025,566280711),new c(-354779690,-840897762),new c(-176337025,-294727304),new c(116418474,1914138554),new c(174292421,-1563912026),new c(289380356,-1090974290),new c(460393269,320620315),new c(685471733,587496836),new c(852142971,1086792851),new c(1017036298,365543100),new c(1126000580,-1676669620),new c(1288033470,-885112138),new c(1501505948,-60457430),new c(1607167915,987167468),new c(1816402316,1246189591)]),r=0;r<80;r+=1)o[r]=new c(0,0);for(e[n>>5]|=128<<24-(31&n),e[31+(n+128>>10<<5)]=n,s=e.length,r=0;r<s;r+=32){for(l(f,u[0]),l(m,u[1]),l(w,u[2]),l(S,u[3]),l(C,u[4]),l(E,u[5]),l(k,u[6]),l(x,u[7]),i=0;i<16;i+=1)o[i].h=e[r+2*i],o[i].l=e[r+2*i+1];for(i=16;i<80;i+=1)d(R,o[i-2],19),g(A,o[i-2],29),v(P,o[i-2],6),O.l=R.l^A.l^P.l,O.h=R.h^A.h^P.h,d(R,o[i-15],1),d(A,o[i-15],8),v(P,o[i-15],7),I.l=R.l^A.l^P.l,I.h=R.h^A.h^P.h,b(o[i],O,o[i-7],I,o[i-16]);for(i=0;i<80;i+=1)j.l=C.l&E.l^~C.l&k.l,j.h=C.h&E.h^~C.h&k.h,d(R,C,14),d(A,C,18),g(P,C,9),O.l=R.l^A.l^P.l,O.h=R.h^A.h^P.h,d(R,f,28),g(A,f,2),g(P,f,7),I.l=R.l^A.l^P.l,I.h=R.h^A.h^P.h,T.l=f.l&m.l^f.l&w.l^m.l&w.l,T.h=f.h&m.h^f.h&w.h^m.h&w.h,_(h,x,O,j,t[i],o[i]),y(p,I,T),l(x,k),l(k,E),l(E,C),y(C,S,h),l(S,w),l(w,m),l(m,f),y(f,h,p);y(u[0],u[0],f),y(u[1],u[1],m),y(u[2],u[2],w),y(u[3],u[3],S),y(u[4],u[4],C),y(u[5],u[5],E),y(u[6],u[6],k),y(u[7],u[7],x)}for(r=0;r<8;r+=1)a[2*r]=u[r].h,a[2*r+1]=u[r].l;return a}function c(e,t){this.h=e,this.l=t}function l(e,t){e.h=t.h,e.l=t.l}function d(e,t,n){e.l=t.l>>>n|t.h<<32-n,e.h=t.h>>>n|t.l<<32-n}function g(e,t,n){e.l=t.h>>>n|t.l<<32-n,e.h=t.l>>>n|t.h<<32-n}function v(e,t,n){e.l=t.l>>>n|t.h<<32-n,e.h=t.h>>>n}function y(e,t,n){var i=(65535&t.l)+(65535&n.l),r=(t.l>>>16)+(n.l>>>16)+(i>>>16),s=(65535&t.h)+(65535&n.h)+(r>>>16),o=(t.h>>>16)+(n.h>>>16)+(s>>>16);e.l=65535&i|r<<16,e.h=65535&s|o<<16}function b(e,t,n,i,r){var s=(65535&t.l)+(65535&n.l)+(65535&i.l)+(65535&r.l),o=(t.l>>>16)+(n.l>>>16)+(i.l>>>16)+(r.l>>>16)+(s>>>16),a=(65535&t.h)+(65535&n.h)+(65535&i.h)+(65535&r.h)+(o>>>16),c=(t.h>>>16)+(n.h>>>16)+(i.h>>>16)+(r.h>>>16)+(a>>>16);e.l=65535&s|o<<16,e.h=65535&a|c<<16}function _(e,t,n,i,r,s){var o=(65535&t.l)+(65535&n.l)+(65535&i.l)+(65535&r.l)+(65535&s.l),a=(t.l>>>16)+(n.l>>>16)+(i.l>>>16)+(r.l>>>16)+(s.l>>>16)+(o>>>16),c=(65535&t.h)+(65535&n.h)+(65535&i.h)+(65535&r.h)+(65535&s.h)+(a>>>16),u=(t.h>>>16)+(n.h>>>16)+(i.h>>>16)+(r.h>>>16)+(s.h>>>16)+(c>>>16);e.l=65535&o|a<<16,e.h=65535&c|u<<16}this.hex=function(e){return u(r(e))},this.b64=function(e){return m(r(e),n)},this.any=function(e,t){return f(r(e),t)},this.raw=function(e){return r(e)},this.hex_hmac=function(e,t){return u(s(e,t))},this.b64_hmac=function(e,t){return m(s(e,t),n)},this.any_hmac=function(e,t,n){return f(s(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return n=e||n,this},this.setUTF8=function(e){return"boolean"==typeof e&&(i=e),this}},RMD160:function(e){!(!e||"boolean"!=typeof e.uppercase)&&e.uppercase;var t=e&&"string"==typeof e.pad?e.pa:"=",n=!e||"boolean"!=typeof e.utf8||e.utf8,i=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],r=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],h=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function l(e){return g(v(d(e=n?o(e):e),8*e.length))}function p(e,t){e=n?o(e):e,t=n?o(t):t;var i,r,s=d(e),a=Array(16),c=Array(16);for(s.length>16&&(s=v(s,8*e.length)),i=0;i<16;i+=1)a[i]=909522486^s[i],c[i]=1549556828^s[i];return r=v(a.concat(d(t)),512+8*t.length),g(v(c.concat(r),672))}function g(e){var t,n="",i=32*e.length;for(t=0;t<i;t+=8)n+=String.fromCharCode(e[t>>5]>>>t%32&255);return n}function v(e,t){var n,o,u,l,d,p,f,m,g,v,w,S,C,E,k=1732584193,x=4023233417,I=2562383102,O=271733878,j=3285377520;for(e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t,l=e.length,u=0;u<l;u+=16){for(d=v=k,p=w=x,f=S=I,m=C=O,g=E=j,o=0;o<=79;o+=1)n=a(d,y(o,p,f,m)),n=a(n,e[u+i[o]]),n=a(n,b(o)),n=a(c(n,s[o]),g),d=g,g=m,m=c(f,10),f=p,p=n,n=a(v,y(79-o,w,S,C)),n=a(n,e[u+r[o]]),n=a(n,_(o)),n=a(c(n,h[o]),E),v=E,E=C,C=c(S,10),S=w,w=n;n=a(x,a(f,C)),x=a(I,a(m,E)),I=a(O,a(g,v)),O=a(j,a(d,w)),j=a(k,a(p,S)),k=n}return[k,x,I,O,j]}function y(e,t,n,i){return 0<=e&&e<=15?t^n^i:16<=e&&e<=31?t&n|~t&i:32<=e&&e<=47?(t|~n)^i:48<=e&&e<=63?t&i|n&~i:64<=e&&e<=79?t^(n|~i):"rmd160_f: j out of range"}function b(e){return 0<=e&&e<=15?0:16<=e&&e<=31?1518500249:32<=e&&e<=47?1859775393:48<=e&&e<=63?2400959708:64<=e&&e<=79?2840853838:"rmd160_K1: j out of range"}function _(e){return 0<=e&&e<=15?1352829926:16<=e&&e<=31?1548603684:32<=e&&e<=47?1836072691:48<=e&&e<=63?2053994217:64<=e&&e<=79?0:"rmd160_K2: j out of range"}this.hex=function(e){return u(l(e))},this.b64=function(e){return m(l(e),t)},this.any=function(e,t){return f(l(e),t)},this.raw=function(e){return l(e)},this.hex_hmac=function(e,t){return u(p(e,t))},this.b64_hmac=function(e,n){return m(p(e,n),t)},this.any_hmac=function(e,t,n){return f(p(e,t),n)},this.vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"===hex("abc").toLowerCase()},this.setUpperCase=function(e){return"boolean"==typeof e&&e,this},this.setPad=function(e){return void 0!==e&&(t=e),this},this.setUTF8=function(e){return"boolean"==typeof e&&(n=e),this}}},t&&"object"==typeof i&&i&&i.global,void 0===(r=function(){return s}.call(t,n,t,e))||(e.exports=r)}()}).call(this,n(7))},function(e,t,n){"use strict";t.a=function(){return!1}},function(e,t,n){"use strict";(function(e){var i=n(6),r="object"==typeof exports&&exports&&!exports.nodeType&&exports,s=r&&"object"==typeof e&&e&&!e.nodeType&&e,o=s&&s.exports===r?i.a.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.a=function(e,t){if(t)return e.slice();var n=e.length,i=a?a(n):new e.constructor(n);return e.copy(i),i}}).call(this,n(34)(e))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var i=n(67),r=n.n(i),s=n(29);const o=(t,{socketIO:n=s}={})=>new Promise((i,s)=>{const o=new r.a(t),a=n.connect(o.origin,{path:o.pathname,"force new connection":!0,rejectUnauthorized:"0"!==e.env.NODE_TLS_REJECT_UNAUTHORIZED});let c,u;const h=()=>{a.off("connect",c),a.off("disconnect",u),a.off("connect_failed",u)};c=()=>{h(),i(a)},u=()=>{h(),s(new Error("got error while connecting"))},a.on("connect",c),a.on("disconnect",u),a.on("connect_failed",u)})}).call(this,n(14))},function(e,t,n){
/**
 * lite-url - Small, JS lib that uses regex for parsing a URL into it's component parts.
 * @version v1.0.5
 * @link https://github.com/sadams/lite-url
 * @license BSD-3-Clause
 */
(function(){"use strict";function n(e,t,n){var i=e.split(t);return n(i.shift(),i.join(t))}function i(e){var t={hash:"",host:"",hostname:"",origin:"",pathname:"",protocol:"",search:"",password:"",username:"",port:""};return n(e,"#",(function(e,i){i&&(t.hash=i?"#"+i:""),n(e,"?",(function(e,i){i&&(t.search="?"+i),e&&n(e,"//",(function(e,i){t.protocol=e,n(i,"/",(function(e,i){t.pathname="/"+(i||""),(t.protocol||e)&&(t.origin=t.protocol+"//"+e),n(e,"@",(function(e,i){if(i){var r=e.split(":");t.username=r[0],t.password=r[1]}else i=e;t.host=i,n(i,":",(function(e,n){t.hostname=e,n&&(t.port=n)}))}))}))}))}))})),t.href=t.origin+t.pathname+t.search+t.hash,t}function r(e){var t={},n=e.search;if(n){var i=(n=n.replace(new RegExp("\\?"),"")).split("&");for(var r in i)if(i.hasOwnProperty(r)&&i[r]){var s=i[r].split("=");t[s[0]]=s[1]}}return t}function s(e){var t=o[e];return void 0!==t?t:((t=i(e)).params=r(t),o[e]=t,t)}var o={};return s.changeQueryParser=function(e){r=e},e.exports&&(t=e.exports=s),t.liteURL=s,s}).call(this)},function(e,t,n){for(var i=self.crypto||self.msCrypto,r="-_",s=36;s--;)r+=s.toString(36);for(s=36;s---10;)r+=s.toString(36).toUpperCase();e.exports=function(e){var t="",n=i.getRandomValues(new Uint8Array(e||21));for(s=e||21;s--;)t+=r[63&n[s]];return t}},function(e,t,n){"use strict";!function(){var t=0;function n(e,t){t=t||{};var n=this,i=this.socket,r=this.chunkSize,s=(this.transmissionDelay,e.uploadId),o=t.uploadTo||"",a=t.data||{},c={id:s,name:e.name,size:e.size,chunkSize:r,sent:0,data:a};o&&(c.uploadTo=o);var u=new FileReader;u.onloadstart=function(){n.emit("loadstart")},u.onprogress=function(e){n.emit("progress",{loaded:e.loaded,total:e.total})},u.onloadend=function(){var t=u.result;if(n.accepts&&n.accepts.length>0){for(var h=!1,l=0;l<n.accepts.length;l++){var d=n.accepts[l];if(e.type===d){h=!0;break}}if(!h)return n.emit("error",new Error("Not Acceptable file type "+e.type+" of "+e.name+". Type must be one of these: "+n.accepts.join(", ")),{uploadId:c.id,name:c.name,size:c.size,type:e.type,uploadTo:o,data:a})}if(n.maxFileSize&&n.maxFileSize>0&&e.size>+n.maxFileSize)return n.emit("error",new Error("Max Uploading File size must be under "+n.maxFileSize+" byte(s)."),{uploadId:c.id,name:c.name,size:c.size,uploadTo:o,data:a});n.uploadingFiles[s]=c,n.emit("start",{uploadId:c.id,name:c.name,size:c.size,uploadTo:o,data:a}),i.emit("socket.io-file::createFile",c),i.once("socket.io-file::request::"+s,(function e(){if(!c.aborted)if(c.sent>=t.byteLength)i.emit("socket.io-file::done::"+s);else{var u=t.slice(c.sent,c.sent+r);n.emit("stream",{uploadId:c.id,name:c.name,size:c.size,sent:c.sent,uploadTo:o,data:a}),i.once("socket.io-file::request::"+s,e),i.emit("socket.io-file::stream::"+s,u),c.sent+=u.byteLength,n.uploadingFiles[s]=c}})),i.on("socket.io-file::complete::"+s,(function(e){e.uploadId=c.id,e.data=c.data,i.removeAllListeners("socket.io-file::abort::"+s),i.removeAllListeners("socket.io-file::error::"+s),i.removeAllListeners("socket.io-file::complete::"+s),delete n.uploadingFiles[s],n.emit("complete",e)})),i.on("socket.io-file::abort::"+s,(function(e){c.aborted=!0,n.emit("abort",{uploadId:c.id,name:c.name,size:c.size,sent:c.sent,wrote:e.wrote,uploadTo:o,data:a})})),i.on("socket.io-file::error::"+s,(function(e){n.emit("error",new Error(e.message),{uploadId:c.id,name:c.name,size:c.size,uploadTo:o,data:a})}))},u.readAsArrayBuffer(e)}function i(e,n){if(!e)return this.emit("error",new Error("SocketIOFile requires Socket."));this.instanceId=t++,this.uploadId=0,this.ev={},this.options=n||{},this.accepts=[],this.maxFileSize=void 0,this.socket=e,this.uploadingFiles={},this.isDestroyed=!1;var i=this;e.on("socket.io-file::recvSync",(function(e){i.maxFileSize=e.maxFileSize||void 0,i.accepts=e.accepts||[],i.chunkSize=e.chunkSize||10240,i.transmissionDelay=e.transmissionDelay||0,i.emit("ready")})),e.emit("socket.io-file::reqSync"),e.on("socket.io-file::disconnectByServer",(function(){i.emit("disconnected"),i.destroy()}))}i.prototype.getUploadId=function(){return"u_"+this.uploadId++},i.prototype.upload=function(e,t){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");if(!e||e.files&&e.files.length<=0||e.length<=0)return this.emit("error",new Error("No file(s) to upload.")),[];for(var i=[],r=e.files?e.files:e,s=0;s<r.length;s++){var o=r[s],a=this.getUploadId();i.push(a),o.uploadId=a,n.call(this,o,t)}return i},i.prototype.on=function(e,t){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");return this.ev[e]||(this.ev[e]=[]),this.ev[e].push(t),this},i.prototype.off=function(e,t){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");if(void 0===e)this.ev=[];else if(void 0===t)this.ev[e]&&delete this.ev[e];else for(var n=this.ev[e]||[],i=0;i<n.length;i++)if(n[i]===t){n=n.splice(i,1);break}return this},i.prototype.emit=function(e){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");var t=this.ev[e]||[],n=Array.from(arguments);n.splice(0,1);for(var i=0;i<t.length;i++)t[i].apply(null,n);return this},i.prototype.abort=function(e){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");this.socket.emit("socket.io-file::abort::"+e)},i.prototype.destroy=function(){if(this.isDestroyed)throw new Error("SocketIOFileClient is closed.");var e=this.uploadingFiles;for(var t in e)this.abort(t);this.socket=null,this.uploadingFiles=null,this.ev=null,this.isDestroyed=!0},i.prototype.getUploadInfo=function(){return JSON.parse(JSON.stringify(this.uploadingFiles))},e.exports=i}()},,,,function(e,t,n){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,c=o(e),u=1;u<arguments.length;u++){for(var h in n=Object(arguments[u]))r.call(n,h)&&(c[h]=n[h]);if(i){a=i(n);for(var l=0;l<a.length;l++)s.call(n,a[l])&&(c[a[l]]=n[a[l]])}}return c}},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,i=u(e),o=i[0],a=i[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,o,a)),h=0,l=a>0?o-4:o;for(n=0;n<l;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[h++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,s=[],o=0,a=n-r;o<a;o+=16383)s.push(h(e,o,o+16383>a?a:o+16383));1===r?(t=e[n-1],s.push(i[t>>2]+i[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return s.join("")};for(var i=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)i[a]=o[a],r[o.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function h(e,t,n){for(var r,s,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(i[(s=r)>>18&63]+i[s>>12&63]+i[s>>6&63]+i[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?r-1:0,d=n?-1:1,p=e[t+l];for(l+=d,s=p&(1<<-h)-1,p>>=-h,h+=a;h>0;s=256*s+e[t+l],l+=d,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=i;h>0;o=256*o+e[t+l],l+=d,h-=8);if(0===s)s=1-u;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,i),s-=u}return(p?-1:1)*o*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var o,a,c,u=8*s-r-1,h=(1<<u)-1,l=h>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:s-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+l>=1?d/c:d*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=h?(a=0,o=h):o+l>=1?(a=(t*c-1)*Math.pow(2,r),o+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,r),o=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(o=o<<r|a,u+=r;u>0;e[n+p]=255&o,p+=f,o/=256,u-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){},function(e,t,n){"use strict";var i=n(33).Buffer,r=n(82);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t,n,r,s=i.allocUnsafe(e>>>0),o=this.head,a=0;o;)t=o.data,n=s,r=a,t.copy(n,r),a+=o.data.length,o=o.next;return s},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(r.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(r.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(84),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(7))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,r,s,o,a,c=1,u={},h=!1,l=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){f(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},i=function(e){s.port2.postMessage(e)}):l&&"onreadystatechange"in l.createElement("script")?(r=l.documentElement,i=function(e){var t=l.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):i=function(e){setTimeout(f,0,e)}:(o="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&f(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),i=function(t){e.postMessage(o+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return u[c]=r,i(c),c++},d.clearImmediate=p}function p(e){delete u[e]}function f(e){if(h)setTimeout(f,0,e);else{var t=u[e];if(t){h=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),h=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(7),n(14))},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var i=!1;return function(){if(!i){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}}).call(this,n(7))},function(e,t,n){var i=n(12),r=i.Buffer;function s(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(s(i,t),t.Buffer=o),s(r,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"==typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},function(e,t,n){"use strict";e.exports=s;var i=n(46),r=n(23);function s(e){if(!(this instanceof s))return new s(e);i.call(this,e)}r.inherits=n(24),r.inherits(s,i),s.prototype._transform=function(e,t,n){n(null,e)}},function(e,t){var n=self.crypto||self.msCrypto;e.exports=function(e){return n.getRandomValues(new Uint8Array(e))}},function(e,t){e.exports=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*n/t.length),s="";;)for(var o=e(r),a=r;a--;)if((s+=t[o[a]&i]||"").length===+n)return s}},function(e,t,n){"use strict";n.r(t),function(e,i){n.d(t,"Hash",(function(){return s})),n.d(t,"Hmac",(function(){return N})),n.d(t,"WebSocket",(function(){return G})),n.d(t,"createHash",(function(){return M})),n.d(t,"createHmac",(function(){return B})),n.d(t,"fetch",(function(){return z})),n.d(t,"getHashes",(function(){return U})),n.d(t,"randomBytes",(function(){return L}));var r=n(19);class s extends r.Transform{constructor(t,n,i="be"){super(),this._block=e.alloc(t),this._finalSize=n,this._blockSize=t,this._bigEndian="be"===i,this._len=0}_transform(e,t,n){let i=null;try{this.update(e,t)}catch(e){i=e}n(i)}_flush(e){let t=null;try{this.push(this.digest())}catch(e){t=e}e(t)}update(t,n){"string"==typeof t&&(n=n||"utf8",t=e.from(t,n));const i=this._block,r=this._blockSize,s=t.length;let o=this._len;for(let e=0;e<s;){const n=o%r,a=Math.min(s-e,r-n);for(let r=0;r<a;r++)i[n+r]=t[e+r];o+=a,e+=a,o%r==0&&this._update(i)}return this._len+=s,this}digest(e){const t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));const n=8*this._len;if(n<=4294967295)this._bigEndian?(this._block.writeUInt32BE(0,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)):(this._block.writeUInt32LE(n,this._blockSize-8),this._block.writeUInt32LE(0,this._blockSize-4));else{const e=(4294967295&n)>>>0,t=(n-e)/4294967296;this._bigEndian?(this._block.writeUInt32BE(t,this._blockSize-8),this._block.writeUInt32BE(e,this._blockSize-4)):(this._block.writeUInt32LE(e,this._blockSize-8),this._block.writeUInt32LE(t,this._blockSize-4))}this._update(this._block);const i=this._hash();return e?i.toString(e):i}_update(e){throw new Error("_update must be implemented by subclass")}_hash(){throw new Error("_update must be implemented by subclass")}}function o(e,t){return e<<t|e>>>32-t}function a(e,t,n,i,r,s,a){return o(e+(t&n|~t&i)+r+s|0,a)+t|0}function c(e,t,n,i,r,s,a){return o(e+(t&i|n&~i)+r+s|0,a)+t|0}function u(e,t,n,i,r,s,a){return o(e+(t^n^i)+r+s|0,a)+t|0}function h(e,t,n,i,r,s,a){return o(e+(n^(t|~i))+r+s|0,a)+t|0}const l=[1518500249,1859775393,-1894007588,-899497514];function d(e){return e<<5|e>>>27}function p(e){return e<<30|e>>>2}function f(e,t,n,i){return 0===e?t&n|~t&i:2===e?t&n|t&i|n&i:t^n^i}class m extends s{constructor(){super(64,56),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this._w=new Array(80)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<80;++n)t[n]=(c=t[n-3]^t[n-8]^t[n-14]^t[n-16])<<1|c>>>31;var c;for(let e=0;e<80;++e){const n=~~(e/20),c=d(i)+f(n,r,s,o)+a+t[e]+l[n]|0;a=o,o=s,s=p(r),r=i,i=c}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0}_hash(){const t=e.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t}}const g=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function v(e,t,n){return n^e&(t^n)}function y(e,t,n){return e&t|n&(e|t)}function b(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function _(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function w(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}class S extends s{constructor(){super(64,56),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=new Array(64)}_update(e){const t=this._w;let n,i=0|this._a,r=0|this._b,s=0|this._c,o=0|this._d,a=0|this._e,c=0|this._f,u=0|this._g,h=0|this._h;for(n=0;n<16;++n)t[n]=e.readInt32BE(4*n);for(;n<64;++n)t[n]=0|(((l=t[n-2])>>>17|l<<15)^(l>>>19|l<<13)^l>>>10)+t[n-7]+w(t[n-15])+t[n-16];var l;for(let e=0;e<64;++e){const n=h+_(a)+v(a,c,u)+g[e]+t[e]|0,l=b(i)+y(i,r,s)|0;h=u,u=c,c=a,a=o+n|0,o=s,s=r,r=i,i=n+l|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=s+this._c|0,this._d=o+this._d|0,this._e=a+this._e|0,this._f=c+this._f|0,this._g=u+this._g|0,this._h=h+this._h|0}_hash(){const t=e.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t}}const C=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function E(e,t,n){return n^e&(t^n)}function k(e,t,n){return e&t|n&(e|t)}function x(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function I(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function O(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function j(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function T(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function R(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function A(e,t){return e>>>0<t>>>0?1:0}class P extends s{constructor(){super(128,112),this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this._w=new Array(160)}_update(e){const t=this._w;let n,i,r=0|this._ah,s=0|this._bh,o=0|this._ch,a=0|this._dh,c=0|this._eh,u=0|this._fh,h=0|this._gh,l=0|this._hh,d=0|this._al,p=0|this._bl,f=0|this._cl,m=0|this._dl,g=0|this._el,v=0|this._fl,y=0|this._gl,b=0|this._hl,_=0;for(_=0;_<32;_+=2)t[_]=e.readInt32BE(4*_),t[_+1]=e.readInt32BE(4*_+4);for(;_<160;_+=2){let e=t[_-30],r=t[_-30+1];const s=O(e,r),o=j(r,e);e=t[_-4],r=t[_-4+1];const a=T(e,r),c=R(r,e),u=t[_-14],h=t[_-14+1],l=t[_-32],d=t[_-32+1];i=o+h|0,n=s+u+A(i,o)|0,i=i+c|0,n=n+a+A(i,c)|0,i=i+d|0,n=n+l+A(i,d)|0,t[_]=n,t[_+1]=i}for(let e=0;e<160;e+=2){n=t[e],i=t[e+1];const _=k(r,s,o),w=k(d,p,f),S=x(r,d),O=x(d,r),j=I(c,g),T=I(g,c),R=C[e],P=C[e+1],D=E(c,u,h),M=E(g,v,y);let q=b+T|0,N=l+j+A(q,b)|0;q=q+M|0,N=N+D+A(q,M)|0,q=q+P|0,N=N+R+A(q,P)|0,q=q+i|0,N=N+n+A(q,i)|0;const F=O+w|0,L=S+_+A(F,O)|0;l=h,b=y,h=u,y=v,u=c,v=g,g=m+q|0,c=a+N+A(g,m)|0,a=o,m=f,o=s,f=p,s=r,p=d,d=q+F|0,r=N+L+A(d,q)|0}this._al=this._al+d|0,this._bl=this._bl+p|0,this._cl=this._cl+f|0,this._dl=this._dl+m|0,this._el=this._el+g|0,this._fl=this._fl+v|0,this._gl=this._gl+y|0,this._hl=this._hl+b|0,this._ah=this._ah+r+A(this._al,d)|0,this._bh=this._bh+s+A(this._bl,p)|0,this._ch=this._ch+o+A(this._cl,f)|0,this._dh=this._dh+a+A(this._dl,m)|0,this._eh=this._eh+c+A(this._el,g)|0,this._fh=this._fh+u+A(this._fl,v)|0,this._gh=this._gh+h+A(this._gl,y)|0,this._hh=this._hh+l+A(this._hl,b)|0}_hash(){const t=e.allocUnsafe(64);function n(e,n,i){t.writeInt32BE(e,i),t.writeInt32BE(n,i+4)}return n(this._ah,this._al,0),n(this._bh,this._bl,8),n(this._ch,this._cl,16),n(this._dh,this._dl,24),n(this._eh,this._el,32),n(this._fh,this._fl,40),n(this._gh,this._gl,48),n(this._hh,this._hl,56),t}}const D=new Map([["md5",class extends s{constructor(){super(64,56,"le"),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._m=new Array(16)}_update(e){const t=this._m;for(let n=0;n<16;++n)t[n]=e.readInt32LE(4*n);let n=this._a,i=this._b,r=this._c,s=this._d;n=a(n,i,r,s,t[0],3614090360,7),s=a(s,n,i,r,t[1],3905402710,12),r=a(r,s,n,i,t[2],606105819,17),i=a(i,r,s,n,t[3],3250441966,22),n=a(n,i,r,s,t[4],4118548399,7),s=a(s,n,i,r,t[5],1200080426,12),r=a(r,s,n,i,t[6],2821735955,17),i=a(i,r,s,n,t[7],4249261313,22),n=a(n,i,r,s,t[8],1770035416,7),s=a(s,n,i,r,t[9],2336552879,12),r=a(r,s,n,i,t[10],4294925233,17),i=a(i,r,s,n,t[11],2304563134,22),n=a(n,i,r,s,t[12],1804603682,7),s=a(s,n,i,r,t[13],4254626195,12),r=a(r,s,n,i,t[14],2792965006,17),i=a(i,r,s,n,t[15],1236535329,22),n=c(n,i,r,s,t[1],4129170786,5),s=c(s,n,i,r,t[6],3225465664,9),r=c(r,s,n,i,t[11],643717713,14),i=c(i,r,s,n,t[0],3921069994,20),n=c(n,i,r,s,t[5],3593408605,5),s=c(s,n,i,r,t[10],38016083,9),r=c(r,s,n,i,t[15],3634488961,14),i=c(i,r,s,n,t[4],3889429448,20),n=c(n,i,r,s,t[9],568446438,5),s=c(s,n,i,r,t[14],3275163606,9),r=c(r,s,n,i,t[3],4107603335,14),i=c(i,r,s,n,t[8],1163531501,20),n=c(n,i,r,s,t[13],2850285829,5),s=c(s,n,i,r,t[2],4243563512,9),r=c(r,s,n,i,t[7],1735328473,14),i=c(i,r,s,n,t[12],2368359562,20),n=u(n,i,r,s,t[5],4294588738,4),s=u(s,n,i,r,t[8],2272392833,11),r=u(r,s,n,i,t[11],1839030562,16),i=u(i,r,s,n,t[14],4259657740,23),n=u(n,i,r,s,t[1],2763975236,4),s=u(s,n,i,r,t[4],1272893353,11),r=u(r,s,n,i,t[7],4139469664,16),i=u(i,r,s,n,t[10],3200236656,23),n=u(n,i,r,s,t[13],681279174,4),s=u(s,n,i,r,t[0],3936430074,11),r=u(r,s,n,i,t[3],3572445317,16),i=u(i,r,s,n,t[6],76029189,23),n=u(n,i,r,s,t[9],3654602809,4),s=u(s,n,i,r,t[12],3873151461,11),r=u(r,s,n,i,t[15],530742520,16),i=u(i,r,s,n,t[2],3299628645,23),n=h(n,i,r,s,t[0],4096336452,6),s=h(s,n,i,r,t[7],1126891415,10),r=h(r,s,n,i,t[14],2878612391,15),i=h(i,r,s,n,t[5],4237533241,21),n=h(n,i,r,s,t[12],1700485571,6),s=h(s,n,i,r,t[3],2399980690,10),r=h(r,s,n,i,t[10],4293915773,15),i=h(i,r,s,n,t[1],2240044497,21),n=h(n,i,r,s,t[8],1873313359,6),s=h(s,n,i,r,t[15],4264355552,10),r=h(r,s,n,i,t[6],2734768916,15),i=h(i,r,s,n,t[13],1309151649,21),n=h(n,i,r,s,t[4],4149444226,6),s=h(s,n,i,r,t[11],3174756917,10),r=h(r,s,n,i,t[2],718787259,15),i=h(i,r,s,n,t[9],3951481745,21),this._a=this._a+n|0,this._b=this._b+i|0,this._c=this._c+r|0,this._d=this._d+s|0}_hash(){const t=e.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t}}],["sha-1",m],["sha-256",S],["sha-512",P],["sha1",m],["sha256",S],["sha512",P]]);function M(e){e=e.toLowerCase();const t=D.get(e);if(t)return new t;throw new Error("Unsupported hash algorithm: "+e)}const q=e.alloc(128);class N extends r.Transform{constructor(t,n){super(),"string"==typeof n&&(n=e.from(n));const i="sha512"===t?128:64;this._alg=t,n.length>i?n=M(t).update(n).digest():n.length<i&&(n=e.concat([n,q],i)),this._ipad=e.alloc(i),this._opad=e.alloc(i);for(let e=0;e<i;e++)this._ipad[e]=54^n[e],this._opad[e]=92^n[e];this._hash=M(t).update(this._ipad)}_transform(e,t,n){let i;try{this.update(e,t)}catch(e){i=e}finally{n(i)}}_flush(e){let t;try{this.push(this._final())}catch(e){t=e}e(t)}_final(){const e=this._hash.digest();return M(this._alg).update(this._opad).update(e).digest()}update(e,t){return this._hash.update(e,t),this}digest(t){const n=this._final()||e.alloc(0);return t?n.toString(t):n}}let F;function L(t){const n=new Uint8Array(t);return t>0&&(F.crypto||F.msCrypto).getRandomValues(n),e.from(n.buffer)}function U(){return["sha-1","sha-256","sha-512","md5"]}function B(e,t){return new N(e.toLowerCase(),t)}"undefined"!=typeof window?F=window:void 0!==i&&(F=i);const z=fetch,G=WebSocket}.call(this,n(12).Buffer,n(7))},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){var i=n(47),r=n(15)("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(r("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),r("parse %s",e),n=i(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port,n.href=n.protocol+"://"+s+(t&&t.port===n.port?"":":"+n.port),n}},function(e,t,n){e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return i.colors[Math.abs(t)%i.colors.length]}function i(e){let n;function o(...e){if(!o.enabled)return;const t=o,r=Number(new Date),s=r-(n||r);t.diff=s,t.prev=n,t.curr=r,n=r,e[0]=i.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,r)=>{if("%%"===n)return n;a++;const s=i.formatters[r];if("function"==typeof s){const i=e[a];n=s.call(t,i),e.splice(a,1),a--}return n}),i.formatArgs.call(t,e),(t.log||i.log).apply(t,e)}return o.namespace=e,o.enabled=i.enabled(e),o.useColors=i.useColors(),o.color=t(e),o.destroy=r,o.extend=s,"function"==typeof i.init&&i.init(o),i.instances.push(o),o}function r(){const e=i.instances.indexOf(this);return-1!==e&&(i.instances.splice(e,1),!0)}function s(e,t){const n=i(this.namespace+(void 0===t?":":t)+e);return n.log=this.log,n}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},i.disable=function(){const e=[...i.names.map(o),...i.skips.map(o).map(e=>"-"+e)].join(",");return i.enable(""),e},i.enable=function(e){let t;i.save(e),i.names=[],i.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?i.skips.push(new RegExp("^"+e.substr(1)+"$")):i.names.push(new RegExp("^"+e+"$")));for(t=0;t<i.instances.length;t++){const e=i.instances[t];e.enabled=i.enabled(e.namespace)}},i.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=i.skips.length;t<n;t++)if(i.skips[t].test(e))return!1;for(t=0,n=i.names.length;t<n;t++)if(i.names[t].test(e))return!0;return!1},i.humanize=n(94),Object.keys(e).forEach(t=>{i[t]=e[t]}),i.instances=[],i.names=[],i.skips=[],i.formatters={},i.selectColor=t,i.enable(i.load()),i}},function(e,t){var n=1e3,i=6e4,r=36e5,s=24*r;function o(e,t,n,i){var r=t>=1.5*n;return Math.round(e/n)+" "+i+(r?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*i;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return o(e,t,s,"day");if(t>=r)return o(e,t,r,"hour");if(t>=i)return o(e,t,i,"minute");if(t>=n)return o(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=r)return Math.round(e/r)+"h";if(t>=i)return Math.round(e/i)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(i){function r(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG),e}(t=e.exports=n(96)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var i="color: "+this.color;e.splice(1,0,i,"color: inherit");var r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(s=r))})),e.splice(s,0,i)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=r,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(r())}).call(this,n(14))},function(e,t,n){function i(e){var n;function i(){if(i.enabled){var e=i,r=+new Date,s=r-(n||r);e.diff=s,e.prev=n,e.curr=r,n=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(n,i){if("%%"===n)return n;c++;var r=t.formatters[i];if("function"==typeof r){var s=o[c];n=r.call(e,s),o.splice(c,1),c--}return n})),t.formatArgs.call(e,o);var u=i.log||t.log||console.log.bind(console);u.apply(e,o)}}return i.namespace=e,i.enabled=t.enabled(e),i.useColors=t.useColors(),i.color=function(e){var n,i=0;for(n in e)i=(i<<5)-i+e.charCodeAt(n),i|=0;return t.colors[Math.abs(i)%t.colors.length]}(e),i.destroy=r,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var i=("string"==typeof e?e:"").split(/[\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&("-"===(e=i[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var s=t.instances[n];s.enabled=t.enabled(s.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,i;for(n=0,i=t.skips.length;n<i;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;n<i;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(97),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,i=6e4,r=36e5,s=24*r;function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var a,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*i;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?o(a=e,s,"day")||o(a,r,"hour")||o(a,i,"minute")||o(a,n,"second")||a+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=r)return Math.round(e/r)+"h";if(e>=i)return Math.round(e/i)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){var i=n(48),r=n(49),s=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===s.call(Blob),a="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===s.call(File);t.deconstructPacket=function(e){var t=[],n=e.data,s=e;return s.data=function e(t,n){if(!t)return t;if(r(t)){var s={_placeholder:!0,num:n.length};return n.push(t),s}if(i(t)){for(var o=new Array(t.length),a=0;a<t.length;a++)o[a]=e(t[a],n);return o}if("object"==typeof t&&!(t instanceof Date)){o={};for(var c in t)o[c]=e(t[c],n);return o}return t}(n,t),s.attachments=t.length,{packet:s,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(i(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var s in t)t[s]=e(t[s],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,s=e;!function e(c,u,h){if(!c)return c;if(o&&c instanceof Blob||a&&c instanceof File){n++;var l=new FileReader;l.onload=function(){h?h[u]=this.result:s=this.result,--n||t(s)},l.readAsArrayBuffer(c)}else if(i(c))for(var d=0;d<c.length;d++)e(c[d],d,c);else if("object"==typeof c&&!r(c))for(var p in c)e(c[p],p,c)}(s),n||t(s)}},function(e,t,n){e.exports=n(100),e.exports.parser=n(22)},function(e,t,n){var i=n(51),r=n(21),s=n(15)("engine.io-client:socket"),o=n(55),a=n(22),c=n(47),u=n(26);function h(e,t){if(!(this instanceof h))return new h(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=c(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=c(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=u.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=h,h.priorWebsocketSuccess=!1,r(h.prototype),h.protocol=a.protocol,h.Socket=h,h.Transport=n(37),h.transports=n(51),h.parser=n(22),h.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new i[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},h.prototype.probe=function(e){s('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,i=this;function r(){if(i.onlyBinaryUpgrades){var r=!this.supportsBinary&&i.transport.supportsBinary;n=n||r}n||(s('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(r){if(!n)if("pong"===r.type&&"probe"===r.data){if(s('probe transport "%s" pong',e),i.upgrading=!0,i.emit("upgrading",t),!t)return;h.priorWebsocketSuccess="websocket"===t.name,s('pausing current transport "%s"',i.transport.name),i.transport.pause((function(){n||"closed"!==i.readyState&&(s("changing transport and sending upgrade packet"),d(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())}))}else{s('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,i.emit("upgradeError",o)}})))}function o(){n||(n=!0,d(),t.close(),t=null)}function a(n){var r=new Error("probe error: "+n);r.transport=t.name,o(),s('probe transport "%s" failed because of error: %s',e,n),i.emit("upgradeError",r)}function c(){a("transport closed")}function u(){a("socket closed")}function l(e){t&&e.name!==t.name&&(s('"%s" works - aborting "%s"',e.name,t.name),o())}function d(){t.removeListener("open",r),t.removeListener("error",a),t.removeListener("close",c),i.removeListener("close",u),i.removeListener("upgrading",l)}h.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",a),t.once("close",c),this.once("close",u),this.once("upgrading",l),t.open()},h.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else s('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},h.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},h.prototype.sendPacket=function(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?i():t()})):this.upgrading?i():t()}function t(){e.onClose("forced close"),s("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function i(){e.once("upgrade",n),e.once("upgradeError",n)}return this},h.prototype.onError=function(e){s("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){s('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;n<i;n++)~o(this.transports,e[n])&&t.push(e[n]);return t}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){var i=n(36),r=n(52),s=n(21),o=n(27),a=n(15)("engine.io-client:polling-xhr");function c(){}function u(e){if(r.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function h(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(e.exports=u,e.exports.Request=h,o(u,r),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new h(e)},u.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,i=this.request({method:"POST",data:e,isBinary:n}),r=this;i.on("success",t),i.on("error",(function(e){r.onError("xhr post error",e)})),this.sendXhr=i},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},s(h.prototype),h.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new i(e),n=this;try{a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof t.status?t.status:0)}),0))},a("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},h.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},h.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},h.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",d);else if("function"==typeof addEventListener){var l="onpagehide"in self?"pagehide":"unload";addEventListener(l,d,!1)}function d(){for(var e in h.requests)h.requests.hasOwnProperty(e)&&h.requests[e].abort()}},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var i in e)n.call(e,i)&&t.push(i);return t}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e,t,n){var i=e.byteLength;if(t=t||0,n=n||i,e.slice)return e.slice(t,n);if(t<0&&(t+=i),n<0&&(n+=i),n>i&&(n=i),t>=i||t>=n||0===i)return new ArrayBuffer(0);for(var r=new Uint8Array(e),s=new Uint8Array(n-t),o=t,a=0;o<n;o++,a++)s[a]=r[o];return s.buffer}},function(e,t){function n(){}e.exports=function(e,t,i){var r=!1;return i=i||n,s.count=e,0===e?t():s;function s(e,n){if(s.count<=0)throw new Error("after called too many times");--s.count,e?(r=!0,t(e),t=i):0!==s.count||r||t(null,n)}}},function(e,t){
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var n,i,r,s=String.fromCharCode;function o(e){for(var t,n,i=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function a(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return s(e>>t&63|128)}function u(e,t){if(0==(4294967168&e))return s(e);var n="";return 0==(4294965248&e)?n=s(e>>6&31|192):0==(4294901760&e)?(a(e,t)||(e=65533),n=s(e>>12&15|224),n+=c(e,6)):0==(4292870144&e)&&(n=s(e>>18&7|240),n+=c(e,12),n+=c(e,6)),n+=s(63&e|128)}function h(){if(r>=i)throw Error("Invalid byte index");var e=255&n[r];if(r++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function l(e){var t,s;if(r>i)throw Error("Invalid byte index");if(r==i)return!1;if(t=255&n[r],r++,0==(128&t))return t;if(192==(224&t)){if((s=(31&t)<<6|h())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&t)){if((s=(15&t)<<12|h()<<6|h())>=2048)return a(s,e)?s:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(s=(7&t)<<18|h()<<12|h()<<6|h())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,i=o(e),r=i.length,s=-1,a="";++s<r;)a+=u(i[s],n);return a},decode:function(e,t){var a=!1!==(t=t||{}).strict;n=o(e),i=n.length,r=0;for(var c,u=[];!1!==(c=l(a));)u.push(c);return function(e){for(var t,n=e.length,i=-1,r="";++i<n;)(t=e[i])>65535&&(r+=s((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=s(t);return r}(u)}}},function(e,t){var n=void 0!==n?n:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,i=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),r=i&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;function o(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function a(e,t){t=t||{};var i=new n;return o(e).forEach((function(e){i.append(e)})),t.type?i.getBlob(t.type):i.getBlob()}function c(e,t){return new Blob(o(e),t||{})}"undefined"!=typeof Blob&&(a.prototype=Blob.prototype,c.prototype=Blob.prototype),e.exports=i?r?Blob:c:s?a:void 0},function(e,t,n){(function(t){var i=n(52),r=n(27);e.exports=h;var s,o=/\n/g,a=/\\n/g;function c(){}function u(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function h(e){if(i.call(this,e),this.query=this.query||{},!s){var t=u();s=t.___eio=t.___eio||[]}this.index=s.length;var n=this;s.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=c)}),!1)}r(h,i),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},h.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},h.prototype.doWrite=function(e,t){var n=this;if(!this.form){var i,r=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=c,r.method="POST",r.setAttribute("accept-charset","utf-8"),s.name="d",r.appendChild(s),document.body.appendChild(r),this.form=r,this.area=s}function u(){h(),t()}function h(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';i=document.createElement(e)}catch(e){(i=document.createElement("iframe")).name=n.iframeId,i.src="javascript:0"}i.id=n.iframeId,n.form.appendChild(i),n.iframe=i}this.form.action=this.uri(),h(),e=e.replace(a,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,n(7))},function(e,t,n){(function(t){var i,r,s=n(37),o=n(22),a=n(26),c=n(27),u=n(54),h=n(15)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?i=WebSocket:"undefined"!=typeof self&&(i=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{r=n(111)}catch(e){}var l=i||r;function d(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=i&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=r),s.call(this,e)}e.exports=d,c(d,s),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new l(e,t):new l(e):new l(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},d.prototype.write=function(e){var n=this;this.writable=!1;for(var i=e.length,r=0,s=i;r<s;r++)!function(e){o.encodePacket(e,n.supportsBinary,(function(r){if(!n.usingBrowserWebSocket){var s={};if(e.options&&(s.compress=e.options.compress),n.perMessageDeflate)("string"==typeof r?t.byteLength(r):r.length)<n.perMessageDeflate.threshold&&(s.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(r):n.ws.send(r,s)}catch(e){h("websocket closed before onclose event")}--i||a()}))}(e[r]);function a(){n.emit("flush"),setTimeout((function(){n.writable=!0,n.emit("drain")}),0)}},d.prototype.onClose=function(){s.prototype.onClose.call(this)},d.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},d.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=u()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},d.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===d.prototype.name)}}).call(this,n(12).Buffer)},function(e,t){},function(e,t){e.exports=function(e,t){for(var n=[],i=(t=t||0)||0;i<e.length;i++)n[i-t]=e[i];return n}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var s=function(e){function t(){return e.call(this,1)||this}return r(t,e),t}(n(59).default);t.Lock=s},function(e,t,n){"use strict";n.r(t);var i={};function r(e,t,n,i,r,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(e){r(o,i,s,a,c,"next",e)}function c(e){r(o,i,s,a,c,"throw",e)}a(void 0)}))}}n.r(i),n.d(i,"STREAM_ADDED",(function(){return tl})),n.d(i,"STREAM_REMOVED",(function(){return nl})),n.d(i,"ConferenceMediaFeed",(function(){return ol}));var o="25.1.2";class a{constructor(){this.executionQueue=[],this.executing=!1}queue(e,t){var n=this._addToExecutionQueue({cb:e,type:t});return this.executing||this._startExecution(),n}_addToExecutionQueue(e){return new Promise((t,n)=>{e.resolve=t,e.reject=n,this.executionQueue.push(e)})}_startExecution(){return this.executing=!0,this._decideKeepExecuting()}_decideKeepExecuting(){return this.executionQueue.length>0?this._executeNextFunction().then(()=>this._decideKeepExecuting()):this._endExecution()}_endExecution(){return Promise.resolve().then(()=>{this.executing=!1})}_executeNextFunction(){var e=this.executionQueue.pop(),t=this._getSameTypePromises(e.type);return this._cleanExecutionQueue(e.type),e.cb().then(n=>{e.resolve(n),((e,t)=>{e.forEach(e=>e.resolve(t))})(t,n)}).catch(n=>{e.reject(n),((e,t)=>{e.forEach(e=>e.reject(t))})(t,n)})}_cleanExecutionQueue(e){this._rejectDifferentTypePromises(e),this.executionQueue=[]}_getSameTypePromises(e){return this.executionQueue.filter(t=>t.type===e)}_rejectDifferentTypePromises(e){return this.executionQueue.filter(t=>t.type!==e).map(e=>{e.reject(Error("Unable to call this function because there are more priority ones"))})}}function c(e,t,n=!0){t.forEach(t=>{e[t]=n?function(...n){return n.push(this),Object.getPrototypeOf(e)[t].apply(e,n)}:Object.getPrototypeOf(e)[t].bind(e)})}function u(...e){if(!(this instanceof u))return new u(...e);(1===e.length&&Array.isArray(e[0])?e[0]:e).forEach(e=>{var t=Symbol(e);this[e]=t,this[t]=e}),Object.freeze(this)}function h(){return!(!window.cordova||!window.device.uuid)}function l(){return window.cordova?window.device.uuid:null}var d=n(60),p=n.n(d),f=n(38);var m=/^data:([A-Za-z-+/]+);base64,(.+)$/;function g(e,t=128,n=128){var i,r;return window?new Promise(t=>{if(!function(e){return!!m.test(e)}(e))return t();[,i,r]=e.match(m);var n=p.a.readFromBinaryFile(Object(f.decode)(r));return n?t(n.Orientation):t()}).then(t=>{return t?(n=e,i=t,r=new Image,new Promise(e=>{r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d");switch(i>4&&i<9?(t.width=this.height,t.height=this.width):(t.width=this.width,t.height=this.height),i){case 2:n.transform(-1,0,0,1,this.width,0);break;case 3:n.transform(-1,0,0,-1,this.width,this.height);break;case 4:n.transform(1,0,0,-1,0,this.height);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,this.height,0);break;case 7:n.transform(0,-1,-1,0,this.height,this.width);break;case 8:n.transform(0,-1,1,0,0,this.width)}n.drawImage(r,0,0,this.width,this.height);var s=n.canvas.toDataURL("image/png");r=null,t=null,e(s)},r.src=n})):e;var n,i,r}).then(e=>function(e,t,n){return new Promise(i=>{window||i(e);var r=new Image;r.onload=function(){var e=document.createElement("canvas");e.width=Math.min(this.width,t),e.height=Math.min(this.height,n);var s=0,o=0,a=this.width,c=this.width,u=Math.min(this.width,t),h=Math.min(this.height,n);this.height>this.width?o=(this.height-this.width)/2:this.height<this.width&&(s=(this.width-this.height)/2,a=c=this.height),e.getContext("2d").drawImage(this,s,o,a,c,0,0,u,h);var l=e.toDataURL("image/png");r=null,e=null,i(l)},r.src=e})}(e,t,n)):e}var v="sippo.storage.";function y(e){return JSON.parse(localStorage.getItem(v+e))}function b(e,t){localStorage.setItem(v+e,JSON.stringify(t))}function _(e){localStorage.removeItem(v+e)}var w=new u(["UNCONNECTED","CONNECTING","CONNECTED","SUSPENDED","DISCONNECTED"]);function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var E=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";S(this,t);var n=C(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(n,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(n,"name",{configurable:!0,enumerable:!1,value:n.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(n,n.constructor),C(n)):(Object.defineProperty(n,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(function(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error));class k extends E{}class x extends E{}class I extends E{}class O extends E{}class j extends E{}class T extends E{}var R={};function A(e){e&&(e.value=!0)}function P(){}function D(e){return void 0===e.size&&(e.size=e.__iterate(q)),e.size}function M(e,t){if("number"!=typeof t){var n=t>>>0;if(""+n!==t||4294967295===n)return NaN;t=n}return t<0?D(e)+t:t}function q(){return!0}function N(e,t,n){return(0===e&&!B(e)||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function F(e,t){return U(e,t,0)}function L(e,t){return U(e,t,t)}function U(e,t,n){return void 0===e?n:B(e)?t===1/0?t:0|Math.max(0,t+e):void 0===t||t===e?e:0|Math.min(t,e)}function B(e){return e<0||0===e&&1/e==-1/0}function z(e){return Boolean(e&&e["@@__IMMUTABLE_ITERABLE__@@"])}function G(e){return Boolean(e&&e["@@__IMMUTABLE_KEYED__@@"])}function W(e){return Boolean(e&&e["@@__IMMUTABLE_INDEXED__@@"])}function H(e){return G(e)||W(e)}var V=function(e){return z(e)?e:de(e)},$=function(e){function t(e){return G(e)?e:pe(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(V),J=function(e){function t(e){return W(e)?e:fe(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(V),Y=function(e){function t(e){return z(e)&&!H(e)?e:me(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(V);V.Keyed=$,V.Indexed=J,V.Set=Y;function Q(e){return Boolean(e&&e["@@__IMMUTABLE_SEQ__@@"])}function K(e){return Boolean(e&&e["@@__IMMUTABLE_RECORD__@@"])}function X(e){return z(e)||K(e)}var Z="@@__IMMUTABLE_ORDERED__@@";function ee(e){return Boolean(e&&e[Z])}var te="function"==typeof Symbol&&Symbol.iterator,ne=te||"@@iterator",ie=function(e){this.next=e};function re(e,t,n,i){var r=0===e?t:1===e?n:[t,n];return i?i.value=r:i={value:r,done:!1},i}function se(){return{value:void 0,done:!0}}function oe(e){return!!ue(e)}function ae(e){return e&&"function"==typeof e.next}function ce(e){var t=ue(e);return t&&t.call(e)}function ue(e){var t=e&&(te&&e[te]||e["@@iterator"]);if("function"==typeof t)return t}ie.prototype.toString=function(){return"[Iterator]"},ie.KEYS=0,ie.VALUES=1,ie.ENTRIES=2,ie.prototype.inspect=ie.prototype.toSource=function(){return this.toString()},ie.prototype[ne]=function(){return this};var he=Object.prototype.hasOwnProperty;function le(e){return!(!Array.isArray(e)&&"string"!=typeof e)||e&&"object"==typeof e&&Number.isInteger(e.length)&&e.length>=0&&(0===e.length?1===Object.keys(e).length:e.hasOwnProperty(e.length-1))}var de=function(e){function t(e){return null==e?_e():X(e)?e.toSeq():function(e){var t=Ce(e);if(t)return t;if("object"==typeof e)return new ve(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(e,t){var n=this._cache;if(n){for(var i=n.length,r=0;r!==i;){var s=n[t?i-++r:r++];if(!1===e(s[1],s[0],this))break}return r}return this.__iterateUncached(e,t)},t.prototype.__iterator=function(e,t){var n=this._cache;if(n){var i=n.length,r=0;return new ie((function(){if(r===i)return{value:void 0,done:!0};var s=n[t?i-++r:r++];return re(e,s[0],s[1])}))}return this.__iteratorUncached(e,t)},t}(V),pe=function(e){function t(e){return null==e?_e().toKeyedSeq():z(e)?G(e)?e.toSeq():e.fromEntrySeq():K(e)?e.toSeq():we(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(de),fe=function(e){function t(e){return null==e?_e():z(e)?G(e)?e.entrySeq():e.toIndexedSeq():K(e)?e.toSeq().entrySeq():Se(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(de),me=function(e){function t(e){return(z(e)&&!H(e)?e:fe(e)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(de);de.isSeq=Q,de.Keyed=pe,de.Set=me,de.Indexed=fe,de.prototype["@@__IMMUTABLE_SEQ__@@"]=!0;var ge=function(e){function t(e){this._array=e,this.size=e.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this.has(e)?this._array[M(this,e)]:t},t.prototype.__iterate=function(e,t){for(var n=this._array,i=n.length,r=0;r!==i;){var s=t?i-++r:r++;if(!1===e(n[s],s,this))break}return r},t.prototype.__iterator=function(e,t){var n=this._array,i=n.length,r=0;return new ie((function(){if(r===i)return{value:void 0,done:!0};var s=t?i-++r:r++;return re(e,s,n[s])}))},t}(fe),ve=function(e){function t(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},t.prototype.has=function(e){return he.call(this._object,e)},t.prototype.__iterate=function(e,t){for(var n=this._object,i=this._keys,r=i.length,s=0;s!==r;){var o=i[t?r-++s:s++];if(!1===e(n[o],o,this))break}return s},t.prototype.__iterator=function(e,t){var n=this._object,i=this._keys,r=i.length,s=0;return new ie((function(){if(s===r)return{value:void 0,done:!0};var o=i[t?r-++s:s++];return re(e,o,n[o])}))},t}(pe);ve.prototype[Z]=!0;var ye,be=function(e){function t(e){this._collection=e,this.size=e.length||e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var n=ce(this._collection),i=0;if(ae(n))for(var r;!(r=n.next()).done&&!1!==e(r.value,i++,this););return i},t.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var n=ce(this._collection);if(!ae(n))return new ie(se);var i=0;return new ie((function(){var t=n.next();return t.done?t:re(e,i++,t.value)}))},t}(fe);function _e(){return ye||(ye=new ge([]))}function we(e){var t=Array.isArray(e)?new ge(e):oe(e)?new be(e):void 0;if(t)return t.fromEntrySeq();if("object"==typeof e)return new ve(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function Se(e){var t=Ce(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function Ce(e){return le(e)?new ge(e):oe(e)?new be(e):void 0}function Ee(e){return Boolean(e&&e["@@__IMMUTABLE_MAP__@@"])}function ke(e){return Ee(e)&&ee(e)}function xe(e){return Boolean(e&&"function"==typeof e.equals&&"function"==typeof e.hashCode)}function Ie(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!!(xe(e)&&xe(t)&&e.equals(t))}var Oe="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var n=65535&(e|=0),i=65535&(t|=0);return n*i+((e>>>16)*i+n*(t>>>16)<<16>>>0)|0};function je(e){return e>>>1&1073741824|3221225471&e}var Te=Object.prototype.valueOf;function Re(e){switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return function(e){if(e!=e||e===1/0)return 0;var t=0|e;t!==e&&(t^=4294967295*e);for(;e>4294967295;)t^=e/=4294967295;return je(t)}(e);case"string":return e.length>Le?function(e){var t=ze[e];void 0===t&&(t=Ae(e),Be===Ue&&(Be=0,ze={}),Be++,ze[e]=t);return t}(e):Ae(e);case"object":case"function":return null===e?1108378658:"function"==typeof e.hashCode?je(e.hashCode(e)):(e.valueOf!==Te&&"function"==typeof e.valueOf&&(e=e.valueOf(e)),function(e){var t;if(qe&&void 0!==(t=Me.get(e)))return t;if(void 0!==(t=e[Fe]))return t;if(!De){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Fe]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}t=++Ne,1073741824&Ne&&(Ne=0);if(qe)Me.set(e,t);else{if(void 0!==Pe&&!1===Pe(e))throw new Error("Non-extensible objects are not allowed as keys.");if(De)Object.defineProperty(e,Fe,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Fe]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Fe]=t}}return t}(e));case"undefined":return 1108378659;default:if("function"==typeof e.toString)return Ae(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function Ae(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return je(t)}var Pe=Object.isExtensible,De=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}();var Me,qe="function"==typeof WeakMap;qe&&(Me=new WeakMap);var Ne=0,Fe="__immutablehash__";"function"==typeof Symbol&&(Fe=Symbol(Fe));var Le=16,Ue=255,Be=0,ze={},Ge=function(e){function t(e,t){this._iter=e,this._useKeys=t,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this._iter.get(e,t)},t.prototype.has=function(e){return this._iter.has(e)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var e=this,t=Ye(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},t.prototype.map=function(e,t){var n=this,i=Je(this,e,t);return this._useKeys||(i.valueSeq=function(){return n._iter.toSeq().map(e,t)}),i},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate((function(t,i){return e(t,i,n)}),t)},t.prototype.__iterator=function(e,t){return this._iter.__iterator(e,t)},t}(pe);Ge.prototype[Z]=!0;var We=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this,i=0;return t&&D(this),this._iter.__iterate((function(r){return e(r,t?n.size-++i:i++,n)}),t)},t.prototype.__iterator=function(e,t){var n=this,i=this._iter.__iterator(1,t),r=0;return t&&D(this),new ie((function(){var s=i.next();return s.done?s:re(e,t?n.size-++r:r++,s.value,s)}))},t}(fe),He=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate((function(t){return e(t,t,n)}),t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(1,t);return new ie((function(){var t=n.next();return t.done?t:re(e,t.value,t.value,t)}))},t}(me),Ve=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(e,t){var n=this;return this._iter.__iterate((function(t){if(t){ot(t);var i=z(t);return e(i?t.get(1):t[1],i?t.get(0):t[0],n)}}),t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(1,t);return new ie((function(){for(;;){var t=n.next();if(t.done)return t;var i=t.value;if(i){ot(i);var r=z(i);return re(e,r?i.get(0):i[0],r?i.get(1):i[1],t)}}}))},t}(pe);function $e(e){var t=ct(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=ut,t.__iterateUncached=function(t,n){var i=this;return e.__iterate((function(e,n){return!1!==t(n,e,i)}),n)},t.__iteratorUncached=function(t,n){if(2===t){var i=e.__iterator(t,n);return new ie((function(){var e=i.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e}))}return e.__iterator(1===t?0:1,n)},t}function Je(e,t,n){var i=ct(e);return i.size=e.size,i.has=function(t){return e.has(t)},i.get=function(i,r){var s=e.get(i,R);return s===R?r:t.call(n,s,i,e)},i.__iterateUncached=function(i,r){var s=this;return e.__iterate((function(e,r,o){return!1!==i(t.call(n,e,r,o),r,s)}),r)},i.__iteratorUncached=function(i,r){var s=e.__iterator(2,r);return new ie((function(){var r=s.next();if(r.done)return r;var o=r.value,a=o[0];return re(i,a,t.call(n,o[1],a,e),r)}))},i}function Ye(e,t){var n=this,i=ct(e);return i._iter=e,i.size=e.size,i.reverse=function(){return e},e.flip&&(i.flip=function(){var t=$e(e);return t.reverse=function(){return e.flip()},t}),i.get=function(n,i){return e.get(t?n:-1-n,i)},i.has=function(n){return e.has(t?n:-1-n)},i.includes=function(t){return e.includes(t)},i.cacheResult=ut,i.__iterate=function(n,i){var r=this,s=0;return i&&D(e),e.__iterate((function(e,o){return n(e,t?o:i?r.size-++s:s++,r)}),!i)},i.__iterator=function(i,r){var s=0;r&&D(e);var o=e.__iterator(2,!r);return new ie((function(){var e=o.next();if(e.done)return e;var a=e.value;return re(i,t?a[0]:r?n.size-++s:s++,a[1],e)}))},i}function Qe(e,t,n,i){var r=ct(e);return i&&(r.has=function(i){var r=e.get(i,R);return r!==R&&!!t.call(n,r,i,e)},r.get=function(i,r){var s=e.get(i,R);return s!==R&&t.call(n,s,i,e)?s:r}),r.__iterateUncached=function(r,s){var o=this,a=0;return e.__iterate((function(e,s,c){if(t.call(n,e,s,c))return a++,r(e,i?s:a-1,o)}),s),a},r.__iteratorUncached=function(r,s){var o=e.__iterator(2,s),a=0;return new ie((function(){for(;;){var s=o.next();if(s.done)return s;var c=s.value,u=c[0],h=c[1];if(t.call(n,h,u,e))return re(r,i?u:a++,h,s)}}))},r}function Ke(e,t,n,i){var r=e.size;if(N(t,n,r))return e;var s=F(t,r),o=L(n,r);if(s!=s||o!=o)return Ke(e.toSeq().cacheResult(),t,n,i);var a,c=o-s;c==c&&(a=c<0?0:c);var u=ct(e);return u.size=0===a?a:e.size&&a||void 0,!i&&Q(e)&&a>=0&&(u.get=function(t,n){return(t=M(this,t))>=0&&t<a?e.get(t+s,n):n}),u.__iterateUncached=function(t,n){var r=this;if(0===a)return 0;if(n)return this.cacheResult().__iterate(t,n);var o=0,c=!0,u=0;return e.__iterate((function(e,n){if(!c||!(c=o++<s))return u++,!1!==t(e,i?n:u-1,r)&&u!==a})),u},u.__iteratorUncached=function(t,n){if(0!==a&&n)return this.cacheResult().__iterator(t,n);if(0===a)return new ie(se);var r=e.__iterator(t,n),o=0,c=0;return new ie((function(){for(;o++<s;)r.next();if(++c>a)return{value:void 0,done:!0};var e=r.next();return i||1===t||e.done?e:re(t,c-1,0===t?void 0:e.value[1],e)}))},u}function Xe(e,t,n,i){var r=ct(e);return r.__iterateUncached=function(r,s){var o=this;if(s)return this.cacheResult().__iterate(r,s);var a=!0,c=0;return e.__iterate((function(e,s,u){if(!a||!(a=t.call(n,e,s,u)))return c++,r(e,i?s:c-1,o)})),c},r.__iteratorUncached=function(r,s){var o=this;if(s)return this.cacheResult().__iterator(r,s);var a=e.__iterator(2,s),c=!0,u=0;return new ie((function(){var e,s,h;do{if((e=a.next()).done)return i||1===r?e:re(r,u++,0===r?void 0:e.value[1],e);var l=e.value;s=l[0],h=l[1],c&&(c=t.call(n,h,s,o))}while(c);return 2===r?e:re(r,s,h,e)}))},r}function Ze(e,t){var n=G(e),i=[e].concat(t).map((function(e){return z(e)?n&&(e=$(e)):e=n?we(e):Se(Array.isArray(e)?e:[e]),e})).filter((function(e){return 0!==e.size}));if(0===i.length)return e;if(1===i.length){var r=i[0];if(r===e||n&&G(r)||W(e)&&W(r))return r}var s=new ge(i);return n?s=s.toKeyedSeq():W(e)||(s=s.toSetSeq()),(s=s.flatten(!0)).size=i.reduce((function(e,t){if(void 0!==e){var n=t.size;if(void 0!==n)return e+n}}),0),s}function et(e,t,n){var i=ct(e);return i.__iterateUncached=function(r,s){if(s)return this.cacheResult().__iterate(r,s);var o=0,a=!1;return function e(c,u){c.__iterate((function(s,c){return(!t||u<t)&&z(s)?e(s,u+1):(o++,!1===r(s,n?c:o-1,i)&&(a=!0)),!a}),s)}(e,0),o},i.__iteratorUncached=function(i,r){if(r)return this.cacheResult().__iterator(i,r);var s=e.__iterator(i,r),o=[],a=0;return new ie((function(){for(;s;){var e=s.next();if(!1===e.done){var c=e.value;if(2===i&&(c=c[1]),t&&!(o.length<t)||!z(c))return n?e:re(i,a++,c,e);o.push(s),s=c.__iterator(i,r)}else s=o.pop()}return{value:void 0,done:!0}}))},i}function tt(e,t,n){t||(t=ht);var i=G(e),r=0,s=e.toSeq().map((function(t,i){return[i,t,r++,n?n(t,i,e):t]})).valueSeq().toArray();return s.sort((function(e,n){return t(e[3],n[3])||e[2]-n[2]})).forEach(i?function(e,t){s[t].length=2}:function(e,t){s[t]=e[1]}),i?pe(s):W(e)?fe(s):me(s)}function nt(e,t,n){if(t||(t=ht),n){var i=e.toSeq().map((function(t,i){return[t,n(t,i,e)]})).reduce((function(e,n){return it(t,e[1],n[1])?n:e}));return i&&i[0]}return e.reduce((function(e,n){return it(t,e,n)?n:e}))}function it(e,t,n){var i=e(n,t);return 0===i&&n!==t&&(null==n||n!=n)||i>0}function rt(e,t,n,i){var r=ct(e),s=new ge(n).map((function(e){return e.size}));return r.size=i?s.max():s.min(),r.__iterate=function(e,t){for(var n,i=this.__iterator(1,t),r=0;!(n=i.next()).done&&!1!==e(n.value,r++,this););return r},r.__iteratorUncached=function(e,r){var s=n.map((function(e){return e=V(e),ce(r?e.reverse():e)})),o=0,a=!1;return new ie((function(){var n;return a||(n=s.map((function(e){return e.next()})),a=i?n.every((function(e){return e.done})):n.some((function(e){return e.done}))),a?{value:void 0,done:!0}:re(e,o++,t.apply(null,n.map((function(e){return e.value}))))}))},r}function st(e,t){return e===t?e:Q(e)?t:e.constructor(t)}function ot(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function at(e){return G(e)?$:W(e)?J:Y}function ct(e){return Object.create((G(e)?pe:W(e)?fe:me).prototype)}function ut(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):de.prototype.cacheResult.call(this)}function ht(e,t){return void 0===e&&void 0===t?0:void 0===e?1:void 0===t?-1:e>t?1:e<t?-1:0}function lt(e,t){t=t||0;for(var n=Math.max(0,e.length-t),i=new Array(n),r=0;r<n;r++)i[r]=e[r+t];return i}function dt(e,t){if(!e)throw new Error(t)}function pt(e){dt(e!==1/0,"Cannot perform this action with an infinite size.")}function ft(e){if(le(e)&&"string"!=typeof e)return e;if(ee(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}function mt(e){return e&&("function"!=typeof e.constructor||"Object"===e.constructor.name)}function gt(e){return"object"==typeof e&&(X(e)||Array.isArray(e)||mt(e))}function vt(e){try{return"string"==typeof e?JSON.stringify(e):String(e)}catch(t){return JSON.stringify(e)}}function yt(e,t){return X(e)?e.has(t):gt(e)&&he.call(e,t)}function bt(e,t,n){return X(e)?e.get(t,n):yt(e,t)?"function"==typeof e.get?e.get(t):e[t]:n}function _t(e){if(Array.isArray(e))return lt(e);var t={};for(var n in e)he.call(e,n)&&(t[n]=e[n]);return t}function wt(e,t){if(!gt(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(X(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!he.call(e,t))return e;var n=_t(e);return Array.isArray(n)?n.splice(t,1):delete n[t],n}function St(e,t,n){if(!gt(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(X(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,n)}if(he.call(e,t)&&n===e[t])return e;var i=_t(e);return i[t]=n,i}function Ct(e,t,n,i){i||(i=n,n=void 0);var r=function e(t,n,i,r,s,o){var a=n===R;if(r===i.length){var c=a?s:n,u=o(c);return u===c?n:u}if(!a&&!gt(n))throw new TypeError("Cannot update within non-data-structure value in path ["+i.slice(0,r).map(vt)+"]: "+n);var h=i[r],l=a?R:bt(n,h,R),d=e(l===R?t:X(l),l,i,r+1,s,o);return d===l?n:d===R?wt(n,h):St(a?t?nn():{}:n,h,d)}(X(e),e,ft(t),0,n,i);return r===R?n:r}function Et(e,t,n){return Ct(e,t,R,(function(){return n}))}function kt(e,t){return Et(this,e,t)}function xt(e,t){return Ct(e,t,(function(){return R}))}function It(e){return xt(this,e)}function Ot(e,t,n,i){return Ct(e,[t],n,i)}function jt(e,t,n){return 1===arguments.length?e(this):Ot(this,e,t,n)}function Tt(e,t,n){return Ct(this,e,t,n)}function Rt(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Pt(this,e)}function At(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if("function"!=typeof e)throw new TypeError("Invalid merger function: "+e);return Pt(this,t,e)}function Pt(e,t,n){for(var i=[],r=0;r<t.length;r++){var s=$(t[r]);0!==s.size&&i.push(s)}return 0===i.length?e:0!==e.toSeq().size||e.__ownerID||1!==i.length?e.withMutations((function(e){for(var t=n?function(t,i){Ot(e,i,R,(function(e){return e===R?t:n(e,t,i)}))}:function(t,n){e.set(n,t)},r=0;r<i.length;r++)i[r].forEach(t)})):e.constructor(i[0])}function Dt(e,t,n){return Mt(e,t,function(e){return function t(n,i,r){return gt(n)&&gt(i)?Mt(n,[i],t):e?e(n,i,r):i}}(n))}function Mt(e,t,n){if(!gt(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(X(e))return"function"==typeof n&&e.mergeWith?e.mergeWith.apply(e,[n].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var i=Array.isArray(e),r=e,s=i?J:$,o=i?function(t){r===e&&(r=_t(r)),r.push(t)}:function(t,i){var s=he.call(r,i),o=s&&n?n(r[i],t,i):t;s&&o===r[i]||(r===e&&(r=_t(r)),r[i]=o)},a=0;a<t.length;a++)s(t[a]).forEach(o);return r}function qt(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Dt(this,e)}function Nt(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return Dt(this,t,e)}function Ft(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return Ct(this,e,nn(),(function(e){return Mt(e,t)}))}function Lt(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return Ct(this,e,nn(),(function(e){return Dt(e,t)}))}function Ut(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function Bt(){return this.__ownerID?this:this.__ensureOwner(new P)}function zt(){return this.__ensureOwner()}function Gt(){return this.__altered}We.prototype.cacheResult=Ge.prototype.cacheResult=He.prototype.cacheResult=Ve.prototype.cacheResult=ut;var Wt=function(e){function t(t){return null==t?nn():Ee(t)&&!ee(t)?t:nn().withMutations((function(n){var i=e(t);pt(i.size),i.forEach((function(e,t){return n.set(t,e)}))}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return nn().withMutations((function(t){for(var n=0;n<e.length;n+=2){if(n+1>=e.length)throw new Error("Missing value for key: "+e[n]);t.set(e[n],e[n+1])}}))},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},t.prototype.set=function(e,t){return rn(this,e,t)},t.prototype.remove=function(e){return rn(this,e,R)},t.prototype.deleteAll=function(e){var t=V(e);return 0===t.size?this:this.withMutations((function(e){t.forEach((function(t){return e.remove(t)}))}))},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):nn()},t.prototype.sort=function(e){return On(tt(this,e))},t.prototype.sortBy=function(e,t){return On(tt(this,t,e))},t.prototype.map=function(e,t){return this.withMutations((function(n){n.forEach((function(i,r){n.set(r,e.call(t,i,r,n))}))}))},t.prototype.__iterator=function(e,t){return new Xt(this,e,t)},t.prototype.__iterate=function(e,t){var n=this,i=0;return this._root&&this._root.iterate((function(t){return i++,e(t[1],t[0],n)}),t),i},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?tn(this.size,this._root,e,this.__hash):0===this.size?nn():(this.__ownerID=e,this.__altered=!1,this)},t}($);Wt.isMap=Ee;var Ht=Wt.prototype;Ht["@@__IMMUTABLE_MAP__@@"]=!0,Ht.delete=Ht.remove,Ht.removeAll=Ht.deleteAll,Ht.setIn=kt,Ht.removeIn=Ht.deleteIn=It,Ht.update=jt,Ht.updateIn=Tt,Ht.merge=Ht.concat=Rt,Ht.mergeWith=At,Ht.mergeDeep=qt,Ht.mergeDeepWith=Nt,Ht.mergeIn=Ft,Ht.mergeDeepIn=Lt,Ht.withMutations=Ut,Ht.wasAltered=Gt,Ht.asImmutable=zt,Ht["@@transducer/init"]=Ht.asMutable=Bt,Ht["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])},Ht["@@transducer/result"]=function(e){return e.asImmutable()};var Vt=function(e,t){this.ownerID=e,this.entries=t};Vt.prototype.get=function(e,t,n,i){for(var r=this.entries,s=0,o=r.length;s<o;s++)if(Ie(n,r[s][0]))return r[s][1];return i},Vt.prototype.update=function(e,t,n,i,r,s,o){for(var a=r===R,c=this.entries,u=0,h=c.length;u<h&&!Ie(i,c[u][0]);u++);var l=u<h;if(l?c[u][1]===r:a)return this;if(A(o),(a||!l)&&A(s),!a||1!==c.length){if(!l&&!a&&c.length>=hn)return function(e,t,n,i){e||(e=new P);for(var r=new Qt(e,Re(n),[n,i]),s=0;s<t.length;s++){var o=t[s];r=r.update(e,0,void 0,o[0],o[1])}return r}(e,c,i,r);var d=e&&e===this.ownerID,p=d?c:lt(c);return l?a?u===h-1?p.pop():p[u]=p.pop():p[u]=[i,r]:p.push([i,r]),d?(this.entries=p,this):new Vt(e,p)}};var $t=function(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n};$t.prototype.get=function(e,t,n,i){void 0===t&&(t=Re(n));var r=1<<(31&(0===e?t:t>>>e)),s=this.bitmap;return 0==(s&r)?i:this.nodes[cn(s&r-1)].get(e+5,t,n,i)},$t.prototype.update=function(e,t,n,i,r,s,o){void 0===n&&(n=Re(i));var a=31&(0===t?n:n>>>t),c=1<<a,u=this.bitmap,h=0!=(u&c);if(!h&&r===R)return this;var l=cn(u&c-1),d=this.nodes,p=h?d[l]:void 0,f=sn(p,e,t+5,n,i,r,s,o);if(f===p)return this;if(!h&&f&&d.length>=ln)return function(e,t,n,i,r){for(var s=0,o=new Array(32),a=0;0!==n;a++,n>>>=1)o[a]=1&n?t[s++]:void 0;return o[i]=r,new Jt(e,s+1,o)}(e,d,u,a,f);if(h&&!f&&2===d.length&&on(d[1^l]))return d[1^l];if(h&&f&&1===d.length&&on(f))return f;var m=e&&e===this.ownerID,g=h?f?u:u^c:u|c,v=h?f?un(d,l,f,m):function(e,t,n){var i=e.length-1;if(n&&t===i)return e.pop(),e;for(var r=new Array(i),s=0,o=0;o<i;o++)o===t&&(s=1),r[o]=e[o+s];return r}(d,l,m):function(e,t,n,i){var r=e.length+1;if(i&&t+1===r)return e[t]=n,e;for(var s=new Array(r),o=0,a=0;a<r;a++)a===t?(s[a]=n,o=-1):s[a]=e[a+o];return s}(d,l,f,m);return m?(this.bitmap=g,this.nodes=v,this):new $t(e,g,v)};var Jt=function(e,t,n){this.ownerID=e,this.count=t,this.nodes=n};Jt.prototype.get=function(e,t,n,i){void 0===t&&(t=Re(n));var r=31&(0===e?t:t>>>e),s=this.nodes[r];return s?s.get(e+5,t,n,i):i},Jt.prototype.update=function(e,t,n,i,r,s,o){void 0===n&&(n=Re(i));var a=31&(0===t?n:n>>>t),c=r===R,u=this.nodes,h=u[a];if(c&&!h)return this;var l=sn(h,e,t+5,n,i,r,s,o);if(l===h)return this;var d=this.count;if(h){if(!l&&--d<dn)return function(e,t,n,i){for(var r=0,s=0,o=new Array(n),a=0,c=1,u=t.length;a<u;a++,c<<=1){var h=t[a];void 0!==h&&a!==i&&(r|=c,o[s++]=h)}return new $t(e,r,o)}(e,u,d,a)}else d++;var p=e&&e===this.ownerID,f=un(u,a,l,p);return p?(this.count=d,this.nodes=f,this):new Jt(e,d,f)};var Yt=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n};Yt.prototype.get=function(e,t,n,i){for(var r=this.entries,s=0,o=r.length;s<o;s++)if(Ie(n,r[s][0]))return r[s][1];return i},Yt.prototype.update=function(e,t,n,i,r,s,o){void 0===n&&(n=Re(i));var a=r===R;if(n!==this.keyHash)return a?this:(A(o),A(s),an(this,e,t,n,[i,r]));for(var c=this.entries,u=0,h=c.length;u<h&&!Ie(i,c[u][0]);u++);var l=u<h;if(l?c[u][1]===r:a)return this;if(A(o),(a||!l)&&A(s),a&&2===h)return new Qt(e,this.keyHash,c[1^u]);var d=e&&e===this.ownerID,p=d?c:lt(c);return l?a?u===h-1?p.pop():p[u]=p.pop():p[u]=[i,r]:p.push([i,r]),d?(this.entries=p,this):new Yt(e,this.keyHash,p)};var Qt=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n};Qt.prototype.get=function(e,t,n,i){return Ie(n,this.entry[0])?this.entry[1]:i},Qt.prototype.update=function(e,t,n,i,r,s,o){var a=r===R,c=Ie(i,this.entry[0]);return(c?r===this.entry[1]:a)?this:(A(o),a?void A(s):c?e&&e===this.ownerID?(this.entry[1]=r,this):new Qt(e,this.keyHash,[i,r]):(A(s),an(this,e,t,Re(i),[i,r])))},Vt.prototype.iterate=Yt.prototype.iterate=function(e,t){for(var n=this.entries,i=0,r=n.length-1;i<=r;i++)if(!1===e(n[t?r-i:i]))return!1},$t.prototype.iterate=Jt.prototype.iterate=function(e,t){for(var n=this.nodes,i=0,r=n.length-1;i<=r;i++){var s=n[t?r-i:i];if(s&&!1===s.iterate(e,t))return!1}},Qt.prototype.iterate=function(e,t){return e(this.entry)};var Kt,Xt=function(e){function t(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&en(e._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n=t.node,i=t.index++,r=void 0;if(n.entry){if(0===i)return Zt(e,n.entry)}else if(n.entries){if(i<=(r=n.entries.length-1))return Zt(e,n.entries[this._reverse?r-i:i])}else if(i<=(r=n.nodes.length-1)){var s=n.nodes[this._reverse?r-i:i];if(s){if(s.entry)return Zt(e,s.entry);t=this._stack=en(s,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}},t}(ie);function Zt(e,t){return re(e,t[0],t[1])}function en(e,t){return{node:e,index:0,__prev:t}}function tn(e,t,n,i){var r=Object.create(Ht);return r.size=e,r._root=t,r.__ownerID=n,r.__hash=i,r.__altered=!1,r}function nn(){return Kt||(Kt=tn(0))}function rn(e,t,n){var i,r;if(e._root){var s={value:!1},o={value:!1};if(i=sn(e._root,e.__ownerID,0,void 0,t,n,s,o),!o.value)return e;r=e.size+(s.value?n===R?-1:1:0)}else{if(n===R)return e;r=1,i=new Vt(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=r,e._root=i,e.__hash=void 0,e.__altered=!0,e):i?tn(r,i):nn()}function sn(e,t,n,i,r,s,o,a){return e?e.update(t,n,i,r,s,o,a):s===R?e:(A(a),A(o),new Qt(t,i,[r,s]))}function on(e){return e.constructor===Qt||e.constructor===Yt}function an(e,t,n,i,r){if(e.keyHash===i)return new Yt(t,i,[e.entry,r]);var s,o=31&(0===n?e.keyHash:e.keyHash>>>n),a=31&(0===n?i:i>>>n),c=o===a?[an(e,t,n+5,i,r)]:(s=new Qt(t,i,r),o<a?[e,s]:[s,e]);return new $t(t,1<<o|1<<a,c)}function cn(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function un(e,t,n,i){var r=i?e:lt(e);return r[t]=n,r}var hn=8,ln=16,dn=8;function pn(e){return Boolean(e&&e["@@__IMMUTABLE_LIST__@@"])}var fn=function(e){function t(t){var n=wn();if(null==t)return n;if(pn(t))return t;var i=e(t),r=i.size;return 0===r?n:(pt(r),r>0&&r<32?_n(0,r,5,null,new gn(i.toArray())):n.withMutations((function(e){e.setSize(r),i.forEach((function(t,n){return e.set(n,t)}))})))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(e,t){if((e=M(this,e))>=0&&e<this.size){var n=En(this,e+=this._origin);return n&&n.array[31&e]}return t},t.prototype.set=function(e,t){return function(e,t,n){if((t=M(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations((function(e){t<0?kn(e,t).set(0,n):kn(e,0,t+1).set(t,n)}));t+=e._origin;var i=e._tail,r=e._root,s={value:!1};t>=xn(e._capacity)?i=Sn(i,e.__ownerID,0,t,n,s):r=Sn(r,e.__ownerID,e._level,t,n,s);if(!s.value)return e;if(e.__ownerID)return e._root=r,e._tail=i,e.__hash=void 0,e.__altered=!0,e;return _n(e._origin,e._capacity,e._level,r,i)}(this,e,t)},t.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},t.prototype.insert=function(e,t){return this.splice(e,0,t)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=5,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):wn()},t.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations((function(n){kn(n,0,t+e.length);for(var i=0;i<e.length;i++)n.set(t+i,e[i])}))},t.prototype.pop=function(){return kn(this,0,-1)},t.prototype.unshift=function(){var e=arguments;return this.withMutations((function(t){kn(t,-e.length);for(var n=0;n<e.length;n++)t.set(n,e[n])}))},t.prototype.shift=function(){return kn(this,1)},t.prototype.concat=function(){for(var t=arguments,n=[],i=0;i<arguments.length;i++){var r=t[i],s=e("string"!=typeof r&&oe(r)?r:[r]);0!==s.size&&n.push(s)}return 0===n.length?this:0!==this.size||this.__ownerID||1!==n.length?this.withMutations((function(e){n.forEach((function(t){return t.forEach((function(t){return e.push(t)}))}))})):this.constructor(n[0])},t.prototype.setSize=function(e){return kn(this,0,e)},t.prototype.map=function(e,t){var n=this;return this.withMutations((function(i){for(var r=0;r<n.size;r++)i.set(r,e.call(t,i.get(r),r,i))}))},t.prototype.slice=function(e,t){var n=this.size;return N(e,t,n)?this:kn(this,F(e,n),L(t,n))},t.prototype.__iterator=function(e,t){var n=t?this.size:0,i=bn(this,t);return new ie((function(){var r=i();return r===yn?{value:void 0,done:!0}:re(e,t?--n:n++,r)}))},t.prototype.__iterate=function(e,t){for(var n,i=t?this.size:0,r=bn(this,t);(n=r())!==yn&&!1!==e(n,t?--i:i++,this););return i},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?_n(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):0===this.size?wn():(this.__ownerID=e,this.__altered=!1,this)},t}(J);fn.isList=pn;var mn=fn.prototype;mn["@@__IMMUTABLE_LIST__@@"]=!0,mn.delete=mn.remove,mn.merge=mn.concat,mn.setIn=kt,mn.deleteIn=mn.removeIn=It,mn.update=jt,mn.updateIn=Tt,mn.mergeIn=Ft,mn.mergeDeepIn=Lt,mn.withMutations=Ut,mn.wasAltered=Gt,mn.asImmutable=zt,mn["@@transducer/init"]=mn.asMutable=Bt,mn["@@transducer/step"]=function(e,t){return e.push(t)},mn["@@transducer/result"]=function(e){return e.asImmutable()};var gn=function(e,t){this.array=e,this.ownerID=t};gn.prototype.removeBefore=function(e,t,n){if(n===t?1<<t:0===this.array.length)return this;var i=n>>>t&31;if(i>=this.array.length)return new gn([],e);var r,s=0===i;if(t>0){var o=this.array[i];if((r=o&&o.removeBefore(e,t-5,n))===o&&s)return this}if(s&&!r)return this;var a=Cn(this,e);if(!s)for(var c=0;c<i;c++)a.array[c]=void 0;return r&&(a.array[i]=r),a},gn.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t:0)||0===this.array.length)return this;var i,r=n-1>>>t&31;if(r>=this.array.length)return this;if(t>0){var s=this.array[r];if((i=s&&s.removeAfter(e,t-5,n))===s&&r===this.array.length-1)return this}var o=Cn(this,e);return o.array.splice(r+1),i&&(o.array[r]=i),o};var vn,yn={};function bn(e,t){var n=e._origin,i=e._capacity,r=xn(i),s=e._tail;return o(e._root,e._level,0);function o(e,a,c){return 0===a?function(e,o){var a=o===r?s&&s.array:e&&e.array,c=o>n?0:n-o,u=i-o;u>32&&(u=32);return function(){if(c===u)return yn;var e=t?--u:c++;return a&&a[e]}}(e,c):function(e,r,s){var a,c=e&&e.array,u=s>n?0:n-s>>r,h=1+(i-s>>r);h>32&&(h=32);return function(){for(;;){if(a){var e=a();if(e!==yn)return e;a=null}if(u===h)return yn;var n=t?--h:u++;a=o(c&&c[n],r-5,s+(n<<r))}}}(e,a,c)}}function _n(e,t,n,i,r,s,o){var a=Object.create(mn);return a.size=t-e,a._origin=e,a._capacity=t,a._level=n,a._root=i,a._tail=r,a.__ownerID=s,a.__hash=o,a.__altered=!1,a}function wn(){return vn||(vn=_n(0,0,5))}function Sn(e,t,n,i,r,s){var o,a=i>>>n&31,c=e&&a<e.array.length;if(!c&&void 0===r)return e;if(n>0){var u=e&&e.array[a],h=Sn(u,t,n-5,i,r,s);return h===u?e:((o=Cn(e,t)).array[a]=h,o)}return c&&e.array[a]===r?e:(s&&A(s),o=Cn(e,t),void 0===r&&a===o.array.length-1?o.array.pop():o.array[a]=r,o)}function Cn(e,t){return t&&e&&t===e.ownerID?e:new gn(e?e.array.slice():[],t)}function En(e,t){if(t>=xn(e._capacity))return e._tail;if(t<1<<e._level+5){for(var n=e._root,i=e._level;n&&i>0;)n=n.array[t>>>i&31],i-=5;return n}}function kn(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0);var i=e.__ownerID||new P,r=e._origin,s=e._capacity,o=r+t,a=void 0===n?s:n<0?s+n:r+n;if(o===r&&a===s)return e;if(o>=a)return e.clear();for(var c=e._level,u=e._root,h=0;o+h<0;)u=new gn(u&&u.array.length?[void 0,u]:[],i),h+=1<<(c+=5);h&&(o+=h,r+=h,a+=h,s+=h);for(var l=xn(s),d=xn(a);d>=1<<c+5;)u=new gn(u&&u.array.length?[u]:[],i),c+=5;var p=e._tail,f=d<l?En(e,a-1):d>l?new gn([],i):p;if(p&&d>l&&o<s&&p.array.length){for(var m=u=Cn(u,i),g=c;g>5;g-=5){var v=l>>>g&31;m=m.array[v]=Cn(m.array[v],i)}m.array[l>>>5&31]=p}if(a<s&&(f=f&&f.removeAfter(i,0,a)),o>=d)o-=d,a-=d,c=5,u=null,f=f&&f.removeBefore(i,0,o);else if(o>r||d<l){for(h=0;u;){var y=o>>>c&31;if(y!==d>>>c&31)break;y&&(h+=(1<<c)*y),c-=5,u=u.array[y]}u&&o>r&&(u=u.removeBefore(i,c,o-h)),u&&d<l&&(u=u.removeAfter(i,c,d-h)),h&&(o-=h,a-=h)}return e.__ownerID?(e.size=a-o,e._origin=o,e._capacity=a,e._level=c,e._root=u,e._tail=f,e.__hash=void 0,e.__altered=!0,e):_n(o,a,c,u,f)}function xn(e){return e<32?0:e-1>>>5<<5}var In,On=function(e){function t(e){return null==e?Tn():ke(e)?e:Tn().withMutations((function(t){var n=$(e);pt(n.size),n.forEach((function(e,n){return t.set(n,e)}))}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(e,t){var n=this._map.get(e);return void 0!==n?this._list.get(n)[1]:t},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Tn()},t.prototype.set=function(e,t){return Rn(this,e,t)},t.prototype.remove=function(e){return Rn(this,e,R)},t.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},t.prototype.__iterate=function(e,t){var n=this;return this._list.__iterate((function(t){return t&&e(t[1],t[0],n)}),t)},t.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e);return e?jn(t,n,e,this.__hash):0===this.size?Tn():(this.__ownerID=e,this._map=t,this._list=n,this)},t}(Wt);function jn(e,t,n,i){var r=Object.create(On.prototype);return r.size=e?e.size:0,r._map=e,r._list=t,r.__ownerID=n,r.__hash=i,r}function Tn(){return In||(In=jn(nn(),wn()))}function Rn(e,t,n){var i,r,s=e._map,o=e._list,a=s.get(t),c=void 0!==a;if(n===R){if(!c)return e;o.size>=32&&o.size>=2*s.size?(i=(r=o.filter((function(e,t){return void 0!==e&&a!==t}))).toKeyedSeq().map((function(e){return e[0]})).flip().toMap(),e.__ownerID&&(i.__ownerID=r.__ownerID=e.__ownerID)):(i=s.remove(t),r=a===o.size-1?o.pop():o.set(a,void 0))}else if(c){if(n===o.get(a)[1])return e;i=s,r=o.set(a,[t,n])}else i=s.set(t,o.size),r=o.set(o.size,[t,n]);return e.__ownerID?(e.size=i.size,e._map=i,e._list=r,e.__hash=void 0,e):jn(i,r)}On.isOrderedMap=ke,On.prototype[Z]=!0,On.prototype.delete=On.prototype.remove;function An(e){return Boolean(e&&e["@@__IMMUTABLE_STACK__@@"])}var Pn=function(e){function t(e){return null==e?Nn():An(e)?e:Nn().pushAll(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(e,t){var n=this._head;for(e=M(this,e);n&&e--;)n=n.next;return n?n.value:t},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var e=arguments;if(0===arguments.length)return this;for(var t=this.size+arguments.length,n=this._head,i=arguments.length-1;i>=0;i--)n={value:e[i],next:n};return this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):qn(t,n)},t.prototype.pushAll=function(t){if(0===(t=e(t)).size)return this;if(0===this.size&&An(t))return t;pt(t.size);var n=this.size,i=this._head;return t.__iterate((function(e){n++,i={value:e,next:i}}),!0),this.__ownerID?(this.size=n,this._head=i,this.__hash=void 0,this.__altered=!0,this):qn(n,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Nn()},t.prototype.slice=function(t,n){if(N(t,n,this.size))return this;var i=F(t,this.size);if(L(n,this.size)!==this.size)return e.prototype.slice.call(this,t,n);for(var r=this.size-i,s=this._head;i--;)s=s.next;return this.__ownerID?(this.size=r,this._head=s,this.__hash=void 0,this.__altered=!0,this):qn(r,s)},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?qn(this.size,this._head,e,this.__hash):0===this.size?Nn():(this.__ownerID=e,this.__altered=!1,this)},t.prototype.__iterate=function(e,t){var n=this;if(t)return new ge(this.toArray()).__iterate((function(t,i){return e(t,i,n)}),t);for(var i=0,r=this._head;r&&!1!==e(r.value,i++,this);)r=r.next;return i},t.prototype.__iterator=function(e,t){if(t)return new ge(this.toArray()).__iterator(e,t);var n=0,i=this._head;return new ie((function(){if(i){var t=i.value;return i=i.next,re(e,n++,t)}return{value:void 0,done:!0}}))},t}(J);Pn.isStack=An;var Dn,Mn=Pn.prototype;function qn(e,t,n,i){var r=Object.create(Mn);return r.size=e,r._head=t,r.__ownerID=n,r.__hash=i,r.__altered=!1,r}function Nn(){return Dn||(Dn=qn(0))}Mn["@@__IMMUTABLE_STACK__@@"]=!0,Mn.shift=Mn.pop,Mn.unshift=Mn.push,Mn.unshiftAll=Mn.pushAll,Mn.withMutations=Ut,Mn.wasAltered=Gt,Mn.asImmutable=zt,Mn["@@transducer/init"]=Mn.asMutable=Bt,Mn["@@transducer/step"]=function(e,t){return e.unshift(t)},Mn["@@transducer/result"]=function(e){return e.asImmutable()};function Fn(e){return Boolean(e&&e["@@__IMMUTABLE_SET__@@"])}function Ln(e){return Fn(e)&&ee(e)}function Un(e,t){if(e===t)return!0;if(!z(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||G(e)!==G(t)||W(e)!==W(t)||ee(e)!==ee(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!H(e);if(ee(e)){var i=e.entries();return t.every((function(e,t){var r=i.next().value;return r&&Ie(r[1],e)&&(n||Ie(r[0],t))}))&&i.next().done}var r=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{r=!0;var s=e;e=t,t=s}var o=!0,a=t.__iterate((function(t,i){if(n?!e.has(t):r?!Ie(t,e.get(i,R)):!Ie(e.get(i,R),t))return o=!1,!1}));return o&&e.size===a}function Bn(e,t){var n=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}function zn(e){if(!e||"object"!=typeof e)return e;if(!z(e)){if(!gt(e))return e;e=de(e)}if(G(e)){var t={};return e.__iterate((function(e,n){t[n]=zn(e)})),t}var n=[];return e.__iterate((function(e){n.push(zn(e))})),n}var Gn=function(e){function t(t){return null==t?Jn():Fn(t)&&!ee(t)?t:Jn().withMutations((function(n){var i=e(t);pt(i.size),i.forEach((function(e){return n.add(e)}))}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this($(e).keySeq())},t.intersect=function(e){return(e=V(e).toArray()).length?Hn.intersect.apply(t(e.pop()),e):Jn()},t.union=function(e){return(e=V(e).toArray()).length?Hn.union.apply(t(e.pop()),e):Jn()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(e){return this._map.has(e)},t.prototype.add=function(e){return Vn(this,this._map.set(e,e))},t.prototype.remove=function(e){return Vn(this,this._map.remove(e))},t.prototype.clear=function(){return Vn(this,this._map.clear())},t.prototype.map=function(e,t){var n=this,i=[],r=[];return this.forEach((function(s){var o=e.call(t,s,s,n);o!==s&&(i.push(s),r.push(o))})),this.withMutations((function(e){i.forEach((function(t){return e.remove(t)})),r.forEach((function(t){return e.add(t)}))}))},t.prototype.union=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return 0===(t=t.filter((function(e){return 0!==e.size}))).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations((function(n){for(var i=0;i<t.length;i++)e(t[i]).forEach((function(e){return n.add(e)}))})):this.constructor(t[0])},t.prototype.intersect=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(0===t.length)return this;t=t.map((function(t){return e(t)}));var i=[];return this.forEach((function(e){t.every((function(t){return t.includes(e)}))||i.push(e)})),this.withMutations((function(e){i.forEach((function(t){e.remove(t)}))}))},t.prototype.subtract=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(0===t.length)return this;t=t.map((function(t){return e(t)}));var i=[];return this.forEach((function(e){t.some((function(t){return t.includes(e)}))&&i.push(e)})),this.withMutations((function(e){i.forEach((function(t){e.remove(t)}))}))},t.prototype.sort=function(e){return di(tt(this,e))},t.prototype.sortBy=function(e,t){return di(tt(this,t,e))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(e,t){var n=this;return this._map.__iterate((function(t){return e(t,t,n)}),t)},t.prototype.__iterator=function(e,t){return this._map.__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):0===this.size?this.__empty():(this.__ownerID=e,this._map=t,this)},t}(Y);Gn.isSet=Fn;var Wn,Hn=Gn.prototype;function Vn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function $n(e,t){var n=Object.create(Hn);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Jn(){return Wn||(Wn=$n(nn()))}Hn["@@__IMMUTABLE_SET__@@"]=!0,Hn.delete=Hn.remove,Hn.merge=Hn.concat=Hn.union,Hn.withMutations=Ut,Hn.asImmutable=zt,Hn["@@transducer/init"]=Hn.asMutable=Bt,Hn["@@transducer/step"]=function(e,t){return e.add(t)},Hn["@@transducer/result"]=function(e){return e.asImmutable()},Hn.__empty=Jn,Hn.__make=$n;var Yn,Qn=function(e){function t(e,n,i){if(!(this instanceof t))return new t(e,n,i);if(dt(0!==i,"Cannot step a Range by 0"),e=e||0,void 0===n&&(n=1/0),i=void 0===i?1:Math.abs(i),n<e&&(i=-i),this._start=e,this._end=n,this._step=i,this.size=Math.max(0,Math.ceil((n-e)/i-1)+1),0===this.size){if(Yn)return Yn;Yn=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},t.prototype.get=function(e,t){return this.has(e)?this._start+M(this,e)*this._step:t},t.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},t.prototype.slice=function(e,n){return N(e,n,this.size)?this:(e=F(e,this.size),(n=L(n,this.size))<=e?new t(0,0):new t(this.get(e,this._end),this.get(n,this._end),this._step))},t.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var n=t/this._step;if(n>=0&&n<this.size)return n}return-1},t.prototype.lastIndexOf=function(e){return this.indexOf(e)},t.prototype.__iterate=function(e,t){for(var n=this.size,i=this._step,r=t?this._start+(n-1)*i:this._start,s=0;s!==n&&!1!==e(r,t?n-++s:s++,this);)r+=t?-i:i;return s},t.prototype.__iterator=function(e,t){var n=this.size,i=this._step,r=t?this._start+(n-1)*i:this._start,s=0;return new ie((function(){if(s===n)return{value:void 0,done:!0};var o=r;return r+=t?-i:i,re(e,t?n-++s:s++,o)}))},t.prototype.equals=function(e){return e instanceof t?this._start===e._start&&this._end===e._end&&this._step===e._step:Un(this,e)},t}(fe);function Kn(e,t,n){for(var i=ft(t),r=0;r!==i.length;)if((e=bt(e,i[r++],R))===R)return n;return e}function Xn(e,t){return Kn(this,e,t)}function Zn(e,t){return Kn(e,t,R)!==R}function ei(){pt(this.size);var e={};return this.__iterate((function(t,n){e[n]=t})),e}V.isIterable=z,V.isKeyed=G,V.isIndexed=W,V.isAssociative=H,V.isOrdered=ee,V.Iterator=ie,Bn(V,{toArray:function(){pt(this.size);var e=new Array(this.size||0),t=G(this),n=0;return this.__iterate((function(i,r){e[n++]=t?[r,i]:i})),e},toIndexedSeq:function(){return new We(this)},toJS:function(){return zn(this)},toKeyedSeq:function(){return new Ge(this,!0)},toMap:function(){return Wt(this.toKeyedSeq())},toObject:ei,toOrderedMap:function(){return On(this.toKeyedSeq())},toOrderedSet:function(){return di(G(this)?this.valueSeq():this)},toSet:function(){return Gn(G(this)?this.valueSeq():this)},toSetSeq:function(){return new He(this)},toSeq:function(){return W(this)?this.toIndexedSeq():G(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Pn(G(this)?this.valueSeq():this)},toList:function(){return fn(G(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return st(this,Ze(this,e))},includes:function(e){return this.some((function(t){return Ie(t,e)}))},entries:function(){return this.__iterator(2)},every:function(e,t){pt(this.size);var n=!0;return this.__iterate((function(i,r,s){if(!e.call(t,i,r,s))return n=!1,!1})),n},filter:function(e,t){return st(this,Qe(this,e,t,!0))},find:function(e,t,n){var i=this.findEntry(e,t);return i?i[1]:n},forEach:function(e,t){return pt(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){pt(this.size),e=void 0!==e?""+e:",";var t="",n=!0;return this.__iterate((function(i){n?n=!1:t+=e,t+=null!=i?i.toString():""})),t},keys:function(){return this.__iterator(0)},map:function(e,t){return st(this,Je(this,e,t))},reduce:function(e,t,n){return ri(this,e,t,n,arguments.length<2,!1)},reduceRight:function(e,t,n){return ri(this,e,t,n,arguments.length<2,!0)},reverse:function(){return st(this,Ye(this,!0))},slice:function(e,t){return st(this,Ke(this,e,t,!0))},some:function(e,t){return!this.every(ai(e),t)},sort:function(e){return st(this,tt(this,e))},values:function(){return this.__iterator(1)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some((function(){return!0}))},count:function(e,t){return D(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,n){var i=Wt().asMutable();return e.__iterate((function(r,s){i.update(t.call(n,r,s,e),0,(function(e){return e+1}))})),i.asImmutable()}(this,e,t)},equals:function(e){return Un(this,e)},entrySeq:function(){var e=this;if(e._cache)return new ge(e._cache);var t=e.toSeq().map(oi).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(ai(e),t)},findEntry:function(e,t,n){var i=n;return this.__iterate((function(n,r,s){if(e.call(t,n,r,s))return i=[r,n],!1})),i},findKey:function(e,t){var n=this.findEntry(e,t);return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(e){return this.find(q,null,e)},flatMap:function(e,t){return st(this,function(e,t,n){var i=at(e);return e.toSeq().map((function(r,s){return i(t.call(n,r,s,e))})).flatten(!0)}(this,e,t))},flatten:function(e){return st(this,et(this,e,!0))},fromEntrySeq:function(){return new Ve(this)},get:function(e,t){return this.find((function(t,n){return Ie(n,e)}),void 0,t)},getIn:Xn,groupBy:function(e,t){return function(e,t,n){var i=G(e),r=(ee(e)?On():Wt()).asMutable();e.__iterate((function(s,o){r.update(t.call(n,s,o,e),(function(e){return(e=e||[]).push(i?[o,s]:s),e}))}));var s=at(e);return r.map((function(t){return st(e,s(t))})).asImmutable()}(this,e,t)},has:function(e){return this.get(e,R)!==R},hasIn:function(e){return Zn(this,e)},isSubset:function(e){return e="function"==typeof e.includes?e:V(e),this.every((function(t){return e.includes(t)}))},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:V(e)).isSubset(this)},keyOf:function(e){return this.findKey((function(t){return Ie(t,e)}))},keySeq:function(){return this.toSeq().map(si).toIndexedSeq()},last:function(e){return this.toSeq().reverse().first(e)},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return nt(this,e)},maxBy:function(e,t){return nt(this,t,e)},min:function(e){return nt(this,e?ci(e):hi)},minBy:function(e,t){return nt(this,t?ci(t):hi,e)},rest:function(){return this.slice(1)},skip:function(e){return 0===e?this:this.slice(Math.max(0,e))},skipLast:function(e){return 0===e?this:this.slice(0,-Math.max(0,e))},skipWhile:function(e,t){return st(this,Xe(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(ai(e),t)},sortBy:function(e,t){return st(this,tt(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return this.slice(-Math.max(0,e))},takeWhile:function(e,t){return st(this,function(e,t,n){var i=ct(e);return i.__iterateUncached=function(i,r){var s=this;if(r)return this.cacheResult().__iterate(i,r);var o=0;return e.__iterate((function(e,r,a){return t.call(n,e,r,a)&&++o&&i(e,r,s)})),o},i.__iteratorUncached=function(i,r){var s=this;if(r)return this.cacheResult().__iterator(i,r);var o=e.__iterator(2,r),a=!0;return new ie((function(){if(!a)return{value:void 0,done:!0};var e=o.next();if(e.done)return e;var r=e.value,c=r[0],u=r[1];return t.call(n,u,c,s)?2===i?e:re(i,c,u,e):(a=!1,{value:void 0,done:!0})}))},i}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(ai(e),t)},update:function(e){return e(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=ee(e),n=G(e),i=t?1:0;return function(e,t){return t=Oe(t,3432918353),t=Oe(t<<15|t>>>-15,461845907),t=Oe(t<<13|t>>>-13,5),t=Oe((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=je((t=Oe(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(n?t?function(e,t){i=31*i+li(Re(e),Re(t))|0}:function(e,t){i=i+li(Re(e),Re(t))|0}:t?function(e){i=31*i+Re(e)|0}:function(e){i=i+Re(e)|0}),i)}(this))}});var ti=V.prototype;ti["@@__IMMUTABLE_ITERABLE__@@"]=!0,ti[ne]=ti.values,ti.toJSON=ti.toArray,ti.__toStringMapper=vt,ti.inspect=ti.toSource=function(){return this.toString()},ti.chain=ti.flatMap,ti.contains=ti.includes,Bn($,{flip:function(){return st(this,$e(this))},mapEntries:function(e,t){var n=this,i=0;return st(this,this.toSeq().map((function(r,s){return e.call(t,[s,r],i++,n)})).fromEntrySeq())},mapKeys:function(e,t){var n=this;return st(this,this.toSeq().flip().map((function(i,r){return e.call(t,i,r,n)})).flip())}});var ni=$.prototype;ni["@@__IMMUTABLE_KEYED__@@"]=!0,ni[ne]=ti.entries,ni.toJSON=ei,ni.__toStringMapper=function(e,t){return vt(t)+": "+vt(e)},Bn(J,{toKeyedSeq:function(){return new Ge(this,!1)},filter:function(e,t){return st(this,Qe(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t);return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return st(this,Ye(this,!1))},slice:function(e,t){return st(this,Ke(this,e,t,!1))},splice:function(e,t){var n=arguments.length;if(t=Math.max(t||0,0),0===n||2===n&&!t)return this;e=F(e,e<0?this.count():this.size);var i=this.slice(0,e);return st(this,1===n?i:i.concat(lt(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t);return n?n[0]:-1},first:function(e){return this.get(0,e)},flatten:function(e){return st(this,et(this,e,!1))},get:function(e,t){return(e=M(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find((function(t,n){return n===e}),void 0,t)},has:function(e){return(e=M(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return st(this,function(e,t){var n=ct(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,i){var r=this,s=0;return e.__iterate((function(e){return(!s||!1!==n(t,s++,r))&&!1!==n(e,s++,r)}),i),s},n.__iteratorUncached=function(n,i){var r,s=e.__iterator(1,i),o=0;return new ie((function(){return(!r||o%2)&&(r=s.next()).done?r:o%2?re(n,o++,t):re(n,o++,r.value,r)}))},n}(this,e))},interleave:function(){var e=[this].concat(lt(arguments)),t=rt(this.toSeq(),fe.of,e),n=t.flatten(!0);return t.size&&(n.size=t.size*e.length),st(this,n)},keySeq:function(){return Qn(0,this.size)},last:function(e){return this.get(-1,e)},skipWhile:function(e,t){return st(this,Xe(this,e,t,!1))},zip:function(){var e=[this].concat(lt(arguments));return st(this,rt(this,ui,e))},zipAll:function(){var e=[this].concat(lt(arguments));return st(this,rt(this,ui,e,!0))},zipWith:function(e){var t=lt(arguments);return t[0]=this,st(this,rt(this,e,t))}});var ii=J.prototype;function ri(e,t,n,i,r,s){return pt(e.size),e.__iterate((function(e,s,o){r?(r=!1,n=e):n=t.call(i,n,e,s,o)}),s),n}function si(e,t){return t}function oi(e,t){return[t,e]}function ai(e){return function(){return!e.apply(this,arguments)}}function ci(e){return function(){return-e.apply(this,arguments)}}function ui(){return lt(arguments)}function hi(e,t){return e<t?1:e>t?-1:0}function li(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}ii["@@__IMMUTABLE_INDEXED__@@"]=!0,ii[Z]=!0,Bn(Y,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),Y.prototype.has=ti.includes,Y.prototype.contains=Y.prototype.includes,Bn(pe,$.prototype),Bn(fe,J.prototype),Bn(me,Y.prototype);var di=function(e){function t(e){return null==e?gi():Ln(e)?e:gi().withMutations((function(t){var n=Y(e);pt(n.size),n.forEach((function(e){return t.add(e)}))}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this($(e).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(Gn);di.isOrderedSet=Ln;var pi,fi=di.prototype;function mi(e,t){var n=Object.create(fi);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function gi(){return pi||(pi=mi(Tn()))}fi[Z]=!0,fi.zip=ii.zip,fi.zipWith=ii.zipWith,fi.__empty=gi,fi.__make=mi;var vi=function(e,t){var n,i=function(s){var o=this;if(s instanceof i)return s;if(!(this instanceof i))return new i(s);if(!n){n=!0;var a=Object.keys(e),c=r._indices={};r._name=t,r._keys=a,r._defaultValues=e;for(var u=0;u<a.length;u++){var h=a[u];c[h]=u,r[h]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+_i(this)+' with property "'+h+'" since that property name is part of the Record API.'):Si(r,h)}}this.__ownerID=void 0,this._values=fn().withMutations((function(e){e.setSize(o._keys.length),$(s).forEach((function(t,n){e.set(o._indices[n],t===o._defaultValues[n]?void 0:t)}))}))},r=i.prototype=Object.create(yi);return r.constructor=i,t&&(i.displayName=t),i};vi.prototype.toString=function(){for(var e,t=_i(this)+" { ",n=this._keys,i=0,r=n.length;i!==r;i++)t+=(i?", ":"")+(e=n[i])+": "+vt(this.get(e));return t+" }"},vi.prototype.equals=function(e){return this===e||e&&this._keys===e._keys&&wi(this).equals(wi(e))},vi.prototype.hashCode=function(){return wi(this).hashCode()},vi.prototype.has=function(e){return this._indices.hasOwnProperty(e)},vi.prototype.get=function(e,t){if(!this.has(e))return t;var n=this._indices[e],i=this._values.get(n);return void 0===i?this._defaultValues[e]:i},vi.prototype.set=function(e,t){if(this.has(e)){var n=this._values.set(this._indices[e],t===this._defaultValues[e]?void 0:t);if(n!==this._values&&!this.__ownerID)return bi(this,n)}return this},vi.prototype.remove=function(e){return this.set(e)},vi.prototype.clear=function(){var e=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:bi(this,e)},vi.prototype.wasAltered=function(){return this._values.wasAltered()},vi.prototype.toSeq=function(){return wi(this)},vi.prototype.toJS=function(){return zn(this)},vi.prototype.entries=function(){return this.__iterator(2)},vi.prototype.__iterator=function(e,t){return wi(this).__iterator(e,t)},vi.prototype.__iterate=function(e,t){return wi(this).__iterate(e,t)},vi.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._values.__ensureOwner(e);return e?bi(this,t,e):(this.__ownerID=e,this._values=t,this)},vi.isRecord=K,vi.getDescriptiveName=_i;var yi=vi.prototype;function bi(e,t,n){var i=Object.create(Object.getPrototypeOf(e));return i._values=t,i.__ownerID=n,i}function _i(e){return e.constructor.displayName||e.constructor.name||"Record"}function wi(e){return we(e._keys.map((function(t){return[t,e.get(t)]})))}function Si(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){dt(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}catch(e){}}yi["@@__IMMUTABLE_RECORD__@@"]=!0,yi.delete=yi.remove,yi.deleteIn=yi.removeIn=It,yi.getIn=Xn,yi.hasIn=ti.hasIn,yi.merge=Rt,yi.mergeWith=At,yi.mergeIn=Ft,yi.mergeDeep=qt,yi.mergeDeepWith=Nt,yi.mergeDeepIn=Lt,yi.setIn=kt,yi.update=jt,yi.updateIn=Tt,yi.withMutations=Ut,yi.asMutable=Bt,yi.asImmutable=zt,yi[ne]=yi.entries,yi.toJSON=yi.toObject=ti.toObject,yi.inspect=yi.toSource=function(){return this.toString()};var Ci=n(3),Ei=n.n(Ci),ki=Symbol(),xi=Symbol();class Ii{static get instance(){return this[ki]||(this[ki]=new Ii(xi)),this[ki]}constructor(e){if(e!=xi)throw new Error("The constructor is private, use Logs.instance instead");this._handlers=[],Ei.a.useDefaults(),Ei.a.setHandler((e,t)=>{this._handlers.forEach(n=>{n(e,t)})}),this.addHandler(Ei.a.createDefaultHandler({formatter:this._formatter}))}get LEVELS(){return{DEBUG:Ei.a.DEBUG,INFO:Ei.a.INFO,TIME:Ei.a.TIME,WARN:Ei.a.WARN,ERROR:Ei.a.ERROR,OFF:Ei.a.OFF}}getLevelFromLocalStorage(e){if(!localStorage||!localStorage.sippodebug)return this.LEVELS.WARN;for(var t=!1,n=localStorage.sippodebug.split(",").map(e=>{var[n,i]=e.split("=");return t=t||"*"===e,{id:n,value:i||"DEBUG"}}),i=0;i<n.length;i++){var r=n[i];if(r.id===e&&this.LEVELS[r.value])return this.LEVELS[r.value]}return t?this.LEVELS.DEBUG:this.LEVELS.WARN}getLogger(e){var t=Ei.a.get(e);return t.setLevel(this.getLevelFromLocalStorage(e)),t}setLevel(e,t){Ei.a.get(e).setLevel(t)}addHandler(e){return-1===this._handlers.indexOf(e)&&this._handlers.push(e),this}removeHandler(e){this._handlers=this._handlers.filter((function(t){return t!==e}))}_formatter(e,t){for(var n=(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),i=0;i<e.length;i++)e[i]instanceof Error&&e[i].stack&&(e[i]=e[i].stack);e.unshift("[".concat(n,"] ").concat(t.name))}}var Oi=n(1),ji=n(0);function Ti(e){return"function"==typeof e}var Ri=!1,Ai={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;Ri=e},get useDeprecatedSynchronousErrorHandling(){return Ri}};function Pi(e){setTimeout((function(){throw e}),0)}var Di={closed:!0,next:function(e){},error:function(e){if(Ai.useDeprecatedSynchronousErrorHandling)throw e;Pi(e)},complete:function(){}},Mi=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function qi(e){return null!==e&&"object"==typeof e}var Ni=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Fi=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,i=this._unsubscribe,r=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var s=0;s<n.length;++s){n[s].remove(this)}if(Ti(i))try{i.call(this)}catch(e){t=e instanceof Ni?Li(e.errors):[e]}if(Mi(r)){s=-1;for(var o=r.length;++s<o;){var a=r[s];if(qi(a))try{a.unsubscribe()}catch(e){t=t||[],e instanceof Ni?t=t.concat(Li(e.errors)):t.push(e)}}}if(t)throw new Ni(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var i=n;(n=new e)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function Li(e){return e.reduce((function(e,t){return e.concat(t instanceof Ni?t.errors:t)}),[])}var Ui=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Bi=function(e){function t(n,i,r){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=Di;break;case 1:if(!n){s.destination=Di;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new zi(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new zi(s,n,i,r)}return s}return ji.b(t,e),t.prototype[Ui]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Fi),zi=function(e){function t(t,n,i,r){var s,o=e.call(this)||this;o._parentSubscriber=t;var a=o;return Ti(n)?s=n:n&&(s=n.next,i=n.error,r=n.complete,n!==Di&&(Ti((a=Object.create(n)).unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=s,o._error=i,o._complete=r,o}return ji.b(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Ai.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Ai.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Pi(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Pi(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Ai.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Ai.useDeprecatedSynchronousErrorHandling)throw e;Pi(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Ai.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return Ai.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(Pi(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Bi);var Gi=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Wi(){}function Hi(e){return e?1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}:Wi}var Vi=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,r=function(e,t,n){if(e){if(e instanceof Bi)return e;if(e[Ui])return e[Ui]()}return e||t||n?new Bi(e,t,n):new Bi(Di)}(e,t,n);if(i?r.add(i.call(r,this.source)):r.add(this.source||Ai.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Ai.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Ai.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,i=t.destination,r=t.isStopped;if(n||r)return!1;e=i&&i instanceof Bi?i:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=$i(t))((function(t,i){var r;r=n.subscribe((function(t){try{e(t)}catch(e){i(e),r&&r.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Gi]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Hi(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=$i(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function $i(e){if(e||(e=Ai.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var Ji=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Yi=function(e){function t(t,n){var i=e.call(this)||this;return i.subject=t,i.subscriber=n,i.closed=!1,i}return ji.b(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Fi),Qi=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return ji.b(t,e),t}(Bi),Ki=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return ji.b(t,e),t.prototype[Ui]=function(){return new Qi(this)},t.prototype.lift=function(e){var t=new Xi(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Ji;if(!this.isStopped)for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ji;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ji;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),i=0;i<t;i++)n[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Ji;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Ji;return this.hasError?(e.error(this.thrownError),Fi.EMPTY):this.isStopped?(e.complete(),Fi.EMPTY):(this.observers.push(e),new Yi(this,e))},t.prototype.asObservable=function(){var e=new Vi;return e.source=this,e},t.create=function(e,t){return new Xi(e,t)},t}(Vi),Xi=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return ji.b(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Fi.EMPTY},t}(Ki),Zi=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return ji.b(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ji;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Ki);function er(e){return e&&"function"==typeof e.schedule}var tr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ji.b(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(Bi),nr=function(e){function t(t,n,i){var r=e.call(this)||this;return r.parent=t,r.outerValue=n,r.outerIndex=i,r.index=0,r}return ji.b(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(Bi),ir=function(e){return function(t){for(var n=0,i=e.length;n<i&&!t.closed;n++)t.next(e[n]);t.complete()}};function rr(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var sr=rr();var or=function(e){if(e&&"function"==typeof e[Gi])return r=e,function(e){var t=r[Gi]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if((i=e)&&"number"==typeof i.length&&"function"!=typeof i)return ir(e);if(function(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Pi),e};if(e&&"function"==typeof e[sr])return t=e,function(e){for(var n=t[sr]();;){var i=n.next();if(i.done){e.complete();break}if(e.next(i.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,i,r,s=qi(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function ar(e,t,n,i,r){if(void 0===r&&(r=new nr(e,n,i)),!r.closed)return t instanceof Vi?t.subscribe(r):or(t)(r)}function cr(e,t){return t?function(e,t){return new Vi((function(n){var i=new Fi,r=0;return i.add(t.schedule((function(){r!==e.length?(n.next(e[r++]),n.closed||i.add(this.schedule())):n.complete()}))),i}))}(e,t):new Vi(ir(e))}var ur={};var hr=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new lr(e,this.resultSelector))},e}(),lr=function(e){function t(t,n){var i=e.call(this,t)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return ji.b(t,e),t.prototype._next=function(e){this.values.push(ur),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var i=e[n];this.add(ar(this,i,i,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){var s=this.values,o=s[n],a=this.toRespond?o===ur?--this.toRespond:this.toRespond:0;s[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(tr);var dr=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new pr(e,this.project,this.thisArg))},e}(),pr=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return ji.b(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Bi),fr=new u(["LOADING","SENDING","COMPLETED","ERROR","ABORTED"]);class mr{constructor(e,t=null){this.name=e,this.url=t,this.cache={type:null},Object.freeze(this)}getName(){return this.name}getUrl(){return this.url}getType(){var e=this;return s((function*(){if(!e.cache.type){var t=yield window.fetch(e.url,{method:"HEAD"});e.cache.type=t.headers.get("content-type"),Object.freeze(e.cache)}return e.cache.type}))()}}var gr={INCOMING:"incoming",OUTGOING:"outgoing"},vr={ERROR:"error",SENDING:"sending",SENT:"sent",RECEIVED:"received",DISPLAYED:"displayed",ACKNOWLEDGED:"acknowledged"},yr={FILE:"file",TEXT:"text"};class br{static of(e,t,{id:n=null,direction:i=gr.INCOMING,type:r=yr.TEXT,status:s=vr.SENDING,progress:o=0,timestamp:a=null}={}){return new br(e,t,n,i,r,s,o,a)}constructor(e,t,n,i,r,s,o,a){this.composer=e,this.data=t,this.id=n,this.direction=i,this.type=r,this.status=s,this.progress=o,this.timestamp=a,Object.freeze(this)}with({data:e=this.data,id:t=this.id,type:n=this.type,status:i=this.status,progress:r=this.progress,timestamp:s=this.timestamp}={}){return new br(this.composer,e,t,this.direction,n,i,r,s)}getId(){return this.id}getDirection(){return this.direction}getType(){return this.type}getComposer(){return this.composer}getData(){return this.data}getTimestamp(){return this.timestamp}getProgress(){return this.progress}getStatus(){return this.status}hasStatus(e){return this.status===e}}var _r={INDIVIDUAL:"chat",GROUP:"groupchat"},wr={MEMBER:"member",ADMIN:"owner"},Sr={ACTIVE:"active",INACTIVE:"inactive",GONE:"gone",COMPOSING:"composing",PAUSED:"paused"};class Cr{constructor(){this.limit=2,this.data=[],this.lastAckedBy=[],this.olderAcked=!1}setLimit(e){this.limit=e}append(e){return!this.data.find(t=>t.key===e)&&(this.data.push({key:e,value:new window.Set}),!0)}prepend(e){if(!this.olderAcked){if(!this.data.find(t=>t.key===e))for(var t=this.data.length-1;t>=0;t--)if(this.data[t].isAdded){var n=new window.Set(this.data[t].value);this.data.splice(t,0,{key:e,value:n});break}this.data.find(t=>t.key===e)||this.data.push({key:e,value:new window.Set});var i=this.data.findIndex(({key:t})=>t===e);this.data[i].isAdded=!0;var{value:r}=this.data[i];this.olderAcked=r.size>=this.limit}}hasElement(e){return!!this.data.find(t=>t.key===e)}appendAck(e,t){if(!this.data.find(t=>t.key===e))throw new Error("".concat(e," doesn't exist"));for(var{key:n,value:i}of this.data)if(i.add(t),n===e)break;for(var r=!1,s=this.data.length-1;s>=0;s--){var o=this.data[s].value,a=this.data[s].key;r||o.size!==this.limit||(r=a,this.olderAcked=!0),r&&this.data.splice(s,1)}return this.lastAckedBy[t]=e,r}prependAck(e,t){if(!this.olderAcked){if(!this.data.find(t=>t.key===e)){var n=new window.Set(this.data[0]&&this.data[0].value);this.data.unshift({key:e,value:n})}for(var{key:i,value:r}of this.data)if(r.add(t),i===e)break;this.lastAckedBy[t]||(this.lastAckedBy[t]=e)}}isOlderAcked(){return this.olderAcked}getLastAckedBy(e){return this.lastAckedBy[e]}}class Er{static newInstance(e,t,n,{id:i,type:r,name:s,subject:o,participants:a}={}){return new Er(e,t,n,i,r,s,o,a)}constructor(e,t,n,i,r,s,o,a){this.ownAddress=n.getAddress().toLowerCase(),this.chatService=e,this.fileManager=t,this.id=i,this.type=r,this.name=s,this.subject=o,this.participants=Wt(),this.participants=this.participants.withMutations(e=>{a.forEach(t=>e.set(t.jid,t.affiliation))}),this.remoteParticipants=Wt(),this.remoteParticipants=this.remoteParticipants.withMutations(e=>{a.filter(e=>e.jid!==this.ownAddress).forEach(t=>e.set(t.jid,Sr.ACTIVE))}),this.pendingMessages=new fn,this.messagesSubject=new Zi(new fn),this.fileMessages=new fn,this.uploads=new window.Map,this.firstUnreadMessageSubject=new Zi,this.lastInvitationTimestamp=null,this.lastRecoveredMessageId=null,this.oldestMessageRecovered=!1,this.receivedMarkCounter=new Cr,this.receivedMarkCounter.setLimit(this.participants.count()),this.displayedMarkCounter=new Cr,this.displayedMarkCounter.setLimit(this.participants.count()),this.ownMessageCache=new window.Map,this.emitter=new Oi.EventEmitter2,c(this,["onReceived","onDisplayed","onState","onMessage","onMessageSent","onMucPresence","onMucConfig"])}bindEventListeners(){this.chatService.emitter.on(["received",this.id],this.onReceived),this.chatService.emitter.on(["displayed",this.id],this.onDisplayed),this.chatService.emitter.on(["state",this.id],this.onState),this.chatService.emitter.on(["message",this.id],this.onMessage),this.chatService.emitter.on(["message:sent",this.id],this.onMessageSent),this.type===_r.GROUP&&(this.chatService.emitter.on(["mucPresence",this.id],this.onMucPresence),this.chatService.emitter.on(["mucConfig",this.id],this.onMucConfig))}unbindEventListeners(){this.chatService.emitter.off(["received",this.id],this.onReceived),this.chatService.emitter.off(["displayed",this.id],this.onDisplayed),this.chatService.emitter.off(["state",this.id],this.onState),this.chatService.emitter.off(["message",this.id],this.onMessage),this.chatService.emitter.off(["message:sent",this.id],this.onMessageSent),this.type===_r.GROUP&&(this.chatService.emitter.off(["mucPresence",this.id],this.onMucPresence),this.chatService.emitter.off(["mucConfig",this.id],this.onMucConfig))}onMessageSent(e){var t=this;return s((function*(){if(e.received)t.onReceived({id:e.received,from:t.ownAddress});else if(e.displayed)t.onDisplayed({id:e.displayed,from:t.ownAddress});else{t.type===_r.GROUP&&t.ownMessageCache.set(e.id,!0);var n=e.links?yr.FILE:yr.TEXT,i=e.links?new mr(e.links[0].description,e.links[0].url):e.body,r=br.of(t.ownAddress,i,{id:e.id,type:n,direction:gr.OUTGOING,status:vr.SENT,timestamp:e.timestamp,progress:100});t.appendMessage(r)}}))()}updateMessages(e,t){var n=this.messages.findLastIndex(t=>t.getId()===e);this.messagesSubject.next(this.messages.map((e,i)=>i<=n?e.with({status:t}):e))}onReceived(e){if(this.receivedMarkCounter.hasElement(e.id)){var t=this.receivedMarkCounter.appendAck(e.id,e.from);if(t){this.updateMessages(t,vr.RECEIVED),this.firstUnreadMessage&&(this.firstUnreadMessageSubject.next(this.messages.find(e=>e.getId()===this.firstUnreadMessage.getId())),this.emitter.emit("firstUnreadMessage")),this.emitter.emit("messages");var n=!1;this.messages.forEach(e=>{if(e.getType()===yr.FILE){n=!0;var t=this.fileMessages.findIndex(t=>t.getId()===e.getId());this.fileMessages=this.fileMessages.set(t,e)}}),n&&this.emitter.emit("fileMessages")}}}onDisplayed(e){if(e.from===this.ownAddress&&this.updateFirstUnreadMessage(e.id),this.receivedMarkCounter.hasElement(e.id)&&this.receivedMarkCounter.appendAck(e.id,e.from),this.displayedMarkCounter.hasElement(e.id)){var t=this.displayedMarkCounter.appendAck(e.id,e.from);if(t){this.updateMessages(t,vr.DISPLAYED),this.firstUnreadMessage&&(this.firstUnreadMessageSubject.next(this.messages.find(e=>e.getId()===this.firstUnreadMessage.getId())),this.emitter.emit("firstUnreadMessage")),this.emitter.emit("messages");var n=!1;this.messages.forEach(e=>{if(e.getType()===yr.FILE){n=!0;var t=this.fileMessages.findIndex(t=>t.getId()===e.getId());this.fileMessages=this.fileMessages.set(t,e)}}),n&&this.emitter.emit("fileMessages")}}}onState(e){e.from!==this.ownAddress&&this.updateRemoteParticipant(e.from,e.state)}onMessage(e){var t=this;return s((function*(){if(t.type===_r.GROUP&&t.ownMessageCache.has(e.id))t.ownMessageCache.delete(e.id);else{var n=e.links?yr.FILE:yr.TEXT,i=e.links?new mr(e.links[0].description,e.links[0].url):e.body,r=e.from===t.ownAddress?gr.OUTGOING:gr.INCOMING,s=r===gr.OUTGOING?vr.SENT:vr.RECEIVED,o=br.of(e.from,i,{id:e.id,type:n,direction:r,timestamp:e.timestamp,status:s,progress:100});t.appendMessage(o),t.firstUnreadMessage||(t.firstUnreadMessageSubject.next(t.messages.last()),t.emitter.emit("firstUnreadMessage"))}}))()}onMucPresence(e){var t=e.affiliation&&"none"!==e.affiliation?this.remoteParticipants.get(e.jid)||Sr.ACTIVE:void 0,n=e.affiliation&&"none"!==e.affiliation?e.affiliation:void 0;this.updateRemoteParticipant(e.jid,t),this.updateParticipant(e.jid,n)}onMucConfig(e){"string"==typeof e.name&&this.name!==e.name&&(this.name=e.name,this.emitter.emit("name")),"string"==typeof e.subject&&this.subject!==e.subject&&(this.subject=e.subject,this.emitter.emit("subject"))}updateRemoteParticipant(e,t){this.remoteParticipants=t?this.remoteParticipants.set(e,t):this.remoteParticipants.delete(e),this.emitter.emit("remoteParticipants")}updateParticipant(e,t){this.participants=t?this.participants.set(e,t):this.participants.delete(e),this.receivedMarkCounter.setLimit(this.participants.count()),this.displayedMarkCounter.setLimit(this.participants.count()),this.emitter.emit("participants")}fetch(e=10){var t=this;return s((function*(){if(t.oldestMessageRecovered){if(t.type===_r.GROUP&&t.messages.isEmpty()){var n=yield t.chatService.fetchMessages(t.id,"chat",null,1);if(n.results.length>0){var i=n.results[0];t.lastInvitationTimestamp=i.timestamp}}}else{var r=yield t.chatService.fetchMessages(t.id,t.type,t.lastRecoveredMessageId,10*e),s=function(n){var i=n.from;if(n.received)return t.receivedMarkCounter.prependAck(n.received,i),"continue";if(n.displayed)return t.receivedMarkCounter.prependAck(n.displayed,i),t.displayedMarkCounter.prependAck(n.displayed,i),"continue";var r=n.id;if(t.messages.find(e=>r===e.getId()))return"continue";t.receivedMarkCounter.prepend(r),t.displayedMarkCounter.prepend(r);var s=t.ownAddress===i?gr.OUTGOING:gr.INCOMING,o=t.messages.first(),a=void 0;a=o&&o.getStatus()===vr.DISPLAYED||t.displayedMarkCounter.isOlderAcked()?vr.DISPLAYED:o&&o.getStatus()===vr.RECEIVED||t.receivedMarkCounter.isOlderAcked()?vr.RECEIVED:vr.SENT;var c=n.timestamp,u=n.links?yr.FILE:yr.TEXT,h=n.links?new mr(n.links[0].description,n.links[0].url):n.body,l=br.of(i,h,{id:r,direction:s,type:u,timestamp:c,status:a});e--,t.messagesSubject.next(t.messages.unshift(l))};for(var o of r.results)s(o);if(r.complete?t.oldestMessageRecovered=!0:t.lastRecoveredMessageId=r.paging.first,t.messages.count()){var a=t.receivedMarkCounter.getLastAckedBy(t.ownAddress);t.messages.last().getId()!==a&&(yield t.chatService.markReceived(t.id,t.messages.last().getId(),t.type)),t.updateFirstUnreadMessage(t.displayedMarkCounter.getLastAckedBy(t.ownAddress))}if(e>0)return t.fetch(e);t.emitter.emit("messages")}}))()}updateFirstUnreadMessage(e){var t=this.firstUnreadMessage;if(e){var n=this.messages.findIndex(t=>t.getId()===e);this.firstUnreadMessageSubject.next(this.messages.get(n+1))}else this.firstUnreadMessageSubject.next(this.messages.first());this.firstUnreadMessage!==t&&this.emitter.emit("firstUnreadMessage")}isOldestMessageRecovered(){return this.oldestMessageRecovered}sync(){var e=this;return s((function*(){var t=e.messages.last();if(!t)return e.fetch();var n=t.getTimestamp(),i=yield e.chatService.sync(e.getId(),e.type,n),r=function(t){if(t.received)return e.onReceived({id:t.received,from:t.from}),"continue";if(t.displayed)return e.onDisplayed({id:t.displayed,from:t.from}),"continue";if(e.messages.find(e=>e.getId()===t.id))return"continue";var n=t.links?yr.FILE:yr.TEXT,i=t.links?new mr(t.links[0].description,t.links[0].url):t.body,r=e.ownAddress===t.from?gr.OUTGOING:gr.INCOMING,s=br.of(t.from,i,{id:t.id,type:n,direction:r,status:vr.SENT,timestamp:t.timestamp});e.appendMessage(s),e.firstUnreadMessage||(e.firstUnreadMessageSubject.next(e.messages.last()),e.emitter.emit("firstUnreadMessage"))};for(var s of i)r(s)}))()}getId(){return this.id}getType(){return this.type}getName(){return this.name}setName(e){var t=this;return s((function*(){yield t.chatService.setRoomName(t.id,e),t.onMucConfig({name:e})}))()}getSubject(){return this.subject}setSubject(e){var t=this;return s((function*(){yield t.chatService.setRoomSubject(t.id,e),t.onMucConfig({subject:e})}))()}getRole(){return this.getParticipants().get(this.ownAddress)}getRemoteParticipants(){return this.remoteParticipants}getParticipants(){return this.participants}addParticipant(e){var t=this;return s((function*(){e=e.toLowerCase(),yield t.chatService.invite(t.id,e),t.updateRemoteParticipant(e,Sr.ACTIVE),t.updateParticipant(e,wr.MEMBER)}))()}expelParticipant(e){return this.chatService.expel(this.id,e)}setParticipantRole(e,t){return this.chatService.setParticipantRole(this.id,e,t)}leave(){var e=this;return s((function*(){if(e.getRole()===wr.ADMIN)throw Error("Admins cannot leave room");return e.chatService.leave(e.id)}))()}delete(){var e=this;return s((function*(){if(e.getType()!==_r.GROUP)throw Error("Only group chats can be deleted");yield e.chatService.destroy(e.getId())}))()}archive(){var e=this;return s((function*(){if(e.getType()!==_r.INDIVIDUAL)throw Error("Only individual chats can be archived");yield e.chatService.deleteIndividualChat(e.getId())}))()}setState(e){return this.chatService.setState(this.getId(),this.type,e)}appendMessage(e){this.receivedMarkCounter.append(e.getId()),this.displayedMarkCounter.append(e.getId()),this.messagesSubject.next(this.messages.push(e)),this.emitter.emit("messages",e),e.getType()===yr.FILE&&(this.fileMessages=this.fileMessages.push(e),this.emitter.emit("fileMessages",e))}sendText(e){var t=this;return s((function*(){var n=br.of(t.ownAddress,e,{direction:gr.OUTGOING,timestamp:Date.now()});t.pendingMessages=t.pendingMessages.push(n),t.emitter.emit("pendingMessages");try{yield t.chatService.sendMessage(t.id,t.type,e)}catch(e){var i=n.with({status:vr.ERROR});throw t.pendingMessages=t.pendingMessages.map(e=>e===n?i:e),t.emitter.emit("pendingMessages"),e}t.pendingMessages=t.pendingMessages.filter(e=>e!==n),t.emitter.emit("pendingMessages"),yield t.resetUnreadMessageCount()}))()}sendFile(e){var t=this;return s((function*(){var n=yield t.fileManager.getFileUploadManager(),i=yield n.create(e);yield new Promise(e=>n.emitter.once([i,"start"],e));var r=br.of(t.ownAddress,new mr(e.name),{direction:gr.OUTGOING,timestamp:Date.now(),type:yr.FILE});t.pendingMessages=t.pendingMessages.push(r),t.uploads.set(r,i),t.emitter.emit("pendingMessages",r,null);var s=()=>{var e=n.getFileUploads().get(i),s=e.getProgress(),o=new mr(e.getName(),e.getUrl()),a=r.with({progress:s,data:o});t.pendingMessages=t.pendingMessages.map(e=>e===r?a:e),t.uploads.delete(r),t.uploads.set(a,i),t.emitter.emit("pendingMessages",a,r),r=a};n.emitter.on([i,"progress"],s);try{t.uploads.delete(r);var o=yield n.waitForEnd(i);if(o.getStatus()!==fr.COMPLETED)return t.pendingMessages=t.pendingMessages.filter(e=>e!==r),void t.emitter.emit("pendingMessages");t.chatService.sendFile(t.id,t.type,o.getUrl(),o.getName())}catch(e){var a=r.with({status:vr.ERROR});throw t.pendingMessages=t.pendingMessages.map(e=>e===r?a:e),t.emitter.emit("pendingMessages"),e}finally{var c=n.getFileUploads().get(i);n.emitter.off([i,"progress"],s),n.remove(c)}t.pendingMessages=t.pendingMessages.filter(e=>e!==r),t.emitter.emit("pendingMessages"),yield t.resetUnreadMessageCount()}))()}cancelPendingMessage(e){var t=this;return s((function*(){if(!t.pendingMessages.includes(e)||e.getType()!==yr.FILE)throw Error("Invalid message");var n=yield t.fileManager.getFileUploadManager(),i=t.uploads.get(e),r=n.getFileUploads().get(i);yield n.abort(r)}))()}getLastMessageTimestamp(){return this.getMessages().size>0?this.getMessages().last().getTimestamp():this.lastInvitationTimestamp}getPendingMessages(){return this.pendingMessages}getMessages$(){return this.messagesSubject.asObservable()}getMessages(){return this.messagesSubject.value}get messages(){return this.messagesSubject.value}getFileMessages(){return this.fileMessages}getFirstUnreadMessage$(){return this.firstUnreadMessageSubject.asObservable()}getFirstUnreadMessage(){return this.firstUnreadMessage}get firstUnreadMessage(){return this.firstUnreadMessageSubject.value}getUnreadMessageCount(){return this.messages.skipUntil(e=>e===this.firstUnreadMessage).count()}getUnreadMessageCount$(){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null,i=null;return er(e[e.length-1])&&(i=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Mi(e[0])&&(e=e[0]),cr(e,i).lift(new hr(n))}(this.messagesSubject,this.firstUnreadMessageSubject).pipe((e=([e,t])=>e.skipUntil(e=>e===t).count(),function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new dr(e,t))}));var e,t}resetUnreadMessageCount(){var e=this;return s((function*(){var t=e.messages.last();t&&t.getStatus()!==vr.DISPLAYED&&(yield e.chatService.markDisplayed(e.id,t.getId(),e.type),e.type===_r.GROUP&&(yield new Promise(n=>{var i=r=>{r.id===t.getId()&&r.from===e.ownAddress&&(e.chatService.emitter.off(["displayed",e.id],i),n())};e.chatService.emitter.on(["displayed",e.id],i)})))}))()}}var kr=n(62);function xr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ir=n(17),Or=n.n(Ir),jr=n(61),Tr=n.n(jr),Rr=n(2);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Pr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){xr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dr=Ii.instance.getLogger("SippoJS/WacStack/ChatService"),Mr="You've been added to the conference's chat room",qr="supportChat",Nr="conference",Fr="support",Lr=e=>{switch(e){case Mr:return Nr;case qr:return Fr;default:return e}};class Ur{constructor(e,t,n){this.wacRequest=e,this.xmppClient=t,this.pushUri=n,this.emitter=new Oi.EventEmitter2({wildcard:!0}),this.emitter.setMaxListeners(0),c(this,["onIndividualChatChanges","onMarkerReceived","onMarkerDisplayed","onMucInvite","onMucLeave","onMucTopic","onMucOther","onChat","onChatState","onPresence","onMessage","onMessageError","onMessageSent"])}start(){return this.wacRequest.emitter.on("xmpp/individualChatList/*",this.onIndividualChatChanges),this.xmppClient.emitter.on("marker:received",this.onMarkerReceived),this.xmppClient.emitter.on("marker:displayed",this.onMarkerDisplayed),this.xmppClient.emitter.on("muc:invite",this.onMucInvite),this.xmppClient.emitter.on("muc:leave",this.onMucLeave),this.xmppClient.emitter.on("muc:topic",this.onMucTopic),this.xmppClient.emitter.on("muc:other",this.onMucOther),this.xmppClient.emitter.on("chat",this.onChat),this.xmppClient.emitter.on("groupchat",this.onChat),this.xmppClient.emitter.on("chat:state",this.onChatState),this.xmppClient.emitter.on("presence",this.onPresence),this.xmppClient.emitter.on("message",this.onMessage),this.xmppClient.emitter.on("message:sent",this.onMessageSent),this.xmppClient.emitter.on("message:error",this.onMessageError),this.xmppClient.start()}stop(){return this.wacRequest.emitter.off("xmpp/individualChatList/*",this.onIndividualChatChanges),this.xmppClient.emitter.off("marker:received",this.onMarkerReceived),this.xmppClient.emitter.off("marker:displayed",this.onMarkerDisplayed),this.xmppClient.emitter.off("muc:invite",this.onMucInvite),this.xmppClient.emitter.off("muc:leave",this.onMucLeave),this.xmppClient.emitter.off("muc:topic",this.onMucTopic),this.xmppClient.emitter.off("muc:other",this.onMucOther),this.xmppClient.emitter.off("chat",this.onChat),this.xmppClient.emitter.off("groupchat",this.onChat),this.xmppClient.emitter.off("chat:state",this.onChatState),this.xmppClient.emitter.off("presence",this.onPresence),this.xmppClient.emitter.off("message",this.onMessage),this.xmppClient.emitter.off("message:sent",this.onMessageSent),this.xmppClient.emitter.off("message:error",this.onMessageError),this.xmppClient.stop()}suspend(){return this.xmppClient.suspend()}resume(){return this.xmppClient.resume()}onIndividualChatChanges(e){var t=e.path.split("/").pop();switch(e.method){case"put":this.emitter.emit("individualChatAdded",t);break;case"delete":this.emitter.emit("individualChatDeleted",t)}}onMarkerReceived(e){this.emitter.emit(["received",Rr.a.toBare(e.from)],{chat:Rr.a.toBare(e.from),from:"groupchat"===e.type?Rr.a.getResource(e.from):Rr.a.toBare(e.from),id:e.marker.id})}onMarkerDisplayed(e){this.emitter.emit(["displayed",Rr.a.toBare(e.from)],{chat:Rr.a.toBare(e.from),from:"groupchat"===e.type?Rr.a.getResource(e.from):Rr.a.toBare(e.from),id:e.marker.id})}onChat(e){var t="groupchat"===e.type?Rr.a.getResource(e.from):Rr.a.toBare(e.from),n=e.delay?new Date(e.delay.timestamp).getTime():Date.now();this.emitter.emit("chat",{type:e.type,id:Rr.a.toBare(e.from)}),this.emitter.emit(["message",Rr.a.toBare(e.from)],{chat:Rr.a.toBare(e.from),type:e.type,id:e.id,from:t,to:Rr.a.toBare(e.to),timestamp:n,body:e.body,links:e.links})}onMucInvite(e){this.emitter.emit("mucInvite",{chatId:Rr.a.toBare(e.room),conferenceChat:e.reason===Mr,reason:Lr(e.reason)})}onMucLeave(e){this.emitter.emit("mucEnd",{chatId:Rr.a.toBare(e.from)})}onMucTopic(e){this.emitter.emit(["mucConfig",Rr.a.toBare(e.from)],{subject:e.topic})}onMucOther(e){var t=this;return s((function*(){if(e.muc.jid){if("admin"===Rr.a.getLocal(e.muc.jid)||Rr.a.equal(e.muc.jid,e.to))return;t.emitter.emit(["mucPresence",e.from],{jid:Rr.a.toBare(e.muc.jid),affiliation:e.muc.affiliation,role:e.muc.role})}else if(e.muc.statusCodes&&e.muc.statusCodes.includes("104")){var n=yield t.getRoomInfo(e.from);t.emitter.emit(["mucConfig",e.from],n)}}))()}onChatState(e){var t="groupchat"===e.type?Rr.a.getResource(e.from):Rr.a.toBare(e.from);this.emitter.emit(["state",Rr.a.toBare(e.from)],{from:t,to:Rr.a.toBare(e.to),state:e.chatState})}onPresence(e){if(e.muc&&e.muc.jid){if("admin"===Rr.a.getLocal(e.muc.jid))return;if(Rr.a.equalBare(e.muc.jid,e.to))return void("none"===e.muc.affiliation&&this.emitter.emit("mucEnd",{chatId:Rr.a.toBare(e.from)}));this.emitter.emit(["mucPresence",Rr.a.toBare(e.from)],{jid:Rr.a.toBare(e.muc.jid),affiliation:e.muc.affiliation,role:e.muc.role})}}onMessageSent(e){if("chat"===e.type||"groupchat"===e.type){var t={chat:Rr.a.toBare(e.to),type:e.type,id:e.id,to:Rr.a.toBare(e.to),timestamp:e.delay?new Date(e.delay.timestamp).getTime():Date.now(),body:e.body,links:e.links};e.marker&&("received"===e.marker.type?t.received=e.marker.id:"displayed"===e.marker.type&&(t.displayed=e.marker.id)),this.emitter.emit(["message:sent",Rr.a.toBare(e.to)],t)}}onMessage(e){e.body&&e.id&&localStorage.setItem("sippo:lastXmppTimestamp",Date.now())}onMessageError(e){Dr.error(e)}getIndividualChats(){var e=this;return s((function*(){return(yield e.wacRequest.get("xmpp/individualChatList/")).chats}))()}addIndividualChat(e){return this.wacRequest.put("xmpp/individualChatList/".concat(e))}deleteIndividualChat(e){return this.wacRequest.delete("xmpp/individualChatList/".concat(e))}getRoomInfo(e){var t=this;return s((function*(){var n=(yield t.xmppClient.getDiscoInfo(e)).extensions[0].fields,i={};for(var r of n)"muc#roomconfig_roomname"===r.name?i.name=r.value||"":"muc#roominfo_description"===r.name&&(i.subject=r.value||"");return i}))()}getBookmarks(){var e=this;return s((function*(){return(yield e.xmppClient.getBookmarks()).map(e=>e.jid)}))()}addBookmark(e){return this.xmppClient.addBookmark({jid:e})}removeBookmark(e){return this.xmppClient.removeBookmark(e)}createRoom(e,t="",n=""){var i=this;return s((function*(){var r="".concat(Tr()("0123456789_abcdefghijklmnopqrstuvwxyz-",28),"@conference.").concat(Rr.a.getDomain(e));yield i.xmppClient.joinRoom(r,e);var s=(yield i.xmppClient.getRoomConfig(r)).fields.map(e=>"FORM_TYPE"===e.name?{name:e.name,value:e.value}:"muc#roomconfig_roomname"===e.name?{name:e.name,value:t}:"muc#roomconfig_roomdesc"===e.name?{name:e.name,value:n}:"muc#roomconfig_persistentroom"===e.name?{name:e.name,value:"1"}:"muc#roomconfig_publicroom"===e.name?{name:e.name,value:"0"}:"muc#roomconfig_membersonly"===e.name?{name:e.name,value:"1"}:"{http://prosody.im/protocol/muc}roomconfig_allowmemberinvites"===e.name?{name:e.name,value:"1"}:"muc#roomconfig_allowinvites"===e.name?{name:e.name,value:"1"}:"muc#roomconfig_changesubject"===e.name?{name:e.name,value:"1"}:"muc#roomconfig_moderatedroom"===e.name?{name:e.name,value:"0"}:"muc#roomconfig_whois"===e.name?{name:e.name,value:"anyone"}:"muc#roomconfig_enablearchiving"===e.name?{name:e.name,value:"1"}:"muc#roomconfig_historylength"===e.name?{name:e.name,value:"0"}:void 0).filter(e=>e);return yield i.xmppClient.configureRoom(r,{fields:s}),r}))()}setRoomName(e,t){var n=this;return s((function*(){try{var i=(yield n.xmppClient.getRoomConfig(e)).fields;for(var r of i)if("muc#roomconfig_roomname"===r.name){r.value=t;break}yield n.xmppClient.configureRoom(e,{fields:i})}catch(e){throw new Error(e.error.condition)}}))()}setRoomSubject(e,t){return this.xmppClient.setSubject(e,t)}getRoomMembers(e){var t=this;return s((function*(){var n,i,r=yield Promise.all([t.xmppClient.getRoomMembers(e,"owner"),t.xmppClient.getRoomMembers(e,"admin"),t.xmppClient.getRoomMembers(e,"member")]);return(n=e=>e.muc.users||[],i=r,i.reduce((e,t)=>e.concat(n(t)),[])).filter(e=>"admin"!==Rr.a.getLocal(e.jid)).map(e=>({affiliation:e.affiliation,jid:Rr.a.toBare(e.jid)}))}))()}joinRoom(e,t){return this.xmppClient.joinRoom(e,t,{muc:{type:"join",history:{maxCharacters:0}}})}invite(e,t){return t=Array.isArray(t)?t:[t],this.xmppClient.invite(e,[{to:t}])}expel(e,t){return this.xmppClient.setRoomAffiliation(e,t,"none")}setParticipantRole(e,t,n){var i=this;return s((function*(){try{yield i.xmppClient.setRoomAffiliation(e,t,n)}catch(e){throw new Error(e.error.condition)}}))()}leave(e){return this.xmppClient.deleteAccount(e)}destroy(e,t="Room deleted by owner"){var n=this;return s((function*(){try{yield n.xmppClient.destroyRoom(e,{reason:t})}catch(e){throw new Error(e.error.condition)}}))()}setState(e,t,n){return this.xmppClient.sendMessage({to:e,type:t,chatState:n})}fetchMessages(e,t,n,i=50){var r=this;return s((function*(){var s={to:"groupchat"===t?e:void 0,with:"chat"===t?e:void 0,paging:{max:i,before:n||!0}},o=yield r.xmppClient.searchHistory(s);return{results:r.processMamMessages(o.results.reverse()),complete:o.complete,paging:o.paging}}))()}sync(e,t,n){var i=this;return s((function*(){for(var r={to:"groupchat"===t?e:void 0,with:"chat"===t?e:void 0},s=yield i.xmppClient.searchHistory(Pr({},r,{start:new Date(n)})),o=s.results;!s.complete;){var a={after:s.paging.last};s=yield i.xmppClient.searchHistory(Pr({},r,{paging:a})),o=o.concat(s.results)}return i.processMamMessages(s.results)}))()}syncMucInvitations(e){var t=this;return s((function*(){var n=parseInt(localStorage.getItem("sippo:lastXmppTimestamp"));if(n>0){for(var i={to:e,start:new Date(n)},r=yield t.xmppClient.searchHistory(i),s=r.results;!r.complete;){var o={after:r.paging.last};r=yield t.xmppClient.searchHistory(Pr({},i,{paging:o})),s=s.concat(r.results)}for(var{item:a}of s){var{muc:c}=a.message;c&&"invite"===c.action&&c.invite.some(({reason:e})=>e!==Mr)&&t.emitter.emit("mucInvite",{chatId:a.message.from})}return r}}))()}sendMessage(e,t,n){return this.xmppClient.sendMessage({to:e,type:t,body:n,marker:{type:"markable"}})}sendFile(e,t,n,i){return this.xmppClient.sendMessage({to:e,type:t,marker:{type:"markable"},links:[{url:n,description:i}]})}markReceived(e,t,n){return this.xmppClient.markReceived(e,t,n)}markDisplayed(e,t,n){return this.xmppClient.markDisplayed(e,t,n)}enableNotifications(e){var t=this;return s((function*(){var n="".concat(t.pushUri,"/v1/register"),i=Or.a.stringify({node:e.node,type:e.type,token:e.token}),r=yield window.fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}),s=yield r.text(),o=s.split("\n");if("OK"!==o[0])throw new Error("ERROR response from register: "+s);if(o[1]!==e.node)throw new Error("Wrong node received from register: "+o[1]);var a=[{name:"secret",value:o[2]}];return t.xmppClient.enableNotifications(e.jid,e.node,a)}))()}disableNotifications(e){var t=this;return s((function*(){var n="".concat(t.pushUri,"/v1/unregister"),i=Or.a.stringify({node:e.node,type:e.type,token:e.token}),r=yield window.fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}),s=yield r.text(),o=s.split("\n");if("OK"!==o[0])throw new Error("ERROR response from register: "+s);if(o[1]!==e.node)throw new Error("Wrong node received from register: "+o[1]);return t.xmppClient.disableNotifications(e.jid,e.node)}))()}processMamMessages(e){return e.filter(({item:e})=>{var t=e.message.marker,n=e.message.body,i=e.message.links;return n||i||t&&("displayed"===t.type||"received"===t.type)}).map(({item:e})=>{var t=e.message;return{id:t.id,from:"groupchat"===t.type?Rr.a.getResource(t.from):Rr.a.toBare(t.from),to:t.to,timestamp:new Date(e.delay.timestamp).getTime(),body:t.body,links:t.links,displayed:t.marker&&"displayed"===t.marker.type?t.marker.id:void 0,received:t.marker&&"received"===t.marker.type?t.marker.id:void 0}})}createSupportChat(e,t){return this.wacRequest.post("/xmpp/supportChat",{id:e},{context:t})}}var Br=Ii.instance.getLogger("SippoJS/chat/ChatManager");function zr(e,t){var n=e.getLastMessageTimestamp(),i=t.getLastMessageTimestamp();return n<i?1:n>i?-1:0}class Gr{static newInstance(e,t,n,i){return s((function*(){return new Gr(e,t,n,i).init()}))()}constructor(e,t,n,i){this.ownAddress=n.getAddress().toLowerCase(),this.chatService=e,this.fileManager=t,this.user=n,this.sessionToken=i,this.individualChats=new Wt,this.groupChats=new Wt,this.chats=new fn,this.conferenceChats=new fn,this.supportChats=new fn,this.emitter=new Oi.EventEmitter2,c(this,["onIndividualChatAdded","onIndividualChatDeleted","onMucInvite","onMucEnd","onChat","onDisplayed","onMessage","onMessageSent","onFile"])}init(){var e=this;return s((function*(){return e.bindEventHandlers(),yield e.chatService.start(),e}))()}fetchIndividualChats(){var e=this;return s((function*(){var t=yield e.chatService.getIndividualChats();for(var n of(e.individualChats=e.deleteOutdatedChats(e.individualChats,t),t))e.individualChats.has(n)||e.onIndividualChatAdded(n)}))()}fetchGroupChats(){var e=this;return s((function*(){var t=yield e.chatService.getBookmarks();e.groupChats=e.deleteOutdatedChats(e.groupChats,t),yield Promise.all(t.map(function(){var t=s((function*(t){try{if(yield e.chatService.joinRoom(t,e.ownAddress),e.groupChats.has(t))return;var n=yield e.newGroupChat(t);e.groupChats=e.groupChats.set(t,n),e.chats=e.chats.unshift(n)}catch(n){Br.warn("Unable to join MUC ".concat(t)),Br.warn(n),e.onMucEnd({chatId:t})}}));return function(e){return t.apply(this,arguments)}}()))}))()}deleteOutdatedChats(e,t){var n=[...e.keys()].filter(e=>!t.includes(e));return this.chats=this.chats.filter(e=>!n.includes(e.getId())),e.withMutations(e=>{for(var t of n){e.get(t).unbindEventListeners(),e.delete(t)}})}uninit(){this.unbindEventHandlers()}bindEventHandlers(){this.chatService.emitter.on("individualChatAdded",this.onIndividualChatAdded),this.chatService.emitter.on("individualChatDeleted",this.onIndividualChatDeleted),this.chatService.emitter.on("mucInvite",this.onMucInvite),this.chatService.emitter.on("mucEnd",this.onMucEnd),this.chatService.emitter.on("chat",this.onChat),this.chatService.emitter.on(["displayed","*"],this.onDisplayed),this.chatService.emitter.on(["message:sent","*"],this.onMessageSent),this.chatService.emitter.on(["message","*"],this.onMessage),this.chatService.emitter.on(["file","*"],this.onFile)}unbindEventHandlers(){this.chatService.emitter.off("individualChatAdded",this.onIndividualChatAdded),this.chatService.emitter.off("individualChatDeleted",this.onIndividualChatDeleted),this.chatService.emitter.off("mucInvite",this.onMucInvite),this.chatService.emitter.off("mucEnd",this.onMucEnd),this.chatService.emitter.off("chat",this.onChat),this.chatService.emitter.off(["displayed","*"],this.onDisplayed),this.chatService.emitter.off(["message:sent","*"],this.onMessageSent),this.chatService.emitter.off(["message","*"],this.onMessage),this.chatService.emitter.off(["file","*"],this.onFile)}newIndividualChat(e){var t=_r.INDIVIDUAL,n=[{jid:this.ownAddress,affiliation:wr.MEMBER},{jid:e,affiliation:wr.MEMBER}],i=Er.newInstance(this.chatService,this.fileManager,this.user,{id:e,type:t,participants:n});return i.bindEventListeners(),i}newGroupChat(e){var t=this;return s((function*(){var n=yield t.chatService.getRoomMembers(e),i=yield t.chatService.getRoomInfo(e),r=i.name,s=i.subject,o=_r.GROUP,a=Er.newInstance(t.chatService,t.fileManager,t.user,{id:e,type:o,name:r,subject:s,participants:n});return a.bindEventListeners(),a}))()}promoteChat({jid:e,type:t}){var n="chat"===t?this.individualChats.get(e):this.groupChats.get(e),i=this.chats.indexOf(n);i>0&&(this.chats=this.chats.delete(i).unshift(n),this.emitter.emit("chats"))}onIndividualChatAdded(e){var t=this.individualChats.get(e);t||(t=this.newIndividualChat(e),this.individualChats=this.individualChats.set(e,t),this.chats=this.chats.unshift(t),this.emitter.emit("chats"))}onIndividualChatDeleted(e){var t=this.individualChats.get(e);t&&(t.unbindEventListeners(),this.individualChats=this.individualChats.remove(e),this.chats=this.chats.filter(e=>e!==t),this.emitter.emit("chats"))}onDisplayed(e){e.from===this.ownAddress&&this.emitter.emit("messageDisplayed")}onMessage(e){this.emitter.emit("message",{chat:e.chat,from:e.from,to:e.to,timestamp:e.timestamp,body:e.body,type:e.type}),this.promoteChat({jid:e.chat,type:e.type})}onMessageSent(e){e.displayed?this.emitter.emit("messageDisplayed"):(e.links||e.body)&&this.promoteChat({jid:e.chat,type:e.type})}onFile(e){this.emitter.emit("file",{chat:e.chat,from:e.from,to:e.to,timestamp:e.timestamp,desc:e.desc,url:e.url,type:e.type}),this.promoteChat({jid:e.chat,type:e.type})}onChat(e){"chat"===e.type&&this.getIndividualChat(e.id)}onMucInvite(e){var t=this;return s((function*(){var n=e.chatId,i=t.groupChats.get(n);i||(yield t.chatService.joinRoom(n,t.ownAddress),i=yield t.newGroupChat(n),t.groupChats=t.groupChats.set(n,i),yield i.sync(),e.conferenceChat?(t.conferenceChats=t.conferenceChats.unshift(i),t.emitter.emit("conferenceChats",i)):e.reason===Fr?(t.supportChats=t.supportChats.unshift(i),t.emitter.emit("supportChat",i)):(yield t.chatService.addBookmark(n),t.chats=t.chats.unshift(i),t.emitter.emit("chats",i)))}))()}onMucEnd(e){var t=this;return s((function*(){var n=t.groupChats.get(e.chatId);n&&(n.unbindEventListeners(),t.groupChats=t.groupChats.remove(n.getId()),t.conferenceChats.includes(n)?(t.conferenceChats=t.conferenceChats.filter(e=>e!==n),t.emitter.emit("conferenceChats",n)):(t.chats=t.chats.filter(e=>e!==n),yield t.chatService.removeBookmark(e.chatId),t.emitter.emit("chats",n)))}))()}setPushConfig({jid:e,type:t,token:n}){var i=this.sessionToken;this.pushConfig={jid:e,type:t,token:n,node:i}}enablePushNotifications(){return this.chatService.enableNotifications(this.pushConfig)}disablePushNotifications(){return this.chatService.disableNotifications(this.pushConfig)}createChat(e="",t=""){var n=this;return s((function*(){var i=yield n.chatService.createRoom(n.ownAddress,e,t);yield n.chatService.addBookmark(i);var r=yield n.newGroupChat(i);return n.groupChats=n.groupChats.set(i,r),n.chats=n.chats.unshift(r),n.emitter.emit("chats",r),r}))()}getIndividualChat(e){e=e.toLowerCase();var t=this.individualChats.get(e);return t||(t=this.newIndividualChat(e),this.individualChats=this.individualChats.set(e,t),this.chatService.addIndividualChat(e),this.chats=this.chats.unshift(t),this.emitter.emit("chats")),t}getGroupChat(e){var t=this.groupChats.get(e);if(!t)throw Error("There is no group with id: ".concat(e));return t}getChats(){return this.chats}getConferenceChats(){return this.conferenceChats}sync(){var e=this;return s((function*(){yield Promise.all([e.fetchIndividualChats(),e.fetchGroupChats()]),yield e.chatService.syncMucInvitations(e.ownAddress),yield Promise.all(e.chats.map(e=>e.sync())),e.chats=e.chats.sort(zr),e.emitter.emit("chats")}))()}createSupportChat(e={}){var t=this;return s((function*(){return new Promise((n,i)=>{var r=Object(kr.uuid)(),s=e=>{n(e),t.emitter.off("supportChat",s)};t.emitter.on("supportChat",s),t.emitter.on("suppe",i),t.chatService.createSupportChat(r,e).catch(i)})}))()}}var Wr={unknown:"unknown",appointment:"appointment",away:"away",breakfast:"breakfast",busy:"busy",dinner:"dinner",holiday:"holiday","in-transit":"in-transit","looking-for-work":"looking-for-work",lunch:"lunch",meal:"meal",meeting:"meeting","on-the-phone":"on-the-phone",other:"other",performance:"performance","permanent-absence":"permanent-absence",playing:"playing",presentation:"presentation",shopping:"shopping",sleeping:"sleeping",spectator:"spectator",steering:"steering",travel:"travel",tv:"tv",vacation:"vacation",working:"working",worship:"worship"},Hr={unknown:"unknown",afraid:"afraid",amazed:"amazed",angry:"angry",annoyed:"annoyed",anxious:"anxious",ashamed:"ashamed",bored:"bored",brave:"brave",calm:"calm",cold:"cold",confused:"confused",contented:"contented",cranky:"cranky",curious:"curious",depressed:"depressed",disappointed:"disappointed",disgusted:"disgusted",distracted:"distracted",embarrassed:"embarrassed",excited:"excited",flirtatious:"flirtatious",frustrated:"frustrated",grumpy:"grumpy",guilty:"guilty",happy:"happy",hot:"hot",humbled:"humbled",humiliated:"humiliated",hungry:"hungry",hurt:"hurt",impressed:"impressed",in_awe:"in_awe",in_love:"in_love",indignant:"indignant",interested:"interested",invincible:"invincible",jealous:"jealous",lonely:"lonely",mean:"mean",moody:"moody",nervous:"nervous",neutral:"neutral",offended:"offended",other:"other",playful:"playful",proud:"proud",relieved:"relieved",remorseful:"remorseful",restless:"restless",sad:"sad",sarcastic:"sarcastic",serious:"serious",shocked:"shocked",shy:"shy",sick:"sick",sleepy:"sleepy",stressed:"stressed",surprised:"surprised",thirsty:"thirsty",worried:"worried"},Vr=Ii.instance.getLogger("SippoJS/Presence");class $r extends Oi.EventEmitter2{get ACTIVITY(){return Vr.warn('Presence.ACTIVITY is deprecated. Please use import {PresenceActivity} from "@quobis/sippojs" instead'),Wr}get MOOD(){return Vr.warn('Presence.MOOD is deprecated. Please use import {PresenceMood} from "@quobis/sippojs" instead'),Hr}constructor(e,t){super(),this._presenceManager=e,this._online=!1,this._activity=Wr.unknown,this._mood=Hr.unknown,this._note="",this._avatar="",this._displayName="",c(this,["onPresenceUpdated"]),t||(this._initializing=Promise.resolve()),this.address=t}get address(){return this._address}set address(e){this._address!==e&&(this._address&&(this._presenceManager.unsubscribeFromPresence(this._address),this._presenceManager.emitter.off("updated",this.onPresenceUpdated),this.update({online:!1,activity:"unknown",mood:"unknown",note:"",avatar:"",displayName:"",address:""})),this._address=e,this._address&&(this._initializing=this._presenceManager.subscribeToPresence(this._address),this._initializing.then(e=>{this.update(e)}),this._presenceManager.emitter.on("updated",this.onPresenceUpdated)))}get online(){return this._online}get activity(){return this._activity}get mood(){return this._mood}get note(){return this._note}get avatar(){return this._avatar}get displayName(){return this._displayName}waitUntilSynced(){return this._initializing}onPresenceUpdated(e){e.address===this._address&&this.update(e)}update(e){this._online=e.online,this._activity=Wr[e.activity],this._mood=Hr[e.mood],this._note=e.note,this._avatar=e.avatar,this._displayName=e.displayName,this._address=e.address,this.emit("update")}toJSON(){return{address:this._address,online:this._online,activity:Wr[this._activity],mood:Hr[this._mood],note:this._note,avatar:this._avatar,displayName:this._displayName}}}var Jr=Ii.instance.getLogger("SippoJS/OwnPresence");class Yr extends $r{constructor(e,t,n){super(t,n),this._stack=e}get online(){return super.online}set online(e){this._online=e,this._sendUpdate()}get activity(){return super.activity}set activity(e){if(!Wr[e])throw Error("".concat(e," is not a valid activity"));this._activity=e,this._sendUpdate()}get mood(){return super.mood}set mood(e){if(!Hr[e])throw Error("".concat(e," is not a valid mood"));this._mood=e,this._sendUpdate()}get note(){return super.note}set note(e){this._note=e,this._sendUpdate()}get avatar(){return super.avatar}set avatar(e){this._avatar=e,this._sendUpdate()}get displayName(){return super.displayName}set displayName(e){this._displayName=e,this._sendUpdate()}setDisplayName(e){return this._displayName=e,this._sendUpdate()}_sendUpdate(){return this._presenceManager.updatePresence(this.address,this.toJSON()).catch(e=>{Jr.error("Error updating presence: ".concat(e))})}scaleImg(e,t,n){return g(e,t,n)}}class Qr{constructor(e){this._pending=[],this._timer=null,this._observer=e}set observer(e){this._observer=e}addToQueue(e){return this._timer&&(clearTimeout(this._timer),this._timer=null),new Promise((t,n)=>{this._pending.push({resolve:t,reject:n,data:e}),this._timer=setTimeout(()=>{var e=this._pending;this._pending=[],this._observer.commit(e)},10)})}}class Kr{constructor(e,t){this._stack=e,this._collection=t,this._queue=new Qr(this)}resolve(e){return e=e.toLowerCase(),this._collection.isSubscribedTo(e)?Promise.resolve():this._queue.addToQueue(e)}commit(e){this._stack.getResolver().resolveUsers(e.map(e=>e.data)).then(t=>{t.resolved.forEach(e=>this._collection.addUser(e)),this._collection.updateSubscribed(t.subscribed),e.forEach(e=>e.resolve(this._collection.resolve(e.data)))}).catch(t=>{e.forEach(e=>e.reject(t))})}}var Xr=RegExp("^(".concat("wac-user:",")(\\w*)$"));class Zr{constructor(e){this._usersById={},this._usersByCompleteUsername={},this._usersByAlias={},this._usersByLandLineNumber={},this._usersByMobilePhone={},this._usersByGatewayUsername={},this._userDomain=e,this._subscribed=[]}isSubscribedTo(e){return this._subscribed.includes(e)}updateSubscribed(e){this._subscribed=e}addUser(e){e.getAddress=()=>"wac-user:"+e.id,this._usersById[e.id]=e,this._usersByCompleteUsername["".concat(e.username,"@").concat(e.domain).toLowerCase()]=e,e.alias&&(this._usersByAlias[e.alias]=e),e.landLineNumber&&(this._usersByLandLineNumber[e.landLineNumber]=e),e.gatewayUsername&&(this._usersByGatewayUsername[e.gatewayUsername]=e),e.mobilePhone.forEach(t=>{this._usersByMobilePhone[t]=e})}updateUsers(e,t){var n=[];e.forEach(e=>{this._usersById[e.id]&&(e=Object.assign(this._usersById[e.id],e)),n.push(e)}),this._usersById={},this._usersByCompleteUsername={},this._usersByAlias={},this._usersByLandLineNumber={},this._usersByGatewayUsername={},this._usersByMobilePhone={},this._subscribed=t,n.forEach(this.addUser.bind(this))}resolve(e){if(Xr.test(e)){var t=Xr.exec(e)[2];return this._usersById[t]}return this._usersById[e]||this._usersByCompleteUsername[e.toLowerCase()]||this._usersByCompleteUsername["".concat(e,"@").concat(this._userDomain).toLowerCase()]||this._usersByAlias[e]||this._usersByLandLineNumber[e]||this._usersByMobilePhone[e]||this._usersByGatewayUsername[e]}}var es="updated";class ts extends Oi.EventEmitter2{constructor(e){super(),this._init=null,this._stack=e,this._collection=null,this._resolveQueue=null,this.setMaxListeners(0),c(this,["onResolveUpdated"])}init(){var e=this;return this._init||(this._stack.getResolver().emitter.on("update",this.onResolveUpdated),this._init=s((function*(){var t=yield e._stack.getResolver().getResolvedUsers();e._collection=new Zr(e._stack.getCurrentSession().domain),e._collection.updateUsers(t.resolved,t.subscribed),e._resolveQueue=new Kr(e._stack,e._collection)}))()),this._init}uninit(){this._stack.getResolver().emitter.off("update",this.onResolveUpdated),this._init=null,this._collection=null,this._resolveQueue=null}getAddress(e){return"".concat("wac-user:").concat(e)}getUserId(e){return e.replace(Xr,"$2")}isAddress(e){return Xr.test(e)}getOwnAddress(){return this.getAddress(this._stack.getCurrentSession().user)}isOwnAddress(e){return this.getUserId(e)===this._stack.getCurrentSession().user}resolveUser(e){var t=this;return s((function*(){if(!t._init)throw new Error("not initialized");return yield t._init,t._collection.resolve(e)||t._resolveQueue.resolve(e)}))()}getUsername(e,t=!0){var n=this._collection.resolve(e);return n&&n.gatewayUsername===e?Promise.resolve(n.username):this._stack.getResolver().getUserByGatewayUsername(e).then(e=>this.resolveUser(e)).then(e=>e.username).catch(n=>{if(t)return e;throw n})}getGatewayUsername(e,t=!0){return this.resolveUser(e).then(e=>e.gatewayUsername?e.gatewayUsername:this._stack.getResolver().getGatewayUsernameByUser(e.id)).catch(n=>{if(t)return e;throw n})}getGatewayUsernames(e,t=!0){return Promise.all(e.map(e=>this.getGatewayUsername(e,t)))}onResolveUpdated(e){this._collection.updateUsers(e.resolved,e.subscribed),this.emit(es)}}var ns=e=>{var{id:t,name:n="",source:i="",favorite:r=!1}=e;return{getId:()=>t,getName:()=>n,getSource:()=>i,isFavorite:()=>r,setName:e=>{n=e},setFavorite:e=>{r=e},setSource:e=>{i=e},setId:e=>{t=e}}},is=(e,t,n)=>e?t.updateContact(n):void 0,rs=(e,t)=>t.removeContact({id:e});class ss extends Oi.EventEmitter2{constructor(e,t,n,i,r={}){super(),this._stack=e,this._userManager=t,this._presenceManager=n,this._favoriteManager=i,this._base=ns(r),this._phones=r.phones||[],this._unnormalizedPhones=r.unnormalizedPhones||[],this._emails=r.emails||[],this._presence=!1,this._deviceId=r.deviceId||"",this._contactDeviceId=r.contactDeviceId||"",this._avatar=r.avatar||"",this._user=null,r.presence&&(this._presence=r.presence),this._userManager&&(this._updateUser(),this._userManager.on(es,this._updateUser.bind(this)))}get id(){return this._base.getId()}get name(){return this._base.getName()}set name(e){this._base.setName(e),is(this._base.getId(),this._stack,this.toJSON())}get address(){if(!this.isWacUser)throw Error("Not implemented for contacts without associated user");return this._user.username+"@"+this._user.domain}get phones(){return this.isWacUser&&this._user.id===this._user.username?[]:this._phones}set phones(e){this._phones=e,this._updateUser(),is(this._base.getId(),this._stack,this.toJSON())}get phone(){return this.phones.length?this.phones[0].address:void 0}set phone(e){this.phones=[{name:"",address:e},...this.phones.filter(e=>""!==e.name)]}get unnormalizedPhones(){return this._unnormalizedPhones}set unnormalizedPhones(e){this._unnormalizedPhones=e}get emails(){return this._emails}set emails(e){this._emails=e,is(this._base.getId(),this._stack,this.toJSON())}get email(){var e=this.emails.find(e=>""===e.type);return e?e.email:void 0}set email(e){this.emails=[{type:"",email:e},...this.emails.filter(e=>""!==e.type)]}get presence(){if(!this._presence){var e=this._user?this._user.getAddress():void 0;this._presence=new $r(this._presenceManager,e)}return this._presence}get source(){return this._base.getSource()}set source(e){this._base.setSource(e),is(this._base.getId(),this._stack,this.toJSON())}get isErasable(){return this.isEditable}get isEditable(){return!["static","domain","users-group"].includes(this.source)}remove(){return rs(this._base.getId(),this._stack).then(()=>this._remove())}get favorite(){return this._base.isFavorite()}set favorite(e){this._base.setFavorite(e),e?this._favoriteManager.saveFavorite(this.contactDeviceId):this._favoriteManager.removeFavorite(this.contactDeviceId),is(this._base.getId(),this._stack,this.toJSON())}get avatar(){return this._avatar||this.presence.avatar}set avatar(e){this._avatar=e}get isWacUser(){return!!this._user}get deviceId(){return this._deviceId}set deviceId(e){this._deviceId=e}get contactDeviceId(){return this._contactDeviceId}set contactDeviceId(e){this._contactDeviceId=e}getWacUserAddress(){return this._user?this._user.getAddress():void 0}_update(e){this._base.setId(e.id),this._base.setName(e.name),this._base.setFavorite(e.favorite),this._base.setSource(e.source),this._phones=e.phones,this._unnormalizedPhones=e.unnormalizedPhones,this._emails=e.emails,this._updateUser(),this._deviceId=e.deviceId,this._contactDeviceId=e.contactDeviceId,this.emit("update")}_updateUser(){return Promise.all(this.phones.map(e=>this._userManager.resolveUser(e.address).then(t=>({user:t,phone:e})))).then(e=>{var t,n,i=[];e.forEach(e=>{!t&&e.user?(t=e.user,n=e.phone):i.push(e.phone)});var r=!1;t&&(this._phones=[n].concat(i),r=!0),this._user!==t&&(this._user=t,this._presence&&(this._presence.address=this._user?this._user.getAddress():null),r=!0),r&&this.emit("update")})}_remove(){this._stack=null,this._presence=null,this.emit("delete")}toJSON(){return{id:this.id,name:this.name,source:this.source,favorite:this.favorite,phones:this.phones,unnormalizedPhones:this.unnormalizedPhones,emails:this.emails,deviceId:this.deviceId,contactDeviceId:this.contactDeviceId,isWacUser:this.isWacUser}}}function os(e){return e&&e.length>0?e[0].value:null}var as=(e,t)=>{var n=t.navigator,i=l(),r=t.ContactFindOptions;function o(){if(!i)throw Error("W3C Contacts: Can`t get device ID")}function a(e){o();var t,n=e.phoneNumbers.slice(0,10).map(e=>({name:e.type,address:e.value.replace(/\s/g,"")})),r=(t=e.emails)?t.map(e=>({type:e.type,email:e.value})):[],s=function(e,t){return e.displayName||(e.name&&e.name.formatted?e.name.formatted:t[0].address)}(e,n);return{contactDeviceId:"w3c-contact-".concat(e.id,"-").concat(i),name:s,source:"device",phones:n,emails:r,avatar:os(e.photos),deviceId:i}}function c(e){return o(),{contactDeviceId:"w3c-contact-".concat(e.id,"-").concat(i),avatar:os(e.photos)}}function u(){return new Promise((e,t)=>{var i=new r;i.multiple=!0,i.hasPhoneNumber=!0,i.desiredFields=[n.contacts.fieldType.displayName,n.contacts.fieldType.name,n.contacts.fieldType.phoneNumbers,n.contacts.fieldType.note,n.contacts.fieldType.emails],n.contacts.find(["*"],e,t,i)})}function h(e="*",t=""){return new Promise((i,s)=>{var o=new r;o.multiple=!0,o.hasPhoneNumber=!0,o.desiredFields=[n.contacts.fieldType.photos],t&&(o.filter=t),n.contacts.find([e],i,s,o)})}function d(){return e.getCapabilities().includes("w3c-contacts-api")&&n.contacts}function p(){return(p=s((function*(){return d()?(yield u()).filter(e=>e.phoneNumbers&&e.phoneNumbers.length>0).map(a):[]}))).apply(this,arguments)}function f(){return(f=s((function*(){return d()?(yield h()).map(c):[]}))).apply(this,arguments)}return{getContacts:function(){return p.apply(this,arguments)},getAvatarContacts:function(){return f.apply(this,arguments)}}};class cs{constructor(e){this._stack=e,this._w3cContacts=as(this._stack,window||{}),this._deviceId=l()}getContactsWac(){var e=this;return s((function*(){var t={};return h()&&(t.deviceId=-1),e._stack.getContacts(t)}))()}getContactsDevice(){return this._w3cContacts.getContacts()}getAvatarDeviceContacts(){return this._w3cContacts.getAvatarContacts().then(e=>{var t=new Map;return(e=e.filter(e=>!!e.avatar)).forEach(e=>{t.set(e.contactDeviceId,e.avatar)}),t})}}var us=n(63),hs=n.n(us);function ls(e){return(new hs.a.MD5).hex(JSON.stringify(e))}function ds(){return y("savedDeviceWacContacts")}function ps(e){b("savedDeviceWacContacts",e)}function fs(e){b("savedWacContacts",e),b("hashWacContacts",ls(e))}function ms(){return y("savedWacContacts")}function gs(e){b("hashDeviceContacts",ls(e)),b("savedDeviceContacts",e)}function vs(){b("validCache",!0)}function ys(){b("validCache",!1),_("savedDeviceContacts"),_("hashDeviceContacts"),_("savedAvatarDeviceContacts")}function bs(e){b("favoriteContacts",e)}function _s(){_("savedDeviceWacContacts"),_("savedWacContacts"),_("hashWacContacts"),_("savedUser"),ys()}var ws=function(){this.__data__=[],this.size=0};var Ss=function(e,t){return e===t||e!=e&&t!=t};var Cs=function(e,t){for(var n=e.length;n--;)if(Ss(e[n][0],t))return n;return-1},Es=Array.prototype.splice;var ks=function(e){var t=this.__data__,n=Cs(t,e);return!(n<0)&&(n==t.length-1?t.pop():Es.call(t,n,1),--this.size,!0)};var xs=function(e){var t=this.__data__,n=Cs(t,e);return n<0?void 0:t[n][1]};var Is=function(e){return Cs(this.__data__,e)>-1};var Os=function(e,t){var n=this.__data__,i=Cs(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this};function js(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}js.prototype.clear=ws,js.prototype.delete=ks,js.prototype.get=xs,js.prototype.has=Is,js.prototype.set=Os;var Ts=js;var Rs=function(){this.__data__=new Ts,this.size=0};var As=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var Ps=function(e){return this.__data__.get(e)};var Ds=function(e){return this.__data__.has(e)},Ms=n(6),qs=Ms.a.Symbol,Ns=Object.prototype,Fs=Ns.hasOwnProperty,Ls=Ns.toString,Us=qs?qs.toStringTag:void 0;var Bs=function(e){var t=Fs.call(e,Us),n=e[Us];try{e[Us]=void 0;var i=!0}catch(e){}var r=Ls.call(e);return i&&(t?e[Us]=n:delete e[Us]),r},zs=Object.prototype.toString;var Gs=function(e){return zs.call(e)},Ws=qs?qs.toStringTag:void 0;var Hs=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Ws&&Ws in Object(e)?Bs(e):Gs(e)};var Vs=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var $s,Js=function(e){if(!Vs(e))return!1;var t=Hs(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Ys=Ms.a["__core-js_shared__"],Qs=($s=/[^.]+$/.exec(Ys&&Ys.keys&&Ys.keys.IE_PROTO||""))?"Symbol(src)_1."+$s:"";var Ks=function(e){return!!Qs&&Qs in e},Xs=Function.prototype.toString;var Zs=function(e){if(null!=e){try{return Xs.call(e)}catch(e){}try{return e+""}catch(e){}}return""},eo=/^\[object .+?Constructor\]$/,to=Function.prototype,no=Object.prototype,io=to.toString,ro=no.hasOwnProperty,so=RegExp("^"+io.call(ro).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var oo=function(e){return!(!Vs(e)||Ks(e))&&(Js(e)?so:eo).test(Zs(e))};var ao=function(e,t){return null==e?void 0:e[t]};var co=function(e,t){var n=ao(e,t);return oo(n)?n:void 0},uo=co(Ms.a,"Map"),ho=co(Object,"create");var lo=function(){this.__data__=ho?ho(null):{},this.size=0};var po=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},fo=Object.prototype.hasOwnProperty;var mo=function(e){var t=this.__data__;if(ho){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return fo.call(t,e)?t[e]:void 0},go=Object.prototype.hasOwnProperty;var vo=function(e){var t=this.__data__;return ho?void 0!==t[e]:go.call(t,e)};var yo=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ho&&void 0===t?"__lodash_hash_undefined__":t,this};function bo(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}bo.prototype.clear=lo,bo.prototype.delete=po,bo.prototype.get=mo,bo.prototype.has=vo,bo.prototype.set=yo;var _o=bo;var wo=function(){this.size=0,this.__data__={hash:new _o,map:new(uo||Ts),string:new _o}};var So=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Co=function(e,t){var n=e.__data__;return So(t)?n["string"==typeof t?"string":"hash"]:n.map};var Eo=function(e){var t=Co(this,e).delete(e);return this.size-=t?1:0,t};var ko=function(e){return Co(this,e).get(e)};var xo=function(e){return Co(this,e).has(e)};var Io=function(e,t){var n=Co(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this};function Oo(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}Oo.prototype.clear=wo,Oo.prototype.delete=Eo,Oo.prototype.get=ko,Oo.prototype.has=xo,Oo.prototype.set=Io;var jo=Oo;var To=function(e,t){var n=this.__data__;if(n instanceof Ts){var i=n.__data__;if(!uo||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new jo(i)}return n.set(e,t),this.size=n.size,this};function Ro(e){var t=this.__data__=new Ts(e);this.size=t.size}Ro.prototype.clear=Rs,Ro.prototype.delete=As,Ro.prototype.get=Ps,Ro.prototype.has=Ds,Ro.prototype.set=To;var Ao=Ro;var Po=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Do=function(e){return this.__data__.has(e)};function Mo(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new jo;++t<n;)this.add(e[t])}Mo.prototype.add=Mo.prototype.push=Po,Mo.prototype.has=Do;var qo=Mo;var No=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1};var Fo=function(e,t){return e.has(t)};var Lo=function(e,t,n,i,r,s){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e);if(u&&s.get(t))return u==t;var h=-1,l=!0,d=2&n?new qo:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],f=t[h];if(i)var m=o?i(f,p,h,t,e,s):i(p,f,h,e,t,s);if(void 0!==m){if(m)continue;l=!1;break}if(d){if(!No(t,(function(e,t){if(!Fo(d,t)&&(p===e||r(p,e,n,i,s)))return d.push(t)}))){l=!1;break}}else if(p!==f&&!r(p,f,n,i,s)){l=!1;break}}return s.delete(e),s.delete(t),l},Uo=Ms.a.Uint8Array;var Bo=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n};var zo=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Go=qs?qs.prototype:void 0,Wo=Go?Go.valueOf:void 0;var Ho=function(e,t,n,i,r,s,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Uo(e),new Uo(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ss(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Bo;case"[object Set]":var c=1&i;if(a||(a=zo),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;i|=2,o.set(e,t);var h=Lo(a(e),a(t),i,r,s,o);return o.delete(e),h;case"[object Symbol]":if(Wo)return Wo.call(e)==Wo.call(t)}return!1};var Vo=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e},$o=Array.isArray;var Jo=function(e,t,n){var i=t(e);return $o(e)?i:Vo(i,n(e))};var Yo=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,s=[];++n<i;){var o=e[n];t(o,n,e)&&(s[r++]=o)}return s};var Qo=function(){return[]},Ko=Object.prototype.propertyIsEnumerable,Xo=Object.getOwnPropertySymbols,Zo=Xo?function(e){return null==e?[]:(e=Object(e),Yo(Xo(e),(function(t){return Ko.call(e,t)})))}:Qo;var ea=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i};var ta=function(e){return null!=e&&"object"==typeof e};var na=function(e){return ta(e)&&"[object Arguments]"==Hs(e)},ia=Object.prototype,ra=ia.hasOwnProperty,sa=ia.propertyIsEnumerable,oa=na(function(){return arguments}())?na:function(e){return ta(e)&&ra.call(e,"callee")&&!sa.call(e,"callee")},aa=n(18),ca=/^(?:0|[1-9]\d*)$/;var ua=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ca.test(e))&&e>-1&&e%1==0&&e<t};var ha=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},la={};la["[object Float32Array]"]=la["[object Float64Array]"]=la["[object Int8Array]"]=la["[object Int16Array]"]=la["[object Int32Array]"]=la["[object Uint8Array]"]=la["[object Uint8ClampedArray]"]=la["[object Uint16Array]"]=la["[object Uint32Array]"]=!0,la["[object Arguments]"]=la["[object Array]"]=la["[object ArrayBuffer]"]=la["[object Boolean]"]=la["[object DataView]"]=la["[object Date]"]=la["[object Error]"]=la["[object Function]"]=la["[object Map]"]=la["[object Number]"]=la["[object Object]"]=la["[object RegExp]"]=la["[object Set]"]=la["[object String]"]=la["[object WeakMap]"]=!1;var da=function(e){return ta(e)&&ha(e.length)&&!!la[Hs(e)]};var pa=function(e){return function(t){return e(t)}},fa=n(13),ma=fa.a&&fa.a.isTypedArray,ga=ma?pa(ma):da,va=Object.prototype.hasOwnProperty;var ya=function(e,t){var n=$o(e),i=!n&&oa(e),r=!n&&!i&&Object(aa.a)(e),s=!n&&!i&&!r&&ga(e),o=n||i||r||s,a=o?ea(e.length,String):[],c=a.length;for(var u in e)!t&&!va.call(e,u)||o&&("length"==u||r&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ua(u,c))||a.push(u);return a},ba=Object.prototype;var _a=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ba)};var wa=function(e,t){return function(n){return e(t(n))}},Sa=wa(Object.keys,Object),Ca=Object.prototype.hasOwnProperty;var Ea=function(e){if(!_a(e))return Sa(e);var t=[];for(var n in Object(e))Ca.call(e,n)&&"constructor"!=n&&t.push(n);return t};var ka=function(e){return null!=e&&ha(e.length)&&!Js(e)};var xa=function(e){return ka(e)?ya(e):Ea(e)};var Ia=function(e){return Jo(e,xa,Zo)},Oa=Object.prototype.hasOwnProperty;var ja=function(e,t,n,i,r,s){var o=1&n,a=Ia(e),c=a.length;if(c!=Ia(t).length&&!o)return!1;for(var u=c;u--;){var h=a[u];if(!(o?h in t:Oa.call(t,h)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var d=!0;s.set(e,t),s.set(t,e);for(var p=o;++u<c;){var f=e[h=a[u]],m=t[h];if(i)var g=o?i(m,f,h,t,e,s):i(f,m,h,e,t,s);if(!(void 0===g?f===m||r(f,m,n,i,s):g)){d=!1;break}p||(p="constructor"==h)}if(d&&!p){var v=e.constructor,y=t.constructor;v!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof y&&y instanceof y)&&(d=!1)}return s.delete(e),s.delete(t),d},Ta=co(Ms.a,"DataView"),Ra=co(Ms.a,"Promise"),Aa=co(Ms.a,"Set"),Pa=co(Ms.a,"WeakMap"),Da=Zs(Ta),Ma=Zs(uo),qa=Zs(Ra),Na=Zs(Aa),Fa=Zs(Pa),La=Hs;(Ta&&"[object DataView]"!=La(new Ta(new ArrayBuffer(1)))||uo&&"[object Map]"!=La(new uo)||Ra&&"[object Promise]"!=La(Ra.resolve())||Aa&&"[object Set]"!=La(new Aa)||Pa&&"[object WeakMap]"!=La(new Pa))&&(La=function(e){var t=Hs(e),n="[object Object]"==t?e.constructor:void 0,i=n?Zs(n):"";if(i)switch(i){case Da:return"[object DataView]";case Ma:return"[object Map]";case qa:return"[object Promise]";case Na:return"[object Set]";case Fa:return"[object WeakMap]"}return t});var Ua=La,Ba=Object.prototype.hasOwnProperty;var za=function(e,t,n,i,r,s){var o=$o(e),a=$o(t),c=o?"[object Array]":Ua(e),u=a?"[object Array]":Ua(t),h="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),d=c==u;if(d&&Object(aa.a)(e)){if(!Object(aa.a)(t))return!1;o=!0,h=!1}if(d&&!h)return s||(s=new Ao),o||ga(e)?Lo(e,t,n,i,r,s):Ho(e,t,c,n,i,r,s);if(!(1&n)){var p=h&&Ba.call(e,"__wrapped__"),f=l&&Ba.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return s||(s=new Ao),r(m,g,n,i,s)}}return!!d&&(s||(s=new Ao),ja(e,t,n,i,r,s))};var Ga=function e(t,n,i,r,s){return t===n||(null==t||null==n||!ta(t)&&!ta(n)?t!=t&&n!=n:za(t,n,i,r,e,s))};var Wa=function(e,t){return Ga(e,t)},Ha=Ii.instance.getLogger("SippoJS/ContactSynchronizer");var Va=e=>"not-sync-avatars"===e.message?Promise.resolve():Promise.reject(e);class $a extends Oi.EventEmitter2{constructor(e,t){super(),this._stack=e,this._retriever=new cs(e),this._deviceId=l(),this._favoriteContacts=t}syncContacts(e){if(this._isAllowDeviceContacts())return this._invalidateAndSyncContacts(e);this.emit("stop-synchronizing")}launchSynchronize(){var e=Promise.resolve();return this._isAllowDeviceContacts()&&(e=this._retriever.getContactsDevice().then(e=>{if(!function(e){return y("hashDeviceContacts")===ls(e)}(e)){this.emit("start-synchronizing");var t=ds();ys();var n=this._getContactsToDeleted(t,e),[i,r]=this._getContactsToSynchronize(t,e);return[n,i,r].reduce((e,t)=>e+=t.length,0)>=30?this._uploadAllContactsAgain(e):this._sendUpdatesToWac(n,i,r,e)}this.emit("stop-synchronizing")}).then(()=>this.launchSynchronizeAvatars()).catch(Va)),e}_getContactsToSynchronize(e,t){var n=new Map(e.map(e=>[e.contactDeviceId,e])),i=[],r=[];return t.forEach(e=>{if(n.has(e.contactDeviceId)){var t=n.get(e.contactDeviceId);return Wa(e,function(e){var t=Object.assign({},e);return delete t.user,delete t.favorite,delete t.id,delete t.unnormalizedPhones,t.avatar=null,t.phones=e.unnormalizedPhones,t}(t))?void 0:i.push((s=t,o=e,Object.assign(s,o)))}var s,o;return r.push(e)}),[i,r]}_getContactsToDeleted(e,t){var n=new Map(t.map(e=>[e.contactDeviceId,e]));return e.map(e=>{if(!n.has(e.contactDeviceId))return e}).filter(e=>!!e)}_sendUpdatesToWac(e,t,n,i){return t=this._favoriteContacts.updateContactsWithFavoriteFlag(t),Promise.all([this._removeContacts(e),this._addContacts(n),this._updateContacts(t)]).then(()=>{gs(i),vs()})}launchSynchronizeAvatars(){if(this._isAllowDeviceContacts())return this._retriever.getAvatarDeviceContacts().then(e=>{!function(e){b("savedAvatarDeviceContacts",e)}(Array.from(e)),this.emit("update-avatars-contacts",e)})}_invalidateAndSyncContacts(e){return Ha.info("device contacts out of sync, uploading new list"),this.emit("sync-all-device-contacts"),this._stack.invalidateContacts(this._deviceId).then(()=>this._uploadContacts(e)).then(()=>{gs(e),vs()})}_uploadAllContactsAgain(e){return this._invalidateAndSyncContacts(e).then(()=>{throw new Error("not-sync-avatars")})}_uploadContacts(e){return e.length?this._stack.insertMany({contacts:e,source:"device"}):Promise.resolve()}_addContacts(e){if(e.length)return Promise.all(e.map(e=>this._stack.addContact(e)))}_updateContacts(e){if(e.length)return Promise.all(e.map(e=>this._stack.updateContact(e)))}_removeContacts(e){if(e.length)return Promise.all(e.map(e=>this._stack.removeContact(e)))}_isAllowDeviceContacts(){return h()&&this._stack.getCapabilities().includes("w3c-contacts-api")}}class Ja extends Oi.EventEmitter2{constructor(e,t={}){super(),this._stack=e,this._base=ns(t),this._participants=t.participants||[]}get id(){return this._base.getId()}get name(){return this._base.getName()}get source(){return this._base.getSource()}get favorite(){return this._base.isFavorite()}get participants(){return this._participants}set name(e){this._base.setName(e),is(this._base.getId(),this._stack,this.toJSON())}set favorite(e){this._base.setFavorite(e),is(this._base.getId(),this._stack,this.toJSON())}set participants(e){if((e=>!(Array.isArray(e)&&e.length>0))(e))throw Error("participants must be an array");this._participants=e,is(this._base.getId(),this._stack,this.toJSON())}remove(){return rs(this._base.getId(),this._stack).then(()=>this._remove())}_update(e){this._base.setName(e.name),this._base.setFavorite(e.favorite),this._participants=e.participants,this.emit("update")}_remove(){this._stack=null,this.emit("delete")}toJSON(){return{id:this.id,name:this.name,source:this.source,favorite:this.favorite,participants:this.participants}}}class Ya{constructor(){this._favoriteContacts=new Set(y("favoriteContacts")||[])}saveFavorite(e){this._favoriteContacts.add(e),bs(Array.from(this._favoriteContacts))}removeFavorite(e){this._favoriteContacts.delete(e)&&bs(Array.from(this._favoriteContacts))}getFavoriteContacts(){return this._favoriteContacts}updateContactsWithFavoriteFlag(e){return e.map(e=>(e.favorite=this.getFavoriteContacts().has(e.contactDeviceId),e))}}var Qa=Ii.instance.getLogger("SippoJS/ContactManager"),Ka=[0,1,2,3,4,5,6,20];class Xa extends Oi.EventEmitter2{constructor(e,t,n){super(),this._stack=e,this._userManager=t,this._presenceManager=n,this._contacts=[],this._initializing=null,this._deviceId=l();var i=t.getAddress(e.getCurrentSession().user);this.ownPresence=new Yr(e,n,i),this._retriever=new cs(e),this._favorite=new Ya,this._synchronizer=new $a(e,this._favorite),this._contactFactory=function({stack:e,userManager:t,presenceManager:n,favoriteManager:i}){return Object.freeze({create:r=>{switch(r.source){case"group":return new Ja(e,r);default:return new ss(e,t,n,i,r)}}})}({stack:this._stack,userManager:this._userManager,presenceManager:this._presenceManager,favoriteManager:this._favorite}),c(this,["onContactAdd","onContactUpdate","onContactRemove","onContactAddMany","onUpdateListContacts","onUpdateAvatarsContacts","_addContact","_onSyncProcessError"]),c(this,["onLocalContactRemove"],!0)}get prototypes(){return{Contact:ss.prototype,GroupContact:Ja.prototype,Presence:$r.prototype,OwnPresence:Yr.prototype}}init(){var e=this;return this._initializing||(this._initializing=s((function*(){var t;(t=e._stack).getCurrentSession().user!==y("savedUser")&&(_s(),b("savedUser",t.getCurrentSession().user)),e._initCallbacks();var n=ds(),i=y("validCache"),r=yield e._retriever.getContactsWac();if(fs(r),n&&i){n=e._favorite.updateContactsWithFavoriteFlag(n),(n=e._updateAvatarOfContacts(n,new Map(y("savedAvatarDeviceContacts")||[]))).concat(r).forEach(e._addContact)}else{e.emit("start-synchronizing"),e._insertWACContact(r);try{var s=yield e._retriever.getContactsDevice();yield e._synchronizer.syncContacts(s)}catch(t){e._onSyncProcessError(t)}}}))()),this._initializing}uninit(){return null===this._initializing?Promise.resolve():this._initializing.finally(()=>{this._unInitCallbacks(),this._contacts=[],this._initializing=null})}createContact(e,t,n){Array.isArray(t)||(t=[{name:"",address:t}]);var i={id:"",phones:t,emails:n,name:e,source:"wac"};return this._initializing.then(()=>this._stack.addContact(i))}createGroupContact(e,t){if(!t)return Promise.reject("a list of participants must be given");var n={name:e,source:"group",participants:t};return this._initializing.then(()=>this._stack.addContact(n))}getContacts(){return this._contacts}getContactByWacId(e){return this.getContactByAddress(this._userManager.getAddress(e))}getPresenceByWacId(e){return new $r(this._presenceManager,this._userManager.getAddress(e))}getContactByEmail(e){return this._contacts.find(t=>t.emails&&t.emails.some(t=>t.email===e))}getContactByAddress(e,t=!0){var n;if(e.includes("@")){var[i,r]=e.split("@");n=this._contacts.find(e=>e._user&&e._user.username.toLowerCase()===i.toLowerCase()&&e._user.domain===r)}else if(this._userManager.isAddress(e)){var s=this._userManager.getUserId(e);(n=this._contacts.find(e=>e._user&&e._user.id===s))&&Qa.warn("getContacByAddress: ".concat(e," is not a valid address. Deprecated fallback searching for old style address obtained a match."))}else(n=this._contacts.find(t=>t.phones?t.phones.some(t=>t.address===e):void 0))&&Qa.warn("getContacByAddress: ".concat(e," is not a valid address. Deprecated fallback searching in phones obtained a match."));if(n)return t?n:Promise.resolve(n);n=this._contactFactory.create({});var o=this._userManager.resolveUser(e).then(t=>{var i=t?t.alias||t.username:e;t||(n.name=e),n.phone=i});return t?n:o.then(()=>n)}getPresenceByAddress(e){return this._userManager.resolveUser(e).then(e=>e?this.getPresenceByWacId(e.id):void 0)}getFakeContact({id:e,name:t,presence:n,avatar:i,phone:r,email:s}){return new ss(null,null,null,null,{id:e,name:t,phones:r?[{name:"",address:r}]:[],emails:s?[{type:"",email:s}]:[],source:"",favorite:!1,deviceId:"",contactDeviceId:"",avatar:i,presence:n})}launchSynchronize(){return this._synchronizer.launchSynchronize().catch(this._onSyncProcessError)}_onSyncProcessError(e){if(Qa.error("Failed sync process: ",e),function(e){var t="number"==typeof e?e:e.code;return!!t&&Ka.includes(t)}(e))return this._contacts=this.getContacts().filter(e=>"device"!==e.source),this._stack.invalidateContacts(this._deviceId).then(()=>{this.clearContactsDataFromPersistentStorage()}).catch(e=>{throw Qa.error("Failed invalidating contacts: ",e),e}).then(()=>{throw e})}onLocalContactRemove(e){void 0!==this._rmContact(e.id)&&this.emit("delete",e)}onContactAddMany(e){this._emptyContactList();var t=ms();return Promise.resolve().then(()=>{h()?this._isFromThisDevice(e[0])&&(ps(e),(e=e.concat(t)).forEach(this._addContact),this.emit("stop-synchronizing"),this.emit("start-synchronizing-avatars"),this._synchronizer.launchSynchronizeAvatars()):(fs(t=(t=t.filter(t=>t.deviceId!==e[0].deviceId)).concat(e)),t.forEach(this._addContact),this.emit("stop-synchronizing"))})}onContactAdd(e){if(e=this._addContact(e),this._isFromThisDevice(e)){var t=ds();t.push(e),ps(t)}else{var n=ms();fs(n=n.concat(e))}this.emit("contact-added",e)}onContactUpdate(e){var t=this._contacts.find(t=>e.id===t.id);if(t){if(t._update(e),this._isFromThisDevice(e)){var n=ds(),i=n.findIndex(t=>t.id===e.id);n[i]=e,ps(n)}this.emit("update",e)}}onUpdateListContacts(e){this._emptyContactList(),(e=e.concat(ds())).forEach(this._addContact)}onContactRemove(e){var t=this._rmContact("".concat(e.id,"@").concat(e.source));if(void 0!==t){if(t._remove(),this._isFromThisDevice(e)){var n=ds();ps(n=n.filter(e=>e.contactDeviceId!==t.contactDeviceId))}this.emit("delete",t)}}onUpdateAvatarsContacts(e){this._contacts=this._updateAvatarOfContacts(this._contacts,e),this.emit("stop-synchronizing-avatars")}clearContactsDataFromPersistentStorage(){_s()}_updateAvatarOfContacts(e,t){return t.size?e.map(e=>(t.has(e.contactDeviceId)&&(e.avatar=t.get(e.contactDeviceId)),e)):e}_initCallbacks(){this._stack.on("qs-contact-add",this.onContactAdd),this._stack.on("qs-contact-add-many",this.onContactAddMany),this._stack.on("qs-contact-update",this.onContactUpdate),this._stack.on("qs-contact-remove",this.onContactRemove),this._synchronizer.on("update-list-contacts",this.onUpdateListContacts),this._synchronizer.on("update-avatars-contacts",this.onUpdateAvatarsContacts),this._synchronizer.on("start-synchronizing",()=>{this.emit("start-synchronizing-background")}),this._synchronizer.on("sync-all-device-contacts",()=>{this.emit("sync-all-device-contacts")}),this._synchronizer.on("stop-synchronizing",()=>{this.emit("stop-synchronizing")})}_unInitCallbacks(){this._stack.off("qs-contact-add",this.onContactAdd),this._stack.off("qs-contact-add-many",this.onContactAddMany),this._stack.off("qs-contact-update",this.onContactUpdate),this._stack.off("qs-contact-remove",this.onContactRemove),this._synchronizer.off("update-list-contacts",this.onUpdateListContacts),this._synchronizer.off("update-avatars-contacts",this.onUpdateAvatarsContacts)}_insertWACContact(e){e.forEach(e=>{(function(e){return""!==e.deviceId})(e)&&this._deviceId||this._addContact(e)})}_addContact(e){var t=this._contactFactory.create(e);return this._contacts.push(t),t.once("delete",this.onLocalContactRemove),this.emit("create",t),t}_rmContact(e){var t=this._contacts.findIndex(t=>t.id===e);if(!(t<0)){var n=this._contacts.splice(t,1)[0];return n.off("delete",this.onLocalContactRemove),n}}_emptyContactList(){this._contacts.length=0}_isFromThisDevice(e){return e.deviceId===this._deviceId&&!!this._deviceId}}class Za{static valueOf({id:e,name:t,type:n,size:i,status:r,bytesSent:s=0,url:o=null}={}){return new Za(e,t,n,i,r,s,o)}constructor(e,t,n,i,r,s,o){this.id=e,this.name=t,this.type=n,this.size=i,this.status=r,this.bytesSent=s,this.url=o}with({bytesSent:e=this.bytesSent,status:t=this.status,url:n=this.url}={}){return new Za(this.id,this.name,this.type,this.size,t,e,n)}getId(){return this.id}getName(){return this.name}getType(){return this.type}getSize(){return this.size}getStatus(){return this.status}hasStatus(...e){return e.includes(this.status)}getBytesSent(){return this.bytesSent}getUrl(){return this.url}getProgress(){return this.bytesSent/this.size}}var ec=Ii.instance.getLogger("SippoJS/FileUploadManager");class tc{static newInstance(e){var t=new tc(e);return t.initialize(),Promise.resolve(t)}constructor(e){this.fileSharingService=e,this.fileUploads=new Wt,this.emitter=new Oi.EventEmitter2({wildcard:!0,delimiter:"/"}),c(this,["onStart","onStream","onComplete","onError","onAbort","onFile"])}initialize(){this.fileSharingService.emitter.on("start",this.onStart),this.fileSharingService.emitter.on("stream",this.onStream),this.fileSharingService.emitter.on("complete",this.onComplete),this.fileSharingService.emitter.on("error",this.onError),this.fileSharingService.emitter.on("abort",this.onAbort),this.fileSharingService.emitter.on("file",this.onFile)}onStart(e){ec.log("start",e);var t=e.uploadId,n=fr.SENDING,i=this.fileUploads.get(t).with({status:n});this.fileUploads=this.fileUploads.set(t,i),this.emitter.emit([t,"start"],i)}onStream(e){ec.log("stream",e);var t=e.uploadId,n=e.sent,i=fr.SENDING,r=this.fileUploads.get(t).with({bytesSent:n,status:i});this.fileUploads=this.fileUploads.set(t,r),this.emitter.emit([t,"progress"],r)}onComplete(e){ec.log("complete",e);var t=e.uploadId,n=e.wrote,i=fr.SENDING,r=this.fileUploads.get(t).with({bytesSent:n,status:i});this.fileUploads=this.fileUploads.set(t,r),this.emitter.emit([t,"progress"],r)}onError(e,t){ec.error("error",e);var n=t.uploadId,i=fr.ERROR,r=this.fileUploads.get(n).with({status:i});this.fileUploads=this.fileUploads.set(n,r),this.emitter.emit([n,"error"],r)}onAbort(e){ec.log("abort",e);var t=e.uploadId,n=e.sent,i=fr.ABORTED,r=this.fileUploads.get(t).with({bytesSent:n,status:i});this.fileUploads=this.fileUploads.set(t,r),this.emitter.emit([t,"abort"],r)}onFile(e){var t=this;return s((function*(){ec.log("file",e);var n=e.uploadId;if(e.file.size<=0){var i=t.fileUploads.get(n).with({status:fr.ERROR});t.fileUploads=t.fileUploads.set(n,i),t.emitter.emit([n,"error"],i)}else{var r=yield t.fileSharingService.createSharedFile(e.file.key),s=t.fileUploads.get(n).with({status:fr.COMPLETED,url:r});t.fileUploads=t.fileUploads.set(n,s),t.emitter.emit([n,"end"],s)}}))()}waitForEnd(e){var t,n,i,r=new Promise(n=>{t=n,this.emitter.on([e,"end"],t)}),s=new Promise(t=>{n=t,this.emitter.on([e,"abort"],n)}),o=new Promise((t,n)=>{i=n,this.emitter.on([e,"error"],i)});return Promise.race([r,s,o]).finally(()=>{this.emitter.off([e,"end"],t),this.emitter.off([e,"abort"],n),this.emitter.off([e,"error"],i)})}getFileUploads(){return this.fileUploads}create(e){var t=this;return s((function*(){var n=yield t.fileSharingService.upload(e),i=e.name,r=e.type,s=e.size,o=fr.LOADING,a=Za.valueOf({id:n,name:i,type:r,size:s,status:o});return t.fileUploads=t.fileUploads.set(n,a),n}))()}abort(e){var t=e.getId();return Promise.all([this.fileSharingService.abort(t),this.waitForEnd(t)])}remove(e){if(!e.hasStatus(fr.COMPLETED,fr.ABORTED,fr.ERROR))throw new Error("File Upload in ".concat(e.getStatus().toString()," status can't be removed"));this.fileUploads=this.fileUploads.delete(e.getId())}}class nc{static newInstance(e){return new nc(e)}constructor(e){this.fileSharingService=e}getFileUploadManager(){return this._fileUploadManager||(this._fileUploadManager=tc.newInstance(this.fileSharingService)),this._fileUploadManager}}var ic=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e},rc=function(){try{var e=co(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var sc=function(e,t,n){"__proto__"==t&&rc?rc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},oc=Object.prototype.hasOwnProperty;var ac=function(e,t,n){var i=e[t];oc.call(e,t)&&Ss(i,n)&&(void 0!==n||t in e)||sc(e,t,n)};var cc=function(e,t,n,i){var r=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=i?i(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),r?sc(n,a,c):ac(n,a,c)}return n};var uc=function(e,t){return e&&cc(t,xa(t),e)};var hc=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},lc=Object.prototype.hasOwnProperty;var dc=function(e){if(!Vs(e))return hc(e);var t=_a(e),n=[];for(var i in e)("constructor"!=i||!t&&lc.call(e,i))&&n.push(i);return n};var pc=function(e){return ka(e)?ya(e,!0):dc(e)};var fc=function(e,t){return e&&cc(t,pc(t),e)},mc=n(65);var gc=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t};var vc=function(e,t){return cc(e,Zo(e),t)},yc=wa(Object.getPrototypeOf,Object),bc=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Vo(t,Zo(e)),e=yc(e);return t}:Qo;var _c=function(e,t){return cc(e,bc(e),t)};var wc=function(e){return Jo(e,pc,bc)},Sc=Object.prototype.hasOwnProperty;var Cc=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Sc.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var Ec=function(e){var t=new e.constructor(e.byteLength);return new Uo(t).set(new Uo(e)),t};var kc=function(e,t){var n=t?Ec(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},xc=/\w*$/;var Ic=function(e){var t=new e.constructor(e.source,xc.exec(e));return t.lastIndex=e.lastIndex,t},Oc=qs?qs.prototype:void 0,jc=Oc?Oc.valueOf:void 0;var Tc=function(e){return jc?Object(jc.call(e)):{}};var Rc=function(e,t){var n=t?Ec(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Ac=function(e,t,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return Ec(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return kc(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Rc(e,n);case"[object Map]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return Ic(e);case"[object Set]":return new i;case"[object Symbol]":return Tc(e)}},Pc=Object.create,Dc=function(){function e(){}return function(t){if(!Vs(t))return{};if(Pc)return Pc(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var Mc=function(e){return"function"!=typeof e.constructor||_a(e)?{}:Dc(yc(e))};var qc=function(e){return ta(e)&&"[object Map]"==Ua(e)},Nc=fa.a&&fa.a.isMap,Fc=Nc?pa(Nc):qc;var Lc=function(e){return ta(e)&&"[object Set]"==Ua(e)},Uc=fa.a&&fa.a.isSet,Bc=Uc?pa(Uc):Lc,zc={};zc["[object Arguments]"]=zc["[object Array]"]=zc["[object ArrayBuffer]"]=zc["[object DataView]"]=zc["[object Boolean]"]=zc["[object Date]"]=zc["[object Float32Array]"]=zc["[object Float64Array]"]=zc["[object Int8Array]"]=zc["[object Int16Array]"]=zc["[object Int32Array]"]=zc["[object Map]"]=zc["[object Number]"]=zc["[object Object]"]=zc["[object RegExp]"]=zc["[object Set]"]=zc["[object String]"]=zc["[object Symbol]"]=zc["[object Uint8Array]"]=zc["[object Uint8ClampedArray]"]=zc["[object Uint16Array]"]=zc["[object Uint32Array]"]=!0,zc["[object Error]"]=zc["[object Function]"]=zc["[object WeakMap]"]=!1;var Gc=function e(t,n,i,r,s,o){var a,c=1&n,u=2&n,h=4&n;if(i&&(a=s?i(t,r,s,o):i(t)),void 0!==a)return a;if(!Vs(t))return t;var l=$o(t);if(l){if(a=Cc(t),!c)return gc(t,a)}else{var d=Ua(t),p="[object Function]"==d||"[object GeneratorFunction]"==d;if(Object(aa.a)(t))return Object(mc.a)(t,c);if("[object Object]"==d||"[object Arguments]"==d||p&&!s){if(a=u||p?{}:Mc(t),!c)return u?_c(t,fc(a,t)):vc(t,uc(a,t))}else{if(!zc[d])return s?t:{};a=Ac(t,d,c)}}o||(o=new Ao);var f=o.get(t);if(f)return f;o.set(t,a),Bc(t)?t.forEach((function(r){a.add(e(r,n,i,r,t,o))})):Fc(t)&&t.forEach((function(r,s){a.set(s,e(r,n,i,s,t,o))}));var m=h?u?wc:Ia:u?keysIn:xa,g=l?void 0:m(t);return ic(g||t,(function(r,s){g&&(r=t[s=r]),ac(a,s,e(r,n,i,s,t,o))})),a};var Wc=function(e){return Gc(e,5)};var Hc=function(e){return"symbol"==typeof e||ta(e)&&"[object Symbol]"==Hs(e)},Vc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$c=/^\w*$/;var Jc=function(e,t){if($o(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Hc(e))||($c.test(e)||!Vc.test(e)||null!=t&&e in Object(t))};function Yc(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var o=e.apply(this,i);return n.cache=s.set(r,o)||s,o};return n.cache=new(Yc.Cache||jo),n}Yc.Cache=jo;var Qc=Yc;var Kc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xc=/\\(\\)?/g,Zc=function(e){var t=Qc(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Kc,(function(e,n,i,r){t.push(i?r.replace(Xc,"$1"):n||e)})),t}));var eu=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r},tu=qs?qs.prototype:void 0,nu=tu?tu.toString:void 0;var iu=function e(t){if("string"==typeof t)return t;if($o(t))return eu(t,e)+"";if(Hc(t))return nu?nu.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var ru=function(e){return null==e?"":iu(e)};var su=function(e,t){return $o(e)?e:Jc(e,t)?[e]:Zc(ru(e))};var ou=function(e){if("string"==typeof e||Hc(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};var au=function(e,t){for(var n=0,i=(t=su(t,e)).length;null!=e&&n<i;)e=e[ou(t[n++])];return n&&n==i?e:void 0};var cu=function(e,t,n,i){if(!Vs(e))return e;for(var r=-1,s=(t=su(t,e)).length,o=s-1,a=e;null!=a&&++r<s;){var c=ou(t[r]),u=n;if(r!=o){var h=a[c];void 0===(u=i?i(h,c,a):void 0)&&(u=Vs(h)?h:ua(t[r+1])?[]:{})}ac(a,c,u),a=a[c]}return e};var uu=function(e,t,n){for(var i=-1,r=t.length,s={};++i<r;){var o=t[i],a=au(e,o);n(a,o)&&cu(s,su(o,e),a)}return s};var hu=function(e,t){return null!=e&&t in Object(e)};var lu=function(e,t,n){for(var i=-1,r=(t=su(t,e)).length,s=!1;++i<r;){var o=ou(t[i]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++i!=r?s:!!(r=null==e?0:e.length)&&ha(r)&&ua(o,r)&&($o(e)||oa(e))};var du=function(e,t){return null!=e&&lu(e,t,hu)};var pu=function(e,t){return uu(e,t,(function(t,n){return du(e,n)}))},fu=qs?qs.isConcatSpreadable:void 0;var mu=function(e){return $o(e)||oa(e)||!!(fu&&e&&e[fu])};var gu=function e(t,n,i,r,s){var o=-1,a=t.length;for(i||(i=mu),s||(s=[]);++o<a;){var c=t[o];n>0&&i(c)?n>1?e(c,n-1,i,r,s):Vo(s,c):r||(s[s.length]=c)}return s};var vu=function(e){return(null==e?0:e.length)?gu(e,1):[]};var yu=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},bu=Math.max;var _u=function(e,t,n){return t=bu(void 0===t?e.length-1:t,0),function(){for(var i=arguments,r=-1,s=bu(i.length-t,0),o=Array(s);++r<s;)o[r]=i[t+r];r=-1;for(var a=Array(t+1);++r<t;)a[r]=i[r];return a[t]=n(o),yu(e,this,a)}};var wu=function(e){return function(){return e}};var Su=function(e){return e},Cu=rc?function(e,t){return rc(e,"toString",{configurable:!0,enumerable:!1,value:wu(t),writable:!0})}:Su,Eu=Date.now;var ku=function(e){var t=0,n=0;return function(){var i=Eu(),r=16-(i-n);if(n=i,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Cu);var xu=function(e){return ku(_u(e,void 0,vu),e+"")}((function(e,t){return null==e?{}:pu(e,t)})),Iu=n(9),Ou=n.n(Iu);
/**
 * MediaStream ImageCapture polyfill
 *
 * @license
 * Copyright 2018 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let ju=window.ImageCapture;void 0===ju&&(ju=class{constructor(e){if("video"!==e.kind)throw new DOMException("NotSupportedError");this._videoStreamTrack=e,"readyState"in this._videoStreamTrack||(this._videoStreamTrack.readyState="live"),this._previewStream=new MediaStream([e]),this.videoElement=document.createElement("video"),this.videoElementPlaying=new Promise(e=>{this.videoElement.addEventListener("playing",e)}),HTMLMediaElement?this.videoElement.srcObject=this._previewStream:this.videoElement.src=URL.createObjectURL(this._previewStream),this.videoElement.muted=!0,this.videoElement.setAttribute("playsinline",""),this.videoElement.play(),this.canvasElement=document.createElement("canvas"),this.canvas2dContext=this.canvasElement.getContext("2d")}get videoStreamTrack(){return this._videoStreamTrack}getPhotoCapabilities(){return new Promise((function(e,t){const n={current:0,min:0,max:0};e({exposureCompensation:n,exposureMode:"none",fillLightMode:"none",focusMode:"none",imageHeight:n,imageWidth:n,iso:n,redEyeReduction:!1,whiteBalanceMode:"none",zoom:n}),t(new DOMException("OperationError"))}))}setOptions(e={}){return new Promise((function(e,t){}))}takePhoto(){const e=this;return new Promise((function(t,n){if("live"!==e._videoStreamTrack.readyState)return n(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),e.canvasElement.toBlob(t)}catch(e){n(new DOMException("UnknownError"))}})}))}grabFrame(){const e=this;return new Promise((function(t,n){if("live"!==e._videoStreamTrack.readyState)return n(new DOMException("InvalidStateError"));e.videoElementPlaying.then(()=>{try{e.canvasElement.width=e.videoElement.videoWidth,e.canvasElement.height=e.videoElement.videoHeight,e.canvas2dContext.drawImage(e.videoElement,0,0),t(window.createImageBitmap(e.canvasElement))}catch(e){n(new DOMException("UnknownError"))}})}))}}),window.ImageCapture=ju;var Tu=n(4),Ru=n.n(Tu),Au=u(["INACTIVE","RECORDING","PAUSED"]);class Pu{constructor(e){this._mediaStream=e,this._mediaRecorder=null,this._chunks=[],this._status=Au.INACTIVE,this.emitter=new Oi.EventEmitter2,this.isAudioRecordingEnabled=!0,this.isVideoRecordingEnabled=!0}get status(){return this._status}start(){if(null!==this._mediaRecorder)throw Error("The StreamRecorder object must be stopped before starting it again");var e;switch(!0){case this.isAudioRecordingEnabled&&this.isVideoRecordingEnabled:e=this._mediaStream;break;case this.isAudioRecordingEnabled&&!this.isVideoRecordingEnabled:e=window.MediaStream(this._mediaStream.getAudioTracks());break;case!this.isAudioRecordingEnabled&&this.isVideoRecordingEnabled:e=window.MediaStream(this._mediaStream.getVideoTracks());break;default:throw Error("At least audio or video recording must be enabled")}this._mediaRecorder=new window.MediaRecorder(e),this._mediaRecorder.onstart=()=>{this._status=Au.RECORDING,this._recordingStartTime=Date.now(),this.emitter.emit("start")},this._mediaRecorder.onstop=()=>{this._status=Au.INACTIVE,this.emitter.emit("stop",{data:new Blob(this._chunks,{type:this._chunks[0].type}),startTime:this._recordingStartTime,endTime:Date.now(),target:this}),this._chunks=[]},this._mediaRecorder.ondataavailable=e=>{this._chunks.push(e.data)},this._mediaRecorder.onpause=()=>{this._status=Au.PAUSED,this.emitter.emit("pause")},this._mediaRecorder.onresume=()=>{this._status=Au.RECORDING,this.emitter.emit("resume")},this._mediaRecorder.onerror=e=>{this.emitter.emit("error",e)},this._mediaRecorder.start()}stop(){if(null===this._mediaRecorder)throw Error("The StreamRecorder object must be started before");this._mediaRecorder.stop(),this._mediaRecorder=null}pause(){if(null===this._mediaRecorder)throw Error("The StreamRecorder object must be started before");this._mediaRecorder.pause()}resume(){if(null===this._mediaRecorder)throw Error("The StreamRecorder object must be started before");this._mediaRecorder.resume()}}class Du{constructor(e,t=!1){xr(this,"mediaStream",void 0),xr(this,"local",void 0),xr(this,"id",void 0),this.mediaStream=e,this.local=t,this.id=Ru()()}getId(){return this.id}isLocal(){return this.local}isRemote(){return!this.local}getMediaStream(){return this.mediaStream}getTracks(){return this.mediaStream.getTracks()}getAudioTracks(){return this.mediaStream.getAudioTracks()}getVideoTracks(){return this.mediaStream.getVideoTracks()}getCameraTracks(){return this.mediaStream.getVideoTracks().filter(e=>!e.label.includes("screen"))}getScreenTracks(){return this.mediaStream.getVideoTracks().filter(e=>["screen","window","web-contents-media-stream"].some(t=>e.label.startsWith(t+":")))}hasAudioTracks(){return this.getAudioTracks().length>0}hasVideoTracks(){return this.getVideoTracks().length>0}hasCameraTracks(){return this.getCameraTracks().length>0}hasScreenTracks(){return this.getScreenTracks().length>0}stop(){this.getTracks().forEach(e=>{e.enabled&&e.stop()})}isAudioMuted(){return this.getAudioTracks().every(e=>!e.enabled)}isVideoMuted(){return this.getVideoTracks().every(e=>!e.enabled)}isScreenMuted(){return this.getScreenTracks().every(e=>!e.enabled)}muteAudio(e=!this.isAudioMuted()){this.getAudioTracks().forEach(t=>t.enabled=!e)}muteVideo(e=!this.isVideoMuted()){this.getVideoTracks().forEach(t=>t.enabled=!e)}muteScreen(e=!this.isScreenMuted()){this.getScreenTracks().forEach(t=>t.enabled=!e)}takePhotos(){var e=this.mediaStream.getVideoTracks().map(e=>new ju(e)).map(e=>e.takePhoto());return Promise.all(e)}createStreamRecorder(){return new Pu(this.mediaStream)}}var Mu=n(11),qu=n.n(Mu);var Nu=function(e){return Gc(e,4)};class Fu{constructor(e={audio:!0,video:!0},t){xr(this,"emitter",new qu.a),xr(this,"mediaTypes",{audio:!0,video:!0,screen:!1}),xr(this,"mediaConstraints",void 0),xr(this,"updateMedia",void 0),xr(this,"videoStream",void 0),xr(this,"audioOnlyStream",void 0),xr(this,"availableAudioInputDevices",[]),xr(this,"availableAudioOutputDevices",[]),xr(this,"availableVideoInputDevices",[]),xr(this,"activeVideoInputDevice",void 0),xr(this,"audioMuted",!1),xr(this,"videoMuted",!1),xr(this,"beforeShareScreenVideo",!0),this.mediaConstraints=Wc(e),this.updateMedia=t}getMediaTypes(){return Nu(this.mediaTypes)}setMediaTypes(e){var t=this;return s((function*(){if(e.video&&e.screen)throw new Error("Simultaneous screen sharing and video is not supported");var{audio:n,video:i}=t.getCurrentMediaConstraints({mediaTypes:e});yield t.updateMedia(n,i,e.screen),t.mediaTypes=Nu(e),t.emitter.emit("*")}))()}getMediaConstraints(){return Wc(this.mediaConstraints)}setMediaConstraints(e){var t=this;return s((function*(){var{audio:n,video:i}=t.getCurrentMediaConstraints({mediaConstraints:e}),{screen:r}=t.getMediaTypes();yield t.updateMedia(n,i,r),t.mediaConstraints=Wc(e),t.emitter.emit("*")}))()}getCurrentMediaConstraints({mediaTypes:e=this.mediaTypes,mediaConstraints:t=this.mediaConstraints}={}){return{audio:e.audio&&Wc(t.audio),video:e.video&&Wc(t.video)}}getVideoStream(){return this.videoStream||this.audioOnlyStream}setVideoStream(e){this.videoStream&&this.videoStream.getMediaStream()===e||(this.videoStream&&(this.videoStream.stop(),delete this.videoStream),e&&(this.videoStream=new Du(e,!0),this.muteAudio(this.audioMuted),this.muteVideo(this.videoMuted)),this.emitter.emit("videoStream"),this.emitter.emit("*"))}setAudioOnlyStream(e){this.audioOnlyStream&&this.audioOnlyStream.getMediaStream()===e||(this.audioOnlyStream&&(this.audioOnlyStream.stop(),delete this.audioOnlyStream),e&&(this.audioOnlyStream=new Du(e,!0)),this.videoStream||this.emitter.emit("videoStream"),this.emitter.emit("*"))}hasAudioTrack(){return this.audioOnlyStream?this.audioOnlyStream.hasAudioTracks():!!this.videoStream&&this.videoStream.hasAudioTracks()}hasVideoTrack(){return!!this.videoStream&&this.videoStream.hasVideoTracks()}isAudioMuted(){return this.audioOnlyStream?this.audioOnlyStream.isAudioMuted():!this.videoStream||this.videoStream.isAudioMuted()}muteAudio(e=!this.isAudioMuted()){this.audioOnlyStream&&this.audioOnlyStream.muteAudio(e),this.videoStream&&this.videoStream.muteAudio(e),this.audioMuted=e}isVideoMuted(){return!!this.videoStream&&this.videoStream.isVideoMuted()}muteVideo(e=!this.isVideoMuted()){this.videoStream&&this.videoStream.muteVideo(e),this.videoMuted=e}canToggleVideo(){return this.availableVideoInputDevices.length>0&&!this.mediaTypes.screen}toggleVideo(e=!this.mediaTypes.video){var{audio:t,screen:n}=this.mediaTypes;return this.setMediaTypes({audio:t,video:e,screen:n})}toggleScreen(e=!this.mediaTypes.screen){var t=this;return s((function*(){var{audio:n}=t.mediaTypes,{video:i}=t.mediaTypes;e?(t.beforeShareScreenVideo=i,i=!1):i=t.beforeShareScreenVideo;try{yield t.setMediaTypes({audio:n,video:i,screen:e})}catch(e){switch(e.message){case"chrome-screensharing-plugin-missing":throw new Error("plugin-missing-chrome");case"firefox-screensharing-plugin-missing":throw new Error("plugin-missing-firefox");case"user-cancel":throw new Error("user-cancel");default:throw e}}}))()}addVideo(){var e=this;return s((function*(){e.mediaTypes.screen?e.beforeShareScreenVideo=!0:e.mediaTypes.video||(yield e.setMediaTypes({audio:e.mediaTypes.audio,video:!0,screen:e.mediaTypes.screen}))}))()}getAvailableAudioInputDevices(){return this.availableAudioInputDevices}setAvailableAudioInputDevices(e){return this.availableAudioInputDevices=e,this.setActiveAudioInputDevice(e[0])}setActiveAudioInputDevice(e){var t=this.getMediaConstraints();if(e){if(t.audio){"boolean"==typeof t.audio&&(t.audio={});var n=e.deviceId;t.audio.deviceId=Ou.a.ios?n:{exact:n}}}else"object"==typeof t.audio&&delete t.audio.deviceId;return this.setMediaConstraints(t)}getAvailableVideoInputDevices(){return this.availableVideoInputDevices}setAvailableVideoInputDevices(e){return this.availableVideoInputDevices=e,this.setActiveVideoInputDevice(e[0])}setActiveVideoInputDevice(e){this.activeVideoInputDevice=e;var t=this.getMediaConstraints();if(e){if(t.video){"boolean"==typeof t.video?t.video={}:delete t.video.facingMode;var n=e.deviceId;t.video.deviceId=Ou.a.ios?n:{exact:n}}}else"object"==typeof t.audio&&delete t.audio.deviceId;return this.setMediaConstraints(t)}getAvailableAudioOutputDevices(){return this.availableAudioOutputDevices}canToggleCamera(){return!!(this.availableVideoInputDevices.length>1&&this.mediaTypes.video&&this.mediaConstraints.video)}toggleCamera(){return this.setActiveVideoInputDevice(this.getNextVideoInputDevice())}init(){var e=this;return s((function*(){yield e.initializeDevices()}))()}initializeDevices(){var e=this;return s((function*(){var t=yield navigator.mediaDevices.enumerateDevices();e.availableAudioInputDevices=t.filter(e=>"audioinput"===e.kind),e.availableVideoInputDevices=t.filter(e=>"videoinput"===e.kind),e.availableAudioOutputDevices=t.filter(e=>"audiooutput"===e.kind)}))()}getActiveVideoInputDeviceFromLocalStreams(){if(this.availableVideoInputDevices.length){if(!this.videoStream||!this.videoStream.hasCameraTracks())return this.availableVideoInputDevices[0];var e=this.videoStream.getCameraTracks();if("function"!=typeof e[0].getSettings)return this.availableVideoInputDevices[0];var t=e.map(e=>e.getSettings().deviceId);return this.availableVideoInputDevices.find(e=>t.includes(e.deviceId))}}getNextVideoInputDevice(){var e=this.activeVideoInputDevice?this.activeVideoInputDevice:this.getActiveVideoInputDeviceFromLocalStreams();if(e){var t,n;return t=this.availableVideoInputDevices,n=e,t[(t.indexOf(n)+1)%t.length]}}}var Lu=new u(["INCOMING","OUTGOING"]),Uu=Ii.instance.getLogger("SippoJS/CallEndReason"),Bu=new u(["UNSPECIFIED","NORMAL_CLEARING","BROWSER_CLOSED","BAD_REQUEST","ORIGINATOR_CANCEL","NOT_FOUND","USER_BUSY","NO_ANSWER","MEDIA_ACCESS_ERROR","SERVER_ERROR"]);function zu(e){switch(e){case"notfound":case"unavailable":return Bu.NOT_FOUND;case"unknown":return Bu.UNSPECIFIED;case"normal":return Bu.NORMAL_CLEARING;case"closebrowser":return Bu.BROWSER_CLOSED;case"rejected":return Bu.USER_BUSY;case"timeout":case"noattended":return Bu.NO_ANSWER;case"webrtcunsupported":case"webrtcerror":case"deniedmediaaccess":return Bu.MEDIA_ACCESS_ERROR;case"missed":case"leavesqueue":return Bu.ORIGINATOR_CANCEL;case"badrequest":case"notallowed":return Bu.BAD_REQUEST;case"cleanup":case"networkerror":case"servererror":default:return Uu.warn("Unexpected end reason received from wac: ".concat(e)),Bu.SERVER_ERROR}}var Gu=new u(["UNCONNECTED","TRYING","QUEUED","CONNECTING","CONNECTED","HOLD","REMOTE_HOLD","RECONNECTING","DISCONNECTED"]);class Wu extends Oi.EventEmitter2{constructor(e,t){super(),this._wacproxy=e,this._callId=t}start(e){return this._wacproxy.startRecording(this._callId,e)}stop(){return this._wacproxy.stopRecording(this._callId)}pause(){throw Error("Not implemented")}getRecordings(){var e={};return e.callIdWAC=this._callId,this._wacproxy.getRecordings(e)}}var Hu=Ii.instance.getLogger("SippoJS/Call");class Vu{static newInstance(e,t,{gatewayCaller:n,gatewayCallee:i,remoteUser:r,id:s=null,direction:o=Lu.INCOMING,mediaConstraints:a={audio:!0,video:!0},pollingCall:c=!1,pullFrom:u=null}={}){var h=new Vu(e,t,n,i,r,s,o,a,c,u);return h.initialize().then(()=>h)}constructor(e,t,n,i,r,s,o,a,u,h){this.wacProxy=e,this.userManager=t,this.callService=e.getCallService(),this.callAttemptService=e.getCallAttemptService(),this.id=s,this.wacId=".invalid",this.direction=o,this.gatewayCaller=n,this.gatewayCallee=i,this.originalGatewayCallee=i,this.remoteUser=r,this.pollingCall=u,this.pullFrom=h,this.beforeShareScreenVideo=!0,this.status=o===Lu.INCOMING?Gu.TRYING:Gu.UNCONNECTED,this.endReason=Bu.UNSPECIFIED,this.localOnlyStreams=new Gn,this.localMediaHandler=new Fu(a,this.updateMedia.bind(this)),this.remoteStreams=new Gn,this.context=null,this.emitter=new Oi.EventEmitter2,c(this,["onRinging","onEstablished","onLocalStream","onRemoteStream","onEndCall","onHoldReceived","onResumeReceived","onTransferred","onCallAttemptRejected"])}initialize(){return this.direction===Lu.INCOMING&&this.bindEventListeners(),this.localMediaHandler.init()}bindEventListeners(){this.wacProxy.on("qs-ringing",this.onRinging),this.wacProxy.on("qs-established",this.onEstablished),this.wacProxy.on("qs-localstream",this.onLocalStream),this.wacProxy.on("qs-remotestream",this.onRemoteStream),this.wacProxy.on("qs-end-call qs-lost-call",this.onEndCall),this.wacProxy.on("qs-onhold-received",this.onHoldReceived),this.wacProxy.on("qs-resume-received",this.onResumeReceived),this.wacProxy.on("qs-transferred",this.onTransferred),this.callAttemptService.emitter.on("rejected",this.onCallAttemptRejected)}unbindEventListeners(){this.wacProxy.off("qs-ringing",this.onRinging),this.wacProxy.off("qs-established",this.onEstablished),this.wacProxy.off("qs-localstream",this.onLocalStream),this.wacProxy.off("qs-remotestream",this.onRemoteStream),this.wacProxy.off("qs-end-call qs-lost-call",this.onEndCall),this.wacProxy.off("qs-onhold-received",this.onHoldReceived),this.wacProxy.off("qs-resume-received",this.onResumeReceived),this.wacProxy.off("qs-transferred",this.onTransferred),this.callAttemptService.emitter.off("rejected",this.onCallAttemptRejected)}onRinging(e){e.userid!==this.gatewayCaller||this.isPolling()||this.wacProxy.hasCapability("call-rehydration")&&this.reconnect(e.callid)}onEstablished(e){e.callid===this.id&&this.updateCallControl("active").then(()=>{this.setStatus(Gu.CONNECTED)})}onLocalStream(e){e.callid===this.id&&(this.clearLocalOnlyStreams(),this.localMediaHandler.setVideoStream(e.stream))}onRemoteStream(e){if(e.callid===this.id)if(e.stream){if(this.remoteStreams.find(t=>t.mediaStream===e.stream))return;var t=new Du(e.stream),n=this.remoteStreams;this.remoteStreams=this.remoteStreams.add(t),this.emitter.emit("remoteStreams",this.remoteStreams,n)}else this.clearRemoteStreams()}onEndCall(e){if(e.callid===this.id){var t=zu(e.endReason),n=this.wacProxy.hasCapability("call-rehydration");if(t===Bu.NETWORK_ERROR&&n)return this.reconnect();this.sendStats(),this.updateCallControl("finished",e.endReason).then(()=>{this.setStatus(Gu.DISCONNECTED,t)})}}onHoldReceived(e){e.callid===this.id&&this.setStatus(Gu.REMOTE_HOLD)}onResumeReceived(e){e.callid===this.id&&this.setStatus(Gu.CONNECTED)}onTransferred(e){e.callid===this.id&&(this.id=e.to,this.direction===Lu.INCOMING?this.gatewayCaller=e.userid:this.gatewayCallee=e.userid,this.userManager.resolveUser(e.userid).then(e=>{this.remoteUser=e,this.setStatus(Gu.CONNECTED),this.emitter.emit("transferred")}))}onCallAttemptRejected(){event.callid===this.id&&this.setStatus(Gu.DISCONNECTED,Bu.USER_BUSY)}sendStats(){var e=Object.assign({id:this.wacId},this.stats);this.wacProxy.sendStats("callcontrol",Date.now(),"call-brief",e).then(()=>{Hu.debug("call brief sent")}).catch(()=>{Hu.error("unable to send call brief")})}createCallControl(){if(!this.wacProxy.hasCapability("callcontrol"))return Promise.resolve();var e=this.wacProxy.getCurrentCredential().data.username;return this.callService.create({caller:e,callee:this.gatewayCallee,context:this.context,anonymousSessionId:this.sessionId}).then(e=>(this.wacId=e.id,this.gatewayCallee=e.gatewayUsername,this.context=e.context,e)).catch(e=>{throw this.setStatus(Gu.DISCONNECTED,Bu.SERVER_ERROR),e})}updateCallControl(e,t="unknown"){return this.wacProxy.hasCapability("callcontrol")?this.callService.update(this.wacId,{caller:this.gatewayCaller,callee:this.gatewayCallee,context:this.context,endReason:t,status:e}).then(e=>(this.wacId=e.id,this.context=e.context,"object"==typeof this.context&&this.emitter.emit("context",this.context),e)):Promise.resolve()}getId(){return this.id}updateMedia(e,t,n){return this.hasStatus(Gu.UNCONNECTED,Gu.TRYING,Gu.DISCONNECTED)?Promise.resolve():this.wacProxy.updateCallMedia(this.id,e,t,n)}getLocalMediaHandler(){return this.localMediaHandler}getDirection(){return this.direction}getRemoteUser(){return this.remoteUser}getRemoteGatewayUser(){return this.direction===Lu.INCOMING?this.gatewayCaller:this.gatewayCallee}getStatus(){return this.status}hasStatus(...e){return e.includes(this.status)}waitForStatus(...e){return new Promise(t=>{if(this.hasStatus(...e))return t(this.status);var n=i=>{e.includes(i)&&(this.emitter.off("status",n),t(i))};this.emitter.on("status",n)})}setStatus(e,t=Bu.UNSPECIFIED){this.status!==e&&(this.status=e,e===Gu.DISCONNECTED&&(this.unbindEventListeners(),this.clearLocalOnlyStreams(),this.localMediaHandler.setVideoStream(),this.clearRemoteStreams(),this.endReason=t),this.emitter.emit("status",e),Hu.log(this.direction,this.status,this.endReason))}getEndReason(){return this.endReason}isPolling(){return this.pollingCall}getLocalOnlyStreams(){return this.localOnlyStreams}getRemoteStreams(){return this.remoteStreams}clearLocalOnlyStreams(){if(!this.localOnlyStreams.isEmpty()){this.localOnlyStreams.forEach(e=>e.stop());var e=this.localOnlyStreams;this.localOnlyStreams=this.localOnlyStreams.clear(),this.emitter.emit("localOnlyStreams",this.localOnlyStreams,e)}}clearRemoteStreams(){if(!this.remoteStreams.isEmpty()){var e=this.remoteStreams;this.remoteStreams=this.remoteStreams.clear(),this.emitter.emit("remoteStreams",this.remoteStreams,e)}}hasLocalOnlyVideo(){return this.localOnlyStreams.some(e=>e.hasVideoTracks())}hasRemoteAudio(){return this.remoteStreams.some(e=>e.hasAudioTracks())}hasRemoteVideo(){return this.remoteStreams.some(e=>e.hasVideoTracks())}getContext(){return this.context}setContext(e){if("object"!=typeof e)throw new TypeError("".concat(e," is not a JSON serializable object"));return this.context=Wc(e),this}createCallRecorder(e){if("remote"===e&&this.wacProxy.hasCapability("recording"))return new Wu(this.wacProxy,this.wacId)}connect(){var e=this;return s((function*(){try{return e.getDirection()===Lu.OUTGOING?yield e.connectOutgoing():yield e.connectIncoming(),e}catch(t){throw Hu.error("connect failed with error",t),e.hasStatus(Gu.DISCONNECTED)||(yield e.updateCallControl("finished"),e.setStatus(Gu.DISCONNECTED)),t}}))()}connectOutgoing(){var e=this;return s((function*(){if(e.getStatus===Gu.DISCONNECTED&&e.setStatus(Gu.UNCONNECTED),!e.hasStatus(Gu.UNCONNECTED))throw new Error("Invalid status. A call in ".concat(Gu[e.status]," status can't be connected"));if(e.setStatus(Gu.TRYING),e.wacProxy.once("qs-calling",t=>{e.id=t.callid}),e.bindEventListeners(),yield e.initializeLocalMedia(),"queued"===(yield e.createCallControl()).state&&(yield e.waitWhileQueued()),e.pullFrom)return e.wacProxy.pullCallFromSession(e.pullFrom.id,e.pullFrom.session.id);var t=e.localMediaHandler.getCurrentMediaConstraints();return e.wacProxy.call(e.gatewayCallee,t,xu(e.context,"recordFilename"))}))()}connectIncoming(){var e=this;return s((function*(){if(!e.hasStatus(Gu.TRYING))throw new Error("Invalid status. A call in ".concat(Gu[e.status]," status can't be connected"));return e.isPolling()?e.connectPollingCall():(yield e.updateCallControl("active"),e.setStatus(Gu.CONNECTING),e.wacProxy.answer(e.id,e.localMediaHandler.getCurrentMediaConstraints()),e.waitForStatus(Gu.CONNECTED))}))()}initializeLocalMedia(){if(Ou.a.msie||Ou.a.safari||Ou.a.firefox||Ou.a.ios)return Promise.resolve();var e=this.localMediaHandler.getCurrentMediaConstraints();return navigator.mediaDevices.getUserMedia(e).then(t=>{var n=new Du(t,!0);if(e.audio&&!n.hasAudioTracks())throw new Error("Problem obtaining access to the microphone");if(e.video&&!n.hasVideoTracks())throw new Error("Problem obtaining access to the camera");var i=this.localOnlyStreams;return this.localOnlyStreams=this.localOnlyStreams.add(n),this.emitter.emit("localOnlyStreams",this.localOnlyStreams,i),n}).catch(e=>{throw this.setStatus(Gu.DISCONNECTED,Bu.MEDIA_ACCESS_ERROR),e})}waitWhileQueued(){return new Promise((e,t)=>{this.setStatus(Gu.QUEUED);var n=i=>{i.id===this.wacId&&(this.context=i.context,this.gatewayCallee=i.gatewayUsername,"queued"!==i.state&&(this.callService.emitter.off("updated",n),"routed"!==i.state?(this.setStatus(Gu.DISCONNECTED,zu(i.endReason)),t(new Error("Call reached non routed state "+i.state))):e()))};this.callService.emitter.on("updated",n)})}connectPollingCall(){var e=new Promise((e,t)=>{var n=i=>{if(this.wacId===i.id&&["finished","active"].includes(i.state)){if(this.callService.emitter.off("updated",n),"finished"===i.state)return this.setStatus(Gu.DISCONNECTED,zu(i.endReason)),t(new Error("Call was unexpectedly finished"));e()}};this.callService.emitter.on("updated",n)}),t=new Promise(e=>{var t=n=>{n.userid===this.gatewayCaller&&(this.wacProxy.off("qs-ringing",t),this.id=n.callid,e(this.connectIncoming()))};this.wacProxy.on("qs-ringing",t)});return Promise.all([t,e,this.callAttemptService.accept(this.wacId)]).then(()=>{this.pollingCall=!1})}reconnect(e){if(this.localMediaHandler.setVideoStream(),this.remoteStreams.forEach(e=>e.stop()),this.clearRemoteStreams(),this.setStatus(Gu.TRYING),this.direction===Lu.INCOMING)return this.id=e,this.connectIncoming();this.wacProxy.once("qs-calling",e=>{this.id=e.callid});var t=this.localMediaHandler.getCurrentMediaConstraints();this.wacProxy.call(this.gatewayCallee,t,xu(this.context,"recordFilename"))}disconnect(){var e=this;return s((function*(){switch(e.status){case Gu.UNCONNECTED:case Gu.DISCONNECTED:throw new Error("Invalid status. A call in ".concat(Gu[e.status]," status can't be disconnected"));case Gu.TRYING:if(e.isPolling()){try{yield e.callAttemptService.reject(e.wacId)}finally{e.setStatus(Gu.DISCONNECTED,Bu.USER_BUSY)}return e}return e.wacProxy.hangup(e.id),yield e.waitForStatus(Gu.DISCONNECTED),e;case Gu.QUEUED:try{e.updateCallControl("finished","leavesqueue")}finally{e.setStatus(Gu.DISCONNECTED,Bu.ORIGINATOR_CANCEL)}return e;case Gu.CONNECTING:return yield e.waitForStatus(Gu.CONNECTED),e.disconnect();default:return e.wacProxy.hangup(e.id),yield e.waitForStatus(Gu.DISCONNECTED),e}}))()}hold(){return new Promise((e,t)=>{var n,i,r=()=>{this.wacProxy.off("qs-onhold-success",n),this.wacProxy.off("qs-onhold-error",i)};n=t=>{t.callid===this.id&&(r(),this.setStatus(Gu.HOLD),e())},i=e=>{e.callid===this.id&&(r(),t(e.reason))},this.wacProxy.on("qs-onhold-success",n),this.wacProxy.on("qs-onhold-error",i),this.wacProxy.hold(this.id)})}resume(){return new Promise((e,t)=>{var n,i,r=()=>{this.wacProxy.off("qs-resume-success",n),this.wacProxy.off("qs-resume-error",i)};n=t=>{t.callid===this.id&&(r(),this.setStatus(Gu.CONNECTED),e())},i=e=>{e.callid===this.id&&(r(),t(e.reason))},this.wacProxy.on("qs-resume-success",n),this.wacProxy.on("qs-resume-error",i),this.wacProxy.resume(this.id)})}transfer(e){var t=this;return s((function*(){if(!t.hasStatus(Gu.CONNECTED,Gu.HOLD))throw new Error("Invalid status. A call in ".concat(Gu[t.status]," status can't be transfered"));var n=yield t.userManager.getGatewayUsername(e);t.wacProxy.transfer(t.getRemoteGatewayUser(),n,t.id),yield t.waitForStatus(Gu.REMOTE_HOLD);var i=yield new Promise(e=>{var n,i,r=()=>{t.wacProxy.off("qs-end-call",n),t.wacProxy.off("qs-resume-success",i)};n=n=>{n.callid===t.id&&(r(),e(!0))},i=n=>{n.callid===t.id&&(r(),t.setStatus(Gu.CONNECTED),e(!1))},t.wacProxy.on("qs-end-call",n),t.wacProxy.on("qs-resume-success",i)});return i&&(yield t.waitForStatus(Gu.DISCONNECTED)),i}))()}sendDtmf(e){this.wacProxy.insertDTMF(this.id,e)}}class $u{constructor(e,t){if("string"!=typeof e)throw new TypeError("id parameter must be an string instead ".concat(typeof e));if("string"!=typeof t)throw new TypeError("name parameter must be an string instead ".concat(typeof t));this._id=e,this._name=t}get id(){return this._id}get name(){return this._name}}class Ju{constructor(e,t,n){if("string"!=typeof e)throw new TypeError("id parameter must be an string instead ".concat(typeof e));if(!(t instanceof Array))throw new TypeError("participants parameter must be an Array instance");if(!(n instanceof $u))throw new TypeError("session parameter must be an RemoteSession instance");this._id=e,this._participants=t,this._session=n}get id(){return this._id}get participants(){return this._participants}get session(){return this._session}}class Yu{constructor(e,t,n,i,r,s,o,a,c,u={},h=""){this.id=e,this.callee=t,this.caller=n,this.target=i,this.from=r,this.to=s,this.status=o,this.endReason=a,this.direction=c,this.origin=u,this.data=h}getId(){return this.id}getCallee(){return this.callee}getCaller(){return this.caller}getTarget(){return this.target}getFrom(){return this.from}getTo(){return this.to}getStatus(){return this.status}getEndReason(){return this.endReason}getDirection(){return this.direction}getOrigin(){return this.origin}getData(){return this.data}getDuration(){return this.status===Gu.CONNECTED?Date.now()-this.from:this.to-this.from}getRemoteAddress(){return this.direction===Lu.INCOMING?this.caller:this.callee}isEnded(){return this.status===Gu.FINISHED}isIncoming(){return this.direction===Lu.INCOMING}isOutgoing(){return this.direction===Lu.OUTGOING}isMissed(){return this.isIncoming()&&(this.endReason===Bu.NO_ANSWER||this.endReason===Bu.ORIGINATOR_CANCEL)}}var Qu=Ii.instance.getLogger("SippoJS/CallLog");class Ku{static create(e,t){var n=new Ku(e,t);return n.fetch().then(()=>n)}constructor(e,t){this.callService=e,this.userManager=t,this.entries=[],this.lastEntryRecovered=!1,this.emitter=new Oi.EventEmitter2,c(this,["onUpdate"]),this.bindEventHandlers()}bindEventHandlers(){this.callService.emitter.on("updated",this.onUpdate),this.callService.emitter.on("created",this.onUpdate)}fetch(e=20){if(!this.lastEntryRecovered)return this.callService.get({limit:e,sortBy:"from"}).then(e=>{if(e.length<=0)this.lastEntryRecovered=!0;else{this.lastEntryRecovered=!0,this.lastRecoveredTimestamp=e[e.length-1].from;var t=e.map(e=>this.createCallLogEntry(e));this.entries=[...this.entries,...t],this.emitter.emit("fetch")}})}getEntries(){return this.entries}getById(e){return this.entries.find(t=>t.id===e)}calculateStatus(e){switch(e){case"active":return Gu.CONNECTED;case"routed":return Gu.TRYING;case"finished":return Gu.DISCONNECTED;default:Qu.error("Unexpected status: ".concat(e))}}createCallLogEntry(e){var t=this.calculateStatus(e.state),n=zu(e.endReason),i=this.userManager.isOwnAddress(e.caller)?Lu.OUTGOING:Lu.INCOMING;return new Yu(e.id,e.callee,e.caller,e.target||e.callee,new Date(e.from),new Date(e.to),t,n,i,e.origin,e.data)}onUpdate(e){var t=this.createCallLogEntry(e),n=this.entries.find(t=>t.id===e.id);n?(this.entries=this.entries.map(n=>n.getId()===e.id?t:n),this.emitter.emit("update",t,n)):(this.entries=[t,...this.entries],this.emitter.emit("create",t))}}var Xu=Ii.instance.getLogger("SippoJS/CallManager");class Zu{static newInstance(e,t,n){return new Zu(e,t,n)}constructor(e,t,n){this._wacProxy=e,this._callAttemptService=e.getCallAttemptService(),this._userManager=t,this._defaultMediaConstraints={audio:!0,video:!0},this._ownGatewayUsername=n,this._pollingCalls=new fn,this._incomingCalls=new Gn,this._outgoingCalls=new Gn,this._callLog=null,this.emitter=new Oi.EventEmitter2,c(this,["_onCallAttemptCreated","_onRinging"]),this._bindEventHandlers()}_bindEventHandlers(){this._callAttemptService.emitter.on("created",this._onCallAttemptCreated),this._wacProxy.on("qs-ringing",this._onRinging)}_onCallAttemptCreated(e){this.userManager.resolveUser(e.caller).then(t=>Vu.newInstance(this.wacProxy,this.userManager,{gatewayCaller:e.caller,gatewayCallee:this._ownGatewayUsername,remoteUser:t,pollingCall:!0})).then(t=>{t.setContext(e.context),this._addIncomingCall(t),this.emitter.emit("incomingCall",t)}).catch(e=>Xu.error(e))}_onRinging(e){var t=this;return s((function*(){var n=e.media&&e.media.data,i=t._incomingCalls.find(t=>t.getRemoteGatewayUser()===e.userid);if(!n&&!i)try{var r=yield t._userManager.resolveUser(e.userid),s=yield Vu.newInstance(t._wacProxy,t._userManager,{id:e.callid,gatewayCaller:e.userid,gatewayCallee:t._ownGatewayUsername,remoteUser:r,mediaConstraints:t._defaultMediaConstraints});yield s.getLocalMediaHandler().setMediaTypes({audio:e.media.audio,video:e.media.video,screen:!1}),t._addIncomingCall(s),t.emitter.emit("incomingCall",s)}catch(e){Xu.error(e)}}))()}_addIncomingCall(e){this._incomingCalls=this._incomingCalls.add(e),e.waitForStatus(Gu.DISCONNECTED).then(()=>{this._incomingCalls=this._incomingCalls.delete(e)})}_addOutgoingCall(e){this._outgoingCalls=this._outgoingCalls.add(e),e.waitForStatus(Gu.DISCONNECTED).then(()=>{this._outgoingCalls=this._outgoingCalls.delete(e)})}getDefaultMediaConstraints(){return Wc(this._defaultMediaConstraints)}setDefaultMediaConstraints(e){this._defaultMediaConstraints=Wc(e)}getCallLog(){if(null===this._callLog){var e=this._wacProxy.getCallService();this._callLog=Ku.create(e,this._userManager)}return this._callLog}createCall(e){return"string"!=typeof e?Promise.reject(new TypeError("".concat(e," is not a string"))):this._userManager.resolveUser(e).then(t=>{var n=t?t.gatewayUsername:e;return Vu.newInstance(this._wacProxy,this._userManager,{direction:Lu.OUTGOING,gatewayCaller:this._ownGatewayUsername,gatewayCallee:n,remoteUser:t,mediaConstraints:this._defaultMediaConstraints})}).then(e=>(this._addOutgoingCall(e),e))}getRemoteCalls(){return Promise.resolve().then(()=>this._wacProxy.getRemoteSessions()).then(e=>{var t=[];return e.forEach(e=>{e.calls.forEach(n=>{var i=new $u(e.id,e.name),r=new Ju(n.id,n.participants,i);t.push(r)})}),t})}pull(e){var t=this;return s((function*(){var n=yield t._userManager.resolveUser(e.participants[0]);return yield Vu.newInstance(t._wacProxy,t._userManager,{direction:Lu.OUTGOING,gatewayCaller:t._ownGatewayUsername,gatewayCallee:e.participants[0],remoteUser:n,defaultMediaConstraints:t._defaultMediaConstraints,pullFrom:e})}))()}}var eh=new u(["UNSPECIFIED","NORMAL_CLEARING","MEDIA_ACCESS_ERROR","SERVER_ERROR"]),th=new u(["DESTROYED","DISCONNECTED","CONNECTING","CONNECTED","DISCONNECTING"]);class nh{constructor(e,t,n,i,r,s,o){this._toUser=e,this._to=t,this._mediaTypes=n,this._autoAccepted=i,this._responseCode=r,this._hasStreams=s,this._canceled=o,this._timestamp=Date.now(),Object.freeze(this)}getToUser(){return this._toUser}getTo(){return this._to}getMediaTypes(){return this._mediaTypes}isAutoAccepted(){return this._autoAccepted}getResponseCode(){return this._responseCode}hasStreams(){return this._hasStreams}isCanceled(){return this._canceled}isActive(){return!this._responseCode&&!this._canceled}getTimestamp(){return this._timestamp}setTo(e){return new nh(this._toUser,e,this._mediaTypes,this._autoAccepted,this._responseCode,this._hasStreams,this._canceled)}setResponseCode(e){return new nh(this._toUser,this._to,this._mediaTypes,this._autoAccepted,e,this._hasStreams,this._canceled)}setCanceled(e){return new nh(this._toUser,this._to,this._mediaTypes,this._autoAccepted,this._responseCode,this._hasStreams,e)}setStreams(e){return new nh(this._toUser,this._to,this._mediaTypes,this._autoAccepted,this._responseCode,e,this._canceled)}}var ih="participantAdded",rh="participantRemoved",sh="participantHold",oh="participantUnhold",ah="localStreamChanged",ch="localStreamAdded",uh="localStreamRemoved",hh="remoteStreamChanged",lh="remoteStreamAdded",dh="remoteStreamRemoved";class ph{constructor(e,t,n){xr(this,"id",void 0),xr(this,"from",void 0),xr(this,"mediaTypes",void 0),this.id=e,this.from=t,this.mediaTypes=n}getId(){return this.id}getFrom(){return this.from}getMediaTypes(){return this.mediaTypes}}var fh=Ii.instance.getLogger("SippoJS/calls/Conference"),mh=(e,t)=>e?t+"/".concat(e):t;class gh{constructor(e,t,n){this._userManager=e,this._room=t,this._status=new Zi(th.DISCONNECTED),this._endReason=eh.UNSPECIFIED,this._localMediaHandler=new Fu(n,this.updateMedia.bind(this)),this._transferingCall=!1,this._outgoingInvitations=new Gn,this._remoteParticipants=new Wt,this._remoteStreams=new Wt,this._remoteWacAddresses=new Gn,this.invitationCount=0,this.emitter=new Oi.EventEmitter2({newListener:!0}),this.emitter.on("newListener",e=>{["status","destroyed","expelled"].includes(e)&&fh.warn("".concat(e," is deprecated. Please use getStatus() and/or getStatus$() instead"))}),c(this,["_onLocalStreamChanged","_onLocalStreamAdded","_onLocalStreamRemoved","_onRemoteStreamChanged","_onRemoteStreamAdded","_onRemoteStreamRemoved","_onExpelled","_onTransferingCall","_onDestroyed","_onParticipantAdded","_onParticipantRemoved","_onParticipantHold","_onParticipantUnhold"]),t.recovered&&this.invitationCount++}static create(e,t,n){return s((function*(){var i=new gh(e,t,n);return i._bindEventHandlers(),i._owner=yield e.resolveUser(t.owner),yield i._localMediaHandler.init(),i}))()}_bindEventHandlers(){this._room.on(ah,this._onLocalStreamChanged),this._room.on(ch,this._onLocalStreamAdded),this._room.on(uh,this._onLocalStreamRemoved),this._room.on(hh,this._onRemoteStreamChanged),this._room.on(lh,this._onRemoteStreamAdded),this._room.on(dh,this._onRemoteStreamRemoved),this._room.on("expelled",this._onExpelled),this._room.on("transferingCall",this._onTransferingCall),this._room.on("conference-destroyed",this._onDestroyed),this._room.on(ih,this._onParticipantAdded),this._room.on(rh,this._onParticipantRemoved),this._room.on(sh,this._onParticipantHold),this._room.on(oh,this._onParticipantUnhold)}_unbindEventHandlers(){this._room.off(ah,this._onLocalStreamChanged),this._room.off(ch,this._onLocalStreamAdded),this._room.off(uh,this._onLocalStreamRemoved),this._room.off(hh,this._onRemoteStreamChanged),this._room.off(lh,this._onRemoteStreamAdded),this._room.off(dh,this._onRemoteStreamRemoved),this._room.off("expelled",this._onExpelled),this._room.off("transferingCall",this._onTransferingCall),this._room.off("conference-destroyed",this._onDestroyed),this._room.off(ih,this._onParticipantAdded),this._room.off(rh,this._onParticipantRemoved),this._room.off(sh,this._onParticipantHold),this._room.off(oh,this._onParticipantUnhold)}_onLocalStreamChanged(e){e.streams&&e.streams.length>0?(this._localMediaHandler.setAudioOnlyStream(e.streams.find(e=>e.getAudioTracks().length>0)),this._localMediaHandler.setVideoStream(e.streams.find(e=>e.getVideoTracks().length>0)),this._localMediaHandler.getVideoStream().getScreenTracks().forEach(e=>{e.onended=()=>this._localMediaHandler.toggleScreen(!1)})):(this._localMediaHandler.setVideoStream(),this._localMediaHandler.setAudioOnlyStream())}_onLocalStreamAdded({participant:e,stream:t}){this.emitter.emit(ch,{participant:e,stream:new Du(t,!0)})}_onLocalStreamRemoved({participant:e,stream:t}){this.emitter.emit(uh,{participant:e,stream:new Du(t,!0)})}_onRemoteStreamAdded({participant:e,stream:t,reason:n}){this.emitter.emit(lh,{participant:e,reason:n,stream:this._getRemoteStream(t)||new Du(t)})}_getRemoteStream(e){for(var t of this._remoteStreams.values())for(var n of t)if(n&&n.mediaStream===e)return n}_onRemoteStreamRemoved({participant:e,stream:t,reason:n}){this.emitter.emit(dh,{participant:e,reason:n,stream:this._getRemoteStream(t)||new Du(t)})}_onRemoteStreamChanged(e){return Promise.resolve(e.participant?this._userManager.resolveUser(e.participant):null).then(t=>{var n,i=this._remoteStreams;if(!e.streams||e.streams.length<=0)this._remoteStreams=this._remoteStreams.delete(e.participant),t&&(this._remoteWacAddresses=this._remoteWacAddresses.delete(t.getAddress()));else{var r=e.streams.map(e=>this._getRemoteStream(e)||new Du(e));this._remoteStreams=this._remoteStreams.set(e.participant,r),t&&(this._remoteWacAddresses=this._remoteWacAddresses.add(t.getAddress())),n=this._getOutgoingInvitation(e.participant)}this.emitter.emit("remoteStreams",this._remoteStreams,i,{participant:e.participant,reason:e.reason}),n&&this._updateOutgoingInvitations(n.setStreams(!0),n)})}_onExpelled(){this._localMediaHandler.setVideoStream(),this._localMediaHandler.setAudioOnlyStream(),this._remoteStreams=new Wt,this.emitter.emit("expelled"),this._setStatus(th.DESTROYED)}_onDestroyed(){this._localMediaHandler.setVideoStream(),this._localMediaHandler.setAudioOnlyStream(),this._remoteStreams=new Wt,this.emitter.emit("destroyed"),this._setStatus(th.DESTROYED)}_onTransferingCall(e){return this._setTransferingCall(!0),this._room.acceptCallTransfer(e.payload.callTransferID).then(()=>(this.emitter.emit("callTransferStart"),this.inviteParticipant(e.payload.to,void 0,e.payload.mediatypes).then(e=>{200!=e&&this.emitter.emit("transferError",e)}).finally(()=>{this._setTransferingCall(!1)})))}_onParticipantAdded(e){var t=this;return s((function*(){fh.debug("onParticipantAdded(participant) : ".concat(e)),t._updateParticipants(t=>t.set(e.user,e.status)),t.emitter.emit(ih,e.user)}))()}_updateParticipants(e){var t=this.getRemoteParticipants(),n=e(t);return this._remoteParticipants=n,this.emitter.emit("remoteParticipants",n,t),n}_onParticipantRemoved(e){var t=this;return s((function*(){fh.debug("onParticipantRemoved(participant) : ".concat(e)),t._updateParticipants(t=>t.delete(e)),t.emitter.emit(rh,e)}))()}_onParticipantHold(e){fh.debug("onParticipantHold(participant) : ".concat(e)),this._updateParticipants(t=>t.set(e,"HOLD")),this.emitter.emit(sh,e)}_onParticipantUnhold(e){fh.debug("onParticipantUnhold(participant) : ".concat(e)),this._updateParticipants(t=>t.set(e,"IN_CALL")),this.emitter.emit(oh,e)}_updateOutgoingInvitations(e,t){var n=this._outgoingInvitations;t&&(this._outgoingInvitations=this._outgoingInvitations.delete(t)),e&&(this._outgoingInvitations=this._outgoingInvitations.add(e)),this.emitter.emit("outgoingInvitations",this._outgoingInvitations,n)}_getOutgoingInvitation(e){return this._outgoingInvitations.find(t=>t.getTo()===e)}_hasActiveInvitation(e){return this._outgoingInvitations.some(t=>t.getTo()===e&&t.isActive())}_alreadyJoined(e){var t=this._getOutgoingInvitation(e);return t?200===t.getResponseCode()&&this._remoteStreams.has(e):this._remoteStreams.has(e)}_canSendInvitation(e){return!this._hasActiveInvitation(e)&&!this._alreadyJoined(e)}getId(){return this._room.id}getRemoteParticipants(){return this._remoteParticipants}fetchRemoteParticipants(){var e=this;return s((function*(){var t=e._userManager.getOwnAddress(),n=yield e._userManager.resolveUser(t),i=(yield e._room.getParticipants()).filter(({user:e})=>e!==n.gatewayUsername),r=i.reduce((e,t)=>Object.assign(e,(({user:e,status:t})=>({[e]:t}))(t)),{});return e._remoteParticipants=Wt(r),e._remoteParticipants}))()}getStatus(){return this._status.value}getStatus$(){return this._status.asObservable()}getOwner(){return this._owner}getLocalMediaHandler(){return this._localMediaHandler}getRemoteStreams(){return this._remoteStreams}getRemoteGatewayUsernames(){return new Gn(this._remoteStreams.keySeq().filter(e=>!!e))}getRemoteWacAddresses(){return this._remoteWacAddresses}getOutgoingInvitations(){return this._outgoingInvitations}isBeingTransfered(){return this._transferingCall}updateMedia(e,t,n){return this.getStatus()===th.CONNECTED?this._room.update({audio:e,video:t,screen:n}):Promise.resolve()}hasRemoteVideo(){for(var[,[e]]of this._remoteStreams)if(e.hasVideoTracks())return!0;return!1}_setStatus(e){var t=this.getStatus();this._status.next(e),this.emitter.emit("status",e,t),e===th.DISCONNECTED&&this._unbindEventHandlers()}_setTransferingCall(e){this._transferingCall=e}canManage(){return this._room.isOwner()||!this._room.hasOwner()}isRecovered(){return this._room.recovered}getCurrentParticipants(){var e=this._remoteStreams.size;return this._outgoingInvitations.forEach(t=>{t.isActive()&&e++}),e}getInvite(){if(this._room.invite){var{id:e,from:t,mediaTypes:n}=this._room.invite;return new ph(e,t,n)}}inviteParticipant(e,t,n,i=!1,r,o=!0,a={}){var c=this;return s((function*(){var s;return n||((n=c._localMediaHandler.getMediaTypes()).screen=!1),c._userManager.resolveUser(e).then(u=>{if(fh.debug("calls/Conference.js/inviteParticipant/resolveUser",e,u),s=o&&u&&u.gatewayUsername?u.gatewayUsername:e,!c._canSendInvitation(s))throw fh.debug("calls/Conference.js/inviteParticipant/cannotSendInvite",s),new Error("ALREADY_JOINED");return c._updateOutgoingInvitations(new nh(u,s,n,i,void 0,!1,!1),c._getOutgoingInvitation(s)),c.invitationCount++,c._room.inviteParticipant(mh(t,s),n,r,a)}).then(e=>{fh.debug("calls/Conference.js/inviteParticipant/room.inviteParticipant/response",e);var t,n,i=c._getOutgoingInvitation(s);t=e.code,n=i,404===t&&"object"==typeof n.getToUser()&&(e.code=480);var r=i.setResponseCode(e.code);return e.whoAccepted&&(s=e.whoAccepted,r=r.setTo(e.whoAccepted)),c._remoteStreams.get(s)&&(r=r.setStreams(!0)),c._updateOutgoingInvitations(r,i),e}).catch(e=>{if(fh.error("calls/Conference.js/inviteParticipant",e),"ALREADY_JOINED"!==e.message){var t=c._getOutgoingInvitation(s);t&&c._updateOutgoingInvitations(t.setCanceled(!0),t)}throw e})}))()}expelParticipant(e,t){return t&&(e+="/".concat(t)),this._room.expelParticipant(e)}cancelInvitation(e,t){e.isCanceled()||(e.getResponseCode()||this._room.cancelInvitation(mh(t,e.getTo())),this._updateOutgoingInvitations(e.setCanceled(!0),e))}inviteParticipants(e){return Promise.all(e.map(e=>this.inviteParticipant(e)))}expelParticipants(e){return Promise.all(e.map(e=>this.expelParticipant(e)))}join(){var e=this;return s((function*(){if(e.getStatus()!==th.DISCONNECTED)return Promise.reject(Error("You can't connect to a conference in ".concat(th[e.getStatus()]," status")));e._setStatus(th.CONNECTING);try{yield e._room.join(e._localMediaHandler.getCurrentMediaConstraints()),yield e.fetchRemoteParticipants(),e._setStatus(th.CONNECTED)}catch(t){throw e._setStatus(th.DISCONNECTED),e._room.leave(),t}}))()}leave(e){var t=this;return s((function*(){switch(t.getStatus()){case th.DESTROYED:return;case th.DISCONNECTED:return t._room.leave(e);case th.DISCONNECTING:throw Error("You can't disconnect to a conference in ".concat(th[t.getStatus()]," status"))}if(t._setStatus(th.DISCONNECTING),t.canManage())try{t._outgoingInvitations.forEach(e=>{t.cancelInvitation(e)})}catch(e){fh.error(e)}try{return t._room.leave()}catch(e){if(!e.message.match(/already disconnected/))throw e}finally{t._setStatus(th.DISCONNECTED)}}))()}hold(){return this._room.hold()}unhold(){return this._room.unhold()}get isOnHold(){return this._room.isOnHold}unattendedCallTransfer(e,t=this._localMediaHandler.getMediaTypes()){return this._userManager.resolveUser(e).then(n=>{var i=n&&n.gatewayUsername?n.gatewayUsername:e;return this._room.unattendedCallTransfer(i,t)})}sendDtmf(e){return this.getStatus()!==th.CONNECTED?Promise.reject(new Error("You aren't joined to the conference")):this._room.sendDtmf(e)}}var vh=(e,t)=>{switch(e){case"ACCEPTED":case 200:return"accepted";case"DECLINED":case 603:return"rejected";case"DECLINED_BY_CREATOR":return"outgoing"===t?"rejected":"missed";case"DECLINED_BY_TIMEOUT":case 408:return"missed"}};class yh{static of(e){return Object.freeze(new yh(e))}constructor(e){this.raw=Wc(e),this.invites=Object.freeze((this.raw.invites||[]).map(e=>(e.getCandidates=()=>e.candidates.map(t=>({address:t.address,state:vh(e.group?t.endReason:e.state,"incoming"),direction:"incoming",type:e.inviteRequest?"inviteRequest":"invite",group:e.group})),e))),this.transfers=Object.freeze((this.raw.transfers||[]).map(e=>(e.getParticipants=()=>[{address:e.from,state:vh(e.state,"outgoing"),direction:"outgoing"},{address:e.to,state:vh(e.state,"incoming"),direction:"incoming"}],e))),this.participants=Object.freeze(this.raw.participants)}getId(){return this.raw.id}getDuration(){return this.raw.finishedAt-this.raw.createdAt}getStartTimestamp(){return this.raw.createdAt}getStartDateTime(){return new Date(this.raw.createdAt)}getEndDateTime(){return new Date(this.raw.finishedAt)}getParticipants(){return this.participants}getInvites(){return this.invites}getTransfers(){return this.transfers}}class bh{constructor(e){this.conferenceLogService=e,this.entries=[],this.timestampOfTheLastEntryRecovered=null,this.emitter=new Oi.EventEmitter2,c(this,["onCreate"]),this.conferenceLogService.emitter.on("create",this.onCreate)}onCreate(e){var t=yh.of(e);this.entries.unshift(t),this.emitter.emit("create",t)}fetch(e=10){var t=this;return s((function*(){t.timestampOfTheLastEntryRecovered||(t.timestampOfTheLastEntryRecovered=Date.now());var n=(yield t.conferenceLogService.fetch(e,t.timestampOfTheLastEntryRecovered)).map(e=>yh.of(e));return t.entries.push(...n),t.timestampOfTheLastEntryRecovered=t.getTimestampOfTheLastEntry(),t.emitter.emit("fetch"),n}))()}getTimestampOfTheLastEntry(){return this.entries.slice(-1).length?this.entries.slice(-1).pop().getStartTimestamp():void 0}getEntries(){return this.entries}}var _h=Ii.instance.getLogger("SippoJS/calls/ConferenceManager");class wh{static newInstance(e,t){return new wh(e,t)}constructor(e,t){this._wacProxy=e,this._userManager=t,this._defaultMediaConstraints={audio:!0,video:!0},this._conferences=new Map,this._conferenceLog=null,this._incomingInvitationRequestIds=new Set,this.emitter=new Oi.EventEmitter2,c(this,["_onIncomingConference","_onConferenceInvitationRequest","_onConferenceInvitationRequestCancelled"]),this._bindEventHandlers()}_bindEventHandlers(){this._wacProxy.conference.on("incomingConference",this._onIncomingConference),this._wacProxy.conference.on("invitationRequest",this._onConferenceInvitationRequest),this._wacProxy.conference.on("cancelInvitationRequest",this._onConferenceInvitationRequestCancelled)}_onIncomingConference(e,t){var n=this;return s((function*(){var i=yield gh.create(n._userManager,e,n._defaultMediaConstraints);yield i.getLocalMediaHandler().setMediaTypes(t),n._conferences.set(e.id,i),n.emitter.emit("conferenceInvitation",i)}))()}_onConferenceInvitationRequest(e){this._incomingInvitationRequestIds.add(e.id);var[t,n]=e.user.split("/"),i={id:e.id,from:t,hasRemoteVideo:()=>e.video,hasStatus:()=>!0,getRemoteUser:()=>i.remoteUser,getRemoteGatewayUser:()=>t,acceptInvitationRequest:()=>e.accept(),_connect:r=>(i.status="trying",r.inviteParticipant(t,n,{audio:!0,video:i.hasRemoteVideo()},!0,e.id,!1)),_disconnect:()=>{e.reject()}};this._userManager.getUsername(t).then(e=>this._userManager.resolveUser(e)).then(n=>{this._incomingInvitationRequestIds.has(e.id)&&(this._incomingInvitationRequestIds.delete(e.id),i.remoteUser=n||t,this.emitter.emit("conferenceInvitationRequest",i))})}_onConferenceInvitationRequestCancelled(e){this._incomingInvitationRequestIds.delete(e.id),this.emitter.emit("conferenceInvitationRequestCancelled",e)}getDefaultMediaConstraints(){return Wc(this._defaultMediaConstraints)}setDefaultMediaConstraints(e){this._defaultMediaConstraints=Wc(e)}createConference(){return this._wacProxy.conference.create().then(e=>gh.create(this._userManager,e,this._defaultMediaConstraints))}getConferenceLog(){return null===this._conferenceLog&&(this._conferenceLog=new bh(this._wacProxy.getConferenceLogService())),this._conferenceLog}requestConferenceInvitation(e,t={audio:!0,video:!0}){return this._userManager.resolveUser(e).then(n=>{var i=n&&n.gatewayUsername?n.gatewayUsername:e;return{getRemoteUser:()=>n,to:i,hasLocalVideo:()=>!!t.video,hasLocalOnlyVideo:()=>!1,_disconnect:()=>{this._wacProxy.conference.cancelInvitationRequest(i)},_connect:()=>this._wacProxy.conference.requestInvitation(i,t)}})}_getConferenceForRoom(e){var t=this;return s((function*(){var n=yield gh.create(t._userManager,e,t._defaultMediaConstraints);return yield n.getLocalMediaHandler().setMediaTypes(e.invite.mediatypes),t._conferences.set(e.id,n),n}))()}getCurrentInvitations(){var e=this;return _h.debug("calls/ConferenceManager.js/getCurrentInvitations"),this._wacProxy.conference.getCurrentInvitations().then(t=>{_h.debug("calls/ConferenceManager.js/getCurrentInvitations/rooms",t);var n=t.map(function(){var t=s((function*(t){if(t.isRequest)return delete t.isRequest,e._onConferenceInvitationRequest(t),t;var n=yield e._getConferenceForRoom(t);return e.emitter.emit("conferenceInvitation",n),n}));return function(e){return t.apply(this,arguments)}}());return Promise.all(n)})}getConferenceByUri(e){var t=this;return s((function*(){var n=yield t._wacProxy.conference.getRoomByUri(e);return yield gh.create(t._userManager,n,t._defaultMediaConstraints)}))()}}class Sh{static of({id:e,name:t,participants:n,phonebook:i}={}){return new Sh(e,t,n,i)}constructor(e,t,n,i){this.id=e,this.name=t,this.participants=new Gn(n),this.phonebook=new Gn(i),Object.freeze(this)}getId(){return this.id}getName(){return this.name}getParticipants(){return this.participants}getPhonebook(){return this.phonebook}with({name:e=this.name,participants:t=this.participants}={}){return new Sh(this.id,e,t)}plusParticipants(...e){return this.with({participants:this.participants.union(e)})}minusParticipants(...e){return this.with({participants:this.participants.subtract(e)})}}function Ch(e,t){return e.name<t.name?-1:e.name>t.name?1:0}class Eh{static newInstance(e,t,n){return new Eh(e,t,n).init()}constructor(e,t,n){this.groupService=e,this.phonebookService=t,this.userManager=n,this.groups=fn(),this.emitter=new Oi.EventEmitter2,c(this,["onDelete","onPut"])}init(){var e=this;return s((function*(){e.groupService.emitter.on("put",e.onPut),e.groupService.emitter.on("delete",e.onDelete);var t=yield e.groupService.fetch();for(var n of t)n.participants=yield e.convertToAddresses(n.participants);return e.groups=fn.of(...yield Promise.all(t.map(t=>e.newGroup(t)))),e.groups=e.groups.sort(Ch),e}))()}uninit(){this.groupService.emitter.off("put",this.onPut),this.groupService.emitter.off("delete",this.onDelete)}convertToAddresses(e){var t=this;return s((function*(){var n=[];for(var i of e){var r=yield t.userManager.resolveUser(i);n.push("".concat(r.username,"@").concat(r.domain))}return n}))()}convertToIds(e){var t=this;return s((function*(){var n=[];for(var i of e){var r=yield t.userManager.resolveUser(i);n.push(r.id)}return n}))()}onPut(e){var t=this;return s((function*(){e.participants=yield t.convertToAddresses(e.participants);var n=t.groups.findIndex(t=>t.getId()===e.id),i=yield t.newGroup(e);return t.groups=n<0?t.groups.push(i):t.groups.set(n,i),t.groups=t.groups.sort(Ch),t.emitter.emit("groups"),i}))()}onDelete({id:e}){this.groups=this.groups.filter(t=>t.getId()!==e),this.emitter.emit("groups")}newGroup({id:e,name:t,participants:n}){var i=this;return s((function*(){var r=(yield i.phonebookService.getPhonebooksBySubscriberId(e)).map(e=>e.contacts).reduce((e,t)=>e.concat(t),[]);return Sh.of({id:e,name:t,participants:n,phonebook:r})}))()}getGroups(){return this.groups}createGroup(e,t){var n=this;return s((function*(){var i=yield n.convertToIds(t),r=yield n.groupService.create(e,i);return yield n.onPut(r)}))()}saveGroup(e){var t=this;return s((function*(){var n=yield t.convertToIds(e.getParticipants().toJS());yield t.groupService.update(e.getId(),e.getName(),n)}))()}deleteGroup(e){var t=this;return s((function*(){yield t.groupService.delete(e.getId()),yield t.onDelete({id:e.getId()})}))()}getPhonebook(e){return this.phonebookService.getPhonebooksBySubscriberId(e.getId())}}var kh=u(["INCOMING","OUTGOING"]);class xh{constructor(e,t,n,i,r){this.wacProxy=e,this.type=t,this.sender=n,this.receiver=i,this.message=r}getSender(){return this.sender}getReceiver(){return this.receiver}getMessage(){return this.message}send(){if(this.type!==kh.outgoing)throw new Error("Outgoing message can not be sent");return this.wacProxy.sendIm(this.receiver,this.message)}}class Ih extends Oi.EventEmitter2{constructor(e,t){super(),this._stack=e,this._id=t.id,this._name=t.name,this._participants=t.participants,this._language=t.language,this._validSince=t.validSince,this._validUntil=t.validUntil,this._url=t.url,this._phone=t.phone}get id(){return this._id}get name(){return this._name}get participants(){return this._participants}get language(){return this._language}get validSince(){return this._validSince}get validUntil(){return this._validUntil}get url(){return this._url}get phone(){return this._phone}set id(e){this._id=e}set phone(e){this._phone=e}reinvite(){return this._stack.sendMeetingInvites(this._id).then(()=>this)}destroy(){return this._stack.delete(this._id).then(()=>this._remove())}isOnline(){return""!==this.phone}_remove(){this._stack=null,this.emit("delete")}toJSON(){return{id:this._id,name:this._name,participants:this._participants,language:this._language,validSince:this._source,validUntil:this._presence,url:this._url,phone:this._phone}}}class Oh extends Oi.EventEmitter2{constructor(e){super(),this._meetingService=e,this._meetings=[],this._initializing=null,this._message="",c(this,["onUserInMeeting","onLocalMeetingRemove"])}init(e={}){return null!==this._initializing?this._initializing:(this._meetingService.emitter.on("update",this.onUserInMeeting),this._initializing=this._meetingService.get(e).then(e=>(e.forEach(e=>{if(this._meetings.some(t=>t.id===e.id))return e;var t=new Ih(this._meetingService,e);this._meetings.push(t),this.emit("meeting-recovered",t)}),this)),this._initializing)}uninit(){return null===this._initializing?Promise.resolve():this._initializing.then(()=>{this._meetingService.emitter.off("update",this.onUserInMeeting),this._meetings=[],this._initializing=null})}createMeeting(e,t,n,i=!1){return Promise.resolve().then(()=>(this._checkInitializingOfService(),i&&(t=this._insertSendSMSFlagInParticipants(t)),this._meetingService.create({name:e,participants:t,validSince:n}))).then(e=>({meeting:this._addMeeting(e),phones:this._getPhonesFromParticipants(t)}))}updateMeeting(e,t,n,i,r){return Promise.resolve().then(()=>(this._checkInitializingOfService(),r&&(n=this._insertSendSMSFlagInParticipants(n)),this._meetingService.update(e,{name:t,participants:n,validSince:i}))).then(e=>(this._updateMeeting(e),e))}_insertSendSMSFlagInParticipants(e){return e.map(e=>(e.sendSMS=!0,e))}getMeetings(){return this._meetings}set message(e){this._message=e}_addMeeting(e){if(!this._meetings.some(t=>t.id===e.id)){var t=new Ih(this._meetingService,e);return this._meetings.push(t),this.emit("create",t),t}}_updateMeeting(e){var t=this._meetings.findIndex(t=>t.id===e.id);t<0||(this._meetings[t]=new Ih(this._meetingService,e))}_rmMeeting(e){var t=this._meetings.findIndex(t=>t.id===e);if(!(t<0)){var n=this._meetings.splice(t,1)[0];return n.off("delete",this.onLocalMeetingRemove),n}}onLocalMeetingRemove(e){this._rmMeeting(e.id)||this.emit("delete",e)}onUserInMeeting(e){var t=this._meetings.find(t=>e.id===t.id);t&&(t.phone=e.phone,""!==t.phone?this.emit("participant-connected"):this.emit("participant-disconnected"))}_checkInitializingOfService(){if(null===this._initializing)throw new Error("MeetingManager not initialized")}_getPhonesFromParticipants(e){return e.map(e=>e.phone).filter(e=>e)}}var jh=u(["UNCONNECTED","CONNECTING","CONNECTED","REJECTED","DISCONNECTED"]),Th=Symbol("id"),Rh=Symbol("internalId"),Ah=Symbol("type"),Ph=Symbol("stack"),Dh=Symbol("participants"),Mh=Symbol("label"),qh=Symbol("status"),Nh=function(e){switch(e){case jh.UNCONNECTED:return 0;case jh.CONNECTING:return 1;case jh.CONNECTED:return 2;case jh.REJECTED:return 3;case jh.DISCONNECTED:return 4}};class Fh extends Oi.EventEmitter2{constructor(e=Math.random().toString(16).substring(2),t,n,i,r="generic"){if(super(),!(i instanceof Array))throw new TypeError("invalid value for participants. An Array expected but an "+typeof i+" received.");this[Th]=e,this[Rh]=null,this[Ah]=t,this[Ph]=n,this[Dh]=i,this[Mh]=r,this[qh]=jh.UNCONNECTED}set status(e){this[qh]!=e&&(this[qh]=e,this.emit("status",e))}set internalId(e){this[Rh]=e}get id(){return this[Th]}get internalId(){return null!==this[Rh]?this[Rh]:this.id}get type(){return this[Ah]}get stack(){return this[Ph]}get participants(){return this[Dh]}get remoteParticipants(){return this[Dh].filter(e=>e!==this.stack.wStack.getCurrentCredential().data.username)}get label(){return this[Mh]}get status(){return this[qh]}addParticipant(){return Promise.reject(new Error("unimplemented"))}removeParticipant(){return Promise.reject(new Error("unimplemented"))}connect(){return Promise.reject(new Error("unimplemented"))}disconnect(){return Promise.reject(new Error("unimplemented"))}reject(){return Promise.reject(new Error("unimplemented"))}send(){return Promise.reject(new Error("unimplemented"))}when(e){var t=Nh(e);return new Promise((e,n)=>{if(Nh(this[qh])>t)n(new Error("unreachable state"));else if(Nh(this[qh])==t)e(this);else{var i=r=>{var s=Nh(r);s==t?(this.off("status",i),e(this)):s>t&&(this.off("status",i),n(new Error("invalid state")))};this.on("status",i)}})}}var Lh=u(["INCOMING","OUTGOING"]);class Uh extends Fh{constructor(e,t,n,i,r){super(e,t,n,i,r),this.datapipeService=n.getDatapipeService(),this.gatewayUsername=n.wStack.getCurrentCredential().data.username,c(this,["onStatus","onData","onDelete","onUpdate"]),this.makeBindings()}connect(){var e=this;return s((function*(){if(e.status!==jh.UNCONNECTED)throw new Error("invalid-state");e.status=jh.CONNECTING;try{if(e.type===Lh.OUTGOING){var t=yield e.datapipeService.create(e.label,e.participants);e.internalId=t.id}yield e.datapipeService.accept(e.internalId),yield e.when(jh.CONNECTED)}catch(t){throw e.status=jh.DISCONNECTED,t}return e}))()}disconnect(){var e=this;return s((function*(){if(e.status!==jh.CONNECTED)throw new Error("invalid-state");return yield e.datapipeService.delete(e.internalId),e.status=jh.DISCONNECTED,e}))()}reject(){var e=this;return s((function*(){if(e.status!==jh.UNCONNECTED||e.type!==Lh.INCOMING)throw new Error("invalid-state");return yield e.datapipeService.delete(e.internalId),e.status=jh.DISCONNECTED,e}))()}send(e){var t=this;return s((function*(){if(t.status!==jh.CONNECTED)throw new Error("invalid-state");return yield t.datapipeService.send(t.internalId,e),t}))()}makeBindings(){return this.on("status",this.onStatus),this.datapipeService.emitter.on("delete",this.onDelete),this.datapipeService.emitter.on("data",this.onData),this.datapipeService.emitter.on("update",this.onUpdate),this}destroyBindings(){return this.off("status",this.onStatus),this.datapipeService.emitter.off("delete",this.onDelete),this.datapipeService.emitter.off("data",this.onData),this.datapipeService.emitter.off("update",this.onUpdate),this}onStatus(){this.status===jh.DISCONNECTED&&this.destroyBindings()}onDelete(e){e.id===this.internalId&&(this.status=jh.DISCONNECTED)}onData(e){e.id===this.internalId&&(this.emit("data",e.payload),this.emit("data-with-info",{data:e.payload,from:e.from,ts:e.ts}))}onUpdate(e){e.id===this.internalId&&e.connected.includes(this.gatewayUsername)&&(this.status=jh.CONNECTED)}}class Bh extends Fh{constructor(e,t,n,i,r){if(super(e,t,n,i,r),2!==i.length)throw new TypeError("participants parameter must have 2 elements");c(this,["onStatus","onQsCalling","onQsEstablished","onQsEndCall","onQsData"]),this.rcv=0,this.handleCalling=this.type===Lh.OUTGOING,this.makeBindings()}_connectOutgoing(){return this.status=jh.CONNECTING,this.stack.call(this.participants[1],{data:!0}),this.when(jh.CONNECTED)}_connectIncoming(){return this.status=jh.CONNECTING,this.stack.answer(this.internalId,{data:!0}),this.when(jh.CONNECTED)}connect(){return this.status!==jh.UNCONNECTED?Promise.reject(new Error("invalid-state")):this.type==Lh.OUTGOING?this._connectOutgoing():this._connectIncoming()}_reject(){return this.stack.hangup(this.internalId),this.when(jh.DISCONNECTED)}disconnect(){return this.status!==jh.CONNECTING&&this.status!==jh.CONNECTED?Promise.reject(new Error("invalid-state")):this._reject()}reject(){return this.status!==jh.UNCONNECTED?Promise.reject(new Error("invalid-state")):this.type!=Lh.INCOMING?Promise.reject(new Error("invalid-state")):this._reject()}send(e){return this.status!==jh.CONNECTED?Promise.reject(new Error("invalid-state")):(this.stack.sendDataChannel(this.internalId,e),Promise.resolve(this))}makeBindings(){return this.on("status",this.onStatus),this.type===Lh.OUTGOING&&this.stack.on("qs-calling",this.onQsCalling),this.stack.on("qs-established",this.onQsEstablished),this.stack.on("qs-end-call qs-lost-call",this.onQsEndCall),this.stack.on("qs-data",this.onQsData),this}destroyBindings(){return this.off("status",this.onStatus),this.type===Lh.OUTGOING&&this.stack.off("qs-calling",this.onQsCalling),this.stack.off("qs-established",this.onQsEstablished),this.stack.off("qs-end-call qs-lost-call",this.onQsEndCall),this.stack.off("qs-data",this.onQsData),this}onStatus(){this.status===jh.DISCONNECTED&&this.destroyBindings()}onQsCalling(e){this.handleCalling&&(this.internalId=e.callid,this.handleCalling=!1)}onQsEstablished(e){e.callid===this.internalId&&this.type===Lh.OUTGOING&&this.stack.sendDataChannel(this.internalId,JSON.stringify({label:this.label}))}onQsEndCall(e){e.callid===this.internalId&&(this.status=jh.DISCONNECTED)}onQsData(e){if(e.id===this.internalId){if(0===this.rcv){if(this.type==Lh.INCOMING){var t=JSON.parse(e.data);this.label=t.label,this.stack.sendDataChannel(this.internalId,e.data)}this.status=jh.CONNECTED}else this.emit("data",e.data);this.rcv++}}}const zh="HOLD",Gh="GONE",Wh="NEW",Hh="UNHOLD",Vh="HOLD",$h={OPEN_COMPLETED:"openCompleted"},Jh="participantHold",Yh="participantUnhold",Qh="participantAdded",Kh="participantRemoved",Xh="connected",Zh="closed";class el{constructor(e,t,n,i){this.feed=e,this.local=t,this.stream=n,this.medium=i}}const tl="streamAdded",nl="streamRemoved",il=Symbol("feed"),rl=Symbol("localStream"),sl=Symbol("remoteStream");class ol extends Oi.EventEmitter2{constructor(e){super(),this[il]=e,this[rl]=null,this[sl]=null}get feed(){return this[il]}get localStream(){return this[rl]}get remoteStream(){return this[sl]}setLocalStream(e,t){if(this[rl]){const e=this[rl];this[rl]=null,this.emit(nl,e)}if(e){const n=new el(this.feed,!0,e,t);this[rl]=n,this.emit(tl,n)}}setRemoteStream(e,t){if(this[sl]){const e=this[sl];this[sl]=null,this.emit(nl,e)}if(e){const n=new el(this.feed,!1,e,t);this[sl]=n,this.emit(tl,n)}}}var al=function(e,t,n,i){for(var r=e.length,s=n+(i?1:-1);i?s--:++s<r;)if(t(e[s],s,e))return s;return-1};var cl=function(e){return e!=e};var ul=function(e,t,n){for(var i=n-1,r=e.length;++i<r;)if(e[i]===t)return i;return-1};var hl=function(e,t,n){return t==t?ul(e,t,n):al(e,cl,n)};var ll=function(e,t){return!!(null==e?0:e.length)&&hl(e,t,0)>-1};var dl=function(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1};var pl=function(e,t,n,i){var r=-1,s=ll,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;n&&(t=eu(t,pa(n))),i?(s=dl,o=!1):t.length>=200&&(s=Fo,o=!1,t=new qo(t));e:for(;++r<a;){var h=e[r],l=null==n?h:n(h);if(h=i||0!==h?h:0,o&&l==l){for(var d=u;d--;)if(t[d]===l)continue e;c.push(h)}else s(t,l,i)||c.push(h)}return c};var fl=function(e,t){return ku(_u(e,t,Su),e+"")};var ml=function(e){return ta(e)&&ka(e)},gl=fl((function(e,t){return ml(e)?pl(e,t):[]}));function vl(e,t,n=!0){t.forEach(t=>{e[t]=n?function(...n){return n.push(this),Object.getPrototypeOf(e)[t].apply(e,n)}:Object.getPrototypeOf(e)[t].bind(e)})}function yl(e,t){if(!e[t])throw Error(`${t} is needed as dependency`)}const bl=Symbol("list");class _l extends Oi.EventEmitter2{constructor(e){super(),this[bl]=[],this.streamEventHandler=e;this.streamEventHandler=e||{onStreamAdded(e,t){e.emit(tl,t)},onStreamRemoved(e,t){e.emit(nl,t)}},vl(this,["onStreamAdded","onStreamRemoved"])}get items(){return this[bl]}get localStreams(){let e=[];return this[bl].forEach(t=>{t.localStream&&e.push(t.localStream),t.localStreams&&(e=e.concat(t.localStreams))}),e}get remoteStreams(){let e=[];return this[bl].forEach(t=>{t.remoteStream&&e.push(t.remoteStream),t.remoteStreams&&(e=e.concat(t.remoteStreams))}),e}_addItem(e){return this[bl].includes(e)||(e.on(tl,this.onStreamAdded),e.on(nl,this.onStreamRemoved),this[bl].push(e)),Promise.resolve()}_removeItem(e){return this[bl].includes(e)&&(e.off(tl,this.onStreamAdded),e.off(nl,this.onStreamRemoved),this[bl]=gl(this[bl],e)),Promise.resolve()}onStreamAdded(e){this.streamEventHandler.onStreamAdded(this,e)}onStreamRemoved(e){this.streamEventHandler.onStreamRemoved(this,e)}}const wl=(e,t)=>Object.assign({},e,{reason:t});const Sl="hold",Cl="unhold";function El(e){const t=new Oi.EventEmitter2;e.emitter.on(Sl,e=>t.emit(Sl,e)),e.emitter.on(Cl,e=>t.emit(Cl,e));const n=t=>()=>e.send(t,{});return{hold:n(Sl),unhold:n(Cl),emitter:t}}const kl="new",xl="gone";function Il(){const e=(e,t)=>e.getSubscribers().subscribe(t.feed.feed,t.feed.medium).catch(()=>{}),t=(e,t)=>{const i=e.getSubscribers();return i.unsubscribe(t.feed.feed,t.feed.medium).catch(()=>{}).then(()=>{if("sipcall"===t.feed.medium&&n(i,t.feed.feed))return i.unsubscribe(t.feed.feed,"sfuvideo").catch(e=>{Ci.error(`Unable to unsubscribe from feed ${t.feed.feed} with error: ${e}`)})})},n=(e,t)=>!!e.get(t,"sfuvideo");return{onJanusFeed:(n,i)=>{switch(i.event){case kl:return e(n,i);case xl:return t(n,i);default:return Promise.resolve()}}}}class Ol{constructor(e){this.client=e}login(e,t,n){return this.client.send("login",{username:e,token:n,room:t})}logout(){return this.client.send("logout",{})}}class jl{constructor(e){this.client=e}publish(e,t){const n={medium:e,jsep:{type:"offer",sdp:t}};return this.parallelSipExtension&&(n.parallelSipExtension=this.parallelSipExtension),this.client.send("open",n)}waitPublishComplete(e){const{emitter:t}=this.client,{OPEN_COMPLETED:n}=$h;return new Promise(i=>{const r=s=>{s.medium===e&&(t.off(n,r),i())};t.on(n,r)})}unpublish(e){return this.client.send("close",{medium:e})}subscribe(e,t){const n={medium:e,feed:t};return this.client.send("open",n)}unsubscribe(e,t){return this.client.send("close",{feed:t,medium:e})}answer(e,t,n){const i={feed:t,medium:e,jsep:{type:"answer",sdp:n}};return this.client.send("answer",i)}trickle(e,t,n){const i={medium:e};return i.candidate=t?{sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate}:{completed:!0},n&&(i.feed=n),this.client.send("trickle",i)}bitrate(e){return this.client.send("bitrate",{bitrate:e})}setParallelSipExtension(e){this.parallelSipExtension=e}}function Tl(e){return{getAll:()=>e.send("getParticipants",{})}}var Rl,Al=n(68),Pl=n.n(Al);!function(e){e.WEBSOCKET="websocket",e.SOCKETIO="socketio"}(Rl||(Rl={}));class Dl{constructor(e,t){this.address=e,this.transport=t}static fromUnknownAddress(e){return"string"==typeof e?this.fromSocketIo(e):e}static fromSocketIo(e){return new Dl(e,Rl.SOCKETIO)}static fromWebsocket(e){return new Dl(e,Rl.WEBSOCKET)}getAddress(){return this.address}getTransport(){return this.transport}}function Ml(e){return"function"==typeof e}Dl.Transport=Rl;var ql=!1,Nl={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;ql=e},get useDeprecatedSynchronousErrorHandling(){return ql}};function Fl(e){setTimeout((function(){throw e}))}var Ll={closed:!0,next:function(e){},error:function(e){if(Nl.useDeprecatedSynchronousErrorHandling)throw e;Fl(e)},complete:function(){}},Ul=Array.isArray||function(e){return e&&"number"==typeof e.length};function Bl(e){return null!==e&&"object"==typeof e}function zl(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}zl.prototype=Object.create(Error.prototype);var Gl=zl,Wl=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,i=this._parents,r=this._unsubscribe,s=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var o=-1,a=i?i.length:0;n;)n.remove(this),n=++o<a&&i[o]||null;if(Ml(r))try{r.call(this)}catch(n){t=!0,e=n instanceof Gl?Hl(n.errors):[n]}if(Ul(s))for(o=-1,a=s.length;++o<a;){var c=s[o];if(Bl(c))try{c.unsubscribe()}catch(n){t=!0,e=e||[],n instanceof Gl?e=e.concat(Hl(n.errors)):e.push(n)}}if(t)throw new Gl(e)}},e.prototype.add=function(t){var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var i=n;(n=new e)._subscriptions=[i]}break;default:if(!t)return e.EMPTY;throw new Error("unrecognized teardown "+t+" added to Subscription.")}if(n._addParent(this)){var r=this._subscriptions;r?r.push(n):this._subscriptions=[n]}return n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;return t!==e&&(t?n?-1===n.indexOf(e)&&(n.push(e),!0):(this._parents=[e],!0):(this._parent=e,!0))},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function Hl(e){return e.reduce((function(e,t){return e.concat(t instanceof Gl?t.errors:t)}),[])}var Vl="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),$l=function(e){function t(n,i,r){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=Ll;break;case 1:if(!n){s.destination=Ll;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new Jl(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new Jl(s,n,i,r)}return s}return ji.b(t,e),t.prototype[Vl]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(Wl),Jl=function(e){function t(t,n,i,r){var s,o=e.call(this)||this;o._parentSubscriber=t;var a=o;return Ml(n)?s=n:n&&(s=n.next,i=n.error,r=n.complete,n!==Ll&&(Ml((a=Object.create(n)).unsubscribe)&&o.add(a.unsubscribe.bind(a)),a.unsubscribe=o.unsubscribe.bind(o))),o._context=a,o._next=s,o._error=i,o._complete=r,o}return ji.b(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Nl.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Nl.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Fl(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Fl(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Nl.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Nl.useDeprecatedSynchronousErrorHandling)throw e;Fl(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Nl.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return Nl.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(Fl(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}($l);var Yl="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ql(){}function Kl(e){return e?1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}:Ql}var Xl=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,r=function(e,t,n){if(e){if(e instanceof $l)return e;if(e[Vl])return e[Vl]()}return e||t||n?new $l(e,t,n):new $l(Ll)}(e,t,n);if(i?r.add(i.call(r,this.source)):r.add(this.source||Nl.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Nl.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Nl.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e,n=t.closed,i=t.destination,r=t.isStopped;if(n||r)return!1;e=i&&i instanceof $l?i:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Zl(t))((function(t,i){var r;r=n.subscribe((function(t){try{e(t)}catch(e){i(e),r&&r.unsubscribe()}}),i,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Yl]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Kl(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Zl(e))((function(e,n){var i;t.subscribe((function(e){return i=e}),(function(e){return n(e)}),(function(){return e(i)}))}))},e.create=function(t){return new e(t)},e}();function Zl(e){if(e||(e=Nl.Promise||Promise),!e)throw new Error("no Promise impl found");return e}function ed(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var td=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function nd(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var id=nd();var rd=function(e){return function(t){for(var n=0,i=e.length;n<i&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}};function sd(e,t){return new Xl(t?function(n){var i=new Wl,r=0;return i.add(t.schedule((function(){r!==e.length?(n.next(e[r++]),n.closed||i.add(this.schedule())):n.complete()}))),i}:rd(e))}var od=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Fl),t}};var ad=function(e){return function(t){for(var n=e[id]();;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}};var cd=function(e){return function(t){var n=e[Yl]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}};var ud=function(e){if(e instanceof Xl)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[Yl])return cd(e);if(td(e))return rd(e);if(ed(e))return od(e);if(e&&"function"==typeof e[id])return ad(e);var t=Bl(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function hd(e,t){if(!t)return e instanceof Xl?e:new Xl(ud(e));if(null!=e){if(function(e){return e&&"function"==typeof e[Yl]}(e))return function(e,t){return new Xl(t?function(n){var i=new Wl;return i.add(t.schedule((function(){var r=e[Yl]();i.add(r.subscribe({next:function(e){i.add(t.schedule((function(){return n.next(e)})))},error:function(e){i.add(t.schedule((function(){return n.error(e)})))},complete:function(){i.add(t.schedule((function(){return n.complete()})))}}))}))),i}:cd(e))}(e,t);if(ed(e))return function(e,t){return new Xl(t?function(n){var i=new Wl;return i.add(t.schedule((function(){return e.then((function(e){i.add(t.schedule((function(){n.next(e),i.add(t.schedule((function(){return n.complete()})))})))}),(function(e){i.add(t.schedule((function(){return n.error(e)})))}))}))),i}:od(e))}(e,t);if(td(e))return sd(e,t);if(function(e){return e&&"function"==typeof e[id]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Xl(t?function(n){var i,r=new Wl;return r.add((function(){i&&"function"==typeof i.return&&i.return()})),r.add(t.schedule((function(){i=e[id](),r.add(t.schedule((function(){if(!n.closed){var e,t;try{var r=i.next();e=r.value,t=r.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),r}:ad(e))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}var ld=new Xl((function(e){return e.complete()}));function dd(e){return e?function(e){return new Xl((function(t){return e.schedule((function(){return t.complete()}))}))}(e):ld}function pd(e){return new Xl((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?hd(n):dd()).subscribe(t)}))}function fd(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new md(e,t))}}var md=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new gd(e,this.project,this.thisArg))},e}(),gd=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return ji.b(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}($l);Object.prototype.toString;function vd(e,t,n,i){return Ml(n)&&(i=n,n=void 0),i?vd(e,t,n).pipe(fd((function(e){return Ul(e)?i.apply(void 0,e):i(e)}))):new Xl((function(i){!function e(t,n,i,r,s){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var a=t;t.addEventListener(n,i,s),o=function(){return a.removeEventListener(n,i,s)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var c=t;t.on(n,i),o=function(){return c.off(n,i)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var u=t;t.addListener(n,i),o=function(){return u.removeListener(n,i)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var h=0,l=t.length;h<l;h++)e(t[h],n,i,r,s)}r.add(o)}(e,t,(function(e){arguments.length>1?i.next(Array.prototype.slice.call(arguments)):i.next(e)}),i,n)}))}function yd(e){return e&&"function"==typeof e.schedule}var bd=function(e){function t(t,n,i){var r=e.call(this)||this;return r.parent=t,r.outerValue=n,r.outerIndex=i,r.index=0,r}return ji.b(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}($l);var _d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ji.b(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}($l);var wd=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new Sd(e,this.project,this.concurrent))},e}(),Sd=function(e){function t(t,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var r=e.call(this,t)||this;return r.project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return ji.b(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var i=new bd(this,void 0,void 0);this.destination.add(i),function(e,t,n,i,r){if(void 0===r&&(r=new bd(e,n,i)),!r.closed)ud(t)(r)}(this,e,t,n,i)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(_d);function Cd(e){return e}function Ed(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),function e(t,n,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof n?function(r){return r.pipe(e((function(e,i){return hd(t(e,i)).pipe(fd((function(t,r){return n(e,t,i,r)})))}),i))}:("number"==typeof n&&(i=n),function(e){return e.lift(new wd(t,i))})}(Cd,e)}function kd(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}kd.prototype=Object.create(Error.prototype);var xd=kd;function Id(e){return function(t){return 0===e?dd():t.lift(new Od(e))}}var Od=function(){function e(e){if(this.total=e,this.total<0)throw new xd}return e.prototype.call=function(e,t){return t.subscribe(new jd(e,this.total))},e}(),jd=function(e){function t(t,n){var i=e.call(this,t)||this;return i.total=n,i.count=0,i}return ji.b(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}($l),Td=n(66),Rd=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n};const Ad=e=>{if("error"===e.response){const t=e.payload,n=Error(t.reason);throw n.code=t.code,n}return e.payload||{}};class Pd{constructor(e){this.socket=e}static async connect(e,t={}){const n=await Td.a(e.getAddress(),t);return new Pd(n)}request(e){return pd(()=>{const{endpoint:t}=e,n=Rd(e,["endpoint"]),i=Object.assign({request:t},n),r=vd(this.socket,e.id).pipe(Id(1),fd(Ad));return this.socket.emit("message",i),r})}getEvents(){const e=e=>vd(this.socket,e).pipe(fd(t=>({eventName:e,payload:t})));return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,i=null,r=e[e.length-1];return yd(r)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof r&&(n=e.pop()),null===i&&1===e.length&&e[0]instanceof Xl?e[0]:Ed(n)(sd(e,i))}(e("disconnect"),e("feed"),e("webrtc"),e("destroyed"),e("disconnected"),e("participantAdded"),e("participantRemoved"),e("hold"),e("unhold"),e("openCompleted"))}disconnect(){this.socket.disconnect()}}function Dd(e,t){return function(n){return n.lift(new Md(e,t))}}var Md=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new qd(e,this.predicate,this.thisArg))},e}(),qd=function(e){function t(t,n,i){var r=e.call(this,t)||this;return r.predicate=n,r.thisArg=i,r.count=0,r}return ji.b(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}($l),Nd=n(30),Fd=n.n(Nd);function Ld(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}Ld.prototype=Object.create(Error.prototype);var Ud=Ld,Bd=function(e){function t(t,n){var i=e.call(this)||this;return i.subject=t,i.subscriber=n,i.closed=!1,i}return ji.b(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Wl),zd=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return ji.b(t,e),t}($l),Gd=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return ji.b(t,e),t.prototype[Vl]=function(){return new zd(this)},t.prototype.lift=function(e){var t=new Wd(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Ud;if(!this.isStopped)for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ud;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ud;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),i=0;i<t;i++)n[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Ud;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Ud;return this.hasError?(e.error(this.thrownError),Wl.EMPTY):this.isStopped?(e.complete(),Wl.EMPTY):(this.observers.push(e),new Bd(this,e))},t.prototype.asObservable=function(){var e=new Xl;return e.source=this,e},t.create=function(e,t){return new Wd(e,t)},t}(Xl),Wd=function(e){function t(t,n){var i=e.call(this)||this;return i.destination=t,i.source=n,i}return ji.b(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Wl.EMPTY},t}(Gd);class Hd{constructor(e,t){this.socket=e,this.messages=t}static fromSocket(e,t){return new Hd(e,t)}static async connect(e,t){const n=(t||(e=>new Fd.a(e,Hd.PROTOCOL)))(e);return new Promise((e,t)=>{const i=new Gd;n.onopen=()=>e(Hd.fromSocket(n,i)),n.onerror=()=>t(Error("Unable to connect")),n.onmessage=e=>{i.next(JSON.parse(e.data))}})}send(e){this.socket.send(JSON.stringify(e))}getMessages(){return this.messages.asObservable()}disconnect(){this.socket.close()}}Hd.PROTOCOL="janus-protocol";const Vd=e=>{var t,n;const{payload:i}=e;if("error"===i.endpoint){const e=Error((null===(t=i.payload)||void 0===t?void 0:t.reason)||"Error response received");throw e.code=(null===(n=i.payload)||void 0===n?void 0:n.code)||1,e}return i.payload||{}},$d=e=>"event"===e.type&&null!==e.payload&&"object"==typeof e.payload&&"string"==typeof e.payload.eventName,Jd=e=>e.payload;class Yd{constructor(e){this.connection=e}static async connect(e,t={}){const n=await Hd.connect(e.getAddress(),e=>new(t.webSocketClient||WebSocket)(e,Hd.PROTOCOL));return new Yd(n)}request(e){return pd(()=>{const t=this.connection.getMessages().pipe(Dd((e=>t=>"object"==typeof t.payload&&null!==t.payload&&t.payload.id===e.id)(e)),fd(Vd),Id(1));return this.connection.send({type:"request",payload:e}),t})}getEvents(){return this.connection.getMessages().pipe(Dd($d),fd(Jd))}disconnect(){this.connection.disconnect()}}class Qd{constructor(e){this.dependencies=e}static from(e){return new Qd(e)}async createClient(e){const t=Dl.fromUnknownAddress(e);return t.getTransport()===Dl.Transport.WEBSOCKET?Yd.connect(t,this.dependencies):Pd.connect(t,this.dependencies)}}class Kd{constructor(e){this.dependencies=e,this.clientEmitter=new Oi.EventEmitter2}static of(e={}){return new Kd(e)}async init(e){if(void 0!==this.client)throw Error("already connected");const t=Qd.from(this.dependencies);this.client=await t.createClient(e),this.client.getEvents().subscribe(e=>this.clientEmitter.emit(e.eventName,e.payload))}async uninit(){if(void 0===this.client)throw Error("already disconnected");this.client.disconnect(),this.client=void 0}async send(e,t){if(void 0===this.client)throw new Error("not connected");const n={endpoint:e,payload:t,id:Pl()()};Ci.debug("send message",n);try{const e=await this.client.request(n).toPromise();return Ci.debug(`received ${n.id} response`,e),e}catch(e){throw Ci.error(`received ${n.id} error response: `,e.message),e}}get emitter(){return this.clientEmitter}isConnected(){return void 0!==this.client}}const Xd=Kd.of;var Zd=function(e){return"string"==typeof e||!$o(e)&&ta(e)&&"[object String]"==Hs(e)};var ep=function(e){return function(t){return null==t?void 0:t[e]}},tp=ep("length"),np=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var ip=function(e){return np.test(e)},rp="[\\ud800-\\udfff]",sp="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",op="\\ud83c[\\udffb-\\udfff]",ap="[^\\ud800-\\udfff]",cp="(?:\\ud83c[\\udde6-\\uddff]){2}",up="[\\ud800-\\udbff][\\udc00-\\udfff]",hp="(?:"+sp+"|"+op+")"+"?",lp="[\\ufe0e\\ufe0f]?"+hp+("(?:\\u200d(?:"+[ap,cp,up].join("|")+")[\\ufe0e\\ufe0f]?"+hp+")*"),dp="(?:"+[ap+sp+"?",sp,cp,up,rp].join("|")+")",pp=RegExp(op+"(?="+op+")|"+dp+lp,"g");var fp=function(e){for(var t=pp.lastIndex=0;pp.test(e);)++t;return t};var mp=function(e){return ip(e)?fp(e):tp(e)};var gp=function(e){if(null==e)return 0;if(ka(e))return Zd(e)?mp(e):e.length;var t=Ua(e);return"[object Map]"==t||"[object Set]"==t?e.size:Ea(e).length};function vp(e={}){return e.window&&e.window.cordova&&"ios"===e.window.cordova.platformId}const yp=class{constructor(e,t,n,i={}){this._pc=new n(e,t),this.deps=i}close(){return this._pc.close()}get signalingState(){return this._pc.signalingState}set onicecandidate(e){this._pc.onicecandidate=e}set onaddstream(e){this._pc.onaddstream=e}set ontrack(e){this._pc.ontrack=e}set onremovestream(e){this._pc.onremovestream=e}set onconnectionstatechange(e){this._pc.onconnectionstatechange=e}addStream(e){return this._pc.addStream(e)}addTrack(e,t){return this._pc.addTrack(e,t)}remoteStreamHandlers(e){vp(this.deps)?(this.onaddstream=t=>{e(t.stream)},this.onremovestream=()=>{e(null)}):this.ontrack=t=>{t.streams[0].onremovetrack=()=>{e(null)},e(t.streams[0])}}addStreamToPeerConnection(e,t){vp(this.deps)?this.addStream(e):this.addTrack(t,e)}createOffer(e){return new Promise((t,n)=>this._pc.createOffer(t,n,e))}createAnswer(e){return new Promise((t,n)=>this._pc.createAnswer(t,n,e))}setLocalDescription(e){return new Promise((t,n)=>this._pc.setLocalDescription(e,t,n))}setRemoteDescription(e){return new Promise((t,n)=>this._pc.setRemoteDescription(e,t,n))}},bp=Symbol("room"),_p=Symbol("constraints"),wp=Symbol("pc");class Sp extends ol{constructor(e,t,n={},i){if(super(e),n=xu(n,"audio","video","screen"),gp(n)>1)throw new Error("only one constraint (audio,video,screen) is supported");this[bp]=t,this[_p]=n,this[wp]=null,yl(i,"RTCPeerConnection"),yl(i,"RTCSessionDescription"),yl(i,"getUserMedia"),this.deps=i}get constraints(){return this[_p]}get hasAudio(){return!!this[_p].audio}get hasVideo(){return!!this[_p].video||!!this[_p].screen}get medium(){return this.hasVideo?"sfuvideo":"sipcall"}get published(){return!!this[wp]&&"connected"===this[wp].signalingState}setBitrate(e){return this[bp].api.media.bitrate(e)}muteAudio(e){this.hasAudio&&(this.localStream&&this.localStream.stream&&this.localStream.stream.getAudioTracks().forEach(t=>t.enabled=!e),this.remoteStream&&this.remoteStream.stream&&this.remoteStream.stream.getAudioTracks().forEach(t=>t.enabled=!e))}publish(){const e=this[_p];return gp(e)?this.deps.getUserMedia(e).then(e=>{this.setLocalStream(e,this.medium);const t=e.getTracks()[0],n={iceServers:this[bp].ice};return this[wp]=new yp(n,{optional:[{DtlsSrtpKeyAgreement:!0}]},this.deps.RTCPeerConnection,this.deps),this[wp].onicecandidate=e=>{this[bp].api.media.trickle(this.medium,e.candidate)},this[wp].remoteStreamHandlers(e=>this.setRemoteStream(e,this.medium)),this[wp].onconnectionstatechange=()=>{this[wp]&&"closed"===this[wp].connectionState&&(this[wp]=null)},this[wp].addStreamToPeerConnection(e,t),Promise.all([this[bp].api.media.waitPublishComplete(this.medium),this.createWebRTCConnection()])}).catch(e=>{throw Ci.error(e),this.unpublish(),e}):Promise.resolve()}async createWebRTCConnection(){const{media:e}=this[bp].api,t=await this[wp].createOffer({offerToReceiveAudio:this.hasAudio,offerToReceiveVideo:this.hasVideo});await this[wp].setLocalDescription(t);const n=await e.publish(this.medium,t.sdp),i=new this.deps.RTCSessionDescription(n.jsep);return this[wp].setRemoteDescription(i)}unpublish(){return this.localStream&&(this.localStream.stream.getTracks().forEach((function(e){e.stop()})),this.setLocalStream(null,this.medium)),this[wp]&&this[wp].close(),this[bp].api.media.unpublish(this.medium)}}const Cp=Symbol("room"),Ep=Symbol("mediatypes");class kp extends _l{constructor(e,t){super(),this[Cp]=e,this[Ep]={audio:!0},this.deps=t}get mediatypes(){return this[Ep]}update(e={},t=!0){return Promise.resolve().then(()=>{if(e.video&&e.screen)throw new Error("screen and camera can not be enabled at same time");const t=this._getUselessPublishers(e);return Promise.all(t.map(e=>this._removeItem(e)))}).then(()=>this.getPublishersAndStartToPublish(e)).then(()=>{this[Ep]=e}).catch(n=>{if(e===this[Ep]||!t)throw n;return this.update(this[Ep]).then(()=>{throw n})})}getPublishersAndStartToPublish(e){const t=this._getRequiredPublishers(e);return Promise.all(t.map(e=>this._addItem(e)))}unpublishAll(){return Promise.all(this.items.map(e=>this._removeItem(e)))}republishAllMediums(){return this.getPublishersAndStartToPublish(this.mediatypes)}_getUselessPublishers(e){return this.items.filter(t=>!!Object.keys(t.constraints).find(n=>!Wa(e[n],t.constraints[n])))}_getRequiredPublishers(e){const t=[];for(const n in e){const i=e[n];i&&(this.items.find(e=>Wa(e.constraints[n],i))||t.push(xu(e,n)))}return t.map(e=>this.createPublisher(e))}createPublisher(e){return new(this.deps.Publisher||Sp)(null,this[Cp],e,this.deps)}_addItem(e){return super._addItem(e),e.publish().catch(t=>this._removeItem(e).then(()=>{throw t}).catch(()=>{throw t}))}_removeItem(e){return e.unpublish().then(()=>{super._removeItem(e)}).catch(t=>{throw super._removeItem(e),t})}}const xp=Symbol("room"),Ip=Symbol("medium"),Op=Symbol("pc");class jp extends ol{constructor(e,t,n="sfuvideo",i={}){super(e),this[xp]=t,this[Ip]=n,this.deps=i,yl(i,"RTCPeerConnection"),yl(i,"RTCSessionDescription"),yl(i,"MediaStream")}provides(e,t){return this.feed===e&&this[Ip]===t}get hasAudio(){return"sipcall"===this[Ip]}get subscribed(){return!!this[Op]&&"connected"===this[Op].connectionState}setRemoteStreamWithMedium(e){return this.setRemoteStream(e,this[Ip])}subscribe(){return this.hasAudio?(this.setRemoteStreamWithMedium(new this.deps.MediaStream),Promise.resolve()):this[xp].api.media.subscribe(this[Ip],this.feed).then(e=>{const t={iceServers:this[xp].ice};return this[Op]=new yp(t,{optional:[{DtlsSrtpKeyAgreement:!0}]},this.deps.RTCPeerConnection,this.deps),this[Op].onicecandidate=e=>{this[xp].api.media.trickle(this[Ip],e.candidate,this.feed)},this[Op].remoteStreamHandlers(this.setRemoteStreamWithMedium.bind(this)),this[Op].onconnectionstatechange=()=>{this[Op]&&"closed"===this[Op].connectionState&&(this[Op]=null)},this[Op].setRemoteDescription(new this.deps.RTCSessionDescription(e.jsep))}).then(()=>this[Op].createAnswer()).then(e=>this[Op].setLocalDescription(e).then(()=>this[xp].api.media.answer(this[Ip],this.feed,e.sdp))).catch(e=>{throw Ci.error("subscribe: got error",e),this.unsubscribe(),e})}unsubscribe(){return"sipcall"===this[Ip]?(this.setRemoteStreamWithMedium(null),Promise.resolve()):(this[Op]&&(this[Op].close(),this[Op]=null),this.setRemoteStreamWithMedium(null),this[xp].api.media.unsubscribe(this[Ip],this.feed))}}const Tp=Symbol("room");class Rp extends _l{constructor(e,t){super(),this[Tp]=e,this.deps=t}unsubscribeAll(){return Promise.all(this.items.map(e=>this._removeItem(e)))}get(e,t){return this.items.find(n=>n.provides(e,t))}subscribe(e,t){return this.get(e,t)?Promise.reject(new Error("already subscribed")):this._addItem(this.createSubscriber(e,t))}subscribeMany(e){return this.isSubscribedToSome(e)?Promise.reject(new Error("already subscribed")):Promise.all(e.map(e=>this.subscribe(e.feed,e.medium)))}isSubscribedToSome(e){return e.some(e=>!!this.get(e.feed,e.medium))}createSubscriber(e,t){return new(this.deps.Subscriber||jp)(e,this[Tp],t,this.deps)}unsubscribe(e,t){const n=this.get(e,t);return n?this._removeItem(n):Promise.reject(new Error("not subscribed"))}_addItem(e){return super._addItem(e),Promise.resolve().then(()=>e.subscribe()).catch(t=>this._removeItem(e).then(()=>{throw t}).catch(()=>{throw t}))}_removeItem(e){return Promise.resolve().then(()=>e.unsubscribe()).then(()=>{super._removeItem(e)}).catch(t=>{throw super._removeItem(e),t})}}const Ap=Symbol("ice"),Pp=Symbol("loggedIn"),Dp=Symbol("media"),Mp=Symbol("publishers"),qp=Symbol("room"),Np=Symbol("server"),Fp=Symbol("subscribers"),Lp=Symbol("token"),Up=Symbol("username");class Bp{constructor({server:e,username:t,room:n,token:i,ice:r,deps:s={}}={}){this[Np]=e,this[Up]=t,this[qp]=n,this[Lp]=i,this[Ap]=r,this[Pp]=!1;const o=s.Client||Xd;this.client=o(s),this.api={session:new Ol(this.client),media:new jl(this.client),user:new Tl(this.client),hold:new El(this.client)};this[Mp]=(()=>s.Publishers?new s.Publishers(this,s):new kp(this,s))();this[Fp]=(()=>s.Subscribers?new s.Subscribers(this,s):new Rp(this,s))();this[Dp]=s.conferenceMediaList?s.conferenceMediaList:new _l,this[Dp]._addItem(this[Mp]),this[Dp]._addItem(this[Fp]);this.janusFeedHandler=(()=>s.janusFeedHandler?s.janusFeedHandler:Il(this[Fp]))(),this.emitter=new Oi.EventEmitter2,vl(this,["onDisconnect","onJanusFeed","onJanusWebRTC","onJanusDisconnected","onJanusDestroyed","onParticipantAdded","onParticipantRemoved"])}getPublishers(){return this[Mp]}getSubscribers(){return this[Fp]}get ice(){return this[Ap]}init(){return Promise.resolve().then(()=>this.client.init(this[Np])).then(()=>(this.onConnect(),this.api.session.login(this[Up],this[qp],this[Lp]))).then(()=>(this[Pp]=!0,this)).catch(e=>this.uninit().then(()=>{throw e}))}async uninit(){if(this[Pp]){this[Pp]=!1,this.client.emitter.removeAllListeners(),await this[Mp].unpublishAll(),await this[Fp].unsubscribeAll();try{await this.api.session.logout()}catch(e){Ci.error("Wrapper stack unable to logout")}await this.client.uninit(),this.emitter.emit(Zh)}}get media(){return this[Dp]}get mediatypes(){return this[Mp].mediatypes}update(e={}){return this[Mp].update(e)}getParticipants(){return Ci.debug("getParticipants"),this.api.user.getAll()}onConnect(){Ci.debug("connection created"),this.client.emitter.on("disconnect",this.onDisconnect),this.client.emitter.on("feed",this.onJanusFeed),this.client.emitter.on("webrtc",this.onJanusWebRTC),this.client.emitter.on("destroyed",this.onJanusDestroyed),this.client.emitter.on("disconnected",this.onJanusDisconnected),this.client.emitter.on("participantAdded",this.onParticipantAdded),this.client.emitter.on("participantRemoved",this.onParticipantRemoved),this.emitter.emit(Xh)}onDisconnect(){if(Ci.debug("connection closed"),this.client.isConnected())return this.client.emitter.removeAllListeners(),this.client.uninit()}onJanusFeed(e){this.janusFeedHandler.onJanusFeed(this,e)}onJanusWebRTC(e){Ci.info("janus webrtc >> ",e)}onJanusDestroyed(e){Ci.info("janus destroyed >> ",e),this.uninit()}onJanusDisconnected(e){Ci.info("janus disconnected >> ",e),this.uninit()}onParticipantAdded(e){Ci.info("janus participant added >> ",e),this.emitter.emit(Qh,e)}onParticipantRemoved(e){Ci.info("janus participant removed >> ",e),this.emitter.emit(Kh,e.user)}}function zp(e){const t=function(){let e=!1;return{hold(){e=!0},unhold(){e=!1},isHolding:()=>e,savedSubscriptions:function(){let e=[];return{saveSubscription({feed:t,medium:n}){e.push({feed:t,medium:n})},getSavedSubscriptions:()=>e,removeSubscription(t){var n;e=e.filter((n=t,e=>n.feed!==e.feed||n.medium!==e.medium))},isStored:({feed:t,medium:n})=>e.some(e=>e.feed===t&&e.medium===n)}}(),heldParticipants:function(){let e=[];const t=t=>e.includes(t);return{isOnHold:t,addParticipant(n){t(n)||e.push(n)},removeParticipant(t){var n;e=e.filter((n=t,e=>n!==e))},participants:()=>e}}()}}(),n=(i=t.heldParticipants,new _l({onStreamAdded(e,t){const n=i.isOnHold(t.feed)?Hh:Wh,r=wl(t,n);e.emit(tl,r)},onStreamRemoved(e,t){const n=i.isOnHold(t.feed)?zh:Gh,r=wl(t,n);e.emit(nl,r)}}));var i;const r=function(e,t){const n=t=>{const{event:n}=t;switch(n){case kl:e.savedSubscriptions.saveSubscription(t.feed);break;case xl:e.savedSubscriptions.removeSubscription(t.feed)}};return{onJanusFeed:(i,r)=>(n(r),e.isHolding()?Promise.resolve():t.onJanusFeed(i,r))}}(t,Il());return function(e,t){const n=e.getPublishers(),i=e.getSubscribers(),{hold:r}=e.api,{heldParticipants:s,savedSubscriptions:o}=t;r.emitter.on(Sl,t=>{s.addParticipant(t.user),e.emitter.emit(Jh,t.user)}),r.emitter.on(Cl,t=>{s.removeParticipant(t.user),e.emitter.emit(Yh,t.user)});const a=({status:e})=>e===Vh;return Object.assign((e=>(e=>({getPublishers:()=>e.getPublishers(),getParticipants:()=>e.getParticipants(),getSubscribers:()=>e.getSubscribers(),init:()=>e.init(),uninit:()=>e.uninit(),update:(t={})=>e.update(t),get media(){return e.media},get mediatypes(){return e.mediatypes},get ice(){return e.ice},get emitter(){return e.emitter},get api(){return e.api}}))(e))(e),{hold:async()=>{if(t.isHolding())throw new Error("Can not hold, already held");if(0==n.items.length)throw new Error("Can not hold, not publishing");await r.hold(),await n.unpublishAll(),await i.unsubscribeAll(),t.hold()},unhold:async()=>{if(!t.isHolding())throw new Error("Can not unhold, not holding");return n.republishAllMediums().then(()=>i.subscribeMany(o.getSavedSubscriptions())).then(()=>r.unhold()).then(()=>t.unhold())},uninit:async()=>(t.isHolding()&&(await r.unhold(),t.unhold()),e.uninit()),isOnHold:()=>t.isHolding(),getParticipants:async()=>{const t=await e.getParticipants();return t.filter(a).forEach(({user:e})=>s.addParticipant(e)),t}})}(new Bp(Object.assign({},e,{deps:Object.assign({},e.deps,{conferenceMediaList:n,janusFeedHandler:r})})),t)}class Gp extends E{constructor(e=500){super(e)}}function Wp(e,t){var n=new Promise((n,i)=>{setTimeout(()=>{i("".concat(e," timed out after ").concat(t," ms"))},t)});return Promise.race([e,n])}function Hp(e){return Wp(navigator.mediaDevices.getUserMedia(e),6e4)}function Vp(e){return $p.apply(this,arguments)}function $p(){return($p=s((function*(e){if(window.desktopCapturer){var[t]=yield window.desktopCapturer.getSources({types:["screen"]});return Hp({video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}})}if(navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getDisplayMedia)return Wp(navigator.mediaDevices.getDisplayMedia(e),1e4);throw Error("Browser does not support screensharing")}))).apply(this,arguments)}function Jp(){return Yp.apply(this,arguments)}function Yp(){return(Yp=s((function*(e={}){var t=e.audio||!1,n=e.video||!1,i=e.screen||!1;if(!(t||n||i))throw Error("At least one of audio, video or screen must be requested");if(n&&i)throw Error("video and screen cannot be both true at the same time");if(!i)return Hp({audio:t,video:n});if(!t)return Vp({video:i});var r=yield Hp({audio:t}),s=yield Vp({video:i});return new MediaStream([...s.getTracks(),...r.getTracks()])}))).apply(this,arguments)}var Qp=Ii.instance.getLogger("SippoJS/Janus/Conference"),{STREAM_ADDED:Kp,STREAM_REMOVED:Xp}=i,Zp=({feed:e,stream:t})=>({stream:t,participant:e}),ef=({feed:e,stream:t,reason:n})=>({stream:t,reason:n,participant:e}),tf=ah,nf=ch,rf=uh,sf=hh,of=lh,af=dh,cf=Symbol("ice"),uf=Symbol("id"),hf=Symbol("invite"),lf=Symbol("room"),df=Symbol("owner"),pf=Symbol("participants"),ff=Symbol("recording"),mf=Symbol("left"),gf=Symbol("pendingInvites"),vf=Symbol("server"),yf=Symbol("session"),bf=Symbol("token"),_f=Symbol("uninitedRoom");class wf extends Oi.EventEmitter2{constructor(e={}){super(),this[yf]=e.session||null,this[lf]=null,this[uf]="",this[hf]=null,this[df]="",this[pf]=[],this[ff]=!1,this[vf]="",this[bf]="",this[cf]=[],this[gf]={},this[mf]=!1,this.parallelSipExtension=null,this.sipUri=null,this[_f]=null,c(this,["onRoomUpdated","onRoomDestroyed","onInviteCancel","onStreamAdded","onStreamRemoved","onTransferingCallToPeer","onParticipantAdded","onParticipantRemoved","onParticipantHold","onParticipantUnhold"]),this.dependencies=e}get id(){return this[uf]}get owner(){return this[df]}get invited(){return!!this[hf]}get invite(){return this[hf]}get joined(){return!!this[lf]}set session(e){this[yf]&&this[yf].signaling&&(this[yf].signaling.removeContentListener(this.onRoomUpdated),this[yf].signaling.removeContentListener(this.onRoomDestroyed),this[yf].signaling.removeContentListener(this.onInviteCancel),this[yf].signaling.removeContentListener(this.onTransferingCallToPeer),this._uninitRoom()),this[yf]=e,this[yf]&&(this[yf].signaling.addContentListener({request:"room-update",payload:{room:this.id}},this.onRoomUpdated),this[yf].signaling.addContentListener({request:"room-destroyed",payload:{room:this.id}},this.onRoomDestroyed),this[yf].signaling.addContentListener({cancel:"invitation"},this.onInviteCancel),this[yf].signaling.addContentListener({request:"transfering-call-to-peer",payload:{roomId:this.id}},this.onTransferingCallToPeer))}isOwner(){return this[yf]&&this.owner===this[yf].username}hasOwner(){return 0!==this.owner.length}get participants(){return this[pf]}get localStreams(){if(!this.joined)throw new Error("not joined");return this[lf].media.localStreams}get remoteStreams(){if(!this.joined)throw new Error("not joined");return this[lf].media.remoteStreams}get streams(){return this.localStreams.concat(this.remoteStreams)}hold(){return this[lf].hold()}unhold(){return this[lf].unhold()}get isOnHold(){return this[lf].isOnHold()}suspend(){return Promise.resolve().then(()=>{Object.keys(this[gf]).forEach(e=>this.cancelInvitation(e)),this.invited&&this.onRoomDestroyed()})}resume(){return Promise.resolve()}join(e){return this.joined?Promise.reject(new Error("already joined")):Promise.resolve().then(()=>(this.invited&&(this[yf].signaling.invites.accept(this[hf].id,this[hf].from),this[hf]=null),this._initRoom())).then(()=>this.update(e))}inviteParticipant(e,t,n,i){var r=this;return s((function*(){if(Qp.debug("inviteParticipant",e),r[gf][e])throw Qp.debug("inviteParticipant/pendintInvites"),new Error("participant ".concat(e," has a pending invitation"));var o=Ru()();return new Promise(function(){var a=s((function*(s,a){try{r[gf][e]={id:o,resolve:s,reject:a},Qp.debug("inviteParticipant/Promise<>/pendingInvites saved, id=",o),Qp.debug(o,r[yf].username,e,r.id,t,n);var c=yield r[yf].signaling.invites.invite(o,r[yf].username,e,r.id,t,n,i);Qp.debug("inviteParticipant/Promise<>/invite request sent"),s({code:200,whoAccepted:c?c.whoAccepted:void 0})}catch(e){Qp.error("inviteParticipant/Promise<>/error invite request",e),e instanceof Gp?s({code:e.message}):a({code:e})}finally{delete r[gf][e]}}));return function(e,t){return a.apply(this,arguments)}}())}))()}cancelInvitation(e){try{this.cancelPendingInvite(e)}catch(e){Qp.error(e)}}cancelPendingInvite(e){var t=this[gf][e];if(!t)throw new Error("participant ".concat(e," has no pending invitation"));delete this[gf][e],this[yf].signaling.invites.cancelInvitation(t.id,this[yf].username),t.reject(new Error("invite canceled"))}expelParticipant(e){return this[yf].signaling.rooms.removeRoomParticipants(this.id,[e]).then(e=>this._updateWithServerData(e))}leave(e){var t=this;return s((function*(){return yield Promise.resolve(),t[mf]=!0,t._declineInviteIfNeeded(e),(t.joined||t.isOwner())&&(yield t._tryToLeaveSignalingRoom()),t}))()}_declineInviteIfNeeded(e){this.invited&&(this._sendDeclineMessage(e),this[hf]=null)}_sendDeclineMessage(e){this[yf].signaling.invites.decline(this[hf].id,this[hf].from,e)}_tryToLeaveSignalingRoom(){var e=this;return s((function*(){try{yield e[yf].signaling.rooms.leaveRoom(e.id)}catch(t){yield e._uninitRoom()}}))()}update(e={}){return this.joined?this._mediaUpdateInProgress?Promise.reject(new Error("media update already in progress")):(this._mediaUpdateInProgress=!0,this[lf].api.media.setParallelSipExtension(this.parallelSipExtension),this[lf].update(e).finally(()=>{this._mediaUpdateInProgress=!1})):Promise.reject(new Error("not joined"))}get recording(){return this[ff]}startRecording(){return this[yf].signaling.rooms.startRecordingRoom(this.id).then(e=>this._updateWithServerData(e))}stopRecording(){return this[yf].signaling.rooms.stopRecordingRoom(this.id).then(e=>this._updateWithServerData(e))}unattendedCallTransfer(e,t){var n=Ru()();return this[yf].signaling.callTransfer.unattendedCallTransfer(n,e,this.id,t)}acceptCallTransfer(e){var t=Ru()();return this[yf].signaling.callTransfer.acceptCallTransfer(t,e)}createDependencies(){var e={RTCPeerConnection:RTCPeerConnection,RTCSessionDescription:RTCSessionDescription,getUserMedia:Jp,window:window,MediaStream:MediaStream};return Object.assign(e,this.dependencies)}_initRoom(){return this[lf]=this.createJanusRoom(),this[lf].media.on(Kp,this.onStreamAdded),this[lf].media.on(Xp,this.onStreamRemoved),this[lf].emitter.on(Zh,this.onRoomDestroyed),this[lf].emitter.on(Qh,this.onParticipantAdded),this[lf].emitter.on(Kh,this.onParticipantRemoved),this[lf].emitter.on(Jh,this.onParticipantHold),this[lf].emitter.on(Yh,this.onParticipantUnhold),this[lf].init().catch(e=>this._uninitRoom().then(()=>{throw e}))}createJanusRoom(){var e=this[vf].wss||this[vf].ws?Dl.fromWebsocket(this[vf].wss||this[vf].ws):Dl.fromSocketIo(this[vf].https||this[vf].http),{room:t}=this.dependencies;return t||new zp({server:e,username:this[yf].username,room:this[uf],token:this[bf],ice:this[cf],deps:this.createDependencies()})}_uninitRoom(){return this[_f]?this[_f]:(this[_f]=this._uninitRoomIfExists().finally(()=>this._resetUninitedRoomPromise()),this[_f])}_uninitRoomIfExists(){return this[lf]?(this._removeRoomListeners(),this[lf].uninit().finally(()=>{this._removeRoomMediaListeners(),this._resetCurrentRoom()})):Promise.resolve()}_removeRoomListeners(){var{emitter:e}=this[lf];e.off(Zh,this.onRoomDestroyed),e.off(Qh,this.onParticipantAdded),e.off(Kh,this.onParticipantRemoved),e.off(Jh,this.onParticipantHold),e.off(Yh,this.onParticipantUnhold)}_removeRoomMediaListeners(){var{media:e}=this[lf];e.off(Kp,this.onStreamAdded),e.off(Xp,this.onStreamRemoved)}_resetCurrentRoom(){this[lf]=null}_resetUninitedRoomPromise(){this[_f]=null}_updateWithServerData(e){return e.room&&(this[uf]=e.room),e.owner&&(this[df]=e.owner),e.participants&&(this[pf]=e.participants),e.record&&(this[ff]=e.record),e.token&&(this[bf]=e.token),e.server&&(this[vf]=e.server),e.ice&&(this[cf]=e.ice),e.invite&&(this[hf]=e.invite),void 0!==e.left&&(this[mf]=e.left),e.parallelSipExtension&&(this.parallelSipExtension=e.parallelSipExtension),e.sipUri&&(this.sipUri=e.sipUri),this}sendDtmf(e){return this[yf].signaling.rooms.sendDtmf({digit:e,sipUri:this.parallelSipExtension||this.sipUri})}getParticipants(){return this[lf].getParticipants()}onRoomUpdated(e){this._updateWithServerData(e.payload),this.emit("conference-updated",this)}onRoomDestroyed(){this[yf]&&(this.joined||this.isOwner())&&this[yf].signaling.rooms.leaveRoom(this.id).catch(e=>{if("string"==typeof e.message&&!e.message.match(/Session closed/)||403!==e.message)throw e}),this.emit("conference-destroyed"),this[mf]||this.emit("expelled")}onInviteCancel(e){this[hf]&&this[hf].id===e.requestID&&(this[hf]=null,this.onRoomDestroyed())}onStreamAdded(e){var t=e.local?{name:nf,data:Zp(e)}:{name:of,data:ef(e)};this.onStreamChanged(e),this.emit(t.name,t.data)}onStreamRemoved(e){var t=e.local?{name:rf,data:Zp(e)}:{name:af,data:ef(e)};this.onStreamChanged(e),this.emit(t.name,t.data)}onStreamChanged(e){if(e.local){var t=this.joined?this.localStreams.map(e=>e.stream):[];this.emit(tf,{streams:t})}else{var n=this.remoteStreams.filter(t=>t.feed===e.feed).map(e=>e.stream);n.length>1&&(n=n.filter(e=>!!e.getTracks().length)),this.emit(sf,{participant:e.feed,streams:n,reason:e.reason})}}onTransferingCallToPeer(e){this.transferingCall=!0,this.emit("transferingCall",e)}onParticipantAdded(e){this.emit(ih,e)}onParticipantRemoved(e){this.emit(rh,e)}onParticipantHold(e){this.emit(sh,e)}onParticipantUnhold(e){this.emit(oh,e)}}var Sf=Ii.instance.getLogger("SippoJS/Janus/Conferences"),Cf=Symbol("conferences"),Ef=Symbol("pendingRequest"),kf=Symbol("receivedRequests"),xf=Symbol("session");class If extends Oi.EventEmitter2{constructor(e={}){super(),this[xf]=null,this[Cf]={},this[Ef]={},this[kf]={},c(this,["onRoomUpdated","onIncomingInvite","onIncomingInviteRequest","onInviteCancelRequest"]),this.dependencies=e}init(e){return this[xf]=e,this[xf].signaling.addContentListener({request:"room-update"},this.onRoomUpdated),this[xf].signaling.addContentListener({request:"invitation"},this.onIncomingInvite),this[xf].signaling.addContentListener({request:"invitationRequest"},this.onIncomingInviteRequest),this[xf].signaling.addContentListener({cancel:"invitationRequest"},this.onInviteCancelRequest),this[xf].signaling.rooms.getRooms().then(e=>{e.forEach(e=>{var t=new wf;t._updateWithServerData(e),this._addConferenceToCollection(t)})})}uninit(){Object.values(this[Cf]).forEach(e=>{this._removeConferenceFromCollection(e.id)}),this[xf]&&this[xf].signaling&&(this[xf].signaling.removeContentListener(this.onRoomUpdated),this[xf].signaling.removeContentListener(this.onIncomingInvite),this[xf].signaling.removeContentListener(this.onIncomingInviteRequest),this[xf].signaling.removeContentListener(this.onInviteCancelRequest)),this[xf]=null}suspend(){return Promise.resolve().then(()=>(Object.keys(this[Ef]).forEach(e=>this.cancelInvitationRequest(e,603)),Object.keys(this[kf]).forEach(e=>{this.onInviteCancelRequest({requestID:e})}),Promise.all(Object.keys(this[Cf]).map(e=>this[Cf][e].suspend()))))}resume(){return Promise.all(Object.keys(this[Cf]).map(e=>this[Cf][e].resume()))}fetch(){return Object.values(this[Cf])}get(e){return this[Cf][e]}create(){return this[xf].signaling.rooms.createRoom().then(e=>{var t=new wf;return t._updateWithServerData(e),this._addConferenceToCollection(t),t})}requestInvitation(e,t={audio:!0,video:!0}){return this[Ef][e]?Promise.reject(new Error("participant ".concat(e," has a pending request"))):new Promise((n,i)=>{var r=Ru()();this[Ef][e]={id:r,resolve:n,reject:i};var s="".concat(this[xf].username,"/").concat(this[xf].peerId);this[xf].signaling.inviteRequest.requestInvitation(r,s,e,t).then(()=>{delete this[Ef][e],n({code:200})}).catch(t=>{delete this[Ef][e],t instanceof Gp?n({code:t.message}):i(t)})})}cancelInvitationRequest(e,t){var n=this[Ef][e];if(!n)throw new Error("participant ".concat(e," has no pending invitation"));delete this[Ef][e];var i="".concat(this[xf].username,"/").concat(this[xf].peerId);this[xf].signaling.inviteRequest.cancelInvitation(n.id,i),n.resolve(t)}getCurrentInvitations(){var e=Ru()(),t="".concat(this[xf].username,"/").concat(this[xf].peerId);return Sf.debug("getCurrentInvitations"),this[xf].signaling.invites.getCurrentInvitations(e,t).then(e=>{if(Sf.debug("getCurrentInvitations/response",e),e.payload&&e.payload.currentInvitations)return e.payload.currentInvitations.map(e=>{if("invitationRequest"===e.request)return this.createInviteRequestFromMessage(e);var t=new wf;return Sf.debug("getCurrentInvitations/invite",e),this.updateWithServerData(t,e),this._addConferenceToCollection(t),Sf.debug("getCurrentInvitations/response/conf",t),t});throw new Error("no valid response")})}getRoomByUri(e){var t=this;return s((function*(){var n=yield t[xf].signaling.rooms.joinRoom(e),i=new wf;return i.session=t[xf],i._updateWithServerData(n),t._addConferenceToCollection(i),i}))()}_addConferenceToCollection(e){Sf.info("added conference",e),this[Cf][e.id]=e;var t=()=>{Sf.debug("updated conference",e)},n=()=>{Sf.debug("destroyed conference",e),e.off("conference-updated",t),e.off("conference-destroyed",n),this._removeConferenceFromCollection(e.id)};e.session=this[xf],e.on("conference-updated",t),e.on("conference-destroyed",n)}_removeConferenceFromCollection(e){Sf.info("removed conference",e),this[Cf][e]&&(this[Cf][e].session=null,delete this[Cf][e])}onRoomUpdated(e){if(!this[Cf][e.payload.room]){var t=new wf;t._updateWithServerData(e.payload),this._addConferenceToCollection(t)}}onIncomingInvite(e){var t=this.handleIncomingInvite(e);this.emit("incomingConference",t,e.mediatypes)}updateWithServerData(e,t){e._updateWithServerData(Object.assign({},t.payload,{invite:{id:t.requestID,from:t.from,mediatypes:t.mediatypes},parallelSipExtension:t.parallelSipExtension,left:!1}))}handleIncomingInvite(e){var t=this.get(e.payload.room)||new wf(this.dependencies);return this.updateWithServerData(t,e),this.get(e.payload.room)||this._addConferenceToCollection(t),t}_buildInvitationRequestEvent(e,t,n){return{id:e,user:t,video:n&&n.video,isRequest:!0,accept:()=>(delete this[kf][e],this[xf].signaling.inviteRequest.accept(e,t)),reject:n=>{delete this[kf][e],this[xf].signaling.inviteRequest.decline(e,t,n)}}}createInviteRequestFromMessage(e){var t=e.requestID,n=e.from;return this[kf][t]=n,this._buildInvitationRequestEvent(t,n,e.mediatypes)}onIncomingInviteRequest(e){this.emit("invitationRequest",this.createInviteRequestFromMessage(e))}onInviteCancelRequest(e){delete this[kf][e.requestID],this.emit("cancelInvitationRequest",{id:e.requestID})}}var Of=Symbol("listeners");class jf extends Oi.EventEmitter2{constructor(){super(),this[Of]=[]}addContentListener(e,t){this[Of].push({filter:e,fn:t})}removeContentListener(e){this[Of]=this[Of].filter(t=>t.fn!==e)}emit(e,t){super.emit(e,t),t&&this[Of].forEach(e=>{this._match(t,e.filter)&&e.fn(t)})}_match(e,t){return!Object.keys(t).find(n=>"object"==typeof t[n]?!this._match(e[n],t[n]):t[n]!==e[n])}}var Tf=Symbol("client");class Rf{constructor(e){this[Tf]=e}request(e,t,n,i){var r=Object.assign({request:e,requestID:t},n);return this[Tf].send(r,t,i)}cancel(e,t,n){var i=Object.assign({cancel:e,requestID:t},n);this[Tf].send(i)}answer(e,t,n){var i=Object.assign({answer:e,requestID:t},n);return this[Tf].send(i)}answerWaitingResponse(e,t,n){var i=Object.assign({answer:e,requestID:t},n);return this[Tf].send(i,t)}}class Af extends Rf{invite(e,t,n,i,r,s,o){return this.request("invitation",e,{from:t,to:n,replyOf:s,payload:{room:i},mediatypes:r,context:o}).then(e=>e.payload)}cancelInvitation(e,t,n=487){this.cancel("invitation",e,{from:t,error:n})}accept(e,t){return this.answer("invitation",e,{from:t})}decline(e,t,n=603){return this.answer("invitation",e,{from:t,error:n})}getCurrentInvitations(e,t){return this.request("getCurrentInvitations",e,{from:t})}}class Pf extends Rf{requestInvitation(e,t,n,i={audio:!0,video:!0}){return this.request("invitationRequest",e,{from:t,to:n,mediatypes:i}).then(e=>e.payload)}cancelInvitation(e,t){this.cancel("invitationRequest",e,{from:t})}accept(e,t){return this.answerWaitingResponse("invitationRequest",e,{from:t})}decline(e,t,n=603){this.answer("invitationRequest",e,{from:t,error:n})}}class Df extends Rf{login(e,t,{deviceId:n}={}){return this.request("login",Ru()(),{payload:{username:e,token:t,deviceId:n}}).then(e=>e.payload)}logout(){return this.request("logout",Ru()(),{}).then(e=>e.payload).catch(()=>{})}}class Mf extends Rf{unattendedCallTransfer(e,t,n,i){return this.request("unattendedCallTransfer",e,{to:t,roomId:n,mediatypes:i})}acceptCallTransfer(e,t){return this.request("acceptCallTransfer",e,{callTransferID:t})}}class qf extends Rf{getRooms(){return this.request("getRooms",Ru()(),{}).then(e=>e.payload)}createRoom(e){return this.request("createRoom",Ru()(),{payload:{record:e}}).then(e=>e.payload)}addRoomParticipants(e,t){return this.request("update",Ru()(),{payload:{room:e,participants:{add:t}}}).then(e=>e.payload)}removeRoomParticipants(e,t){return this.request("update",Ru()(),{payload:{room:e,participants:{remove:t}}}).then(e=>e.payload)}startRecordingRoom(e){return this.request("update",Ru()(),{payload:{room:e,record:!1}}).then(e=>e.payload)}stopRecordingRoom(e){return this.request("update",Ru()(),{payload:{room:e,record:!1}}).then(e=>e.payload)}leaveRoom(e){return this.request("leaveRoom",Ru()(),{payload:{room:e}},60)}sendDtmf(e){return this.request("dtmf",Ru()(),{payload:e})}joinRoom(e){return this.request("joinRoom",Ru()(),{payload:{uri:e}}).then(e=>e.payload)}}var Nf=Ii.instance.getLogger("SippoJS/Janus/SignalingClient");class Ff extends jf{constructor(e,t={}){super(),this.dependencies=t,this.address=e,this.socket=null,this.pending={},this.invites=new Af(this),this.inviteRequest=new Pf(this),this.register=new Df(this),this.callTransfer=new Mf(this),this.rooms=new qf(this),this.running=!1,c(this,["onMessage","onClose"]),this.pingTimer=0}get ready(){return!!this.socket}init(){return new Promise((e,t)=>{Nf.debug("init with address ".concat(this.address)),this.ready&&t(new Error("already initialized")),this.running=!0;var n=new(this.dependencies.ReconnectingWebSocket||Fd.a)(this.address,"jt",{minReconnectionDelay:1e4,connectionTimeout:4e3,debug:!0});n.onopen=()=>{Nf.debug("socket created with ".concat(this.address)),this.socket=n,this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onClose.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.emit("connected"),this.heartbeat(),e(this)},n.onerror=this.handlerErrorSocket.bind(this),n.onclose=this.handlerErrorSocket.bind(this)})}handlerErrorSocket(e){Nf.error("socket error with ".concat(this.address),JSON.stringify(e)),clearTimeout(this.pingTimer)}uninit(){return new Promise((e,t)=>{Nf.debug("uninit"),this.ready||t(new Error("not initialized")),this.running=!1,clearTimeout(this.pingTimer),this.closePendingMessages(),this.socket.onclose=this.socket.onerror=()=>{this.unbindSocketEvents(),this.socket=null,this.emit("closed"),e(this)},this.socket.close(void 0,void 0,{keepClosed:!0})})}closePendingMessages(){Object.keys(this.pending).forEach(e=>{Nf.warn("pending request exist on uninit with id",e),this.pending[e].reject(new Error("uninit")),delete this.pending[e]})}send(e,t,n){return new Promise((i,r)=>{if(Nf.debug("send",e),!this.ready)return r(new Error("not initialized"));if(t){var s={resolve:i,reject:r};"number"==typeof n&&(s.timer=setInterval(()=>{if(--n<=0)clearInterval(s.timer),s.reject(new Error("timeout")),delete this.pending[t];else try{this.socket.send(JSON.stringify(e))}catch(e){throw Error("Session closed")}},2e3)),this.pending[t]=s}else i();e.requestID=e.requestID||Ru()(),this.socket.send(JSON.stringify(e))})}onMessage(e){Nf.debug("received ".concat(e.data));var t=JSON.parse(e.data);"ping"===t.request&&(this.heartbeat(),this.send({answer:"ping"}));var n=this.pending[t.requestID];if(n)return clearInterval(n.timer),delete this.pending[t.requestID],t.error?n.reject(new Gp(t.error)):n.resolve(t);this.emit("message",t)}heartbeat(){clearTimeout(this.pingTimer),this.pingTimer=setTimeout(()=>{this.stopCurrentSocketAndReconnect()},35e3)}stopCurrentSocketAndReconnect(){this.closeCurrentSocket(),this.cleanState(),this.reconnect()}closeCurrentSocket(){this.unbindSocketEvents(),this.socket.close(void 0,void 0,{keepClosed:!0})}reconnect(){var e=this;return s((function*(){try{e.emit("reconnecting"),yield e.init(),e.emit("reconnected")}catch(t){e.unbindSocketEvents(),e.cleanState(),e.closePendingMessages(),e.emit("closed")}}))()}cleanState(){clearTimeout(this.pingTimer),this.running=!1,this.socket=null}unbindSocketEvents(){this.socket&&(this.socket.onmessage=this.socket.onclose=this.socket.onerror=()=>{})}onClose(){var e=this;return s((function*(){e.ready&&e.stopCurrentSocketAndReconnect()}))()}}var Lf=Ii.instance.getLogger("SippoJS/Janus/Session");class Uf extends Oi.EventEmitter2{constructor(e,t,n=";",i="",r={}){super(),this.dependencies=r,this.signaling=null,this.address=e,this.username=t,this.token=n,this.applicationToken=i,this.session=null,c(this,["onSessionClosed"])}get registered(){return!!this.session}get peerId(){return this.session.id}register({deviceId:e}={}){var t=this;return s((function*(){var n=new Ff(t.address,t.dependencies);try{if(Lf.debug("register ".concat(t.username)),t.deviceId=e,t.registered)throw new Error("already registered");t.bindSignalingEvents(n),yield n.init(),yield t.login(n,{deviceId:t.deviceId}),t.onSessionCreated(n)}catch(e){throw Lf.error("register failed with error",e),n&&n.ready&&n.uninit(),new Error("registration failed")}}))()}unregister(){var e=this;return s((function*(){try{if(!e.registered)throw new Error("not registered");yield e.signaling.register.logout(),yield e.signaling.uninit()}catch(e){throw Lf.error("unregister failed with error",e),new Error("unregister failed")}}))()}suspend(){var e=this;return s((function*(){e.unbindSignalingEvents(),yield e.signaling.register.logout(),yield e.signaling.uninit(),Lf.debug("session suspended")}))()}resume(){var e=this;return s((function*(){yield e.signaling.init(),yield e.login(e.signaling,{deviceId:e.deviceId}),e.bindSignalingEvents(e.signaling),Lf.debug("session resumed")}))()}login(e,{deviceId:t}={}){var n=this;return s((function*(){var i=yield e.register.login(n.username,"".concat(n.token).concat(n.applicationToken),{deviceId:t});n.session=i}))()}onSessionCreated(e){Lf.debug("session created"),this.signaling=e,this.emit("connected")}onSessionClosed(){Lf.debug("session closed"),this.unbindSignalingEvents(),this.signaling=null,this.session=null,this.emit("closed")}bindSignalingEvents(e){e.on("connected",()=>{e.removeAllListeners("connected"),e.on("reconnecting",this.onReconnecting.bind(this)),e.on("reconnected",this.onReconnected.bind(this))}),e.on("closed",this.onSessionClosed)}onReconnecting(){this.emit("reconnecting")}onReconnected(){var e=this;return s((function*(){try{yield e.login(e.signaling,{deviceId:e.deviceId}),e.emit("reconnected",e)}catch(t){e.onSessionClosed()}}))()}unbindSignalingEvents(){this.signaling&&(this.signaling.removeAllListeners("connected"),this.signaling.removeAllListeners("reconnecting"),this.signaling.removeAllListeners("reconnected"),this.signaling.removeAllListeners("closed"))}}var Bf=["audio","video","audio-call","video-call","audio-video-call","media-update","multicall","conferences","conference-hold"];class zf extends Error{constructor(e){super(e),this.name="Already registered"}}class Gf extends class{constructor(){this._callbacks={}}on(e,t){return e.split(" ").map(e=>{this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].includes(t)||this._callbacks[e].push(t)}),this}off(e,t){return t?e.split(" ").forEach(e=>{this._callbacks[e]&&(this._callbacks[e]=this._callbacks[e].filter(e=>e!==t))}):e?e.split(" ").forEach(e=>{this._callbacks[e]=[]}):this._callbacks={},this}once(e,t){var n=(...i)=>{t.apply(this,i),this.off(e,n)};return this.on(e,n),this}trigger(e,...t){var n;return null!=this._callbacks[e]&&this._callbacks[e].forEach((n=this,e=>t=>t.apply(n,e))(t)),this}}{constructor(e={}){super(),this.dependencies=e,this.conferences=new If(e),this.session=null,c(this,["onSessionClosed","onSessionReconnected","onSessionReconnecting"])}get conference(){return this.conferences}getSession(){return this.session}start(){return this.trigger("qs-ready"),Promise.resolve()}capabilities(){return Bf}register(e,{deviceId:t}){var n=this;return s((function*(){try{if(n.session)throw new zf("already registered or registering");n.session=new Uf(e.authserver,e.username,e.token,e.applicationToken,n.dependencies),yield n.session.register({deviceId:t}),yield n.onSessionCreated(),n.trigger("qs-register-success")}catch(e){throw e instanceof zf||(n.session=null),n.trigger("qs-register-error"),e}}))()}unregister(){var e=this;return s((function*(){try{if(!e.session||!e.session.registered)throw new Error("not registered");yield e.session.unregister(),yield e.onSessionClosed(),e.trigger("qs-unregister-success")}catch(t){throw e.trigger("qs-unregister-error"),t}}))()}suspendSession(){return this.conferences.suspend().then(()=>this.session.suspend())}resumeSession(){return this.session.resume().then(()=>this.conferences.resume())}version(){return[]}onSessionCreated(){return this.session.on("closed",this.onSessionClosed),this.session.on("reconnecting",this.onSessionReconnecting),this.session.on("reconnected",this.onSessionReconnected),this.conferences.init(this.session).then(()=>{this.trigger("qs-registered")})}onSessionReconnecting(){this.trigger("qs-reconnecting")}onSessionReconnected(){this.trigger("qs-reconnected")}onSessionClosed(){this.conferences.uninit(),this.session&&(this.session.off("closed",this.onSessionClosed),this.session.off("reconnecting",this.onSessionReconnecting),this.session.off("reconnected",this.onSessionReconnected),this.session=null,this.trigger("qs-unregistered"))}}var Wf,Hf=fl((function(e,t){return ml(e)?pl(e,gu(t,1,ml,!0)):[]}));!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTING=2]="DISCONNECTING",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.SUSPENDED=4]="SUSPENDED",e[e.SUSPENDING=5]="SUSPENDING"}(Wf||(Wf={}));var Vf=function(e,t,n,i){var r=n.length,s=r,o=!i;if(null==e)return!s;for(e=Object(e);r--;){var a=n[r];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++r<s;){var c=(a=n[r])[0],u=e[c],h=a[1];if(o&&a[2]){if(void 0===u&&!(c in e))return!1}else{var l=new Ao;if(i)var d=i(u,h,c,e,t,l);if(!(void 0===d?Ga(h,u,3,i,l):d))return!1}}return!0};var $f=function(e){return e==e&&!Vs(e)};var Jf=function(e){for(var t=xa(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,$f(r)]}return t};var Yf=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}};var Qf=function(e){var t=Jf(e);return 1==t.length&&t[0][2]?Yf(t[0][0],t[0][1]):function(n){return n===e||Vf(n,e,t)}};var Kf=function(e,t,n){var i=null==e?void 0:au(e,t);return void 0===i?n:i};var Xf=function(e,t){return Jc(e)&&$f(t)?Yf(ou(e),t):function(n){var i=Kf(n,e);return void 0===i&&i===t?du(n,e):Ga(t,i,3)}};var Zf=function(e){return function(t){return au(t,e)}};var em=function(e){return Jc(e)?ep(ou(e)):Zf(e)};var tm=function(e){return"function"==typeof e?e:null==e?Su:"object"==typeof e?$o(e)?Xf(e[0],e[1]):Qf(e):em(e)};var nm,im=function(e,t){if(null==e)return{};var n=eu(wc(e),(function(e){return[e]}));return t=tm(t),uu(e,n,(function(e,n){return t(e,n[0])}))};!function(e){e.PING="0",e.PONG="1",e.REQUEST="2",e.RESPONSE="3",e.CONTROL="4"}(nm||(nm={}));const rm={connectionTimeout:4e3,requestTimeout:6e4,maxRetries:10,minReconnectionDelay:1e3+4e3*Math.random(),maxReconnectionDelay:1e4,reconnectionDelayGrowFactor:1.3,pingInterval:3e4};function sm(){return WebSocket}class om{constructor(e){this.requests={},this.timeout=e}insert(e){return Object(ji.a)(this,void 0,void 0,(function*(){return new Promise((t,n)=>{const i=setTimeout(()=>{n(new Error(`No server response received after ${this.timeout}ms`))},this.timeout);this.requests[e]={resolve:t,reject:n,timer:i}})}))}resolve(e,t){const n=this.requests[e];if(!n)throw new Error(`Received server response for a non-existent id: ${e}`);clearTimeout(n.timer),n.resolve(t),delete this.requests[e]}}class am{constructor(e={}){if(this.emitter=new qu.a,this.retryCount=-1,this.state=Wf.DISCONNECTED,this.requestId=0,this.url="",this.token="",this.wapiId="",this.suspendedId="",e.WebSocket&&("function"!=typeof(t=e.WebSocket)||2!==t.CLOSING))throw Error("Provided WebSocket is not a valid WebSocket class");var t;this.options=function(e){const{WebSocket:t=sm(),logger:n=console,connectionTimeout:i=rm.connectionTimeout,requestTimeout:r=rm.requestTimeout,maxRetries:s=rm.maxRetries,minReconnectionDelay:o=rm.minReconnectionDelay,maxReconnectionDelay:a=rm.maxReconnectionDelay,reconnectionDelayGrowFactor:c=rm.reconnectionDelayGrowFactor,pingInterval:u=rm.pingInterval}=e;return{WebSocket:t,logger:n,connectionTimeout:i,requestTimeout:r,maxRetries:s,minReconnectionDelay:o,maxReconnectionDelay:a,reconnectionDelayGrowFactor:c,pingInterval:u}}(e),this.requestMap=new om(this.options.requestTimeout),this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onMessage=this.onMessage.bind(this),this.bindEventListeners=this.bindEventListeners.bind(this),this.unbindEventListeners=this.unbindEventListeners.bind(this)}getState(){return this.state}configure(e,t){if(this.state!==Wf.DISCONNECTED)throw Error(`Invalid state: ${Wf[this.state]}`);this.url=e,this.token=t}connect(){return Object(ji.a)(this,void 0,void 0,(function*(){if(this.state!==Wf.DISCONNECTED)throw Error(`Invalid state: ${Wf[this.state]}`);return this.doConnect(),this.waitForState(Wf.CONNECTED,Wf.DISCONNECTED)}))}disconnect(){return Object(ji.a)(this,void 0,void 0,(function*(){if(![Wf.SUSPENDED,Wf.SUSPENDING].includes(this.state)){if(![Wf.CONNECTING,Wf.CONNECTED].includes(this.state))throw Error("Not connected");this.setState(Wf.DISCONNECTING),this.socket.close(1e3),yield this.waitForState(Wf.DISCONNECTED,Wf.CONNECTED)}}))}send(e,t,n){return Object(ji.a)(this,void 0,void 0,(function*(){if([Wf.SUSPENDING,Wf.SUSPENDED].includes(this.state))throw Error("We're suspended/-ing, you cannot send messages");if(!this.socket)throw Error("Not connected");const i=this.requestId=(this.requestId+1)%Number.MAX_SAFE_INTEGER,r={id:i,method:e,path:t,body:n};return this.socket.send(nm.REQUEST+JSON.stringify(r)),this.requestMap.insert(i)}))}sendControl(e){if(!this.socket)throw Error("Not connected");this.socket.send(nm.CONTROL+JSON.stringify(e))}suspend(){return Object(ji.a)(this,void 0,void 0,(function*(){return this.setState(Wf.SUSPENDING),this.suspendedId=this.wapiId,this.sendControl({action:"suspend"}),this.options.logger.debug("Clearing timers while suspended"),clearTimeout(this.connectionTimer),clearTimeout(this.pingTimer),this.waitForState(Wf.SUSPENDED,Wf.DISCONNECTED)}))}resume(e){return Object(ji.a)(this,void 0,void 0,(function*(){if(this.state!==Wf.SUSPENDED)throw Error(`Invalid state: ${Wf[this.state]}`);this.doConnect(),yield this.waitForState(Wf.CONNECTED,Wf.DISCONNECTED),this.sendControl({action:"resume",wapiId:e||this.suspendedId}),this.suspendedId=""}))}doConnect(){const e=this.options.logger,{WebSocket:t,maxRetries:n,connectionTimeout:i}=this.options;if(++this.retryCount>n)return e.debug("Maximum number of retries reached"),void this.setState(Wf.DISCONNECTED);e.debug(`Trying to establish a connection with the server. Retry count: ${this.retryCount}`),this.setState(Wf.CONNECTING),this.socket=new t(this.url,["wapi"]),this.bindEventListeners(),this.connectionTimer=setTimeout(()=>{e.debug("Timeout waiting for connection establishment"),this.socket&&(this.socket.readyState===t.OPEN&&this.socket.close(4408),this.unbindEventListeners(),delete this.socket),this.setState(Wf.DISCONNECTED)},i)}onOpen(){this.options.logger.debug("Socket open. Sending AUTH message"),this.retryCount=-1,this.socket.send(`AUTH ${this.token}`)}onMessage(e){const t=this.options.logger;if(this.state===Wf.CONNECTING){clearTimeout(this.connectionTimer),this.heartbeat();let n={status:400,wapiId:""};try{n=JSON.parse(e.data)}catch(n){t.error(`Failed to parse auth data: ${e.data}`),this.disconnect().catch(t.error)}200===n.status?(t.debug("Success in authentication received from server"),this.setState(Wf.CONNECTED),this.wapiId=n.wapiId):(t.error(e.data),this.disconnect().catch(t.error))}else if(this.state===Wf.CONNECTED){const n=e.data[0];n===nm.PING?(this.heartbeat(),this.socket.send(nm.PONG)):n===nm.RESPONSE?this.processResponse(e.data.substring(1)):t.warn(`Ignoring message with WapiMessageType: ${n}`)}else t.warn(`Ignoring message received in ${Wf[this.state]} state`)}heartbeat(){const e=this.options.logger,{pingInterval:t}=this.options;clearTimeout(this.pingTimer),this.pingTimer=setTimeout(()=>{e.warn(`No PING received from server in the last ${1.5*t}ms. Disconnecting...`),this.doConnect()},1.5*t)}processResponse(e){const t=this.options.logger;let n;try{n=JSON.parse(e)}catch(n){return void t.error(`Problem parsing message "${e}"`,n)}if("number"==typeof n.id){const e=n,{id:t}=e,i=Object(ji.c)(e,["id"]);this.requestMap.resolve(t,i)}else{const e=n;this.emitter.emit("event",e)}}onClose(e){return Object(ji.a)(this,void 0,void 0,(function*(){const t=this.options.logger;if(this.unbindEventListeners(),clearTimeout(this.connectionTimer),clearTimeout(this.pingTimer),delete this.socket,this.state===Wf.DISCONNECTING)return t.debug("Disconnected."),void this.setState(Wf.DISCONNECTED);switch(e.code){case 1e3:case 4400:case 4401:case 4408:return this.setState(Wf.DISCONNECTED),void t.debug("Connection closed by the server.");case 3001:return this.setState(Wf.SUSPENDED),void t.debug("Connection suspended by client.")}const n=this.getNextDelay();t.debug(`Connection unexpectedly closed (${e.code}). Waiting ${n.toFixed(1)}ms before reconnecting`),yield function(e){return Object(ji.a)(this,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}))}(n),this.doConnect()}))}setState(e){this.options.logger.debug(`setState(${e})`),this.state!==e&&(this.state=e,this.emitter.emit("state",e))}bindEventListeners(){this.socket.addEventListener("open",this.onOpen),this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage)}unbindEventListeners(){this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("close",this.onClose),this.socket.removeEventListener("message",this.onMessage)}waitForState(e,t){return Object(ji.a)(this,void 0,void 0,(function*(){return new Promise((n,i)=>{const r=s=>{s===e?(this.emitter.off("state",r),n()):s===t&&(this.emitter.off("state",r),i(Error(`Invalid state: ${Wf[s]}`)))};this.emitter.on("state",r)})}))}getNextDelay(){const{minReconnectionDelay:e,maxReconnectionDelay:t,reconnectionDelayGrowFactor:n}=this.options,i=e*n**this.retryCount;return Math.min(i,t)}}var cm=Ii.instance.getLogger("SippoJS/WacStack/WacRequest");class um{constructor(){this.emitter=new Oi.EventEmitter2({wildcard:!0,delimiter:"/"}),this.wapi=new am,c(this,["onWapiEvent"]),this._urls={}}init(){this.wapi.emitter.on("event",this.onWapiEvent)}uninit(){this.wapi.emitter.off("event",this.onWapiEvent)}onWapiEvent(e){var t=e.path.substring(1);this.emitter.emit(t,{method:e.method,path:e.path,body:e.body})}set urls(e){this._urls=e}set token(e){this.wapi.configure(this._urls["urn:quobis:sippo:websocket"],e)}request(e={}){var t=this;return s((function*(){if(t.wapi.getState()===Wf.CONNECTED){var n=e.method||"GET",i=Or.a.stringify(e.qs),r=e.url+(i?"?"+i:""),s=Array.isArray(e.body)?e.body:im(e.body,e=>void 0!==e);cm.debug("Request ".concat(n," ").concat(r),s);var o=yield t.wapi.send(n,r,s);if(o.status>=300)throw cm.error("Unexpected response",e,o),new Error(o.status);return cm.debug("Response ".concat(n," ").concat(r),o.status,o.body),o.body}cm.debug("Dropping request while disconnected")}))()}get(e,t={}){return this.request({method:"GET",url:e,qs:t})}post(e,t={},n={}){return this.request({method:"POST",url:e,qs:t,body:n})}put(e,t={},n={}){return this.request({method:"PUT",url:e,qs:t,body:n})}delete(e,t={}){return this.request({method:"DELETE",url:e,qs:t})}}class hm{set urls(e){if(!e["urn:quobis:sippo:https"])throw new Error("No valid URL found for SAPI");this._url=e["urn:quobis:sippo:https"]}login(e,t,n){var i=this;return s((function*(){return i._request("".concat(i._url,"/login"),{grant_type:"oauth2",provider:e,token:t,context:i._getContext(n)}).catch(e=>{throw new x("Failed to login",e.message)})}))()}recover(e){var t=this;return s((function*(){return t._request("".concat(t._url,"/login/sessionToken"),{token:e}).catch(e=>{throw new x("Failed to recover session",e.message)})}))()}_request(e,t){var n=this;return s((function*(){if(!n._url)throw new Error("No URL set");var i={method:"POST",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(t)},r=yield fetch(e,i);if(r.status>=200&&r.status<300)return yield r.json();throw new Error("Non 200 OK response")}))()}_getContext(e){var t=navigator.language||"en";return navigator.languages&&navigator.languages.length&&(t=navigator.languages[0]),{useragent:navigator.userAgent,language:t,location:this._getLocationHref(),platform:navigator.platform,vendor:navigator.vendor,deviceId:e}}_getLocationHref(){return location.href}}var lm=n(39),dm=n.n(lm),pm=Ii.instance.getLogger("SippoJS/WacStack/XmppClient");class fm{constructor(e,t,n){this.lock=new dm.a(1),this.throttleLock=new dm.a(100),this.mucJoinPromise={},this.messagePromise={},this.options={jid:n,password:t,timeout:50,transports:{websocket:e}},this.emitter=new Oi.EventEmitter2,c(this,["onEvent","onStanzaAcked","onMucError","onMucJoin","onDisconnected"])}start(){var e=this;return s((function*(){if(e.started)throw Error("already started");e.started=!0,yield e.lock.acquire(),e.client=Object(Rr.c)(e.options);var t=sessionStorage.getItem("cachedSM");t&&e.client.sm.load(JSON.parse(t,Rr.b.reviveData));try{yield e.connectClient()}catch(t){if("SESSION_ENDED"!==t.message)throw t;sessionStorage.removeItem("cachedSM"),yield e.disconnectClient(),e.client=Object(Rr.c)(e.options),yield e.connectClient()}e.bindEventListeners(),e.client.sm.cache(e=>{sessionStorage.setItem("cachedSM",JSON.stringify(e))}),yield e.client.getRoster(),e.client.updateCaps(),e.client.sendPresence({caps:e.client.disco.caps}),e.client.enableKeepAlive({interval:20,timeout:10}),yield e.client.enableCarbons(),e.lock.release()}))()}stop(){var e=this;return s((function*(){if(!e.started)throw Error("not started");e.started=!1,yield e.lock.acquire(),e.unbindEventListeners(),sessionStorage.removeItem("cachedSM"),yield e.disconnectClient(),delete e.client,e.lock.release()}))()}suspend(){var e=this;return s((function*(){e.started=!1,yield e.lock.acquire(),e.unbindEventListeners(),new Promise((t,n)=>{e.client.transport.conn.addEventListener("close",t),e.client.transport.conn.addEventListener("error",n),e.client.transport.conn.close()}).catch(pm.error),delete e.client,e.lock.release()}))()}resume(){var e=this;return s((function*(){yield e.start()}))()}connectClient(){var e=this;return s((function*(){return new Promise((t,n)=>{var i,r,s,o,a=()=>{e.client.off("session:started",i),e.client.off("session:end",s),e.client.off("stream:management:resumed",i),e.client.off("auth:failed",r)};i=()=>{a(),t()},r=()=>{a(),n(Error("XMPP authentication error"))},o=()=>{a(),n(Error("XMPP Server unavailable"))},s=()=>{a(),n(Error("SESSION_ENDED"))},e.client.on("auth:failed",r),e.client.on("session:end",s),e.client.on("session:started",i),e.client.on("stream:management:resumed",i),e.client.on("disconnected",o),e.client.connect()})}))()}disconnectClient(){return new Promise(e=>{if(this.reconnectingInterval)return e();this.client.once("disconnected",e),this.client.disconnect()})}onDisconnected(){this.started&&!this.reconnectingInterval&&(this.client.once("connected",()=>{clearInterval(this.reconnectingInterval),this.reconnectingInterval=null}),this.reconnectingInterval=setInterval(()=>{this.client.connect()},1e4))}bindEventListeners(){this.client.on("*",this.onEvent),this.client.on("muc:join",this.onMucJoin),this.client.on("muc:error",this.onMucError),this.client.on("stanza:acked",this.onStanzaAcked),this.client.on("disconnected",this.onDisconnected)}unbindEventListeners(){this.client.off("*",this.onEvent),this.client.off("muc:join",this.onMucJoin),this.client.off("muc:error",this.onMucError),this.client.off("stanza:acked",this.onStanzaAcked),this.client.off("disconnected",this.onDisconnected)}sendMessage(e){var t=this.client.sendMessage(e);return new Promise((e,n)=>{this.messagePromise[t]={resolve:e,reject:n}})}markReceived(e,t,n){var i={from:e,type:n,id:t,marker:{type:"markable"}};return this.client.markReceived(i)}markDisplayed(e,t,n){var i=this;return s((function*(){var r={from:e,type:n,id:t,marker:{type:"markable"}};yield i.client.markDisplayed(r)}))()}searchHistory(e){var t=this;return s((function*(){yield t.throttleLock.acquire();var n=yield t.client.searchHistory(e);return t.throttleLock.release(),n}))()}getBookmarks(){return this.client.getBookmarks()}addBookmark(e){var t=this;return s((function*(){yield t.lock.acquire();try{yield t.client.addBookmark(e)}finally{t.lock.release()}}))()}removeBookmark(e){var t=this;return s((function*(){yield t.lock.acquire();try{yield t.client.removeBookmark(e)}finally{t.lock.release()}}))()}getDiscoInfo(e){var t=this;return s((function*(){yield t.throttleLock.acquire();var n=yield t.client.getDiscoInfo(e);return t.throttleLock.release(),n}))()}getRoomConfig(e){return this.client.getRoomConfig(e)}configureRoom(e,t){return this.client.configureRoom(e,t)}destroyRoom(e,t){return this.client.destroyRoom(e,t)}getRoomMembers(e,t){var n=this;return s((function*(){yield n.throttleLock.acquire();var i=yield n.client.getRoomMembers(e,{affiliation:t});return n.throttleLock.release(),i}))()}joinRoom(e,t,n){var i=this;return s((function*(){yield i.throttleLock.acquire(),i.client.joinRoom(e,t,n);var r=yield new Promise((t,n)=>{i.mucJoinPromise[e]={resolve:t,reject:n}});return i.throttleLock.release(),r}))()}invite(e,t){return this.client.invite(e,t)}setRoomAffiliation(e,t,n,i){return this.client.setRoomAffiliation(e,t,n,i)}setSubject(e,t){return this.client.setSubject(e,t)}deleteAccount(e){var t=this;return s((function*(){try{yield t.client.deleteAccount(e)}catch(e){if("error"!==e.type)throw e;if("gone"!==e.error.condition)throw Error(e.error.text)}}))()}enableNotifications(e,t,n){return this.client.enableNotifications(e,t,n)}disableNotifications(e,t){return this.client.disableNotifications(e,t)}onEvent(e,t){pm.debug(e,t),this.emitter.emit(e,t)}onStanzaAcked(e){if("message"===e.kind){var t=this.messagePromise[e.stanza.id];t&&(t.resolve(e.stanza.id),delete this.messagePromise[e.stanza.id])}}onMucError(e){var t=Rr.a.toBare(e.from);this.mucJoinPromise[t]&&(this.mucJoinPromise[t].reject(new Error(e.error.text)),delete this.mucJoinPromise[t])}onMucJoin(e){var t=Rr.a.toBare(e.from);this.mucJoinPromise[t]&&(this.mucJoinPromise[t].resolve(),delete this.mucJoinPromise[t])}}var mm=Ii.instance.getLogger("SippoJS/WacStack/CallAttemptService"),gm="/callAttempts/";class vm{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),c(this,["onEvent","onInstanceEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("callAttempts",this.onEvent),this.wacRequest.emitter.on("callAttempts/*",this.onInstanceEvent)}onEvent(e){switch(e.method){case"post":this.emitter.emit("created",e.body);break;default:mm.warn("Unhandled WAC event: ",e)}}onInstanceEvent(e){switch(e.method){case"delete":this.emitter.emit("rejected",e.body);break;default:mm.warn("Unhandled WAC event: ",e)}}accept(e){return this.wacRequest.put(gm+e,{},{accepted:!0})}reject(e){return this.wacRequest.put(gm+e,{},{accepted:!1})}}var ym=Ii.instance.getLogger("SippoJS/WacStack/CallService");class bm{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),c(this,["onEvent","onInstanceEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("calls",this.onEvent),this.wacRequest.emitter.on("calls/*",this.onInstanceEvent)}onEvent(e){switch(e.method){case"post":this.emitter.emit("created",e.body);break;default:ym.warn("Unhandled WAC event: ",e)}}onInstanceEvent(e){switch(e.method){case"put":this.emitter.emit("updated",e.body);break;default:ym.warn("Unhandled WAC event: ",e)}}get({after:e,before:t,limit:n,sortBy:i,caller:r,callee:s,target:o,queueposition:a}={}){return this.wacRequest.get("/calls/",{after:e,before:t,limit:n,sortBy:i,caller:r,callee:s,target:o,queueposition:a})}create({caller:e,callee:t,context:n,anonymousSessionId:i}={}){return this.wacRequest.post("/calls/",{},{caller:e,callee:t,context:n,anonymousSessionId:i})}update(e,{caller:t,callee:n,context:i,anonymousSessionId:r,state:s}={}){return this.wacRequest.put("/calls/"+e,{},{caller:t,callee:n,context:i,anonymousSessionId:r,state:s})}}var _m=function(){},wm=Aa&&1/zo(new Aa([,-0]))[1]==1/0?function(e){return new Aa(e)}:_m;var Sm=function(e,t,n){var i=-1,r=ll,s=e.length,o=!0,a=[],c=a;if(n)o=!1,r=dl;else if(s>=200){var u=t?null:wm(e);if(u)return zo(u);o=!1,r=Fo,c=new qo}else c=t?[]:a;e:for(;++i<s;){var h=e[i],l=t?t(h):h;if(h=n||0!==h?h:0,o&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),a.push(h)}else r(c,l,n)||(c!==a&&c.push(l),a.push(h))}return a},Cm=fl((function(e){return Sm(gu(e,1,ml,!0))}));class Em{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,c(this,["onEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("/capabilities",this.onEvent)}onEvent(e){var t=this;return s((function*(){"put"===e.method&&(yield t.process(e.body),t.emitter.emit("change"))}))()}populate(){var e=this;return s((function*(){var t=yield e.wacRequest.get("/capabilities");e.process(t)}))()}process(e){var t=this;return s((function*(){var n=e.domain,i=e.user.filter(e=>e.startsWith("+")).map(e=>e.slice(1));t.capabilities=Cm(n,i),t.forbiddenCapabilities=e.user.filter(e=>e.startsWith("-")).map(e=>e.slice(1))}))()}getCapabilities(){var e=this;return s((function*(){return e.capabilities||(yield e.populate()),e.capabilities}))()}getForbiddenCapabilities(){var e=this;return s((function*(){return e.forbiddenCapabilities||(yield e.populate()),e.forbiddenCapabilities}))()}}class km{constructor(e){this.wacRequest=e,c(this,["onEvent"]),this.emitter=new Oi.EventEmitter2({wildcard:!0}),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("conferences",this.onEvent)}onEvent(e){this.emitter.emit("create",e.body)}fetch(e,t){return this.wacRequest.get("/conferences",{limit:e,createdAt:t})}}class xm{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,c(this,["onEvent","onInstanceEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("datapipe",this.onEvent),this.wacRequest.emitter.on(["datapipe","*"],this.onInstanceEvent)}onEvent(e){switch(e.method){case"post":return this.emitter.emit("invite",e.body)}}onInstanceEvent(e){switch(e.method){case"post":return this.emitter.emit("data",e.body);case"put":return this.emitter.emit("update",e.body);case"del":return this.emitter.emit("delete",e.body)}}get(){return this.wacRequest.get("datapipe")}create(e,t){return this.wacRequest.post("datapipe",{},{label:e,participants:t})}accept(e,t){return this.wacRequest.put("".concat("datapipe","/").concat(e),{},{session:t})}delete(e){return this.wacRequest.delete("".concat("datapipe","/").concat(e))}send(e,t){return this.wacRequest.post("".concat("datapipe","/").concat(e),{},{data:t})}}var Im=n(29),Om=n.n(Im),jm=n(69),Tm=n.n(jm);class Rm{constructor(e,t,n){this.wacRequest=e,this.fileUploadUrl=t,this.token=n,this.socketsPromise=null,this.emitter=new Oi.EventEmitter2,c(this,["onFile","onDisconnect","onStart","onStream","onComplete","onAbort","onError"])}createSocket(){var e=this;return s((function*(){var t=new URL(e.fileUploadUrl),n=new Om.a("".concat(t.protocol,"//").concat(t.hostname,":").concat(t.port),{path:t.pathname});n.once("connect",()=>{n.on("disconnect",e.onDisconnect),n.emit("authentication",{[e.token.token_type]:e.token.access_token})}),yield new Promise(e=>n.once("authenticated",e));var i=new Tm.a(n);return yield new Promise(e=>i.on("ready",e)),i.off("ready"),n.on("file",e.onFile),i.on("start",e.onStart),i.on("stream",e.onStream),i.on("complete",e.onComplete),i.on("abort",e.onAbort),i.on("error",e.onError),[n,i]}))()}getSockets(){return this.socketsPromise||(this.socketsPromise=this.createSocket()),this.socketsPromise}onDisconnect(){var e=this;return s((function*(){var[t,n]=yield e.socketsPromise;e.socketsPromise=null,t.off("disconnect",e.onDisconnect),t.off("file",e.onFile),n.off("start",e.onStart),n.off("stream",e.onStream),n.off("complete",e.onComplete),n.off("abort",e.onAbort),n.off("error",e.onError)}))()}onFile(e){this.emitter.emit("file",e)}onStart(e){this.emitter.emit("start",e)}onStream(e){this.emitter.emit("stream",e)}onComplete(e){this.emitter.emit("complete",e)}onAbort(e){this.emitter.emit("abort",e)}onError(e){this.emitter.emit("error",e)}upload(e){var t=this;return s((function*(){var[,n]=yield t.getSockets(),[i]=n.upload([e]);return i}))()}abort(e){var t=this;return s((function*(){var[,n]=yield t.getSockets();n.abort(e)}))()}createSharedFile(e){return this.wacRequest.post("/filesharing/",{},{key:e}).then(e=>e.publicUrl)}}function Am(e){return{id:e.groupId,name:e.name,participants:e.participants,owner:"".concat(e.owner.username,"@").concat(e.owner.domain)}}class Pm{constructor(e){this.emitter=new Oi.EventEmitter2,this.wacRequest=e,c(this,["onEvent","onParticipantEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("usersGroup",this.onEvent),this.wacRequest.emitter.on("".concat("usersGroup","/participant"),this.onParticipantEvent)}onEvent(e){switch(e.method){case"put":case"post":return this.emitter.emit("put",Am(e.body));case"delete":return this.emitter.emit("delete",{id:e.body.groupId})}}onParticipantEvent(e){switch(e.method){case"put":case"delete":return this.emitter.emit("put",Am(e.body))}}fetch(){var e=this;return s((function*(){return(yield e.wacRequest.get("usersGroup",{participating:!0})).groupList.map(Am)}))()}create(e,t){var n=this;return s((function*(){var i=(yield n.wacRequest.post("usersGroup",{},{name:e})).groupId;return yield Promise.all(t.map(e=>n.wacRequest.post("".concat("usersGroup","/").concat(i,"/participants"),{},{targetUserId:e}))),{id:i,name:e,participants:t}}))()}update(e,t,n){return this.wacRequest.put("".concat("usersGroup","/").concat(e),{},{id:e,name:t,participants:n})}delete(e){return this.wacRequest.delete("".concat("usersGroup","/").concat(e))}}var Dm=Ii.instance.getLogger("SippoJS/WacStack/MeetingService");class Mm{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),c(this,["onEvent","onInstanceEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("meetings",this.onEvent),this.wacRequest.emitter.on("meetings/*",this.onInstanceEvent)}onEvent(e){e.method,Dm.warn("Unhandled WAC event: ",e)}onInstanceEvent(e){switch(e.method){case"put":this.emitter.emit("update",e.body);break;default:Dm.warn("Unhandled WAC event: ",e)}}get({language:e,phone:t,name:n,validUntil:i}={}){return this.wacRequest.get("/meetings/",{language:e,phone:t,name:n,validUntil:i})}create({name:e,participants:t,language:n,validSince:i,validUntil:r}={}){return this.wacRequest.post("/meetings/",{},{name:e,participants:t,language:n,validSince:i,validUntil:r})}update(e,{name:t,participants:n,language:i,validSince:r,validUntil:s}={}){return this.wacRequest.put("/meetings/"+e,{sendInvites:!0},{name:t,participants:n,language:i,validSince:r,validUntil:s})}delete(e){return this.wacRequest.delete("/meetings/"+e)}}class qm{constructor(e){this.wacRequest=e}getPhonebooksBySubscriberId(e){var t=this;return s((function*(){return(yield t.wacRequest.get("/phonebook",{subscriberId:e})).phonebooks}))()}}class Nm{constructor(e){this.wacRequest=e}notifyToken(e,t,n){return this.wacRequest.post("/pushNotifications",{},{deviceId:e,tokenType:t,token:n})}destroyToken(e){return this.wacRequest.delete("/pushNotifications",{},{deviceId:e})}}var Fm=Ii.instance.getLogger("SippoJS/WacStack/Resolver");class Lm{constructor(e){this.wacRequest=e,this.emitter=new qu.a,c(this,["onEvent"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on(["resolver","**"],this.onEvent)}onEvent(e){switch(e.method){case"put":this.emitter.emit("updated",e.body);break;default:Fm.warn("Unhandled event: ",e)}}getResolvedUsers(){return this.wacRequest.get("/".concat("resolver","/user/"))}resolveUsers(e){return this.wacRequest.post("/".concat("resolver","/user/"),{},e)}updateResolvedUsers(e){return this.wacRequest.put("/".concat("resolver","/user/"),{},e)}getUserByGatewayUsername(e){return this.wacRequest.post("/".concat("resolver","/userByGatewayUsername/"),{},{username:e})}getGatewayUsernameByUser(e){return this.wacRequest.post("/".concat("resolver","/gatewayUsernameByUser/"),{},{id:e})}}class Um{constructor(e){this.pathname="/stats/call",this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),c(this,["onStatsEnable","sendStats"]),this.bindEventHandlers()}bindEventHandlers(){this.wacRequest.emitter.on("/stats/call",this.onStatsEnable)}onStatsEnable(e){this.emitter.emit("qs-enable-stats",e.body)}sendStats(e,t,n,i){var r={service:e,ts:t,message:n,payload:i};return this.wacRequest.post(this.pathname,{},r)}}class Bm{constructor(e){this.pathname="/contacts",this.wacRequest=e,this.wacRequest.emitter.on("contacts/",this.onContact.bind(this)),this.wacRequest.emitter.on("contacts/insert_many",this.onContacts.bind(this)),this.wacRequest.emitter.on("contacts/:id",this.onContactChanged.bind(this)),this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),this.getContacts=this.getContacts.bind(this),this.addContact=this.addContact.bind(this),this.invalidateContacts=this.invalidateContacts.bind(this),this.updateContact=this.updateContact.bind(this),this.removeContact=this.removeContact.bind(this),this.searchContact=this.searchContact.bind(this),this.insertMany=this.insertMany.bind(this),this.getContactsWacUser=this.getContactsWacUser.bind(this)}onContact(e){this.emitter.emit("qs-contact-add",e.body)}onContacts(e){this.emitter.emit("qs-contact-add-many",e.body)}onContactChanged(e){"put"===e.method?this.emitter.emit("qs-contact-update",e.body):"del"===e.method&&this.emitter.emit("qs-contact-remove",e.body)}getContacts(e={}){return this.wacRequest.get(this.pathname,e)}addContact(e){return this.wacRequest.post(this.pathname,{},e)}updateContact(e){var t="".concat(this.pathname,"/").concat(e.id);return this.wacRequest.put(t,{},e)}invalidateContacts(e){return this.wacRequest.delete(this.pathname,{deviceId:e})}removeContact(e){var t="".concat(this.pathname,"/").concat(e.id);return this.wacRequest.delete(t)}searchContact(e){return this.getAll(!0,e)}getAll(e=!1,t={}){return e?this.wacRequest.get("/ldap/",{query:t}):this.wacRequest.get(this.pathname,{})}insertMany(e){return this.wacRequest.post("/contacts/insert_many",{},e)}getContactsWacUser(e={}){return this.wacRequest.get("/contacts/iswacuser/",e)}}var zm=Symbol("context"),Gm=Symbol("timer"),Wm=Symbol("retain"),Hm=Symbol("running");class Vm extends class{constructor(e){this[Gm]=null,this[zm]=e,this[Wm]=null,this[Hm]=!1}start(e){this[Hm]&&(this._timer=setTimeout(()=>{this._timer=null,this._thread.bind(this[zm])().then(e=>{this.start(e)})},e/2))}stop(){this[Hm]=!1,this._timer&&(clearTimeout(this._timer),this._timer=null)}isRunning(){return this[Hm]}get retained(){return this[Wm]}retain(e,t){this.release(),this[Wm]=e,this[Hm]=!0;var n=e[t]||0;0!==n&&this.start(Math.max(n,0))}release(){this[Wm]=null,this.stop()}_thread(){}}{_thread(){return this.update(this._thread.retained.id,this._thread.retained.lease).then(e=>(this._thread.retained.lease=e.lease,e.lease)).catch(e=>{this.onThreadError(e)})}}class $m{constructor(e){this.wacRequest=e,this._retain={},this._thread=new Vm(this),this.pathname="/credentials",this.getCredentials=this.getCredentials.bind(this)}getCredentials(e){return this.wacRequest.get(this.pathname,e)}update(e,t){var n={lease:t},i="".concat(this.pathname,"/").concat(e);return this.wacRequest.put(i,{},n)}retain(e){return this._thread.retain(e,"lease")}release(){return this._thread.release()}get retained(){return this._thread.retained}onThreadError(){this.release()}}class Jm{constructor(e,t,n){xr(this,"emitter",void 0),xr(this,"handler",void 0),xr(this,"action",void 0),xr(this,"interval",void 0),xr(this,"scheduler",void 0),this.action=e,this.interval=t,this.scheduler=n,this.emitter=new qu.a}run(){var e=this;this.handler=this.scheduler.setInterval(s((function*(){try{yield e.action()}catch(t){e.emitter.emit("error",t)}})),this.interval)}clear(){this.handler&&this.scheduler.clearInterval(this.handler)}stop(){this.clear()}}class Ym{constructor(e,t,n,i){xr(this,"interval",void 0),xr(this,"retained",void 0),xr(this,"updateFn",void 0),xr(this,"updatedFn",void 0),xr(this,"onError",void 0),this.updateFn=e,this.updatedFn=t,this.onError=n,this.interval=new Jm(this.action.bind(this),3e4,{setInterval:i.setInterval,clearInterval:i.clearInterval}),this.interval.emitter.on("error",this.onError)}retain(e){this.retained=e,this.interval.run()}action(){var e=this;return s((function*(){e.retained=yield e.updateFn(e.retained.id),e.updatedFn()}))()}release(){this.interval.stop()}}class Qm{constructor(e,t={}){var n={clearInterval:t.clearInterval?t.clearInterval:e=>clearInterval(e),setInterval:t.setInterval?t.setInterval:(e,t)=>setInterval(e,t)};this.pathname="/sessions",this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),this.getSessions=this.getSessions.bind(this),this.retain=this.retain.bind(this),this.release=this.release.bind(this),this._thread=new Ym(this.update.bind(this),this.onThreadCompleted.bind(this),this.onThreadError.bind(this),n)}getSessions(e){return this.wacRequest.get(this.pathname,e)}update(e,t){var n=t?{expires:t.expires,registered:t}:{},i="".concat(this.pathname,"/").concat(e);return this.wacRequest.put(i,{},n)}destroy(e){var t="".concat(this.pathname,"/").concat(e);return this.wacRequest.delete(t)}retain(e){return this._thread.retain(e,"expires")}release(){if(this.retained){var e=this.retained;this._thread.release(),this.destroy(e.id)}}get retained(){return this._thread.retained}suspend(){var e=this;return s((function*(){e._thread.release(),yield e.wacRequest.wapi.suspend()}))()}resume(){var e=this;return s((function*(){yield e.wacRequest.wapi.resume(),e._thread.retain(e.retained)}))()}onThreadError(){this.release(),this.emitter.emit("disconnected")}onThreadCompleted(){this.emitter.emit("updated")}}class Km{constructor(e){this.pathname="/login",this.sapiClient=e}doLoginToken(e,t,n){var i=this;return s((function*(){return i.sapiClient.login(e,t,n)}))()}recoverSession(e){var t=this;return s((function*(){return t.sapiClient.recover(e)}))()}}var Xm=Ii.instance.getLogger("SippoJS/WacStack/Presence");class Zm{constructor(e){this.wacRequest=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),c(this,["onPresencesReceived","onContactPresenceUpdated"]),this.bindEventHandlers(),Xm.warn("PresenceService started")}bindEventHandlers(){this.wacRequest.emitter.on("presence/*",this.onContactPresenceUpdated),this.wacRequest.emitter.on("batch/presence",this.onPresencesReceived)}onPresencesReceived(e){Xm.debug("subscriptions response ".concat(e.body))}onContactPresenceUpdated(e){var{path:t,method:n}=e;Xm.debug("presence:onContactPresenceUpdated:".concat(n," ").concat(t)),this.emitter.emit("presence-updated",e.body)}getAll(e=!1){try{return this.wacRequest.get("/presence",{withoutAvatar:e})}catch(e){if(404!==e)throw e;return Xm.warn("presence not found (404)"),[]}}get(e){return this.wacRequest.get("".concat("/presence","/").concat(e))}update(e,t){return this.wacRequest.put("".concat("/presence","/").concat(e),{},t)}create(e){return this.wacRequest.post("/presence",{},{address:e})}destroy(e){return this.wacRequest.delete("".concat("/presence","/").concat(e))}unsubscribeFromPresence(e){return this.destroy(e)}subscribeToPresences(e){return this.wacRequest.post("/batch".concat("/presence"),{},e)}}class eg{constructor(e){this.wacRequest=e,this.pathname="/recordings",this.getRecordings=this.getRecordings.bind(this),this.startRecording=this.startRecording.bind(this),this.stopRecording=this.stopRecording.bind(this)}getRecordings(e){var t="";return Object.keys(e).length&&"object"==typeof e&&(t=Ir.stringify(e)),this.wacRequest.get(this.pathame,t)}startRecording(e,t,n){var i="".concat(this.pathname,"/start/").concat(e),r={};return t&&(r.filename=t),n&&(r.source=n),this.wacRequest.put("".concat(i),{},r)}stopRecording(e){var t="".concat(this.pathname,"/stop/").concat(e);return this.wacRequest.put("".concat(t),{},{})}}class tg{constructor(e){this.wacRequest=e,this.pathname="/remotelog",this._enabled=!1,this._logHandler=this._logHandler.bind(this)}enable(){this._enabled||(Ii.instance.addHandler(this._logHandler),this._enabled=!0)}disable(){this._enabled&&(Ii.instance.removeHandler(this._logHandler),this._enabled=!1)}create(e,t,n){var i={level:e,file:t,text:n};return this.wacRequest.post(this.pathname,{},i)}_logHandler(e,t){return this.create(t.level.name.toUpperCase(),t.name,JSON.stringify(e,null,2))}}class ng{constructor(e){this.wacRequest=e,this.pathname="/usersettings",this.getSettings=this.getSettings.bind(this),this.setSetting=this.setSetting.bind(this)}getSettings(){return this._getAllSettings().then(e=>this._parseSettings(e))}setSetting(e,t){return this._getAllSettings().then(n=>{var i=n.find(t=>t.key===e);return i?this._updateSettings(i.id,e,t):this._createSettings("wac",e,t)})}_getAllSettings(){return this.wacRequest.get(this.pathname)}_updateSettings(e,t,n){var i="".concat(this.pathname,"/").concat(e),r={[t]:n};return this.wacRequest.put(i,{},r)}_createSettings(e,t,n){var i={source:e,[t]:n};return this.wacRequest.post(this.pathname,{},i)}_parseSettings(e){Array.isArray(e)||(e=[e]);var t={settings:e};return this.wacRequest.post("/usersettingsparser",{},t)}}class ig{constructor(e){this.wacRequest=e,this.pathname="/users",this.updateUser=this.updateUser.bind(this),this.validatePhone=this.validatePhone.bind(this),this.getUser=this.getUser.bind(this)}updateUser(e,t){var n="".concat(this.pathname,"/").concat(e);return this.wacRequest.put(n,{},t)}getUser(e){var t="".concat(this.pathname,"/").concat(e);return this.wacRequest.get(t)}validatePhone(e,t,n){var i="".concat(this.pathname,"/").concat(e),r={code:t,phone:n};return this.wacRequest.post(i,{},r)}}var rg=Ii.instance.getLogger("SippoJS/WacStack"),sg=Ii.instance.getLogger("SippoJS/WacStack events");class og extends Oi.EventEmitter2{constructor(e,t,n){super(),this.setMaxListeners(0),this.WACVersion="",this.wacUri=e,this.urls={},this._reconnecting=!1,this.wacRequest=t||new um,this.sapiClient=n||new hm,c(this,["onCapabilitiesChange","onClose","onConnection","onWapiStateChange"])}generateWacProxyActions(){for(var e in this.actionProxy={getContacts:this.contactService.getContacts,addContact:this.contactService.addContact,updateContact:this.contactService.updateContact,removeContact:this.contactService.removeContact,searchContact:this.contactService.searchContact,invalidateContacts:this.contactService.invalidateContacts,insertMany:this.contactService.insertMany,getContactsWacUser:this.contactService.getContactsWacUser,getSettings:this.settingsService.getSettings,setSetting:this.settingsService.setSetting,sendStats:this.callStatsService.sendStats,getSessions:this.sessionsService.getSessions,retainSession:this.sessionsService.retain,releaseSession:this.sessionsService.release,getCredentials:this.credentialsService.getCredentials,getUser:this.userService.getUser,updateUser:this.userService.updateUser,validatePhone:this.userService.validatePhone},this.actionProxy)this[e]=this.actionProxy[e]}onWapiStateChange(e){switch(rg.debug("Wapi connection transitioned to ".concat(e)),e){case Wf.CONNECTED:this.onConnection();break;case Wf.DISCONNECTED:this.onClose("io server disconnect");break;default:rg.debug("No handler for this wapi state transition")}}start(){var e=this;return s((function*(){var t=yield fetch("".concat(e.wacUri,"/.well-known/host-meta.json")),n=yield t.json();for(var i of n.links)e.urls[i.rel]=i.href;e.wacRequest.urls=e.urls,e.sapiClient.urls=e.urls,e.generateWacProxyActions()}))()}stop(){var e=this;return s((function*(){if(e.getCurrentCredential()&&e.releaseCredential(),e.getCurrentSession()&&e.releaseSession(),e.wacRequest&&e.wacRequest.uninit(),e.wacRequest.wapi.getState()===Wf.DISCONNECTED)return e;e.wacRequest.wapi.emitter.off("state",e.onWapiStateChange);var t=e._chatService?e._chatService.stop():Promise.resolve();yield Promise.all([e.wacRequest.wapi.disconnect(),t])}))()}loginToken(e,t,n){return this.processLogin(this.loginService.doLoginToken(e,t,n))}processLogin(e){var t=this;return s((function*(){try{var n=yield e;return t._wapiToken=n,t._username=n.session.userObj.username,t._domain=n.session.userObj.domain,t.wacRequest.token=n.access_token,t.wacRequest.init(),t.wacRequest.wapi.emitter.on("state",t.onWapiStateChange),yield t.wacRequest.wapi.connect(),t.capabilitiesService=new Em(t.wacRequest),t.capabilitiesService.emitter.on("change",t.onCapabilitiesChange),yield t.onCapabilitiesChange(),n}catch(e){switch(e.message){case 403:throw new x;case 409:throw new T;case 500:throw new j;default:throw e}}}))()}recoverSession(e){return this.processLogin(this.loginService.recoverSession(e))}getCurrentSession(){return this.sessionsService&&this.sessionsService.retained}getCurrentCredential(){return this.credentialsService&&this.credentialsService.retained}retainCredential(e){this.credentialsService.retain(e);var t=this.sessionsService.retained;t.registered!==e.id&&(t.registered=e.id,t.expires=-1,this.sessionsService.retain(t))}releaseCredential(){var e=this.sessionsService.retained;e.registered="",e.expires=-1,this.sessionsService.retain(e),this.credentialsService.release()}suspendSession(){var e=this;return s((function*(){var t=e._chatService?e._chatService.suspend():Promise.resolve(),n=e._sessionsService?e._sessionsService.suspend():Promise.resolve();yield Promise.all([n,t])}))()}resumeSession(){var e=this;return s((function*(){var t=e._chatService?e._chatService.resume():Promise.resolve(),n=e._sessionsService?e._sessionsService.resume():Promise.resolve();yield Promise.all([n,t])}))()}getVersion(){return[{name:"WAPI",version:"unknown"},{name:"WAC",version:"unknown"}]}updatePresence(e,t){return this.presenceService.update(e,t)}isReconnecting(){return this._reconnecting}onCapabilitiesChange(){var e=this;return s((function*(){var t=yield e.capabilitiesService.getCapabilities(),n=yield e.capabilitiesService.getForbiddenCapabilities();Hf(t,n).includes("log")?e.remoteLogService.enable():e.remoteLogService.disable()}))()}onConnection(){if(this._reconnecting){this.emit("reconnected"),this._reconnecting=!1;var e=this.sessionsService.retained;e&&(e.expires=-1,this.sessionsService.retain(e))}}onClose(e){if(rg.warn("WAC API closed: "+e),"io server disconnect"===e)this.emit("disconnected");else switch(this._reconnecting=!0,this.emit("reconnecting"),e){case"transport close":this.emit("qs-transport-close");break;case"ping timeout":this.emit("qs-connection-lost");break;default:this.emit("qs-unknown-close")}}trace(e,t){return rg.debug("trace: "+e,t)}emit(...e){sg.debug(e),super.emit.apply(this,e)}get callAttemptService(){return this._callAttemptService||(this._callAttemptService=new vm(this.wacRequest)),this._callAttemptService}get callService(){return this._callService||(this._callService=new bm(this.wacRequest)),this._callService}get callStatsService(){return this._callStatsService||(this._callStatsService=new Um(this.wacRequest)),this._callStatsService}get chatService(){if(!this._chatService){var e=this.urls["urn:xmpp:alt-connections:websocket"],t=new fm(e,this._wapiToken.access_token,"".concat(this._username,"@").concat(this._domain).toLowerCase()),n=this.urls["urn:quobis:xmpp:push"];this._chatService=new Ur(this.wacRequest,t,n)}return this._chatService}get conferenceLogService(){return this._conferenceLog||(this._conferenceLog=new km(this.wacRequest)),this._conferenceLog}get contactService(){return this._contactService||(this._contactService=new Bm(this.wacRequest),this._contactService.emitter.on("qs-contact-add",e=>this.emit("qs-contact-add",e)),this._contactService.emitter.on("qs-contact-add-many",e=>this.emit("qs-contact-add-many",e)),this._contactService.emitter.on("qs-contact-update",e=>this.emit("qs-contact-update",e)),this._contactService.emitter.on("qs-contact-remove",e=>this.emit("qs-contact-remove",e))),this._contactService}get credentialsService(){return this._credentialsService||(this._credentialsService=new $m(this.wacRequest)),this._credentialsService}get datapipeService(){return this._datapipeService||(this._datapipeService=new xm(this.wacRequest)),this._datapipeService}get groupService(){return this._groupService||(this._groupService=new Pm(this.wacRequest)),this._groupService}get fileSharingService(){if(!this._fileSharingService){var e=this.urls["urn:quobis:fileupload:websocket"];this._fileSharingService=new Rm(this.wacRequest,e,this._wapiToken)}return this._fileSharingService}get loginService(){return this._loginService||(this._loginService=new Km(this.sapiClient)),this._loginService}get meetingService(){return this._meetingService||(this._meetingService=new Mm(this.wacRequest)),this._meetingService}get phonebookService(){return this._phonebookService||(this._phonebookService=new qm(this.wacRequest)),this._phonebookService}get pushNotificationsService(){return this._pushNotifications||(this._pushNotifications=new Nm(this.wacRequest)),this._pushNotifications}get resolver(){return this._resolver||(this._resolver=new Lm(this.wacRequest)),this._resolver}get presenceService(){return this._presenceService||(this._presenceService=new Zm(this.wacRequest)),this._presenceService}get recordingService(){return this._recordingService||(this._recordingService=new eg(this.wacRequest)),this._recordingService}get remoteLogService(){return this._remoteLogService||(this._remoteLogService=new tg(this.wacRequest)),this._remoteLogService}get sessionsService(){return this._sessionsService||(this._sessionsService=new Qm(this.wacRequest),this._sessionsService.emitter.on("disconnected",e=>this.emit("disconnected",e))),this._sessionsService}get settingsService(){return this._settingsService||(this._settingsService=new ng(this.wacRequest)),this._settingsService}get userService(){return this._userService||(this._userService=new ig(this.wacRequest)),this._userService}}class ag{constructor(){this.gatewayCapabilities=[],this.wacCapabilities=[],this.forbiddenCapabilities=[],this.regenerateCapabilities(),this.onCapabilitiesUpdated=this.onCapabilitiesUpdated.bind(this)}start(e){return this.capabilitiesService=e,this.capabilitiesService.emitter.on("change",this.onCapabilitiesUpdated),this.onCapabilitiesUpdated()}setGatewayCapabilities(e){this.gatewayCapabilities=e,this.regenerateCapabilities()}getCapabilities(){return this.capabilities}hasWacCapability(e){return this.wacCapabilities.includes(e)}hasGatewayCapability(e){return this.gatewayCapabilities.includes(e)}onCapabilitiesUpdated(){var e=this;return s((function*(){e.wacCapabilities=yield e.capabilitiesService.getCapabilities(),e.forbiddenCapabilities=yield e.capabilitiesService.getForbiddenCapabilities(),e.regenerateCapabilities()}))()}regenerateCapabilities(){this.capabilities=Gn.of().withMutations(e=>{e.union(this.wacCapabilities),e.union(this.gatewayCapabilities),e.subtract(this.forbiddenCapabilities),window.MediaRecorder||e.delete("local-recording"),("https:"!==window.location.protocol||Ou.a.android||Ou.a.ios)&&e.delete("screen-sharing")})}}var cg=Ii.instance.getLogger("SippoJS/WacProxy"),ug=e=>e&&"function"==typeof e.then,hg=[{method:"getSessions",capability:"sessions"},{method:"getCurrentSession",capability:"sessions"},{method:"retainSession",capability:"sessions"},{method:"getCredentials",capability:"credentials"},{method:"getCurrentCredential",capability:"credentials"},{method:"retainCredential",capability:"credentials"},{method:"suspendSession",capability:null},{method:"resumeSession",capability:null},{method:"call",capability:null},{method:"answer",capability:null},{method:"hangup",capability:null},{method:"hold",capability:"hold"},{method:"resume",capability:"hold"},{method:"transfer",capability:"blind-transfer"},{method:"move",capability:"move"},{method:"enableScreenSharing",capability:"screen-sharing"},{method:"getCurrentMediaTypes",capability:"media-update"},{method:"updateCallMedia",capability:"media-update"},{method:"sendDataChannel",capability:"datachannel"},{method:"insertDTMF",capability:null},{method:"getSubscribedPresences",capability:"presence"},{method:"getPresence",capability:"presence"},{method:"updatePresence",capability:"presence"},{method:"subscribeToPresence",capability:"presence"},{method:"subscribeToPresences",capability:"presence"},{method:"unsubscribeFromPresence",capability:"presence"},{method:"sendIm",capability:"im"},{method:"updateMediaState",capability:null},{method:"getSettings",capability:"settings"},{method:"setSetting",capability:"settings"},{method:"getContacts",capability:"contacts"},{method:"addContact",capability:"contacts"},{method:"updateContact",capability:"contacts"},{method:"removeContact",capability:"contacts"},{method:"invalidateContacts",capability:"contacts"},{method:"searchContact",capability:"ldap"},{method:"getLogger",capability:"log"},{method:"sendStats",capability:"stats"},{method:"getCallAlarms",capability:"call-alarms"},{method:"triggerAlarm",capability:"call-alarms"},{method:"startListeningAudioLevel",capability:"audio-level-reporting"},{method:"stopListeningAudioLevel",capability:"audio-level-reporting"},{method:"reportStats",capability:"stats-reporting"},{method:"detectNetworkErrors",capability:"networkerror-reporting"},{method:"startRecording",capability:"recording"},{method:"stopRecording",capability:"recording"},{method:"getRecordings",capability:"recording"},{method:"getUser",capability:null},{method:"updateUser",capability:null},{method:"validatePhone",capability:null},{method:"insertMany",capability:null},{method:"getContactsWacUser",capability:null},{method:"checkConnection",capability:"network-reporting"},{method:"getRemoteSessions",capability:"list-remote"},{method:"pushCallToSession",capability:"call-push"},{method:"pullCallFromSession",capability:"call-pull"}],lg={conference:{capability:"conferences",methods:["on","off","create","fetch","requestInvitation","cancelInvitationRequest","getCurrentInvitations","getRoomByUri"]}};class dg{constructor(){var e=this;this.emitter=new qu.a;var t=function(t){e[t.method]=function(...e){return this._routeCall(t.method,t.capability,e)}.bind(e)};for(var n of hg)t(n);var i=function(t){e[t]={};var{capability:n}=lg[t],i=function(i){e[t][i]=function(...e){return this._newRouteCall(t,i,n,e)}.bind(e)};for(var r of lg[t].methods)i(r)};for(var r in lg)i(r);this.stackReconnecting=!1,c(this,["onWacStackDisconnected","onStackDisconnected","onWacStackReconnecting","onStackReconnecting","onWacStackReconnected","onStackReconnected"])}initialize(e){this.cStack=new Gf,this.wStack=new og(e),this.capabilitiesManager=new ag}start(){function e(){return(e=s((function*(e){yield new Promise(t=>{e.on("qs-ready",t),e.start()}),e.off("qs-ready")}))).apply(this,arguments)}return this.wStack.on("disconnected",this.onWacStackDisconnected),this.cStack.on("qs-unregistered",this.onStackDisconnected),this.wStack.on("reconnecting",this.onWacStackReconnecting),this.cStack.on("qs-reconnecting",this.onStackReconnecting),this.wStack.on("reconnecting",this.onWacStackReconnected),this.cStack.on("qs-reconnected",this.onStackReconnected),Promise.all([function(t){return e.apply(this,arguments)}(this.cStack),this.wStack.start()])}loginToken(e,t,n){var i=this;return s((function*(){var r=yield i.wStack.loginToken(e,t,n);return yield i.capabilitiesManager.start(i.wStack.capabilitiesService),r}))()}recoverSession(e,t){var n=this;return s((function*(){var i=yield n.wStack.recoverSession(e,t);return yield n.capabilitiesManager.start(n.wStack.capabilitiesService),i}))()}register(e,{deviceId:t}){var n=this;return s((function*(){n.capabilitiesManager.setGatewayCapabilities(n.cStack.capabilities()),yield new Promise((i,r)=>{n.cStack.on("qs-register-success",()=>{n.cStack.off("qs-register-success qs-register-error"),i()}),n.cStack.on("qs-register-error",()=>{n.cStack.off("qs-register-success qs-register-error"),r(new I)}),n.cStack.register(e,{deviceId:t})}),n.registeredCredential=e}))()}stop(){var e=this;return s((function*(){e.wStack.off("disconnected",e.onWacStackDisconnected),e.cStack.off("qs-unregistered",e.onStackDisconnected),e.wStack.off("reconnecting",e.onWacStackReconnecting),e.cStack.off("qs-reconnecting",e.onStackReconnecting),e.wStack.off("reconnecting",e.onWacStackReconnected),e.cStack.off("qs-reconnected",e.onStackReconnected),e.registeredCredential&&(yield new Promise((t,n)=>{e.cStack.on("qs-unregister-success",()=>{e.cStack.off("qs-unregister-success qs-unregister-error"),t()}),e.cStack.on("qs-unregister-error",t=>{e.cStack.off("qs-unregister-success qs-unregister-error"),n(t)}),e.cStack.unregister()})),yield e.wStack.stop()}))()}getCapabilities(){return this.capabilitiesManager.getCapabilities()}hasCapability(e){return this.getCapabilities().includes(e)}getVersion(){this.wStack.getVersion().concat(this.cStack.version())}on(e,t){this.cStack.on(e,t),this.wStack.on(e,t)}once(e,t){this.cStack.once(e,t),this.wStack.once(e,t)}off(e,t){this.cStack.off(e,t),this.wStack.off(e,t)}_joinResults(e,t){if(null!=e||null!=t)return null!=e&&null==t?e:null!=t&&null==e?t:typeof e!=typeof t?Error("result type mismatch: ".concat(typeof e," != ").concat(typeof t)):"boolean"==typeof e?e&&t:"number"==typeof e?e+t:"string"==typeof e?e+t:e instanceof Array&&t instanceof Array?e.concat(t):ug(e)&&ug(t)?Promise.all([e,t]):void 0}_routeCall(e,t,n){if(cg.info("route ".concat(e,", capability ").concat(t)),n=Array.prototype.slice.call(n),this.wStack.trace(e,n),this.capabilitiesManager.hasWacCapability(t))return this.wStack[e](...n);if(this.capabilitiesManager.hasGatewayCapability(t))return this.cStack[e](...n);var i,r;if(null==t)return"function"==typeof this.wStack[e]&&(i=this.wStack[e](...n)),"function"==typeof this.cStack[e]&&(r=this.cStack[e](...n)),this._joinResults(i,r);throw new Error("stack does not support ".concat(t))}_newRouteCall(e,t,n,i){return i=Array.prototype.slice.call(i),this.capabilitiesManager.hasWacCapability(n)?null!=this.wStack[e]?this.wStack[e][t](...i):void 0:this.capabilitiesManager.hasGatewayCapability(n)?null!=this.cStack[e]?this.cStack[e][t](...i):void 0:n?void 0:null!=this.wStack[e]?this.wStack[e][t](...i):void 0}getChatService(){return this.wStack.chatService}getCallAttemptService(){return this.wStack.callAttemptService}getCallService(){return this.wStack.callService}getConferenceLogService(){return this.wStack.conferenceLogService}getDatapipeService(){return this.capabilitiesManager.hasWacCapability("datapipe")?this.wStack.datapipeService:this.capabilitiesManager.hasGatewayCapability("datapipe")?this.cStack:void 0}getFileSharingService(){return this.wStack.fileSharingService}getGroupService(){return this.wStack.groupService}getContactService(){return this.wStack.contactService}getMeetingService(){return this.wStack.meetingService}getPhonebookService(){return this.wStack.phonebookService}getPresenceService(){return this.wStack.presenceService}getPushNotificationsService(){return this.wStack.pushNotificationsService}getResolver(){return this.wStack.resolver}onWacStackDisconnected(){var e=this;return s((function*(){try{yield e.stop()}catch(e){cg.error(e)}finally{e.emitter.emit("disconnected")}}))()}onStackDisconnected(){var e=this;return s((function*(){try{yield e.stop()}catch(e){cg.error(e)}finally{e.emitter.emit("disconnected")}}))()}onWacStackReconnecting(){var e=this;return s((function*(){e.stackReconnecting||e.emitter.emit("reconnecting")}))()}onStackReconnecting(){var e=this;return s((function*(){e.stackReconnecting=!0,e.wStack.isReconnecting()||e.emitter.emit("reconnecting")}))()}onWacStackReconnected(){var e=this;return s((function*(){e.stackReconnecting||e.emitter.emit("reconnected")}))()}onStackReconnected(){var e=this;return s((function*(){e.stackReconnecting=!1,e.wStack.isReconnecting()||e.emitter.emit("reconnected")}))()}}class pg{constructor(e,t){this.presenceService=e,this._collection=t,this._queue=new Qr(this)}subscribeToPresence(e){return this._queue.addToQueue(e)}unsubscribeFromPresence(e){return this.presenceService.destroy(e)}commit(e){this.presenceService.subscribeToPresences(e.map(e=>e.data)).then(t=>{t.forEach(e=>this._collection.updatePresence(e)),e.forEach(e=>e.resolve(this._collection.getPresence(e.data)))}).catch(t=>{e.forEach(e=>e.reject(t))})}}class fg{constructor(e=[]){this._presenceByAddress={},e.forEach(e=>{this._presenceByAddress[e.address]=e})}updatePresence(e){this._presenceByAddress[e.address]=e}getPresence(e){return this._presenceByAddress[e]}removePresence(e){delete this._presenceByAddress[e]}}class mg{static of(e){return new mg(e)}constructor(e){this.presenceService=e,this.emitter=new Oi.EventEmitter2,this.emitter.setMaxListeners(0),this._init=null,this._collection=null,this._queue=null,c(this,["onPresenceUpdated"]),this.init()}init(){this._collection=new fg,this._queue=new pg(this.presenceService,this._collection),this.presenceService.emitter.on("presence-updated",this.onPresenceUpdated),this._init=!0}uninit(){this.presenceService.emitter.off("presence-update",this.onPresenceUpdated),this.presenceService=null,this._init=null,this._collection=null,this._queue=null}isInitialized(){this._init||this.init()}subscribeToPresence(e){var t=this;return s((function*(){return(yield t._collection.getPresence(e))||t._queue.subscribeToPresence(e)}))()}unsubscribeFromPresence(e){var t=this;return s((function*(){return t._collection.removePresence(e),t._queue.unsubscribeFromPresence(e)}))()}onPresenceUpdated(e){this._collection&&this._collection.updatePresence(e),this.emitter.emit("updated",e)}updatePresence(e,t){var n=Object.assign({},t,{address:e});return this._collection&&this._collection.updatePresence(n),this.presenceService.update(e,t)}getPresence(e){return this.subscribeToPresence(e)}}class gg extends Oi.EventEmitter2{static get PROTOCOL(){return"selfie/2.0"}constructor(){super(),this._pipe=null,c(this,["_onPipeData"])}get isConnected(){return null!==this._pipe&&this._pipe.status===jh.CONNECTED}cancel(){return this._pipe.when(jh.CONNECTED).then(()=>this._pipe.disconnect())}notifyTaking(){return this._sendCommand("taking")}send(e){return this._sendCommand({action:"image",image:e})}_initDatapipe(e){if(e.status!==jh.UNCONNECTED){var t=jh[jh.UNCONNECTED],n=jh[e.status];return Promise.reject(Error('Expected datapipe status "'.concat(t,'" but got "').concat(n,'" instead.')))}return this._pipe=e,this._pipe.on("data",this._onPipeData),this._pipe.when(jh.DISCONNECTED).then(()=>{this.off("data",this._onPipeData),this.emit("cancel"),this._pipe=null}),this._pipe.connect().then(()=>{if(this._pipe.type===Lh.OUTGOING)return this._sendCommand("selfie-invite")})}_onPipeData(e){var t=this._parseData(e);switch(t.action){case"taking":this.emit("taking");break;case"image":this.emit("image",t.image)}}_parseData(e){var t=JSON.parse(e);if(t.protocol!==gg.PROTOCOL)throw new Error('Expected protocol "'.concat(gg.PROTOCOL,'" but got "').concat(t.protocol,'" instead.'));return t}_sendCommand(e){return"string"==typeof e&&(e={action:e}),e.protocol=gg.PROTOCOL,this._pipe.when(jh.CONNECTED).then(()=>this._pipe.send(JSON.stringify(e)))}}class vg{static newInstance(e){return new vg(e)}constructor(e){this._wacProxy=e,this._initializing=null}init(){return this._initializing||(this._id=this._wacProxy.getCurrentSession().userObj.id,this._initializing=this._wacProxy.getUser(this._id).then(e=>{this._update(e)})),this._initializing}get id(){return this._id}get domain(){return this._domain}get username(){return this._username}getAddress(){return"".concat(this._username,"@").concat(this._domain)}get email(){return this._email}get created(){return this._created}get lastLogin(){return this._lastLogin}get role(){return this._role}get capabilities(){return this._capabilities}get mobilePhone(){return this._mobilePhone}get landLineNumber(){return this._landLineNumber}get alias(){return this._alias}update(e){return this._wacProxy.updateUser(this._id,e).then(e=>this._update(e))}validatePhone(e,t){return this._wacProxy.validatePhone(this._id,e,t).then(e=>this._update(e))}_update(e){return this._id=e.id,this._domain=e.domain,this._username=e.username,this._email=e.email,this._created=e.created,this._lastLogin=e.lastLogin,this._role=e.role,this._capabilities=e.capabilities,this._mobilePhone=e.mobilePhone,this._landLineNumber=e.landLineNumber,this._alias=e.alias,this}toJSON(){return{id:this._id,domain:this._domain,username:this._username,email:this._email,created:this._created,lastLogin:this._lastLogin,role:this._role,capabilities:this._capabilities,mobilePhone:this._mobilePhone,landLineNumer:this._landLineNumer,alias:this._alias}}}function yg(){}var bg=function(e){return null==e?yg:function(){return this.querySelector(e)}};function _g(){return[]}var wg=function(e){return new Array(e.length)};function Sg(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Sg.prototype={constructor:Sg,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Cg(e,t,n,i,r,s){for(var o,a=0,c=t.length,u=s.length;a<u;++a)(o=t[a])?(o.__data__=s[a],i[a]=o):n[a]=new Sg(e,s[a]);for(;a<c;++a)(o=t[a])&&(r[a]=o)}function Eg(e,t,n,i,r,s,o){var a,c,u,h={},l=t.length,d=s.length,p=new Array(l);for(a=0;a<l;++a)(c=t[a])&&(p[a]=u="$"+o.call(c,c.__data__,a,t),u in h?r[a]=c:h[u]=c);for(a=0;a<d;++a)(c=h[u="$"+o.call(e,s[a],a,s)])?(i[a]=c,c.__data__=s[a],h[u]=null):n[a]=new Sg(e,s[a]);for(a=0;a<l;++a)(c=t[a])&&h[p[a]]===c&&(r[a]=c)}function kg(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var xg="http://www.w3.org/1999/xhtml",Ig={svg:"http://www.w3.org/2000/svg",xhtml:xg,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Og=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Ig.hasOwnProperty(t)?{space:Ig[t],local:e}:e};function jg(e){return function(){this.removeAttribute(e)}}function Tg(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Rg(e,t){return function(){this.setAttribute(e,t)}}function Ag(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Pg(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function Dg(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}var Mg=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView};function qg(e){return function(){this.style.removeProperty(e)}}function Ng(e,t,n){return function(){this.style.setProperty(e,t,n)}}function Fg(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Lg(e,t){return e.style.getPropertyValue(t)||Mg(e).getComputedStyle(e,null).getPropertyValue(t)}function Ug(e){return function(){delete this[e]}}function Bg(e,t){return function(){this[e]=t}}function zg(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Gg(e){return e.trim().split(/^|\s+/)}function Wg(e){return e.classList||new Hg(e)}function Hg(e){this._node=e,this._names=Gg(e.getAttribute("class")||"")}function Vg(e,t){for(var n=Wg(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function $g(e,t){for(var n=Wg(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Jg(e){return function(){Vg(this,e)}}function Yg(e){return function(){$g(this,e)}}function Qg(e,t){return function(){(t.apply(this,arguments)?Vg:$g)(this,e)}}Hg.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Kg(){this.textContent=""}function Xg(e){return function(){this.textContent=e}}function Zg(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function ev(){this.innerHTML=""}function tv(e){return function(){this.innerHTML=e}}function nv(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function iv(){this.nextSibling&&this.parentNode.appendChild(this)}function rv(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sv(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===xg&&t.documentElement.namespaceURI===xg?t.createElement(e):t.createElementNS(n,e)}}function ov(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}var av=function(e){var t=Og(e);return(t.local?ov:sv)(t)};function cv(){return null}function uv(){var e=this.parentNode;e&&e.removeChild(this)}function hv(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function lv(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}var dv={},pv=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(dv={mouseenter:"mouseover",mouseleave:"mouseout"}));function fv(e,t,n){return e=mv(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function mv(e,t,n){return function(i){var r=pv;pv=i;try{e.call(this,this.__data__,t,n)}finally{pv=r}}}function gv(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}function vv(e){return function(){var t=this.__on;if(t){for(var n,i=0,r=-1,s=t.length;i<s;++i)n=t[i],e.type&&n.type!==e.type||n.name!==e.name?t[++r]=n:this.removeEventListener(n.type,n.listener,n.capture);++r?t.length=r:delete this.__on}}}function yv(e,t,n){var i=dv.hasOwnProperty(e.type)?fv:mv;return function(r,s,o){var a,c=this.__on,u=i(t,s,o);if(c)for(var h=0,l=c.length;h<l;++h)if((a=c[h]).type===e.type&&a.name===e.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=u,a.capture=n),void(a.value=t);this.addEventListener(e.type,u,n),a={type:e.type,name:e.name,value:t,listener:u,capture:n},c?c.push(a):this.__on=[a]}}function bv(e,t,n,i){var r=pv;e.sourceEvent=pv,pv=e;try{return t.apply(n,i)}finally{pv=r}}function _v(e,t,n){var i=Mg(e),r=i.CustomEvent;"function"==typeof r?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function wv(e,t){return function(){return _v(this,e,t)}}function Sv(e,t){return function(){return _v(this,e,t.apply(this,arguments))}}var Cv=[null];function Ev(e,t){this._groups=e,this._parents=t}function kv(){return new Ev([[document.documentElement]],Cv)}Ev.prototype=kv.prototype={constructor:Ev,select:function(e){"function"!=typeof e&&(e=bg(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s,o,a=t[r],c=a.length,u=i[r]=new Array(c),h=0;h<c;++h)(s=a[h])&&(o=e.call(s,s.__data__,h,a))&&("__data__"in s&&(o.__data__=s.__data__),u[h]=o);return new Ev(i,this._parents)},selectAll:function(e){var t;"function"!=typeof e&&(e=null==(t=e)?_g:function(){return this.querySelectorAll(t)});for(var n=this._groups,i=n.length,r=[],s=[],o=0;o<i;++o)for(var a,c=n[o],u=c.length,h=0;h<u;++h)(a=c[h])&&(r.push(e.call(a,a.__data__,h,c)),s.push(a));return new Ev(r,s)},filter:function(e){var t;"function"!=typeof e&&(t=e,e=function(){return this.matches(t)});for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s)for(var o,a=n[s],c=a.length,u=r[s]=[],h=0;h<c;++h)(o=a[h])&&e.call(o,o.__data__,h,a)&&u.push(o);return new Ev(r,this._parents)},data:function(e,t){if(!e)return f=new Array(this.size()),h=-1,this.each((function(e){f[++h]=e})),f;var n,i=t?Eg:Cg,r=this._parents,s=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var o=s.length,a=new Array(o),c=new Array(o),u=new Array(o),h=0;h<o;++h){var l=r[h],d=s[h],p=d.length,f=e.call(l,l&&l.__data__,h,r),m=f.length,g=c[h]=new Array(m),v=a[h]=new Array(m);i(l,d,g,v,u[h]=new Array(p),f,t);for(var y,b,_=0,w=0;_<m;++_)if(y=g[_]){for(_>=w&&(w=_+1);!(b=v[w])&&++w<m;);y._next=b||null}}return(a=new Ev(a,r))._enter=c,a._exit=u,a},enter:function(){return new Ev(this._enter||this._groups.map(wg),this._parents)},exit:function(){return new Ev(this._exit||this._groups.map(wg),this._parents)},join:function(e,t,n){var i=this.enter(),r=this,s=this.exit();return i="function"==typeof e?e(i):i.append(e+""),null!=t&&(r=t(r)),null==n?s.remove():n(s),i&&r?i.merge(r).order():r},merge:function(e){for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var c,u=t[a],h=n[a],l=u.length,d=o[a]=new Array(l),p=0;p<l;++p)(c=u[p]||h[p])&&(d[p]=c);for(;a<i;++a)o[a]=t[a];return new Ev(o,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i,r=e[t],s=r.length-1,o=r[s];--s>=0;)(i=r[s])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=kg);for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o,a=n[s],c=a.length,u=r[s]=new Array(c),h=0;h<c;++h)(o=a[h])&&(u[h]=o);u.sort(t)}return new Ev(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=new Array(this.size()),t=-1;return this.each((function(){e[++t]=this})),e},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null},size:function(){var e=0;return this.each((function(){++e})),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r,s=t[n],o=0,a=s.length;o<a;++o)(r=s[o])&&e.call(r,r.__data__,o,s);return this},attr:function(e,t){var n=Og(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?Tg:jg:"function"==typeof t?n.local?Dg:Pg:n.local?Ag:Rg)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?qg:"function"==typeof t?Fg:Ng)(e,t,null==n?"":n)):Lg(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Ug:"function"==typeof t?zg:Bg)(e,t)):this.node()[e]},classed:function(e,t){var n=Gg(e+"");if(arguments.length<2){for(var i=Wg(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof t?Qg:t?Jg:Yg)(n,t))},text:function(e){return arguments.length?this.each(null==e?Kg:("function"==typeof e?Zg:Xg)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?ev:("function"==typeof e?nv:tv)(e)):this.node().innerHTML},raise:function(){return this.each(iv)},lower:function(){return this.each(rv)},append:function(e){var t="function"==typeof e?e:av(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:av(e),i=null==t?cv:"function"==typeof t?t:bg(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(uv)},clone:function(e){return this.select(e?lv:hv)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var i,r,s=gv(e+""),o=s.length;if(!(arguments.length<2)){for(a=t?yv:vv,null==n&&(n=!1),i=0;i<o;++i)this.each(a(s[i],t,n));return this}var a=this.node().__on;if(a)for(var c,u=0,h=a.length;u<h;++u)for(i=0,c=a[u];i<o;++i)if((r=s[i]).type===c.type&&r.name===c.name)return c.value},dispatch:function(e,t){return this.each(("function"==typeof t?Sv:wv)(e,t))}};var xv=function(e){return"string"==typeof e?new Ev([[document.querySelector(e)]],[document.documentElement]):new Ev([[e]],Cv)},Iv=function(){for(var e,t=pv;e=t.sourceEvent;)t=e;return t},Ov=function(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]},jv=function(e){var t=Iv();return t.changedTouches&&(t=t.changedTouches[0]),Ov(e,t)},Tv={value:function(){}};function Rv(){for(var e,t=0,n=arguments.length,i={};t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new Av(i)}function Av(e){this._=e}function Pv(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",i=e.indexOf(".");if(i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function Dv(e,t){for(var n,i=0,r=e.length;i<r;++i)if((n=e[i]).name===t)return n.value}function Mv(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Tv,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}Av.prototype=Rv.prototype={constructor:Av,on:function(e,t){var n,i=this._,r=Pv(e+"",i),s=-1,o=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<o;)if(n=(e=r[s]).type)i[n]=Mv(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Mv(i[n],e.name,null);return this}for(;++s<o;)if((n=(e=r[s]).type)&&(n=Dv(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Av(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),s=0;s<n;++s)r[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=0,n=(i=this._[e]).length;s<n;++s)i[s].value.apply(t,r)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};var qv=Rv,Nv=function(e,t,n){arguments.length<3&&(n=t,t=Iv().changedTouches);for(var i,r=0,s=t?t.length:0;r<s;++r)if((i=t[r]).identifier===n)return Ov(e,i);return null};function Fv(){pv.stopImmediatePropagation()}var Lv=function(){pv.preventDefault(),pv.stopImmediatePropagation()},Uv=function(e){var t=e.document.documentElement,n=xv(e).on("dragstart.drag",Lv,!0);"onselectstart"in t?n.on("selectstart.drag",Lv,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")};var Bv=function(e){return function(){return e}};function zv(e,t,n,i,r,s,o,a,c,u){this.target=e,this.type=t,this.subject=n,this.identifier=i,this.active=r,this.x=s,this.y=o,this.dx=a,this.dy=c,this._=u}function Gv(){return!pv.ctrlKey&&!pv.button}function Wv(){return this.parentNode}function Hv(e){return null==e?{x:pv.x,y:pv.y}:e}function Vv(){return navigator.maxTouchPoints||"ontouchstart"in this}zv.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var $v=function(){var e,t,n,i,r=Gv,s=Wv,o=Hv,a=Vv,c={},u=qv("start","drag","end"),h=0,l=0;function d(e){e.on("mousedown.drag",p).filter(a).on("touchstart.drag",g).on("touchmove.drag",v).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(){if(!i&&r.apply(this,arguments)){var o=b("mouse",s.apply(this,arguments),jv,this,arguments);o&&(xv(pv.view).on("mousemove.drag",f,!0).on("mouseup.drag",m,!0),Uv(pv.view),Fv(),n=!1,e=pv.clientX,t=pv.clientY,o("start"))}}function f(){if(Lv(),!n){var i=pv.clientX-e,r=pv.clientY-t;n=i*i+r*r>l}c.mouse("drag")}function m(){var e,t,i,r;xv(pv.view).on("mousemove.drag mouseup.drag",null),e=pv.view,t=n,i=e.document.documentElement,r=xv(e).on("dragstart.drag",null),t&&(r.on("click.drag",Lv,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in i?r.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect),Lv(),c.mouse("end")}function g(){if(r.apply(this,arguments)){var e,t,n=pv.changedTouches,i=s.apply(this,arguments),o=n.length;for(e=0;e<o;++e)(t=b(n[e].identifier,i,Nv,this,arguments))&&(Fv(),t("start"))}}function v(){var e,t,n=pv.changedTouches,i=n.length;for(e=0;e<i;++e)(t=c[n[e].identifier])&&(Lv(),t("drag"))}function y(){var e,t,n=pv.changedTouches,r=n.length;for(i&&clearTimeout(i),i=setTimeout((function(){i=null}),500),e=0;e<r;++e)(t=c[n[e].identifier])&&(Fv(),t("end"))}function b(e,t,n,i,r){var s,a,l,p=n(t,e),f=u.copy();if(bv(new zv(d,"beforestart",s,e,h,p[0],p[1],0,0,f),(function(){return null!=(pv.subject=s=o.apply(i,r))&&(a=s.x-p[0]||0,l=s.y-p[1]||0,!0)})))return function o(u){var m,g=p;switch(u){case"start":c[e]=o,m=h++;break;case"end":delete c[e],--h;case"drag":p=n(t,e),m=h}bv(new zv(d,u,s,e,m,p[0]+a,p[1]+l,p[0]-g[0],p[1]-g[1],f),f.apply,f,[u,i,r])}}return d.filter=function(e){return arguments.length?(r="function"==typeof e?e:Bv(!!e),d):r},d.container=function(e){return arguments.length?(s="function"==typeof e?e:Bv(e),d):s},d.subject=function(e){return arguments.length?(o="function"==typeof e?e:Bv(e),d):o},d.touchable=function(e){return arguments.length?(a="function"==typeof e?e:Bv(!!e),d):a},d.on=function(){var e=u.on.apply(u,arguments);return e===u?d:e},d.clickDistance=function(e){return arguments.length?(l=(e=+e)*e,d):Math.sqrt(l)},d},Jv=Math.PI,Yv=2*Jv,Qv=Yv-1e-6;function Kv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Xv(){return new Kv}Kv.prototype=Xv.prototype={constructor:Kv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var s=this._x1,o=this._y1,a=n-e,c=i-t,u=s-e,h=o-t,l=u*u+h*h;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(l>1e-6)if(Math.abs(h*a-c*u)>1e-6&&r){var d=n-s,p=i-o,f=a*a+c*c,m=d*d+p*p,g=Math.sqrt(f),v=Math.sqrt(l),y=r*Math.tan((Jv-Math.acos((f+l-m)/(2*g*v)))/2),b=y/v,_=y/g;Math.abs(b-1)>1e-6&&(this._+="L"+(e+b*u)+","+(t+b*h)),this._+="A"+r+","+r+",0,0,"+ +(h*d>u*p)+","+(this._x1=e+_*a)+","+(this._y1=t+_*c)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,i,r,s){e=+e,t=+t,s=!!s;var o=(n=+n)*Math.cos(i),a=n*Math.sin(i),c=e+o,u=t+a,h=1^s,l=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+c+","+u:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+c+","+u),n&&(l<0&&(l=l%Yv+Yv),l>Qv?this._+="A"+n+","+n+",0,1,"+h+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+h+","+(this._x1=c)+","+(this._y1=u):l>1e-6&&(this._+="A"+n+","+n+",0,"+ +(l>=Jv)+","+h+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var Zv=Xv,ey=function(e){return function(){return e}};function ty(e){this._context=e}ty.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var ny=function(e){return new ty(e)};function iy(e){return e[0]}function ry(e){return e[1]}class sy{constructor(){this._index=0,this._history=[]}clear(){this._index=0,this._history=[]}_getPreviousShape(e){var t=this._history.slice(0,this._index).filter(t=>t.id===e).pop();return t?t.current:JSON.stringify({id:e})}add(e){var t=e.id,n=this._getPreviousShape(t);n!==(e=JSON.stringify(e))&&(this._history.length=this._index,this._history.push({id:t,previous:n,current:e}),this._index>=20?this._history.shift():this._index++)}canUndo(){return this._index>0}canRedo(){return this._index<this._history.length}undo(){if(!this.canUndo())return null;var e=JSON.parse(this._history[this._index-1].previous);return this._index--,e}redo(){if(!this.canRedo())return null;var e=JSON.parse(this._history[this._index].current);return this._index++,e}}class oy extends Oi.EventEmitter2{static get PROTOCOL(){return"whiteboard/2.0"}static get TOOL(){return[null,"select","add-line","freedraw","add-rect","add-circle","remove"]}constructor(e){super(),this._pipe=e,this._width=1920,this._height=1080,this._tool=null,this._color="black",this._backgroundImage="",this._backgroundVideo="",this._element=null,this._svg=this._createCanvas(),this._initializing=null,this._lastShapeSendTimestamp=0,this._pendingShapes=new Map,this._pendingShapesTimer=0,this._history=new sy,this._lineWidth=1,c(this,["_onPointerDown"])}_createCanvas(){var e=xv(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("height","100%").attr("width","100%").attr("viewBox","0 0 1920 1440").attr("preserveAspectRatio","xMidYMid meet").attr("clip-path","url(#clip)");return e.append("rect").attr("width","1920").attr("height","1440").attr("x","0").attr("y","0").attr("fill","none").attr("stroke","gray").attr("stroke-width",1),e}_onPointerDown(){if("mousedown"!==pv.type||0===pv.button)switch(this.tool){case"select":this._selectPointedElement(this,pv.target);break;case"remove":var e=xv(pv.target).data()[0];"object"==typeof e&&"string"==typeof e.id&&(xv(pv.target).data([]).exit().remove(),this._send({id:e.id},!0));break;case"add-line":return this._createLine();case"freedraw":return this._createFreedraw();case"add-rect":return this._createRect();case"add-circle":return this._createCircle();default:this._unselectAllElements()}}_selectPointedElement(e,t){switch(t.tagName.toLowerCase()){case"svg":e._svg.selectAll(".shape.selected").classList.remove("selected");break;case"path":case"circle":case"rect":pv.ctrlKey?t.classList.contains("selected")?t.classList.add("selected"):t.classList.remove("selected"):(e._unselectAllElements(),t.classList.add("selected"))}}_unselectAllElements(){this._svg.selectAll(".selected").classed("selected",!1)}clear(){this._svg.selectAll(".shape").data([],e=>e.id).exit().remove(),this._pipe.send(JSON.stringify({cmd:"clear"})),this._history.clear()}_updateShape(e){e&&(this._renderShape(e),this.emit("shape",e),this._pipe.send(JSON.stringify({cmd:"shape",shape:e})))}canUndo(){return this._history.canUndo()}undo(){this._updateShape(this._history.undo())}canRedo(){return this._history.canRedo()}redo(){this._updateShape(this._history.redo())}setArea(e){if(null!==this._element&&(this._element.node().removeChild(this._svg.node()),this._element.html(""),this._element=null),null===e)return this;if(this._element=xv(e),this._element.empty())throw Error("No elements exist for selector "+e);return this._element.html(""),this._element.node().appendChild(this._svg.node()),this._svg.on("mousedown",this._onPointerDown),this._svg.on("touchstart",this._onPointerDown),this}close(){return this._pipe.disconnect(),this}get width(){return this._width}get height(){return this._height}get aspectRatio(){return this._width/this._height}set aspectRatio(e){this._height=this._width/e,this._svg.attr("viewBox","0 0 ".concat(this._width," ").concat(this._height)).select("rect").attr("height",this._height)}get remoteParticipants(){return this._pipe.remoteParticipants}get color(){return this._color}set color(e){this._color=e,this._svg.selectAll(".selected").each(t=>{t.fill="none"===t.fill?"none":e,t.stroke="none"===t.stroke?"none":e,this._send(t,!0),this._renderShape(t)})}get tool(){return this._tool}set tool(e){if(null===this._element)throw Error("No area selected. Method setArea must be called before.");if(!oy.TOOL.some(t=>e===t))throw Error("Invalid tool: "+e);"select"!==e&&this._unselectAllElements(),this._tool=e}get backgroundImage(){return this._backgroundImage}set backgroundImage(e){var t;Promise.resolve(e instanceof Blob?(t=e,new Promise(e=>{var n=new window.FileReader;n.readAsDataURL(t),n.onloadend=function(){e(n.result)}})):e).then(e=>{this._backgroundImage=e;var t={type:"background",url:e};this._send(t,!0),this._renderBackground(t)})}get backgroundVideo(){return this._backgroundVideo}set backgroundVideo(e){if("local"!==e&&"remote"!==e&&""!==e)throw new TypeError("".concat(e,' is not a valid value. Valid values are "local" "remote" and ""'));switch(this._backgroundVideo=e,e){case"local":e="remote";break;case"remote":e="local"}var t={type:"backgroundVideo",source:e};this._send(t,!0)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e}init(){var e=this;return this._initializing?this._initializing:(this._initializing=new Promise(function(){var t=s((function*(t){e._pipe.on("data",n=>{var i=JSON.parse(n);switch(i.cmd){case"shape":e._renderShape(i.shape),e.emit("shape",i.shape);break;case"clear":e._svg.selectAll(".shape").data([],e=>e.id).exit().remove(),e.emit("clear");break;case"ready":t(e)}}),e._pipe.when(jh.DISCONNECTED).then(()=>{e._pipe.removeAllListeners(),e._pipe=null,e.emit("closed")}),yield e._pipe.connect(),e._pipe.type===Lh.OUTGOING&&(yield e._pipe.send(JSON.stringify({cmd:"ready"}))),t(e)}));return function(e){return t.apply(this,arguments)}}()),this._initializing)}_send(e,t=!1){return this.emit("shape",e),!t&&this._lastShapeSendTimestamp+500>Date.now()?(this._pendingShapes.set(e.id,e),this._pendingShapesTimer||(this._pendingShapesTimer=setTimeout(()=>{this._pendingShapes.forEach(e=>this._sendShape(e)),this._lastShapeSendTimestamp=Date.now(),this._pendingShapesTimer=0,this._pendingShapes.clear()},this._lastShapeSendTimestamp+500-Date.now())),Promise.resolve()):(this._pendingShapes.delete(e.id),this._lastShapeSendTimestamp=Date.now(),this._sendShape(e))}_sendShape(e){return this._history.add(e),this._pipe.send(JSON.stringify({cmd:"shape",shape:e}))}_updateOrAppend(e,t){var n=e.findIndex(e=>e.id===t.id);return n<0?e.push(t):e[n]=t,e}_addDragBehaviour(e,t,n){var i=$v();i.on("start",()=>{e._selectPointedElement(this,pv.sourceEvent.target)}),i.on("drag",e=>{n(e)}),i.filter((function(){return"select"===e._tool})),t.call(i)}_renderLine(e){var t=this._svg.selectAll("path"),n=this._updateOrAppend(t.data(),e),i=function(){var e=iy,t=ry,n=ey(!0),i=null,r=ny,s=null;function o(o){var a,c,u,h=o.length,l=!1;for(null==i&&(s=r(u=Zv())),a=0;a<=h;++a)!(a<h&&n(c=o[a],a,o))===l&&((l=!l)?s.lineStart():s.lineEnd()),l&&s.point(+e(c,a,o),+t(c,a,o));if(u)return s=null,u+""||null}return o.x=function(t){return arguments.length?(e="function"==typeof t?t:ey(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:ey(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:ey(!!e),o):n},o.curve=function(e){return arguments.length?(r=e,null!=i&&(s=r(i)),o):r},o.context=function(e){return arguments.length?(null==e?i=s=null:s=r(i=e),o):i},o}().x(e=>e.x).y(e=>e.y),r=t.data(n,e=>e.id);r.exit().remove(),r.enter().append("path").attr("id",e=>e.id).attr("stroke-width",this._lineWidth).classed("shape",!0),r.attr("d",e=>i(e.path)).attr("stroke",e=>e.stroke).attr("fill",e=>e.fill),this._addDragBehaviour(this,r,e=>{e.path.forEach(e=>{e.x+=pv.dx,e.y+=pv.dy}),r.attr("d",e=>i(e.path)),this._send(e)})}_renderCircle(e){var t=this._svg.selectAll("circle"),n=this._updateOrAppend(t.data(),e),i=t.data(n,e=>e.id);i.exit().remove(),i.enter().append("circle").attr("id",e=>e.id).classed("shape",!0),i.attr("cx",e=>e.cx).attr("cy",e=>e.cy).attr("r",e=>e.r).attr("stroke",e=>e.stroke).attr("fill",e=>e.fill),this._addDragBehaviour(this,i,e=>{e.cx+=pv.dx,e.cy+=pv.dy,i.attr("cx",e=>e.cx).attr("cy",e=>e.cy),this._send(e)})}_renderRect(e){var t=this._svg.selectAll("rect.shape"),n=this._updateOrAppend(t.data(),e),i=t.data(n,e=>e.id);i.exit().remove(),i.enter().append("rect").attr("id",e=>e.id).classed("shape",!0),i.attr("x",e=>e.x).attr("y",e=>e.y).attr("width",e=>e.width).attr("height",e=>e.height).attr("stroke",e=>e.stroke).attr("fill",e=>e.fill),this._addDragBehaviour(this,i,e=>{e.x+=pv.dx,e.y+=pv.dy,i.attr("x",e=>e.x).attr("y",e=>e.y),this._send(e)})}_renderRemoveShape(e){var t=this._svg.selectAll(".shape"),n=t.data().filter(t=>t.id!==e.id);t.data(n,e=>e.id).exit().remove()}_bindEndActionEvents(e){this._svg.on("mouseup",()=>{this._svg.on("mousemove",null),this._svg.on("mouseup",null),e()}),this._svg.on("touchend",()=>{this._svg.on("touchmove",null),this._svg.on("touchend",null),e()})}_createLine(){var e=jv(this._svg.node()),t={id:Ru()(),type:"line",path:[{x:e[0],y:e[1]},{x:e[0],y:e[1]}],stroke:this.color,fill:this.color};this._renderLine(t);var n=()=>{e=jv(this._svg.node()),t.path[1].x=e[0],t.path[1].y=e[1],this._renderLine(t),this._send(t)};this._svg.on("mousemove",n),this._svg.on("touchmove",n),this._bindEndActionEvents(()=>this._send(t,!0))}_createFreedraw(){var e=jv(this._svg.node()),t={id:Ru()(),type:"freedraw",path:[{x:e[0],y:e[1]}],stroke:this.color,fill:"none"};this._renderLine(t);var n=()=>{e=jv(this._svg.node()),t.path.push({x:e[0],y:e[1]}),this._renderLine(t),this._send(t)};this._svg.on("mousemove",n),this._svg.on("touchmove",n),this._bindEndActionEvents(()=>this._send(t,!0))}_createCircle(){var e=jv(this._svg.node()),t={id:Ru()(),type:"circle",cx:e[0],cy:e[1],r:0,stroke:this.color,fill:this.color};this._renderCircle(t);var n=()=>{var n=jv(this._svg.node());t.cx=(n[0]+e[0])/2,t.cy=(n[1]+e[1])/2,t.r=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2))/2,this._renderCircle(t),this._send(t)};this._svg.on("mousemove",n),this._svg.on("touchmove",n),this._bindEndActionEvents(()=>this._send(t,!0))}_createRect(){var e=jv(this._svg.node()),t={id:Ru()(),type:"rect",x:e[0],y:e[1],width:0,height:0,stroke:this.color,fill:this.color};this._renderRect(t);var n=()=>{var n=jv(this._svg.node()),i=n[0]-e[0],r=n[1]-e[1];i<0?(t.x=n[0],t.width=-i):(t.x=e[0],t.width=i),r<0?(t.y=n[1],t.height=-r):(t.y=e[1],t.height=r),this._renderRect(t),this._send(t)};this._svg.on("mousemove",n),this._svg.on("touchmove",n),this._bindEndActionEvents(()=>this._send(t,!0))}_renderBackground(e){var t=this._svg.select("#background");t.empty()&&(t=this._svg.insert("svg:image",":first-child").attr("id","background").attr("width","100%").attr("height","100%").attr("x",0).attr("y",0)),t.attr("xlink:href",e.url)}_renderShape(e){switch(e.type){case"background":this._backgroundImage=e.url,this._renderBackground(e);break;case"backgroundVideo":this._backgroundVideo=e.source;break;case"line":case"freedraw":this._renderLine(e);break;case"rect":this._renderRect(e);break;case"circle":this._renderCircle(e);break;default:this._renderRemoveShape(e)}}}var ay="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),cy=new Uint8Array(16);function uy(){if(!ay)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ay(cy)}for(var hy=[],ly=0;ly<256;++ly)hy[ly]=(ly+256).toString(16).substr(1);var dy=function(e,t){var n=t||0,i=hy;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")};var py=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||uy)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[i+s]=r[s];return t||dy(r)};class fy{constructor(e){xr(this,"conferenceManager",void 0),this.conferenceManager=e}static of(e){return new fy(e)}callAgent(e,t){var n=this;return s((function*(){var i=yield n.conferenceManager.createConference();yield i.join();var r=n.generateWacAgentUri(),s=yield i.inviteParticipant(r,void 0,e,void 0,void 0,void 0,t);if(s.code<200||s.code>=300)throw new Error("Error calling an agent");return i}))()}generateWacAgentUri(){return"wac-agent:".concat(py())}}var my=Ii.instance.getLogger("SippoJS/Session");class gy extends Oi.EventEmitter2{static withOAuth2(e,t,n){return new gy((n,i)=>n.loginToken(e,t,i),n)}static withSessionToken(e,t){return new gy((t,n)=>t.recoverSession(e,n),t)}constructor(e,t){super(),this.status=w.DISCONNECTED,this.meetingManager=null,this.session=null,this.credential=null,this.wacUri=t.wacUri,this.applicationToken=t.applicationToken,this.deviceId=t.deviceId,this.sessionEstablisher=e,this._promiseQueue=new a,this._boundEvents=!1,this.wacProxy=new dg,this.wacProxy.initialize(this.wacUri),this.userManager=new ts(this.wacProxy),this.setStatus(w.UNCONNECTED),c(this,["onSessionDisconnected","onSessionReconnecting","onSessionReconnected","onDataPipeInvite","onRinging","onInstantMessage","onTransportClose","onConnectionLost","onUnknownClose"])}setStatus(e){return this.status===e?this:(my.info("session status changed from ".concat(w[this.status]," to ").concat(w[e])),this.status=e,this.emit("status",{status:this.status,target:this}),this)}handleDataPipe(e){switch(e.label){case oy.PROTOCOL:new oy(e).init().then(e=>this.emit("incomingWhiteboard",e)).catch(my.error);break;case gg.PROTOCOL:var t=new gg;t._initDatapipe(e).then(()=>{this.emit("incomingSelfie",t)}).catch(my.error);break;default:e.connect().then(()=>this.emit("incomingDataPipe",e)).catch(my.error)}}onDataPipeInvite(e){var t=new Uh(e.id,Lh.INCOMING,this.wacProxy,e.participants,e.label);this.handleDataPipe(t)}onRinging(e){if(e.media&&e.media.data){var t=new Bh(e.callid,Lh.INCOMING,this.wacProxy,[this.getGatewayUsername(),e.userid]);return this.handleDataPipe(t)}}onInstantMessage(e){this.emit("incomingInstantMessage",new xh(kh.INCOMING,this.wacProxy,e.userid,this.getGatewayUsername(),e.text))}bindEventHandlers(){this._boundEvents||(this.wacProxy.on("disconnected",this.onSessionDisconnected),this.wacProxy.on("qs-reconnecting",this.onSessionReconnecting),this.wacProxy.on("qs-reconnected",this.onSessionReconnected),this.wacProxy.getDatapipeService().emitter.on("invite",this.onDataPipeInvite),this.wacProxy.on("qs-ringing",this.onRinging),this.wacProxy.on("qs-instant-message",this.onInstantMessage),this.wacProxy.on("qs-transport-close",this.onTransportClose),this.wacProxy.on("qs-connection-lost",this.onConnectionLost),this.wacProxy.on("qs-unknown-close",this.onUnknownClose),this._boundEvents=!0)}unbindEventHandlers(){this._boundEvents&&(this.wacProxy.off("disconnected",this.onSessionDisconnected),this.wacProxy.off("qs-reconnecting",this.onSessionReconnecting),this.wacProxy.off("qs-reconnected",this.onSessionReconnected),this.wacProxy.getDatapipeService().emitter.off("invite",this.onDataPipeInvite),this.wacProxy.off("qs-ringing",this.onRinging),this.wacProxy.off("qs-instant-message",this.onInstantMessage),this.wacProxy.off("qs-transport-close",this.onTransportClose),this.wacProxy.off("qs-connection-lost",this.onConnectionLost),this.wacProxy.off("qs-unknown-close",this.onUnknownClose),this._boundEvents=!1)}onSessionDisconnected(){my.warn("[SippoJS] Session disconnected"),this.setStatus(w.DISCONNECTED)}onSessionReconnecting(){this.setStatus(w.CONNECTING)}onSessionReconnected(){this.setStatus(w.CONNECTED)}onTransportClose(){my.warn("WAPI transport closed"),this.emit("qs-transport-close")}onUnknownClose(){my.warn("WAPI closed with unknown reason"),this.emit("qs-unknown-close")}onConnectionLost(){my.warn("WAPI connection lost"),this.emit("qs-connection-lost")}connect(){var e=this;return s((function*(){e.setStatus(w.CONNECTING);try{yield e.wacProxy.start();var t=yield e.sessionEstablisher(e.wacProxy,e.deviceId);e.userManager.init(),e.session=t.session,e.deviceId||(e.deviceId=e.session.context.deviceId),e.wacProxy.retainSession(e.session);var n=t.credential?[t.credential]:yield e.wacProxy.getCredentials({type:"ims",user:e.session.user});if(n.length&&n[0].data){e.wacProxy.retainCredential(n[0]);var i=n[0].data;i.wacUri=e.wacUri,i.token=e.session.token,i.applicationToken=e.applicationToken,yield e.wacProxy.register(i,{deviceId:e.deviceId}),e.credential=i}else my.warn("No credentials for this user. No stack will be used. Only wac");return e.bindEventHandlers(),e.user=vg.newInstance(e.wacProxy),yield e.user.init(),e.setStatus(w.CONNECTED),e}catch(t){try{yield e.disconnect()}catch(e){my.error("Error disconnecting",e)}if(t instanceof x)throw new k("UNAUTHORIZED");if(t instanceof j)throw new k("WAC_INTERNAL_ERROR");if(t instanceof I)throw new k("STACK_REGISTER_ERROR");if(t instanceof T)throw new k("ALREADY_LOGGED");throw t}}))()}getGatewayUsername(){return this.credential.username}getAlias(){return this.credential.alias}getSessionToken(){return this.session.token}createWhiteboard(e){return new oy(this.createDataPipe(e,oy.PROTOCOL)).init()}createSelfie(e){var t=new gg;return t._initDatapipe(this.createDataPipe([e],gg.PROTOCOL)).then(()=>t)}createDataPipe(e,t){if(!(e instanceof Array))throw new TypeError("".concat(e," is not an Array"));return e.includes(this.getGatewayUsername())||e.push(this.getGatewayUsername()),class{static create(e,t,n,i,r){return n.getCapabilities().includes("datapipe")?new Uh(e,t,n,i,r):new Bh(e,t,n,i,r)}}.create(void 0,Lh.OUTGOING,this.wacProxy,e,t)}createInstantMessage(e,t){return new xh(this.wacProxy,kh.OUTGOING,this.getGatewayUsername(),e,t)}getCallManager(){return this.callManager||(this.callManager=Zu.newInstance(this.wacProxy,this.userManager,this.credential.username)),this.callManager}getConferenceManager(){return this.conferenceManager||(this.conferenceManager=wh.newInstance(this.wacProxy,this.userManager)),this.conferenceManager}getUserManager(){return this.userManager}getChatManager(){var e=this;return s((function*(){if(!e.chatManager){var t=e.wacProxy.getChatService(),n=yield e.getFileManager(),i=e.getUser();e.chatManager=Gr.newInstance(t,n,i,e.getSessionToken())}return e.chatManager}))()}getFileManager(){var e=this;return s((function*(){if(!e.fileManager){var t=e.wacProxy.getFileSharingService();e.fileManager=nc.newInstance(t)}return e.fileManager}))()}getContactManager(){return void 0===this.contactManager&&(this.contactManager=new Xa(this.wacProxy,this.userManager,this.getPresenceManager())),this.contactManager}getRemoteSessions(){return Promise.resolve().then(()=>this.getCapabilities().includes("list-remote")?this.wacProxy.getRemoteSessions():this.wacProxy.getSessions({to:-1}).then(e=>e.filter(e=>e.id!==this.session.id).map(e=>(e.name="wac",e)))).then(e=>e.map(e=>new $u(e.id,e.name)))}getUser(){return this.user}getLogger(e){return Ii.instance.getLogger(e)}getMeetingList(){return this.getMeetingManager()}getMeetingManager(){return null===this.meetingManager&&(this.meetingManager=new Oh(this.wacProxy.getMeetingService())),this.meetingManager}getGroupManager(){if(void 0===this.groupManager&&this.getCapabilities().includes("user-group")){var e=this.wacProxy.getGroupService(),t=this.wacProxy.getPhonebookService(),n=this.getUserManager();this.groupManager=Eh.newInstance(e,t,n)}return this.groupManager}getPresenceManager(){if(!this.presenceManager){var e=this.wacProxy.getPresenceService();this.presenceManager=mg.of(e)}return this.presenceManager}getSupportService(){return this.supportService||(this.supportService=fy.of(this.getConferenceManager())),this.supportService}checkConnection(e="udp"){if(!this.getCapabilities().includes("network-reporting"))throw Error("Network reporting is not supported");return this.wacProxy.checkConnection(e)}getVersion(){return[{name:"SippoJS",version:o}].concat(this.wacProxy.getVersion())}getCapabilities(){return this.wacProxy.getCapabilities()}settings(){return this.wacProxy.getSettings()}setSetting(e,t){return this.wacProxy.setSetting(e,t),this}disconnect(){var e=this;return s((function*(){if(e.status===w.DISCONNECTED)return Promise.reject(Error("Session is already disconnected"));e.unbindEventHandlers();try{e.groupManager&&(yield e.groupManager).uninit(),e.chatManager&&(yield e.chatManager).uninit(),yield e.wacProxy.stop()}catch(e){if(e instanceof O)throw new k("STACK_UNREGISTER_ERROR");throw e}finally{e.setStatus(w.DISCONNECTED)}}))()}_suspend(){var e=this;return s((function*(){return e.status===w.CONNECTED&&(yield e.wacProxy.suspendSession(),e.setStatus(w.SUSPENDED),!0)}))()}_resume(){var e=this;return s((function*(){return e.status===w.SUSPENDED&&(yield e.wacProxy.resumeSession(),e.setStatus(w.CONNECTED),!0)}))()}suspend(){return this._promiseQueue.queue(this._suspend.bind(this),"suspend")}resume(){return this._promiseQueue.queue(this._resume.bind(this),"resume")}getStatus(){return this.status}notifyPushToken(e,t,...n){return 1===n.length&&(my.warn('Only two arguments expected: Current method signature is "session.notifyPushToken(tokenType, token)"'),e=t,t=n[0]),this.wacProxy.getPushNotificationsService().notifyToken(this.deviceId,e,t)}destroyPushToken(){return this.wacProxy.getPushNotificationsService().destroyToken(this.deviceId)}}function vy(e,t,n){var i=gy.withOAuth2(e,t,n);return Promise.resolve(i)}function yy(e,t){var n=gy.withSessionToken(e,t);return Promise.resolve(n)}function by(e){return window.fetch("".concat(e,"/sapi/oauth2/providers")).then(e=>e.json())}n.d(t,"createSession",(function(){return vy})),n.d(t,"recoverSession",(function(){return yy})),n.d(t,"getAuthProviders",(function(){return by})),n.d(t,"StreamRecorder",(function(){return Pu})),n.d(t,"StreamRecorderStatus",(function(){return Au})),n.d(t,"InstantMessageType",(function(){return kh})),n.d(t,"DataPipeStatus",(function(){return jh})),n.d(t,"DataPipeType",(function(){return Lh})),n.d(t,"CallStatus",(function(){return Gu})),n.d(t,"CallDirection",(function(){return Lu})),n.d(t,"CallEndReason",(function(){return Bu})),n.d(t,"Conference",(function(){return gh})),n.d(t,"ConferenceManager",(function(){return wh})),n.d(t,"ConferenceStatus",(function(){return th})),n.d(t,"ConferenceEndReason",(function(){return eh})),n.d(t,"ChatType",(function(){return _r})),n.d(t,"ChatParticipantState",(function(){return Sr})),n.d(t,"ChatParticipantRole",(function(){return wr})),n.d(t,"ChatMessageDirection",(function(){return gr})),n.d(t,"ChatMessageStatus",(function(){return vr})),n.d(t,"ChatMessageType",(function(){return yr})),n.d(t,"FileUploadStatus",(function(){return fr})),n.d(t,"PresenceActivity",(function(){return Wr})),n.d(t,"PresenceMood",(function(){return Hr})),n.d(t,"SessionError",(function(){return k})),n.d(t,"SessionStatus",(function(){return w})),n.d(t,"ManagedStream",(function(){return Du})),n.d(t,"LocalMediaHandler",(function(){return Fu}))}])}));
//# sourceMappingURL=Sippo.js.map